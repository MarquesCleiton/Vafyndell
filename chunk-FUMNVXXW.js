import{a as ie}from"./chunk-XQNWO7VY.js";import{a as ne}from"./chunk-SSYR3IKG.js";import{c as j,f as R,g as q,h as U,i as H,j as G,k as Z,m as X,n as J,o as K,p as Q,q as Y,r as $}from"./chunk-Y76CBAMU.js";import{a as te}from"./chunk-2FJKFAQG.js";import{f as I,g as B,m as L,t as W,v as z,z as ee}from"./chunk-QALXKQRA.js";import{Ab as u,Bb as i,Cb as n,Db as N,Hb as M,Ib as E,Jb as w,Nb as g,Pb as f,Sa as P,Ua as d,Za as y,Zb as S,a as h,bc as l,cc as V,eb as O,ec as D,g as v,gc as _,hc as b,ic as C,jb as x,jc as F,la as p,ma as m,nb as A,qc as T,za as k}from"./chunk-HRDPHWQR.js";function re(s,r){if(s&1){let t=w();M(0),N(1,"img",28),i(2,"button",29),g("click",function(){p(t);let a=f();return m(a.removerImagem())}),l(3,"\u2716"),n(),E()}if(s&2){let t=f();d(),u("src",t.imagemBase64Temp||t.npc.imagem,P)}}function le(s,r){if(s&1){let t=w();i(0,"label",30)(1,"span",31),l(2,"\u{1F4F7}"),n(),i(3,"input",32),g("change",function(a){p(t);let c=f();return m(c.onFileChange(a))}),n()()}}function se(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let t=r.$implicit;d(),V(t)}}function ce(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let t=r.$implicit;d(),V(t)}}function de(s,r){if(s&1){let t=w();i(0,"div",33)(1,"div",34),l(2),n(),i(3,"div",35)(4,"button",36),g("click",function(){let a=p(t).$implicit,c=f();return m(c.ajustarValor(a.key,-1))}),l(5,"\u2212"),n(),i(6,"input",37),g("ngModelChange",function(a){let c=p(t).$implicit,o=f();return m(o.setValor(c.key,a))}),n(),i(7,"button",36),g("click",function(){let a=p(t).$implicit,c=f();return m(c.ajustarValor(a.key,1))}),l(8,"+"),n()()()}if(s&2){let t=r.$implicit,e=f();d(2),D(" ",t.icon," ",t.label," "),d(4),u("name",F(t.key))("ngModel",e.getValor(t.key))}}function pe(s,r){s&1&&(M(0),l(1,"\u{1F4BE}"),E())}function me(s,r){s&1&&(M(0),N(1,"span",38),E())}var ae=class s{constructor(r,t,e,a){this.router=r;this.route=t;this.el=e;this.zone=a}npc={id:"",imagem:"",nome:"",classificacao:"Inimigo",tipo:"Comum",descricao:"",alinhamento:"",pontos_de_vida:0,classe_armadura:0,forca:0,constituicao:0,destreza:0,sabedoria:0,inteligencia:0,energia:0,ataques:"",xp:0,visivel_jogadores:!1,email:""};imagemBase64Temp=null;salvando=!1;editMode=!1;atributosNumericos=[{key:"xp",label:"XP",icon:"\u2B50"},{key:"pontos_de_vida",label:"Vida",icon:"\u2764\uFE0F"},{key:"classe_armadura",label:"Armadura",icon:"\u{1F6E1}\uFE0F"},{key:"forca",label:"For\xE7a",icon:"\u{1F4AA}"},{key:"constituicao",label:"Constitui\xE7\xE3o",icon:"\u{1FAA8}"},{key:"destreza",label:"Destreza",icon:"\u{1F938}\u200D\u2642\uFE0F"},{key:"sabedoria",label:"Sabedoria",icon:"\u{1F4D6}"},{key:"inteligencia",label:"Intelig\xEAncia",icon:"\u{1F9E0}"},{key:"energia",label:"Energia",icon:"\u26A1"}];classificacoes=["Inimigo","Bestial"];tipos=["Comum","Elite","M\xE1gico","Lend\xE1rio"];repo=new te("NPCs");ngOnInit(){return v(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield this.repo.getLocal()).find(a=>String(a.id)===r);if(e&&(this.npc=h({},e),this.scheduleAutoExpand()),this.repo.sync().then(a=>v(this,null,function*(){if(a){let o=(yield this.repo.getLocal()).find(oe=>String(oe.id)===r);o&&(this.npc=h({},o),this.scheduleAutoExpand())}})),!e){let c=(yield this.repo.forceFetch()).find(o=>String(o.id)===r);c&&(this.npc=h({},c),this.scheduleAutoExpand())}}catch(t){console.error("[CadastroNpc] Erro ao carregar NPC:",t)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(t=>{t.style.height="auto";let e=200;t.style.height=Math.min(t.scrollHeight,e)+"px",t.oninput=()=>{t.style.height="auto",t.style.height=Math.min(t.scrollHeight,e)+"px"}})}getValor(r){return this.npc[r]}setValor(r,t){this.npc[r]=Math.max(0,t)}ajustarValor(r,t){this.setValor(r,this.getValor(r)+t)}onFileChange(r){return v(this,null,function*(){let t=r.target;if(t.files?.length){let e=t.files[0];try{this.imagemBase64Temp=yield ne.toOptimizedBase64(e,.7,1024)}catch(a){console.error("[CadastroNpc] Erro ao otimizar imagem:",a)}}})}removerImagem(){this.npc.imagem="-",this.imagemBase64Temp=null}salvar(r){return v(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let t=ee.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");this.npc.email=t.email;let e=h({},this.npc);if(this.imagemBase64Temp&&(e.imagem=this.imagemBase64Temp),this.editMode){let a=yield this.repo.update(e);this.npc=h({},a),alert("\u2705 NPC atualizado com sucesso!")}else{e.id=ie.generateULID();let a=yield this.repo.create(e);this.npc=h({},a),alert("\u2705 NPC criado com sucesso!")}this.router.navigate(["/npcs"])}catch(t){console.error("[CadastroNpc] Erro ao salvar NPC:",t),alert("\u274C Erro ao salvar NPC. Veja o console.")}finally{this.salvando=!1,this.imagemBase64Temp=null}})}cancelar(){this.editMode&&this.npc?.id?this.router.navigate(["/npc-detalhes",this.npc.id]):this.router.navigate(["/npcs"])}static \u0275fac=function(t){return new(t||s)(y(z),y(W),y(k),y(A))};static \u0275cmp=O({type:s,selectors:[["app-cadastro-npc"]],decls:68,vars:14,consts:[["form","ngForm"],["uploadBox",""],[1,"npc-cadastro-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","pb-5"],["id","formNpc",3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold","mb-3","text-light"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","nome","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","classificacao","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["name","tipo","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","alinhamento",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[1,"fw-bold","mt-4","text-light"],[1,"atributos-grid-edit","mb-3"],["class","atributo-item-edit",4,"ngFor","ngForOf"],["rows","3","name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"mb-3","mt-4"],["rows","3","name","ataques",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],["type","submit","form","formNpc",1,"fab","fab-warning",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"atributo-item-edit"],[1,"atributo-label","text-center"],[1,"atributo-controls"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","min","0",1,"atributo-input",3,"ngModelChange","ngModel","name"],[1,"spinner-border","spinner-border-sm"]],template:function(t,e){if(t&1){let a=w();i(0,"div",2)(1,"div",3)(2,"form",4,0),g("ngSubmit",function(){p(a);let o=S(3);return m(e.salvar(o))}),i(4,"div",5),x(5,re,4,1,"ng-container",6)(6,le,4,0,"ng-template",null,1,T),n(),i(8,"div",7)(9,"div",8)(10,"h4",9),l(11,"\u{1F479} Cadastro de Feras & Vil\xF5es"),n(),i(12,"div",10)(13,"label",11),l(14,"\u{1F64D} Nome *"),n(),i(15,"input",12),C("ngModelChange",function(o){return p(a),b(e.npc.nome,o)||(e.npc.nome=o),m(o)}),n()(),i(16,"div",10)(17,"label",11),l(18,"\u{1F3F7}\uFE0F Classifica\xE7\xE3o *"),n(),i(19,"select",13),C("ngModelChange",function(o){return p(a),b(e.npc.classificacao,o)||(e.npc.classificacao=o),m(o)}),x(20,se,2,1,"option",14),n()(),i(21,"div",10)(22,"label",11),l(23,"\u{1F3AD} Tipo *"),n(),i(24,"select",15),C("ngModelChange",function(o){return p(a),b(e.npc.tipo,o)||(e.npc.tipo=o),m(o)}),x(25,ce,2,1,"option",14),n()(),i(26,"div",10)(27,"label",11),l(28,"\u2696\uFE0F Alinhamento"),n(),i(29,"select",16),C("ngModelChange",function(o){return p(a),b(e.npc.alinhamento,o)||(e.npc.alinhamento=o),m(o)}),i(30,"option",17),l(31,"Selecione..."),n(),i(32,"option"),l(33,"Leal e Bom (Lawful Good)"),n(),i(34,"option"),l(35,"Neutro e Bom (Neutral Good)"),n(),i(36,"option"),l(37,"Ca\xF3tico e Bom (Chaotic Good)"),n(),i(38,"option"),l(39,"Leal e Neutro (Lawful Neutral)"),n(),i(40,"option"),l(41,"Neutro (Neutral)"),n(),i(42,"option"),l(43,"Ca\xF3tico e Neutro (Chaotic Neutral)"),n(),i(44,"option"),l(45,"Leal e Mau (Lawful Evil)"),n(),i(46,"option"),l(47,"Neutro e Mau (Neutral Evil)"),n(),i(48,"option"),l(49,"Ca\xF3tico e Mau (Chaotic Evil)"),n()()(),i(50,"h6",18),l(51,"\u{1F4CA} Atributos Num\xE9ricos"),n(),i(52,"div",19),x(53,de,9,5,"div",20),n(),i(54,"div",10)(55,"label",11),l(56,"\u{1F4DD} Descri\xE7\xE3o"),n(),i(57,"textarea",21),C("ngModelChange",function(o){return p(a),b(e.npc.descricao,o)||(e.npc.descricao=o),m(o)}),n()(),i(58,"div",22)(59,"label",11),l(60,"\u2694\uFE0F Ataques"),n(),i(61,"textarea",23),C("ngModelChange",function(o){return p(a),b(e.npc.ataques,o)||(e.npc.ataques=o),m(o)}),n()()()()()(),i(62,"div",24)(63,"button",25),g("click",function(){return p(a),m(e.cancelar())}),l(64," \u2B05\uFE0F "),n(),i(65,"button",26),x(66,pe,2,0,"ng-container",27)(67,me,2,0,"ng-container",27),n()()()}if(t&2){let a=S(7);d(5),u("ngIf",e.imagemBase64Temp||e.npc.imagem&&e.npc.imagem!=="-")("ngIfElse",a),d(10),_("ngModel",e.npc.nome),d(4),_("ngModel",e.npc.classificacao),d(),u("ngForOf",e.classificacoes),d(4),_("ngModel",e.npc.tipo),d(),u("ngForOf",e.tipos),d(4),_("ngModel",e.npc.alinhamento),d(24),u("ngForOf",e.atributosNumericos),d(4),_("ngModel",e.npc.descricao),d(4),_("ngModel",e.npc.ataques),d(4),u("disabled",e.salvando),d(),u("ngIf",!e.salvando),d(),u("ngIf",e.salvando)}},dependencies:[L,I,B,$,G,J,K,j,Z,X,R,q,Y,Q,H,U],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#dc3545;color:#dc3545}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributos-grid-edit[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}@media (min-width: 768px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (min-width: 992px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}}.atributo-item-edit[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:6px;padding:8px 10px;display:flex;flex-direction:column;align-items:center}.atributo-label[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa;margin-bottom:6px;text-align:center}.atributo-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px}.atributo-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;color:#fff;background:#1e1e1e;border:1px solid #444;border-radius:4px;padding:2px 4px}.atributo-input[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributo-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:2px 8px;font-size:.9rem;line-height:1}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;font-size:1.4rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease,background .2s ease;border:none;cursor:pointer}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}"]})};export{ae as CadastroNpc};
