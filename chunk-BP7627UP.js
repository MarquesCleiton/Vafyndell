import{a as B}from"./chunk-56YLIEVM.js";import{c as R,f as $,i as q,r as N}from"./chunk-SDLLENPQ.js";import{a as w}from"./chunk-VVJ3SDR7.js";import{h as z}from"./chunk-YLUT5PWF.js";import{h as T,i as V,p as j,w as L}from"./chunk-CKJAMVG4.js";import{$b as f,Ab as d,Bb as r,Cb as s,Db as C,Jb as x,Nb as m,Pb as c,Sa as I,Ua as n,Za as P,a as y,ac as O,b as M,bc as g,cc as h,dc as _,eb as k,g as u,gc as E,hc as D,ic as S,jb as p,jc as F,kc as A,la as v,ma as b}from"./chunk-YAKM3PEZ.js";function J(o,i){if(o&1){let t=x();r(0,"li",5)(1,"button",6),m("click",function(){v(t);let a=c();return b(a.selecionarAba("ocultos"))}),g(2," \u{1F648} Ocultos "),s()()}if(o&2){let t=c();n(),f("active",t.abaAtiva==="ocultos")}}function G(o,i){o&1&&(r(0,"div",14),C(1,"div",15),r(2,"p",16),g(3,"Carregando cat\xE1logo..."),s()())}function H(o,i){o&1&&(r(0,"div",17),g(1," Nenhum item encontrado. "),s())}function K(o,i){if(o&1&&C(0,"img",35),o&2){let t=c().$implicit;d("alt",F(t.nome||"Item"))("src",t.imagem,I)}}function Q(o,i){if(o&1&&(r(0,"span",36),g(1),s()),o&2){let t=c().$implicit,e=c(4);n(),_(" ",e.getEmojiFallback(t.categoria)," ")}}function X(o,i){if(o&1&&(r(0,"p",37),g(1),s()),o&2){let t=c().$implicit;n(),_("\u2728 ",t.efeito)}}function Y(o,i){if(o&1&&(r(0,"p",38),g(1),s()),o&2){let t=c().$implicit;n(),_("\u26A0\uFE0F ",t.colateral)}}function Z(o,i){if(o&1&&(r(0,"p",39),g(1),s()),o&2){let t=c().$implicit;n(),_("\u{1F4DD} ",t.descricao)}}function tt(o,i){if(o&1&&(r(0,"span"),g(1),s()),o&2){let t=c(2).$implicit;n(),_(" ",t.visivel_jogadores?"\u{1F648} Ocultar":"\u{1F649} Mostrar"," ")}}function et(o,i){o&1&&C(0,"span",42)}function it(o,i){if(o&1){let t=x();r(0,"button",40),m("click",function(a){v(t);let l=c().$implicit,W=c(4);return b(W.toggleVisibilidade(a,l))}),p(1,tt,2,1,"span",11)(2,et,1,0,"span",41),s()}if(o&2){let t=c().$implicit,e=c(4);d("disabled",e.loadingVisibilidade[t.id]),n(),d("ngIf",!e.loadingVisibilidade[t.id]),n(),d("ngIf",e.loadingVisibilidade[t.id])}}function ot(o,i){if(o&1){let t=x();r(0,"div",24)(1,"div",25),m("click",function(){let a=v(t).$implicit,l=c(4);return b(l.abrirItem(a))}),r(2,"div",26)(3,"div",27),p(4,K,1,3,"img",28)(5,Q,2,1,"span",29),s(),r(6,"div")(7,"h6",30),g(8),s(),r(9,"small"),g(10),s()()(),p(11,X,2,1,"p",31)(12,Y,2,1,"p",32)(13,Z,2,1,"p",33)(14,it,3,3,"button",34),s()()}if(o&2){let t=i.$implicit,e=c(4);n(4),d("ngIf",t.imagem&&t.imagem!=="-"),n(),d("ngIf",!t.imagem||t.imagem==="-"),n(3),h(t.nome||"Sem nome"),n(),O(A("raridade ",e.getRaridadeClass(t.raridade))),n(),_(" ",t.raridade||"Comum"," "),n(),d("ngIf",t.efeito),n(),d("ngIf",t.colateral),n(),d("ngIf",t.descricao),n(),d("ngIf",e.ehMestre)}}function at(o,i){if(o&1&&(r(0,"div",16)(1,"div",22),p(2,ot,15,11,"div",23),s()()),o&2){let t=c().$implicit;n(2),d("ngForOf",t.itens)}}function nt(o,i){if(o&1){let t=x();r(0,"div",19)(1,"button",20),m("click",function(){let a=v(t).$implicit,l=c(2);return b(l.toggleCategoria(a))}),r(2,"span"),g(3),s(),r(4,"span"),g(5),s()(),p(6,at,3,1,"div",21),s()}if(o&2){let t=i.$implicit,e=c(2);d("hidden",e.abaAtiva!=="ocultos"&&!e.pertenceAba(t.nome)),n(3),h(t.nome||"Outros"),n(2),h(t.expandido?"\u2212":"+"),n(),d("ngIf",t.expandido)}}function rt(o,i){if(o&1&&(r(0,"div"),p(1,nt,7,4,"div",18),s()),o&2){let t=c();n(),d("ngForOf",t.categoriasFiltradas)}}var U=class o{constructor(i){this.router=i}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="recursos";repo=new w("Catalogo");jogadorRepo=new w("Personagem");visibilidadeService=new B(this.repo);todosItens=[];ehMestre=!1;loadingVisibilidade={};mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return u(this,null,function*(){this.carregando=!0;try{yield this.definirSeEhMestre(),yield this.loadLocalAndSync()}catch(i){console.error("[Catalogo] Erro ao carregar itens:",i)}finally{this.carregando=!1}})}definirSeEhMestre(){return u(this,null,function*(){let i=L.getUser();if(i?.email){let e=(yield this.jogadorRepo.getLocal()).find(a=>a.email===i.email);this.ehMestre=e?.tipo_jogador==="Mestre",console.log(`[Catalogo] \u{1F451} Usu\xE1rio \xE9 mestre? ${this.ehMestre}`)}})}loadLocalAndSync(){return u(this,null,function*(){console.log("[Catalogo] \u{1F4C2} Carregando itens locais...");let i=yield this.repo.getLocal();if(this.todosItens=i,this.processarItens(this.todosItens),this.repo.sync().then(t=>u(this,null,function*(){if(t){console.log("[Catalogo] \u{1F504} Itens atualizados no servidor, recarregando...");let e=yield this.repo.getLocal();this.todosItens=e,this.processarItens(this.todosItens)}})),i.length===0){console.log("[Catalogo] \u{1F310} Nenhum item local, for\xE7ando fetch online...");let t=yield this.repo.forceFetch();this.todosItens=t,this.processarItens(this.todosItens)}})}processarItens(i){console.log(`[Catalogo] Processando ${i.length} itens...`);let t=new Map(this.categorias.map(a=>[a.nome,a.expandido])),e=new Map;i.filter(a=>this.abaAtiva==="ocultos"?this.ehMestre&&!a.visivel_jogadores:this.ehMestre?!0:a.visivel_jogadores).forEach(a=>{let l=a.categoria||"Outros";e.has(l)||e.set(l,[]),e.get(l).push(a)}),this.categorias=Array.from(e.entries()).sort(([a],[l])=>a.localeCompare(l)).map(([a,l])=>({nome:a,itens:l,expandido:t.get(a)??!1})),this.categoriasFiltradas=[...this.categorias]}aplicarFiltro(){let i=this.normalizarTexto(this.filtro);if(!i){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(t=>{let e=t.itens.filter(a=>[a.nome,a.raridade,a.efeito,a.colateral,a.categoria].map(l=>this.normalizarTexto(String(l||""))).some(l=>l.includes(i)));return M(y({},t),{itens:e,expandido:e.length>0})}).filter(t=>t.itens.length>0)}normalizarTexto(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(i){this.abaAtiva=i,this.processarItens(this.todosItens)}pertenceAba(i){return this.mapaAbas[this.abaAtiva].includes(i)}toggleCategoria(i){i.expandido=!i.expandido}abrirItem(i){this.router.navigate(["/item-catalogo",String(i.id)])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}getRaridadeClass(i){return i?String(i).toLowerCase():"comum"}toggleVisibilidade(i,t){return u(this,null,function*(){if(i.stopPropagation(),!!this.ehMestre){this.loadingVisibilidade[t.id]=!0;try{let e=yield this.visibilidadeService.toggleVisibilidade(t.id);e&&(t.visivel_jogadores=e.visivel_jogadores)}catch(e){console.error("[Catalogo] Erro ao alternar visibilidade:",e)}finally{this.loadingVisibilidade[t.id]=!1}}})}getEmojiFallback(i){if(!i)return"\u{1F4E6}";let t={recursos:"\u{1F33F}",equipamentos:"\u2694\uFE0F",pocoes:"\u{1F9EA}",outros:"\u{1F4E6}",ocultos:"\u{1F648}"};for(let e of Object.keys(this.mapaAbas))if(this.mapaAbas[e].includes(i))return t[e];return"\u{1F4E6}"}static \u0275fac=function(t){return new(t||o)(P(z))};static \u0275cmp=k({type:o,selectors:[["app-catalogo"]],decls:25,vars:13,consts:[[1,"catalogo-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar no cat\xE1logo...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["class","nav-item","role","presentation",4,"ngIf"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"catalogo-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",3,"hidden",4,"ngFor","ngForOf"],[1,"mb-3",3,"hidden"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","catalogo-card","shadow-sm","h-100","p-3","position-relative",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],["class","text-muted fs-4",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],["class","small descricao-text fst-italic",4,"ngIf"],["class","btn btn-sm btn-outline-warning position-absolute bottom-0 end-0 m-2 d-flex align-items-center gap-1",3,"disabled","click",4,"ngIf"],[3,"src","alt"],[1,"text-muted","fs-4"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[1,"small","descricao-text","fst-italic"],[1,"btn","btn-sm","btn-outline-warning","position-absolute","bottom-0","end-0","m-2","d-flex","align-items-center","gap-1",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"div",1)(2,"input",2),S("ngModelChange",function(l){return D(e.filtro,l)||(e.filtro=l),l}),m("input",function(){return e.aplicarFiltro()}),s()(),r(3,"ul",3),p(4,J,3,2,"li",4),r(5,"li",5)(6,"button",6),m("click",function(){return e.selecionarAba("recursos")}),g(7," \u{1F33F} Recursos "),s()(),r(8,"li",5)(9,"button",6),m("click",function(){return e.selecionarAba("equipamentos")}),g(10," \u2694\uFE0F Equipamentos "),s()(),r(11,"li",5)(12,"button",6),m("click",function(){return e.selecionarAba("pocoes")}),g(13," \u{1F9EA} Po\xE7\xF5es "),s()(),r(14,"li",5)(15,"button",6),m("click",function(){return e.selecionarAba("outros")}),g(16," \u{1F4E6} Outros "),s()()(),r(17,"div",7)(18,"div",8),p(19,G,4,0,"div",9)(20,H,2,0,"div",10)(21,rt,2,1,"div",11),s()(),r(22,"div",12)(23,"button",13),m("click",function(){return e.novoItem()}),g(24,"\uFF0B"),s()()()),t&2&&(n(2),E("ngModel",e.filtro),n(2),d("ngIf",e.ehMestre),n(2),f("active",e.abaAtiva==="recursos"),n(3),f("active",e.abaAtiva==="equipamentos"),n(3),f("active",e.abaAtiva==="pocoes"),n(3),f("active",e.abaAtiva==="outros"),n(4),d("ngIf",e.carregando),n(),d("ngIf",!e.carregando&&e.categoriasFiltradas.length===0),n(),d("ngIf",!e.carregando))},dependencies:[j,T,V,N,R,$,q],styles:[".nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid #444}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600}.catalogo-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.catalogo-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#f8f9fa;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40;color:#fff}.catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease;color:#f1f1f1}.catalogo-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-thumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#bbb}.catalogo-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.catalogo-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ddd}.catalogo-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e0e0e0;white-space:pre-line}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.catalogo-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}"]})};export{U as Catalogo};
