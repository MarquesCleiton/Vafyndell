import{a as J}from"./chunk-QWKS73CC.js";import{a as h}from"./chunk-QXDASCMK.js";import{r as T}from"./chunk-CWQYRPQ6.js";import"./chunk-2CFPKSUU.js";import{f as B,g as j,j as S,s as F}from"./chunk-YWTK67XE.js";import{$b as b,Db as v,Eb as C,Fb as O,Jb as x,Lb as g,Pa as w,Qa as i,Va as P,Vb as y,Zb as s,_b as E,ab as I,ac as D,d as _,fb as p,fc as k,ia as f,ja as u,lc as M,wb as r,xb as o,yb as c,zb as m}from"./chunk-DIJLFEPN.js";function N(n,e){n&1&&(o(0,"div",8),m(1,"div",9),o(2,"p",10),s(3,"Carregando jogadores..."),c()())}function R(n,e){n&1&&(o(0,"span",33),s(1,"\u{1F480}"),c())}function $(n,e){if(n&1&&m(0,"img",34),n&2){let t=g().$implicit;r("alt",k(t.personagem))("src",t.imagem,w)}}function U(n,e){n&1&&(o(0,"span",20),s(1,"\u{1F464}"),c())}function L(n,e){if(n&1&&(o(0,"span"),s(1),c()),n&2){let t=g().$implicit;i(),b("| ",t.tipo)}}function z(n,e){n&1&&(v(0),m(1,"span",36),C())}function A(n,e){n&1&&s(0,"\u{1F5D1}\uFE0F")}function q(n,e){if(n&1){let t=O();o(0,"button",35),x("click",function(){f(t);let l=g().$implicit,d=g(2);return u(d.excluirNpcDaBatalha(l))}),p(1,z,2,0,"ng-container",31)(2,A,1,0,"ng-template",null,2,M),c()}if(n&2){let t=y(3),a=g().$implicit,l=g(2);r("disabled",l.processando[a.id]==="excluir"),i(),r("ngIf",l.processando[a.id]==="excluir")("ngIfElse",t)}}function Y(n,e){n&1&&m(0,"div",37)}function G(n,e){n&1&&(v(0),m(1,"span",36),C())}function H(n,e){n&1&&s(0,"\u{1F48A}")}function K(n,e){n&1&&(v(0),m(1,"span",36),C())}function Q(n,e){n&1&&s(0,"\u2694\uFE0F")}function W(n,e){if(n&1){let t=O();o(0,"div",12),x("click",function(){let l=f(t).$implicit,d=g(2);return u(d.abrirDetalhes(l))}),o(1,"div",13)(2,"div",14),p(3,R,2,0,"span",15)(4,$,1,3,"img",16)(5,U,2,0,"span",17),c(),o(6,"div",18)(7,"h6",19),s(8),c(),o(9,"small",20),s(10),p(11,L,2,1,"span",6),c()(),o(12,"div",21),x("click",function(l){return f(t),u(l.stopPropagation())}),o(13,"div",22)(14,"div",23),s(15),c(),o(16,"div",24),s(17),c()(),o(18,"div",25),s(19),c(),o(20,"div",26)(21,"div",27),p(22,q,4,3,"button",28)(23,Y,1,0,"div",29),c(),o(24,"div",27)(25,"button",30),x("click",function(){let l=f(t).$implicit,d=g(2);return u(d.acaoRecuperacao(l))}),p(26,G,2,0,"ng-container",31)(27,H,1,0,"ng-template",null,0,M),c()(),o(29,"div")(30,"button",32),x("click",function(){let l=f(t).$implicit,d=g(2);return u(d.acaoEspada(l))}),p(31,K,2,0,"ng-container",31)(32,Q,1,0,"ng-template",null,1,M),c()()()()()()}if(n&2){let t=e.$implicit,a=y(28),l=y(33),d=g(2);i(3),r("ngIf",d.JogadorUtils.estaMorto(t)),i(),r("ngIf",t.imagem&&!d.JogadorUtils.estaMorto(t)),i(),r("ngIf",!t.imagem&&!d.JogadorUtils.estaMorto(t)),i(3),E(t.personagem),i(2),b(" ",t.classificacao||"Jogador"," "),i(),r("ngIf",t.tipo),i(4),D(" \u2764\uFE0F ",d.JogadorUtils.getVidaAtual(t),"/",d.JogadorUtils.getVidaBase(t)," "),i(2),b("\u{1F6E1}\uFE0F ",t.classe_de_armadura),i(2),b(" \u{1F4A5} Dano: ",t.dano_tomado||0," "),i(3),r("ngIf",!t.email),i(),r("ngIf",t.email),i(2),r("disabled",d.processando[t.id]==="recuperar"),i(),r("ngIf",d.processando[t.id]==="recuperar")("ngIfElse",a),i(4),r("disabled",d.processando[t.id]==="espada"),i(),r("ngIf",d.processando[t.id]==="espada")("ngIfElse",l)}}function X(n,e){if(n&1&&(o(0,"div"),p(1,W,34,18,"div",11),c()),n&2){let t=g();i(),r("ngForOf",t.jogadoresFiltrados)}}function Z(n,e){n&1&&(o(0,"div",38),s(1," Nenhum jogador encontrado. "),c())}var V=class n{constructor(e){this.router=e}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=J;ngOnInit(){return _(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let e=yield h.getLocalJogadores();if(e.length>0&&(this.jogadores=e,this.aplicarFiltro(),this.carregando=!1),_(this,null,function*(){if(yield h.syncJogadores()){let a=yield h.getLocalJogadores();this.jogadores=a,this.aplicarFiltro()}}),!e.length){let t=yield h.forceFetchJogadores();this.jogadores=t,this.aplicarFiltro(),this.carregando=!1}}catch(e){console.error("[Batalha] Erro ao carregar jogadores:",e),this.carregando=!1}})}aplicarFiltro(){let e=this.filtro.toLowerCase().trim();if(!e){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(t=>String(t.personagem||"").toLowerCase().includes(e)||String(t.nome_do_jogador||"").toLowerCase().includes(e)||String(t.classificacao||"").toLowerCase().includes(e)||String(t.tipo||"").toLowerCase().includes(e))}abrirDetalhes(e){return _(this,null,function*(){this.processando[e.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",e.id]),this.processando[e.id]=null},400)})}acaoEspada(e){return _(this,null,function*(){this.processando[e.id]="espada",setTimeout(()=>{this.router.navigate(["/combate",e.id]),this.processando[e.id]=null},400)})}acaoRecuperacao(e){return _(this,null,function*(){this.processando[e.id]="recuperar",setTimeout(()=>{this.router.navigate(["/recuperacao",e.id]),this.processando[e.id]=null},400)})}excluirNpcDaBatalha(e){return _(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${e.personagem}" do campo de batalha?`)){this.processando[e.id]="excluir";try{yield h.deleteJogador(e.id),this.jogadores=this.jogadores.filter(a=>a.id!==e.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(a){console.error("[Batalha] Erro ao excluir NPC:",a),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[e.id]=null}}})}static \u0275fac=function(t){return new(t||n)(P(F))};static \u0275cmp=I({type:n,selectors:[["app-batalha"]],decls:5,vars:3,consts:[["recuperarIcon",""],["espadaIcon",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["class","fs-3",4,"ngIf"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger","fw-bold"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[1,"fs-3"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(t,a){t&1&&(o(0,"div",3)(1,"div",4),p(2,N,4,0,"div",5)(3,X,2,1,"div",6)(4,Z,2,0,"div",7),c()()),t&2&&(i(2),r("ngIf",a.carregando),i(),r("ngIf",!a.carregando&&a.jogadoresFiltrados.length>0),i(),r("ngIf",!a.carregando&&a.jogadoresFiltrados.length===0))},dependencies:[S,B,j,T],styles:[".catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem;border:1px solid rgba(255,255,255,.05)}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d26;border-radius:.5rem;padding:.75rem 1rem;text-align:center;margin-bottom:1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d;width:50px;height:50px;object-fit:cover}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#6c757d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff}"]})};export{V as Batalha};
