import{a as U}from"./chunk-56YLIEVM.js";import{c as $,f as R,i as B,s as W}from"./chunk-IQUV2DCR.js";import{a as N}from"./chunk-SL4CV3BB.js";import{h as L}from"./chunk-XMJCILQE.js";import{h as j,i as A,p as z,w as J}from"./chunk-ZOZAG657.js";import{$b as h,Ab as d,Bb as o,Cb as s,Db as x,Hb as E,Ib as O,Jb as b,Nb as _,Pb as p,Sa as P,Ua as r,Za as k,a as y,b as M,bc as l,cc as g,dc as w,eb as D,ec as S,g as f,gc as I,hc as F,ic as T,jb as m,jc as V,la as u,ma as v}from"./chunk-YAKM3PEZ.js";function G(n,i){if(n&1){let e=b();o(0,"li",5)(1,"button",6),_("click",function(){u(e);let a=p();return v(a.selecionarAba("ocultos"))}),l(2," \u{1F648} Ocultos "),s()()}if(n&2){let e=p();r(),h("active",e.abaAtiva==="ocultos")}}function H(n,i){n&1&&(o(0,"div",15),x(1,"div",16),o(2,"p",17),l(3,"Carregando NPCs..."),s()())}function K(n,i){n&1&&(o(0,"div",18),l(1," Nenhum NPC encontrado. "),s())}function Q(n,i){if(n&1&&x(0,"img",36),n&2){let e=p().$implicit;d("alt",V(e.nome))("src",e.imagem,P)}}function X(n,i){n&1&&(o(0,"span"),l(1,"\u{1F479}"),s())}function Y(n,i){if(n&1&&(o(0,"p",37),l(1),s()),n&2){let e=p().$implicit;r(),w(" ",e.descricao," ")}}function Z(n,i){if(n&1&&(o(0,"span"),l(1),s()),n&2){let e=p(2).$implicit;r(),w(" ",e.visivel_jogadores?"\u{1F648} Ocultar":"\u{1F649} Mostrar"," ")}}function ee(n,i){n&1&&x(0,"span",40)}function te(n,i){if(n&1){let e=b();o(0,"button",38),_("click",function(a){u(e);let c=p().$implicit,C=p(4);return v(C.toggleVisibilidade(a,c))}),m(1,Z,2,1,"span",12)(2,ee,1,0,"span",39),s()}if(n&2){let e=p().$implicit,t=p(4);d("disabled",t.loadingVisibilidade[e.id]),r(),d("ngIf",!t.loadingVisibilidade[e.id]),r(),d("ngIf",t.loadingVisibilidade[e.id])}}function ie(n,i){if(n&1){let e=b();o(0,"div",26)(1,"div",27),_("click",function(){let a=u(e).$implicit,c=p(4);return v(c.abrirItem(a))}),o(2,"div",28)(3,"div",29),m(4,Q,1,3,"img",30)(5,X,2,0,"span",12),s(),o(6,"div")(7,"h6",31),l(8),s(),o(9,"small",32),l(10),s()()(),o(11,"p",33),l(12," \u2764\uFE0F "),o(13,"b"),l(14),s(),l(15," | \u{1F6E1}\uFE0F "),o(16,"b"),l(17),s(),l(18," | \u2B50 "),o(19,"b"),l(20),s()(),m(21,Y,2,1,"p",34)(22,te,3,3,"button",35),s()()}if(n&2){let e=i.$implicit,t=p(4);r(4),d("ngIf",e.imagem&&e.imagem!=="-"),r(),d("ngIf",!e.imagem||e.imagem==="-"),r(3),g(e.nome),r(2),S(" ",e.tipo||"\u2014"," | ",e.alinhamento||"Sem alinhamento"," "),r(4),g(e.pontos_de_vida),r(3),g(e.classe_armadura),r(3),g(e.xp),r(),d("ngIf",e.descricao),r(),d("ngIf",t.ehMestre)}}function ne(n,i){if(n&1&&(o(0,"div",17)(1,"div",24),m(2,ie,23,10,"div",25),s()()),n&2){let e=p().$implicit;r(2),d("ngForOf",e.itens)}}function ae(n,i){if(n&1){let e=b();E(0),o(1,"div",20)(2,"button",21),_("click",function(){let a=u(e).$implicit,c=p(2);return v(c.toggleCategoria(a))}),o(3,"span",22),l(4),s(),o(5,"span"),l(6),s()(),m(7,ne,3,1,"div",23),s(),O()}if(n&2){let e=i.$implicit;r(4),g(e.nome),r(2),g(e.expandido?"\u2212":"+"),r(),d("ngIf",e.expandido)}}function oe(n,i){if(n&1&&(o(0,"div"),m(1,ae,8,3,"ng-container",19),s()),n&2){let e=p();r(),d("ngForOf",e.categoriasFiltradas)}}var q=class n{constructor(i){this.router=i}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="bestiais";repo=new N("NPCs");jogadorRepo=new N("Personagem");todosNpcs=[];visibilidadeService=new U(this.repo);loadingVisibilidade={};ehMestre=!1;ngOnInit(){return f(this,null,function*(){this.carregando=!0;try{yield this.definirSeEhMestre(),yield this.loadLocalAndSync()}catch(i){console.error("[Npcs] Erro ao carregar NPCs:",i)}finally{this.carregando=!1}})}definirSeEhMestre(){return f(this,null,function*(){let i=J.getUser();if(i?.email){let t=(yield this.jogadorRepo.getLocal()).find(a=>a.email===i.email);this.ehMestre=t?.tipo_jogador==="Mestre"}})}loadLocalAndSync(){return f(this,null,function*(){let i=yield this.repo.getLocal();if(this.todosNpcs=i,this.processarCategorias(this.todosNpcs),this.repo.sync().then(e=>f(this,null,function*(){if(e){let t=yield this.repo.getLocal();this.todosNpcs=t,this.processarCategorias(this.todosNpcs)}})),i.length===0){let e=yield this.repo.forceFetch();this.todosNpcs=e,this.processarCategorias(this.todosNpcs)}})}processarCategorias(i){let e=new Map(this.categorias.map(a=>[a.nome,a.expandido])),t=new Map;i.filter(a=>{if(this.abaAtiva==="ocultos")return this.ehMestre&&!a.visivel_jogadores;let c=this.abaAtiva==="bestiais"?a.classificacao==="Bestial":a.classificacao==="Inimigo",C=this.ehMestre?!0:a.visivel_jogadores;return c&&C}).forEach(a=>{let c=a.tipo||"Comum";t.has(c)||t.set(c,[]),t.get(c).push(a)}),this.categorias=Array.from(t.entries()).sort(([a],[c])=>this.ordemTipos(a)-this.ordemTipos(c)).map(([a,c])=>({nome:a,itens:c,expandido:e.get(a)??!1})),this.categoriasFiltradas=[...this.categorias]}ordemTipos(i){let t=["Comum","Elite","M\xE1gico","Lend\xE1rio"].indexOf(i);return t>=0?t:999}aplicarFiltro(){let i=this.normalizarTexto(this.filtro);if(!i){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>{let t=e.itens.filter(a=>[a.nome,a.tipo,a.descricao,a.alinhamento,a.classificacao].map(c=>this.normalizarTexto(String(c||""))).some(c=>c.includes(i)));return M(y({},e),{itens:t,expandido:t.length>0})}).filter(e=>e.itens.length>0)}normalizarTexto(i){return i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(i){this.abaAtiva=i,this.processarCategorias(this.todosNpcs)}toggleCategoria(i){i.expandido=!i.expandido}abrirItem(i){this.router.navigate(["/npc-detalhes",i.id])}novoNpc(){this.router.navigate(["/cadastro-npc"])}toggleVisibilidade(i,e){return f(this,null,function*(){if(i.stopPropagation(),!!this.ehMestre){this.loadingVisibilidade[e.id]=!0;try{let t=yield this.visibilidadeService.toggleVisibilidade(e.id);t&&(e.visivel_jogadores=t.visivel_jogadores)}catch(t){console.error("[Npcs] Erro ao alternar visibilidade:",t)}finally{this.loadingVisibilidade[e.id]=!1}}})}static \u0275fac=function(e){return new(e||n)(k(L))};static \u0275cmp=D({type:n,selectors:[["app-npcs"]],decls:21,vars:9,consts:[[1,"npc-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar NPCs...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["class","nav-item",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"npc-container","w-100"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],[4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","npc-card","shadow-sm","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-secondary"],[1,"small","mb-1","text-info"],["class","text-white small descricao-text fst-italic",4,"ngIf"],["class","btn btn-sm btn-outline-warning position-absolute bottom-0 end-0 m-2 d-flex align-items-center gap-1",3,"disabled","click",4,"ngIf"],[3,"src","alt"],[1,"text-white","small","descricao-text","fst-italic"],[1,"btn","btn-sm","btn-outline-warning","position-absolute","bottom-0","end-0","m-2","d-flex","align-items-center","gap-1",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),T("ngModelChange",function(c){return F(t.filtro,c)||(t.filtro=c),c}),_("input",function(){return t.aplicarFiltro()}),s()(),o(3,"ul",3),m(4,G,3,2,"li",4),o(5,"li",5)(6,"button",6),_("click",function(){return t.selecionarAba("bestiais")}),l(7," \u{1F43E} Bestiais "),s()(),o(8,"li",5)(9,"button",6),_("click",function(){return t.selecionarAba("inimigos")}),l(10," \u2694\uFE0F Inimigos "),s()()(),o(11,"div",7)(12,"div",8)(13,"h4",9),l(14,"\u{1F479} Feras & Vil\xF5es"),s(),m(15,H,4,0,"div",10)(16,K,2,0,"div",11)(17,oe,2,1,"div",12),s()(),o(18,"div",13)(19,"button",14),_("click",function(){return t.novoNpc()}),l(20,"\uFF0B"),s()()()),e&2&&(r(2),I("ngModel",t.filtro),r(2),d("ngIf",t.ehMestre),r(2),h("active",t.abaAtiva==="bestiais"),r(3),h("active",t.abaAtiva==="inimigos"),r(6),d("ngIf",t.carregando),r(),d("ngIf",!t.carregando&&t.categoriasFiltradas.length===0),r(),d("ngIf",!t.carregando))},dependencies:[z,j,A,W,$,R,B],styles:[".npc-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.npc-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:20px;padding:.5rem 1rem}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.npc-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease}.npc-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.npc-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.npc-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#cfcfcf!important}.descricao-text[_ngcontent-%COMP%]{color:#e0e0e0!important;white-space:pre-line;line-height:1.4;font-size:.9rem}.item-thumb[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden;color:#cfcfcf}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.npc-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}"]})};export{q as Npcs};
