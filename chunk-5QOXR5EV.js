import{a as J}from"./chunk-QWKS73CC.js";import{r as F}from"./chunk-63E4UXQ5.js";import{a as T}from"./chunk-SPQF6BCK.js";import{f as k,g as B,j,s as S}from"./chunk-S65SB5BW.js";import{$b as h,Db as b,Eb as v,Fb as M,Jb as x,Lb as p,Pa as O,Qa as a,Va as y,Vb as C,Zb as s,_b as I,ab as P,ac as E,d as m,fb as g,fc as D,ia as f,ja as u,mc as w,wb as r,xb as o,yb as c,zb as _}from"./chunk-QQSIVCMV.js";function N(n,t){n&1&&(o(0,"div",9),_(1,"div",10),o(2,"p",11),s(3,"Carregando jogadores..."),c()())}function R(n,t){n&1&&(o(0,"span",34),s(1,"\u{1F480}"),c())}function $(n,t){if(n&1&&_(0,"img",35),n&2){let e=p().$implicit;r("alt",D(e.personagem))("src",e.imagem,O)}}function U(n,t){n&1&&(o(0,"span",21),s(1,"\u{1F464}"),c())}function L(n,t){if(n&1&&(o(0,"span"),s(1),c()),n&2){let e=p().$implicit;a(),h("| ",e.tipo)}}function z(n,t){n&1&&(b(0),_(1,"span",37),v())}function A(n,t){n&1&&s(0,"\u{1F5D1}\uFE0F")}function q(n,t){if(n&1){let e=M();o(0,"button",36),x("click",function(){f(e);let d=p().$implicit,l=p(2);return u(l.excluirNpcDaBatalha(d))}),g(1,z,2,0,"ng-container",32)(2,A,1,0,"ng-template",null,2,w),c()}if(n&2){let e=C(3),i=p().$implicit,d=p(2);r("disabled",d.processando[i.id]==="excluir"),a(),r("ngIf",d.processando[i.id]==="excluir")("ngIfElse",e)}}function Y(n,t){n&1&&_(0,"div",38)}function G(n,t){n&1&&(b(0),_(1,"span",37),v())}function H(n,t){n&1&&s(0,"\u{1F48A}")}function K(n,t){n&1&&(b(0),_(1,"span",37),v())}function Q(n,t){n&1&&s(0,"\u2694\uFE0F")}function W(n,t){if(n&1){let e=M();o(0,"div",13),x("click",function(){let d=f(e).$implicit,l=p(2);return u(l.abrirDetalhes(d))}),o(1,"div",14)(2,"div",15),g(3,R,2,0,"span",16)(4,$,1,3,"img",17)(5,U,2,0,"span",18),c(),o(6,"div",19)(7,"h6",20),s(8),c(),o(9,"small",21),s(10),g(11,L,2,1,"span",7),c()(),o(12,"div",22),x("click",function(d){return f(e),u(d.stopPropagation())}),o(13,"div",23)(14,"div",24),s(15),c(),o(16,"div",25),s(17),c()(),o(18,"div",26),s(19),c(),o(20,"div",27)(21,"div",28),g(22,q,4,3,"button",29)(23,Y,1,0,"div",30),c(),o(24,"div",28)(25,"button",31),x("click",function(){let d=f(e).$implicit,l=p(2);return u(l.acaoRecuperacao(d))}),g(26,G,2,0,"ng-container",32)(27,H,1,0,"ng-template",null,0,w),c()(),o(29,"div")(30,"button",33),x("click",function(){let d=f(e).$implicit,l=p(2);return u(l.acaoEspada(d))}),g(31,K,2,0,"ng-container",32)(32,Q,1,0,"ng-template",null,1,w),c()()()()()()}if(n&2){let e=t.$implicit,i=C(28),d=C(33),l=p(2);a(3),r("ngIf",l.JogadorUtils.estaMorto(e)),a(),r("ngIf",e.imagem&&e.imagem!=="-"&&!l.JogadorUtils.estaMorto(e)),a(),r("ngIf",(!e.imagem||e.imagem==="-")&&!l.JogadorUtils.estaMorto(e)),a(3),I(e.personagem),a(2),h(" ",e.classificacao||"Jogador"," "),a(),r("ngIf",e.tipo),a(4),E(" \u2764\uFE0F ",l.JogadorUtils.getVidaAtual(e),"/",l.JogadorUtils.getVidaBase(e)," "),a(2),h("\u{1F6E1}\uFE0F ",e.classe_de_armadura),a(2),h(" \u{1F4A5} Dano: ",e.dano_tomado||0," "),a(3),r("ngIf",!e.email),a(),r("ngIf",e.email),a(2),r("disabled",l.processando[e.id]==="recuperar"),a(),r("ngIf",l.processando[e.id]==="recuperar")("ngIfElse",i),a(4),r("disabled",l.processando[e.id]==="espada"),a(),r("ngIf",l.processando[e.id]==="espada")("ngIfElse",d)}}function X(n,t){if(n&1&&(o(0,"div"),g(1,W,34,18,"div",12),c()),n&2){let e=p();a(),r("ngForOf",e.jogadoresFiltrados)}}function Z(n,t){n&1&&(o(0,"div",39),s(1," Nenhum jogador encontrado. "),c())}var V=class n{constructor(t){this.router=t}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=J;repo=new T("Personagem");ngOnInit(){return m(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let t=yield this.repo.getLocal();if(t.length>0&&(this.jogadores=t,this.aplicarFiltro(),this.carregando=!1),m(this,null,function*(){if(yield this.repo.sync()){let i=yield this.repo.getLocal();this.jogadores=i,this.aplicarFiltro()}}),!t.length){let e=yield this.repo.forceFetch();this.jogadores=e,this.aplicarFiltro(),this.carregando=!1}}catch(t){console.error("[Batalha] Erro ao carregar jogadores:",t),this.carregando=!1}})}aplicarFiltro(){let t=this.filtro.toLowerCase().trim();if(!t){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(e=>String(e.personagem||"").toLowerCase().includes(t)||String(e.nome_do_jogador||"").toLowerCase().includes(t)||String(e.classificacao||"").toLowerCase().includes(t)||String(e.tipo||"").toLowerCase().includes(t))}abrirDetalhes(t){return m(this,null,function*(){this.processando[t.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",t.id]),this.processando[t.id]=null},400)})}acaoEspada(t){return m(this,null,function*(){this.processando[t.id]="espada",setTimeout(()=>{this.router.navigate(["/combate",t.id]),this.processando[t.id]=null},400)})}acaoRecuperacao(t){return m(this,null,function*(){this.processando[t.id]="recuperar",setTimeout(()=>{this.router.navigate(["/recuperacao",t.id]),this.processando[t.id]=null},400)})}excluirNpcDaBatalha(t){return m(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${t.personagem}" do campo de batalha?`)){this.processando[t.id]="excluir";try{yield this.repo.delete(t.id),this.jogadores=this.jogadores.filter(i=>i.id!==t.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(i){console.error("[Batalha] Erro ao excluir NPC:",i),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[t.id]=null}}})}static \u0275fac=function(e){return new(e||n)(y(S))};static \u0275cmp=P({type:n,selectors:[["app-batalha"]],decls:6,vars:3,consts:[["recuperarIcon",""],["espadaIcon",""],["excluirIcon",""],[1,"batalha-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto","d-flex","justify-content-center"],[1,"batalha-container","w-100"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["class","fs-3",4,"ngIf"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger","fw-bold"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[1,"fs-3"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(e,i){e&1&&(o(0,"div",3)(1,"div",4)(2,"div",5),g(3,N,4,0,"div",6)(4,X,2,1,"div",7)(5,Z,2,0,"div",8),c()()()),e&2&&(a(3),r("ngIf",i.carregando),a(),r("ngIf",!i.carregando&&i.jogadoresFiltrados.length>0),a(),r("ngIf",!i.carregando&&i.jogadoresFiltrados.length===0))},dependencies:[j,k,B,F],styles:[".batalha-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.batalha-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;border:none;transition:transform .2s ease}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0006}.catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem;border:1px solid rgba(255,255,255,.05)}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d26;border-radius:.5rem;padding:.75rem 1rem;text-align:center;margin-bottom:1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d;width:50px;height:50px;object-fit:cover}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#6c757d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff}"]})};export{V as Batalha};
