import{a as _}from"./chunk-BIKZT75S.js";import{a as b}from"./chunk-AH4ZKKXF.js";import"./chunk-FL3Z7HVM.js";import{Ga as l,Ha as o,Hb as A,Ia as n,Ja as p,Lb as R,Na as f,Oa as x,Ob as V,Pa as F,Ra as S,S as y,T as D,Ta as m,Vb as N,Xb as B,_b as U,d as C,fb as t,gb as j,ha as k,hb as d,ia as a,ib as L,ma as w,nb as z,qa as T,ua as u}from"./chunk-D4SJKQCR.js";function $(i,r){i&1&&(o(0,"div",3),p(1,"div",4),o(2,"p",5),t(3,"Carregando item..."),n()())}function G(i,r){if(i&1&&p(0,"img",21),i&2){let e=m(2);l("alt",z(e.item.catalogo==null?null:e.item.catalogo.nome))("src",e.item.catalogo==null?null:e.item.catalogo.imagem,k)}}function H(i,r){i&1&&(o(0,"div",22)(1,"span",23),t(2,"\u{1F4E6} Sem imagem"),n()())}function K(i,r){if(i&1&&(o(0,"p",24),t(1," \u2728 "),o(2,"b"),t(3,"Efeito:"),n(),t(4),n()),i&2){let e=m(2);a(4),d(" ",e.item.catalogo==null?null:e.item.catalogo.efeito," ")}}function W(i,r){if(i&1&&(o(0,"p",25),t(1," \u26A0\uFE0F "),o(2,"b"),t(3,"Colateral:"),n(),t(4),n()),i&2){let e=m(2);a(4),d(" ",e.item.catalogo==null?null:e.item.catalogo.colateral," ")}}function X(i,r){if(i&1&&(o(0,"p",26),t(1),n()),i&2){let e=m(2);a(),d(" \u{1F4DD} ",e.item.catalogo==null?null:e.item.catalogo.descricao," ")}}function Y(i,r){i&1&&(f(0),t(1,"\u270F\uFE0F Editar"),x())}function Z(i,r){i&1&&(f(0),p(1,"span",27),t(2," Editando... "),x())}function ee(i,r){i&1&&(f(0),t(1,"\u{1F5D1}\uFE0F Excluir"),x())}function te(i,r){i&1&&(f(0),p(1,"span",27),t(2," Excluindo... "),x())}function ne(i,r){if(i&1){let e=F();f(0),o(1,"div",6),u(2,G,1,3,"img",7)(3,H,3,0,"div",8),n(),o(4,"div",9)(5,"h4",10),t(6),n(),o(7,"div",11)(8,"p")(9,"span",12),t(10,"\u{1F4C2}"),n(),o(11,"b"),t(12,"Categoria: "),n(),t(13),n(),o(14,"p")(15,"span",12),t(16,"\u{1F331}"),n(),o(17,"b"),t(18,"Origem:"),n(),t(19),n(),o(20,"p")(21,"span",12),t(22,"\u{1F48E}"),n(),o(23,"b"),t(24,"Raridade:"),n(),t(25),n(),o(26,"p")(27,"span",12),t(28,"\u{1F522}"),n(),o(29,"b"),t(30,"Quantidade:"),n(),t(31),n(),o(32,"p")(33,"span",12),t(34,"\u2696\uFE0F"),n(),o(35,"b"),t(36,"Peso total:"),n(),t(37),n()(),p(38,"hr",13),u(39,K,5,1,"p",14)(40,W,5,1,"p",15)(41,X,2,1,"p",16),n(),o(42,"div",17)(43,"button",18),S("click",function(){y(e);let s=m();return D(s.cancelar())}),t(44," \u2B05\uFE0F Cancelar "),n(),o(45,"button",19),S("click",function(){y(e);let s=m();return D(s.editarItem())}),u(46,Y,2,0,"ng-container",2)(47,Z,3,0,"ng-container",2),n(),o(48,"button",20),S("click",function(){y(e);let s=m();return D(s.excluirItem())}),u(49,ee,2,0,"ng-container",2)(50,te,3,0,"ng-container",2),n()(),x()}if(i&2){let e=m();a(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.imagem),a(),l("ngIf",!(e.item.catalogo!=null&&e.item.catalogo.imagem)),a(3),j((e.item.catalogo==null?null:e.item.catalogo.nome)||"Item desconhecido"),a(7),d(" ",(e.item.catalogo==null?null:e.item.catalogo.categoria)||"\u2014"),a(6),d(" ",(e.item.catalogo==null?null:e.item.catalogo.origem)||"\u2014"),a(6),d(" ",(e.item.catalogo==null?null:e.item.catalogo.raridade)||"\u2014"),a(6),L(" ",e.item.inventario.quantidade," ",(e.item.catalogo==null?null:e.item.catalogo.unidade_medida)||""," "),a(6),d(" ",(e.item.inventario.quantidade||0)*((e.item.catalogo==null?null:e.item.catalogo.peso)||0)," kg "),a(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.efeito),a(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.colateral),a(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.descricao),a(4),l("disabled",e.processandoEditar),a(),l("ngIf",!e.processandoEditar),a(),l("ngIf",e.processandoEditar),a(),l("disabled",e.processandoExcluir),a(),l("ngIf",!e.processandoExcluir),a(),l("ngIf",e.processandoExcluir)}}var q=class i{constructor(r,e,c){this.route=r;this.router=e;this.location=c}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;ngOnInit(){return C(this,null,function*(){try{console.log("[ItemInventario] Iniciando carregamento..."),this.carregando=!0;let r=Number(this.route.snapshot.paramMap.get("id"));if(!r)throw new Error("ID inv\xE1lido para item do invent\xE1rio");let e=U.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let c=yield _.getLocalInventarioByJogador(e.email),s=yield b.getLocalItens(),v=c.find(g=>g.id===r),J=v?s.find(g=>g.id===v.item_catalogo):void 0;if(v&&(this.item={inventario:v,catalogo:J},this.carregando=!1),Promise.all([_.syncInventario(),b.syncItens()]).then(h=>C(this,[h],function*([g,O]){if(g||O){console.log("[ItemInventario] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let M=yield _.getLocalInventarioByJogador(e.email),I=yield b.getLocalItens(),E=M.find(P=>P.id===r),Q=E?I.find(P=>P.id===E.item_catalogo):void 0;E&&(this.item={inventario:E,catalogo:Q})}else console.log("[ItemInventario] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!v){console.log("[ItemInventario] Item n\xE3o encontrado localmente. Buscando online...");let g=yield _.forceFetchInventario(),O=yield b.getLocalItens(),h=g.find(I=>I.id===r),M=h?O.find(I=>I.id===h.item_catalogo):void 0;if(h)this.item={inventario:h,catalogo:M};else throw new Error("Item n\xE3o encontrado nem online.");this.carregando=!1}}catch(r){console.error("[ItemInventario] Erro ao carregar item:",r),this.carregando=!1}})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-inventario",this.item.inventario.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},500))}excluirItem(){return C(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja remover "${this.item.catalogo?.nome}" do invent\xE1rio?`))){this.processandoExcluir=!0;try{yield _.deleteInventario(this.item.inventario.id),alert("\u2705 Item removido do invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(e){console.error("[ItemInventario] Erro ao excluir item:",e),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}static \u0275fac=function(e){return new(e||i)(w(N),w(B),w(A))};static \u0275cmp=T({type:i,selectors:[["app-item-inventario"]],decls:3,vars:2,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","mb-3"],["class","img-fluid rounded shadow-sm","style","max-height: 280px; object-fit: cover; width: 100%;",3,"src","alt",4,"ngIf"],["class","bg-secondary d-flex align-items-center justify-content-center rounded","style","height: 200px; width: 100%;",4,"ngIf"],[1,"card","bg-dark","border-0","shadow-sm","p-3"],[1,"fw-bold","mb-3","text-light"],[1,"meta-info"],[1,"icon"],[1,"border-secondary"],["class","efeito-text mt-2",4,"ngIf"],["class","colateral mt-2",4,"ngIf"],["class","descricao-text mt-2 fst-italic",4,"ngIf"],[1,"d-flex","gap-2","mt-4"],[1,"btn","btn-secondary","flex-fill",3,"click"],[1,"btn","btn-outline-warning","flex-fill",3,"click","disabled"],[1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"img-fluid","rounded","shadow-sm",2,"max-height","280px","object-fit","cover","width","100%",3,"src","alt"],[1,"bg-secondary","d-flex","align-items-center","justify-content-center","rounded",2,"height","200px","width","100%"],[1,"text-light"],[1,"efeito-text","mt-2"],[1,"colateral","mt-2"],[1,"descricao-text","mt-2","fst-italic"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,c){e&1&&(o(0,"div",0),u(1,$,4,0,"div",1)(2,ne,51,18,"ng-container",2),n()),e&2&&(a(),l("ngIf",c.carregando),a(),l("ngIf",!c.carregando&&c.item))},dependencies:[V,R],styles:[".card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;border:1px solid #2c2c2c}.img-fluid[_ngcontent-%COMP%]{border-radius:10px}.bg-secondary[_ngcontent-%COMP%]{background:#2c2c2c!important;color:#ccc;font-size:1rem;border-radius:10px}.meta-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:6px;font-size:.95rem;color:#eaeaea}.meta-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:4px}.efeito-text[_ngcontent-%COMP%]{color:#0dcaf0;font-weight:500}.colateral[_ngcontent-%COMP%]{color:#ff6b6b;font-weight:500}.descricao-text[_ngcontent-%COMP%]{color:#bbb;font-size:.9rem;line-height:1.4}.btn[_ngcontent-%COMP%]{font-weight:600;border-radius:8px;padding:10px}.btn-secondary[_ngcontent-%COMP%]{background:#444;border:none}.btn-secondary[_ngcontent-%COMP%]:hover{background:#555}.btn-outline-warning[_ngcontent-%COMP%]{border-color:#ffc107;color:#ffc107}.btn-outline-warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffc107;color:#1e1e1e}.btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.btn-outline-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#ff4d6d;color:#fff}"]})};export{q as ItemInventario};
