import{a as _}from"./chunk-OMXCDONK.js";import{q as T}from"./chunk-SBITE6UI.js";import"./chunk-FL3Z7HVM.js";import{Ga as c,Ha as r,Ia as d,Ja as p,Kb as j,Lb as F,Na as C,Oa as y,Ob as S,Pa as M,Ra as x,S as f,T as b,Ta as s,Xb as J,bb as w,d as m,fb as l,gb as E,ha as P,hb as h,ia as o,ib as k,ma as I,nb as B,qa as D,tb as O,ua as g}from"./chunk-D4SJKQCR.js";var v=class{static getVidaBase(e){return e.pontos_de_vida>0?e.pontos_de_vida:e.energia+e.constituicao}static getVidaAtual(e){let t=this.getVidaBase(e),a=e.classe_de_armadura||0,i=e.dano_tomado||0;return a>0?t:t-i}static estaMorto(e){return this.getVidaAtual(e)<=0}};function N(n,e){n&1&&(r(0,"div",7),p(1,"div",8),r(2,"p",9),l(3,"Carregando jogadores..."),d()())}function A(n,e){n&1&&(r(0,"span",31),l(1,"\u{1F480}"),d())}function $(n,e){if(n&1&&p(0,"img",32),n&2){let t=s().$implicit;c("alt",B(t.personagem))("src",t.imagem,P)}}function L(n,e){n&1&&(r(0,"span",19),l(1,"\u{1F464}"),d())}function U(n,e){if(n&1&&(r(0,"span"),l(1),d()),n&2){let t=s().$implicit;o(),h("| ",t.tipo)}}function R(n,e){n&1&&(C(0),p(1,"span",34),y())}function z(n,e){n&1&&l(0,"\u{1F5D1}\uFE0F")}function q(n,e){if(n&1){let t=M();r(0,"button",33),x("click",function(){f(t);let i=s().$implicit,u=s(2);return b(u.excluirNpcDaBatalha(i))}),g(1,R,2,0,"ng-container",30)(2,z,1,0,"ng-template",null,1,O),d()}if(n&2){let t=w(3),a=s().$implicit,i=s(2);c("disabled",i.processando[a.id]==="excluir"),o(),c("ngIf",i.processando[a.id]==="excluir")("ngIfElse",t)}}function Y(n,e){n&1&&p(0,"div",35)}function G(n,e){n&1&&(C(0),p(1,"span",34),y())}function H(n,e){n&1&&l(0,"\u2694\uFE0F")}function K(n,e){if(n&1){let t=M();r(0,"div",11),x("click",function(){let i=f(t).$implicit,u=s(2);return b(u.abrirDetalhes(i))}),r(1,"div",12)(2,"div",13),g(3,A,2,0,"span",14)(4,$,1,3,"img",15)(5,L,2,0,"span",16),d(),r(6,"div",17)(7,"h6",18),l(8),d(),r(9,"small",19),l(10),g(11,U,2,1,"span",5),d()(),r(12,"div",20),x("click",function(i){return f(t),b(i.stopPropagation())}),r(13,"div",21)(14,"div",22),l(15),d(),r(16,"div",23),l(17),d()(),r(18,"div",24),l(19),d(),r(20,"div",25)(21,"div",26),g(22,q,4,3,"button",27)(23,Y,1,0,"div",28),d(),r(24,"button",29),x("click",function(){let i=f(t).$implicit,u=s(2);return b(u.acaoEspada(i))}),g(25,G,2,0,"ng-container",30)(26,H,1,0,"ng-template",null,0,O),d()()()()()}if(n&2){let t=e.$implicit,a=w(27),i=s(2);o(3),c("ngIf",i.JogadorUtils.estaMorto(t)),o(),c("ngIf",t.imagem&&!i.JogadorUtils.estaMorto(t)),o(),c("ngIf",!t.imagem&&!i.JogadorUtils.estaMorto(t)),o(3),E(t.personagem),o(2),h(" ",t.classificacao||"Jogador"," "),o(),c("ngIf",t.tipo),o(4),k(" \u2764\uFE0F ",i.JogadorUtils.getVidaAtual(t),"/",i.JogadorUtils.getVidaBase(t)," "),o(2),h("\u{1F6E1}\uFE0F ",t.classe_de_armadura),o(2),h(" \u{1F4A5} Dano: ",t.dano_tomado||0," "),o(3),c("ngIf",!t.email),o(),c("ngIf",t.email),o(),c("disabled",i.processando[t.id]==="espada"),o(),c("ngIf",i.processando[t.id]==="espada")("ngIfElse",a)}}function Q(n,e){if(n&1&&(r(0,"div"),g(1,K,28,15,"div",10),d()),n&2){let t=s();o(),c("ngForOf",t.jogadoresFiltrados)}}function W(n,e){n&1&&(r(0,"div",36),l(1," Nenhum jogador encontrado. "),d())}var V=class n{constructor(e){this.router=e}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=v;ngOnInit(){return m(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let e=yield _.getLocalJogadores();if(e.length>0&&(this.jogadores=e,this.aplicarFiltro(),this.carregando=!1),_.syncJogadores().then(t=>m(this,null,function*(){if(t){let a=yield _.getLocalJogadores();this.jogadores=a,this.aplicarFiltro()}})),e.length===0){let t=yield _.forceFetchJogador();t&&(this.jogadores=Array.isArray(t)?t:[t],this.aplicarFiltro()),this.carregando=!1}}catch(e){console.error("[Batalha] Erro ao carregar jogadores:",e),this.carregando=!1}})}aplicarFiltro(){let e=this.filtro.toLowerCase().trim();if(!e){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(t=>String(t.personagem||"").toLowerCase().includes(e)||String(t.nome_do_jogador||"").toLowerCase().includes(e)||String(t.classificacao||"").toLowerCase().includes(e)||String(t.tipo||"").toLowerCase().includes(e))}abrirDetalhes(e){return m(this,null,function*(){this.processando[e.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",e.id]),this.processando[e.id]=null},400)})}acaoEspada(e){return m(this,null,function*(){this.router.navigate(["/combate",e.id])})}excluirNpcDaBatalha(e){return m(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${e.personagem}" do campo de batalha?`)){this.processando[e.id]="excluir";try{yield _.deleteJogador(e.id),this.jogadores=this.jogadores.filter(a=>a.id!==e.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(a){console.error("[Batalha] Erro ao excluir NPC:",a),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[e.id]=null}}})}static \u0275fac=function(t){return new(t||n)(I(J))};static \u0275cmp=D({type:n,selectors:[["app-batalha"]],decls:5,vars:3,consts:[["espadaIcon",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["class","fs-3",4,"ngIf"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger","fw-bold"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"fs-3"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(t,a){t&1&&(r(0,"div",2)(1,"div",3),g(2,N,4,0,"div",4)(3,Q,2,1,"div",5)(4,W,2,0,"div",6),d()()),t&2&&(o(2),c("ngIf",a.carregando),o(),c("ngIf",!a.carregando&&a.jogadoresFiltrados.length>0),o(),c("ngIf",!a.carregando&&a.jogadoresFiltrados.length===0))},dependencies:[S,j,F,T],styles:[".catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem;border:1px solid rgba(255,255,255,.05)}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d26;border-radius:.5rem;padding:.75rem 1rem;text-align:center;margin-bottom:1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d;width:50px;height:50px;object-fit:cover}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#6c757d;color:#fff}"]})};export{V as Batalha};
