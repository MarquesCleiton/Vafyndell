import{a as p}from"./chunk-FJZA3HMC.js";import{q as J}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import"./chunk-HS244SCX.js";import{Ga as r,Ha as o,Ia as d,Ib as P,Ja as _,Jb as M,Mb as S,Na as C,Oa as y,Pa as I,Ra as h,S as f,T as x,Ta as c,Vb as k,bb as w,d as g,fb as s,gb as j,ha as B,hb as b,ia as n,ma as D,nb as F,qa as O,sb as E,ua as m}from"./chunk-ILJPX4RU.js";var v=class{static getVidaBase(e){return e.pontos_de_vida>0?e.pontos_de_vida:e.energia+e.constituicao}static getVidaTotal(e){return this.getVidaBase(e)+(e.classe_de_armadura||0)-(e.dano_tomado||0)}static getVidaAtual(e){return this.getVidaBase(e)-(e.dano_tomado||0)}static estaMorto(e){return this.getVidaTotal(e)<=0}};function V(a,e){a&1&&(o(0,"div",7),_(1,"div",8),o(2,"p",9),s(3,"Carregando jogadores..."),d()())}function N(a,e){if(a&1&&_(0,"img",29),a&2){let t=c().$implicit;r("alt",F(t.personagem))("src",t.imagem,B)}}function $(a,e){a&1&&(o(0,"span",18),s(1,"\u{1F464}"),d())}function L(a,e){if(a&1&&(o(0,"span"),s(1),d()),a&2){let t=c().$implicit;n(),b("| ",t.tipo)}}function A(a,e){a&1&&(C(0),_(1,"span",31),y())}function R(a,e){a&1&&s(0,"\u{1F5D1}\uFE0F")}function z(a,e){if(a&1){let t=I();o(0,"button",30),h("click",function(){f(t);let l=c().$implicit,u=c(2);return x(u.excluirNpcDaBatalha(l))}),m(1,A,2,0,"ng-container",28)(2,R,1,0,"ng-template",null,1,E),d()}if(a&2){let t=w(3),i=c().$implicit,l=c(2);r("disabled",l.processando[i.id]==="excluir"),n(),r("ngIf",l.processando[i.id]==="excluir")("ngIfElse",t)}}function U(a,e){a&1&&_(0,"div",32)}function q(a,e){a&1&&(C(0),_(1,"span",31),y())}function Y(a,e){a&1&&s(0,"\u2694\uFE0F")}function G(a,e){if(a&1){let t=I();o(0,"div",11),h("click",function(){let l=f(t).$implicit,u=c(2);return x(u.abrirDetalhes(l))}),o(1,"div",12)(2,"div",13),m(3,N,1,3,"img",14)(4,$,2,0,"span",15),d(),o(5,"div",16)(6,"h6",17),s(7),d(),o(8,"small",18),s(9),m(10,L,2,1,"span",5),d()(),o(11,"div",19),h("click",function(l){return f(t),x(l.stopPropagation())}),o(12,"div",20)(13,"div",21),s(14),d(),o(15,"div",22),s(16),d()(),o(17,"div",23)(18,"div",24),m(19,z,4,3,"button",25)(20,U,1,0,"div",26),d(),o(21,"button",27),h("click",function(){let l=f(t).$implicit,u=c(2);return x(u.acaoEspada(l))}),m(22,q,2,0,"ng-container",28)(23,Y,1,0,"ng-template",null,0,E),d()()()()()}if(a&2){let t=e.$implicit,i=w(24),l=c(2);n(3),r("ngIf",t.imagem),n(),r("ngIf",!t.imagem),n(3),j(t.personagem),n(2),b(" ",t.classificacao||"Jogador"," "),n(),r("ngIf",t.tipo),n(4),b("\u2764\uFE0F ",l.JogadorUtils.getVidaBase(t)),n(2),b("\u{1F6E1}\uFE0F ",t.classe_de_armadura),n(3),r("ngIf",!t.email),n(),r("ngIf",t.email),n(),r("disabled",l.processando[t.id]==="espada"),n(),r("ngIf",l.processando[t.id]==="espada")("ngIfElse",i)}}function H(a,e){if(a&1&&(o(0,"div"),m(1,G,25,12,"div",10),d()),a&2){let t=c();n(),r("ngForOf",t.jogadoresFiltrados)}}function K(a,e){a&1&&(o(0,"div",33),s(1," Nenhum jogador encontrado. "),d())}var T=class a{constructor(e){this.router=e}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=v;ngOnInit(){return g(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let e=yield p.getLocalJogadores();if(e.length>0&&(this.jogadores=e,this.aplicarFiltro(),this.carregando=!1),p.syncJogadores().then(t=>g(this,null,function*(){if(t){let i=yield p.getLocalJogadores();this.jogadores=i,this.aplicarFiltro()}})),e.length===0){let t=yield p.forceFetchJogador();t&&(this.jogadores=Array.isArray(t)?t:[t],this.aplicarFiltro()),this.carregando=!1}}catch(e){console.error("[Batalha] Erro ao carregar jogadores:",e),this.carregando=!1}})}aplicarFiltro(){let e=this.filtro.toLowerCase().trim();if(!e){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(t=>String(t.personagem||"").toLowerCase().includes(e)||String(t.nome_do_jogador||"").toLowerCase().includes(e)||String(t.classificacao||"").toLowerCase().includes(e)||String(t.tipo||"").toLowerCase().includes(e))}abrirDetalhes(e){return g(this,null,function*(){this.processando[e.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",e.id]),this.processando[e.id]=null},400)})}acaoEspada(e){return g(this,null,function*(){this.router.navigate(["/combate",e.id])})}excluirNpcDaBatalha(e){return g(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${e.personagem}" do campo de batalha?`)){this.processando[e.id]="excluir";try{yield p.deleteJogador(e.id),this.jogadores=this.jogadores.filter(i=>i.id!==e.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(i){console.error("[Batalha] Erro ao excluir NPC:",i),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[e.id]=null}}})}static \u0275fac=function(t){return new(t||a)(D(k))};static \u0275cmp=O({type:a,selectors:[["app-batalha"]],decls:5,vars:3,consts:[["espadaIcon",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1"],[1,"me-2","text-danger"],[1,"text-info"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[4,"ngIf","ngIfElse"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(t,i){t&1&&(o(0,"div",2)(1,"div",3),m(2,V,4,0,"div",4)(3,H,2,1,"div",5)(4,K,2,0,"div",6),d()()),t&2&&(n(2),r("ngIf",i.carregando),n(),r("ngIf",!i.carregando&&i.jogadoresFiltrados.length>0),n(),r("ngIf",!i.carregando&&i.jogadoresFiltrados.length===0))},dependencies:[S,P,M,J],styles:[".catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}"]})};export{T as Batalha};
