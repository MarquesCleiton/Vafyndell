import{c as K,f as X,i as Y,r as Z}from"./chunk-UJUF775I.js";import{a as F}from"./chunk-SL4CV3BB.js";import{h as H}from"./chunk-XMJCILQE.js";import{h as U,i as Q,o as W,p as G,w as ee}from"./chunk-ZOZAG657.js";import{$b as J,Ab as m,Bb as s,Cb as c,Db as h,Hb as b,Ib as I,Jb as E,Nb as u,Pb as d,Sa as O,Ua as o,Za as S,Zb as w,a as D,ac as A,b as y,bc as _,cc as k,dc as x,eb as T,ec as R,fc as V,g as C,gc as j,hc as q,ic as z,jb as p,jc as $,kc as L,la as v,ma as f,pc as N,qc as B,rc as P}from"./chunk-YAKM3PEZ.js";function ae(n,t){if(n&1){let e=E();s(0,"li",18)(1,"button",19),u("click",function(){v(e);let a=d().$implicit,r=d();return f(r.selecionarAba(a))}),_(2),c()()}if(n&2){let e=d().$implicit,i=d();o(),J("active",i.abaAtiva===e),o(),R(" ",e==="recursos"?"\u{1F33F} Recursos":e==="equipamentos"?"\u2694\uFE0F Equipamentos":e==="pocoes"?"\u{1F9EA} Po\xE7\xF5es":"\u{1F4E6} Outros"," (",i.getQuantidadePorAba(e),") ")}}function oe(n,t){if(n&1&&(b(0),p(1,ae,3,4,"li",17),I()),n&2){let e=t.$implicit,i=d();o(),m("ngIf",i.getQuantidadePorAba(e)>0)}}function re(n,t){if(n&1&&(s(0,"div",20)(1,"p",21),_(2," \u2696\uFE0F Peso total: "),s(3,"b"),_(4),N(5,"number"),c()()()),n&2){let e=d();o(4),x("",B(5,1,e.resumo.pesoTotal,"1.0-2")," kg")}}function le(n,t){n&1&&(s(0,"div",22),h(1,"div",23),s(2,"p",24),_(3,"Carregando invent\xE1rio..."),c()())}function se(n,t){n&1&&(s(0,"div",25),_(1," Nenhum item encontrado. "),c())}function ce(n,t){if(n&1&&h(0,"img",47),n&2){let e=d().$implicit;m("alt",$(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,O)}}function de(n,t){if(n&1&&(s(0,"span"),_(1),c()),n&2){let e=d().$implicit,i=d(5);o(),x(" ",i.getEmojiFallback(e.itemDetalhe==null?null:e.itemDetalhe.categoria)," ")}}function me(n,t){if(n&1&&(s(0,"p",48),_(1),c()),n&2){let e=d().$implicit;o(),x("\u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito)}}function _e(n,t){if(n&1&&(s(0,"p",49),_(1),c()),n&2){let e=d().$implicit;o(),x("\u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function pe(n,t){n&1&&(b(0),h(1,"span",50),I())}function ge(n,t){n&1&&_(0,"\u{1F4E4}")}function ue(n,t){n&1&&(b(0),h(1,"span",50),I())}function ve(n,t){n&1&&_(0,"\u270F\uFE0F")}function fe(n,t){n&1&&(b(0),h(1,"span",50),I())}function xe(n,t){n&1&&_(0,"\u{1F5D1}\uFE0F")}function he(n,t){if(n&1){let e=E();s(0,"div",32)(1,"div",33)(2,"small"),_(3),c(),s(4,"div",34),u("click",function(){let a=v(e).$implicit,r=d(5);return f(r.abrirItem(a.id))}),s(5,"div",35)(6,"div",36),p(7,ce,1,3,"img",37)(8,de,2,1,"span",14),c(),s(9,"div")(10,"h6",38),_(11),c(),s(12,"small",39),_(13),c()()(),p(14,me,2,1,"p",40)(15,_e,2,1,"p",41),c(),s(16,"div",42)(17,"button",43),u("click",function(a){let r=v(e).$implicit,l=d(5);return f(l.trocarItem(r.id,a))}),p(18,pe,2,0,"ng-container",44)(19,ge,1,0,"ng-template",null,0,P),c(),s(21,"button",45),u("click",function(a){let r=v(e).$implicit,l=d(5);return f(l.editarItem(r.id,a))}),p(22,ue,2,0,"ng-container",44)(23,ve,1,0,"ng-template",null,1,P),c(),s(25,"button",46),u("click",function(a){let r=v(e).$implicit,l=d(5);return f(l.excluirItem(r.id,a))}),p(26,fe,2,0,"ng-container",44)(27,xe,1,0,"ng-template",null,2,P),c()()()()}if(n&2){let e=t.$implicit,i=w(20),a=w(24),r=w(28),l=d(5);o(2),A(L("raridade-label ",l.getRaridadeClass(e.itemDetalhe==null?null:e.itemDetalhe.raridade))),o(),x(" ",(e.itemDetalhe==null?null:e.itemDetalhe.raridade)||"Comum"," "),o(4),m("ngIf",(e.itemDetalhe==null?null:e.itemDetalhe.imagem)&&(e.itemDetalhe==null?null:e.itemDetalhe.imagem)!=="-"),o(),m("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)||(e.itemDetalhe==null?null:e.itemDetalhe.imagem)==="-"),o(3),x(" ",(e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"," "),o(2),V(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",e.quantidade*((e.itemDetalhe==null?null:e.itemDetalhe.peso)||0)," kg "),o(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),o(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral),o(2),m("disabled",l.processando[e.id]==="transferir"),o(),m("ngIf",l.processando[e.id]==="transferir")("ngIfElse",i),o(3),m("disabled",l.processando[e.id]==="editar"),o(),m("ngIf",l.processando[e.id]==="editar")("ngIfElse",a),o(3),m("disabled",l.processando[e.id]==="excluir"),o(),m("ngIf",l.processando[e.id]==="excluir")("ngIfElse",r)}}function be(n,t){if(n&1&&(s(0,"div",24)(1,"div",30),p(2,he,29,21,"div",31),c()()),n&2){let e=d(2).$implicit;o(2),m("ngForOf",e.itens)}}function Ie(n,t){if(n&1){let e=E();s(0,"div",27)(1,"button",28),u("click",function(){v(e);let a=d().$implicit,r=d(2);return f(r.toggleCategoria(a))}),s(2,"span"),_(3),c(),s(4,"span"),_(5),c()(),p(6,be,3,1,"div",29),c()}if(n&2){let e=d().$implicit;o(3),k(e.nome),o(2),k(e.expandido?"\u2212":"+"),o(),m("ngIf",e.expandido)}}function Ce(n,t){if(n&1&&(b(0),p(1,Ie,7,3,"div",26),I()),n&2){let e=t.$implicit,i=d(2);o(),m("ngIf",i.pertenceAba(e.nome))}}function De(n,t){if(n&1&&(s(0,"div"),p(1,Ce,2,1,"ng-container",7),c()),n&2){let e=d();o(),m("ngForOf",e.categoriasFiltradas)}}var te=class n{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abas=["recursos","equipamentos","pocoes","outros"];abaAtiva="recursos";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};processando={};catalogoRepo=new F("Catalogo");inventarioRepo=new F("Inventario");mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return C(this,null,function*(){try{this.carregando=!0;let t=ee.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");yield this.loadLocalAndSync(t.email)}finally{this.carregando=!1}})}loadLocalAndSync(t){return C(this,null,function*(){let[e,i]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),a=i.filter(r=>r.jogador===t);this.processarInventario(a,e),C(this,null,function*(){let[r,l]=yield Promise.all([this.catalogoRepo.sync(),this.inventarioRepo.sync()]);if(r||l){let[g,M]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),ne=M.filter(ie=>ie.jogador===t);this.processarInventario(ne,g)}})})}processarInventario(t,e){let i=t.map(l=>{let g=e.find(M=>String(M.id)===String(l.item_catalogo));return y(D({},l),{itemDetalhe:g})}),a=new Map(this.categorias.map(l=>[l.nome,l.expandido])),r=new Map;i.forEach(l=>{let g=l.itemDetalhe?.categoria||"Outros";r.has(g)||r.set(g,[]),r.get(g).push(l)}),this.categorias=Array.from(r.entries()).sort(([l],[g])=>l.localeCompare(g)).map(([l,g])=>({nome:l,itens:g,expandido:a.get(l)??!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,i)=>e+(i.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,i)=>e+(i.quantidade||0)*(i.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>{let i=e.itens.filter(a=>[a.itemDetalhe?.nome,a.itemDetalhe?.raridade,a.itemDetalhe?.efeito,a.itemDetalhe?.colateral,a.itemDetalhe?.categoria].map(r=>this.normalizarTexto(String(r||""))).some(r=>r.includes(t)));return y(D({},e),{itens:i,expandido:i.length>0})}).filter(e=>e.itens.length>0)}normalizarTexto(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(t){this.abaAtiva=t}pertenceAba(t){return t?this.mapaAbas[this.abaAtiva].includes(t):this.abaAtiva==="outros"}toggleCategoria(t){t.expandido=!t.expandido}getQuantidadePorAba(t){let e=this.mapaAbas[t],i=0;return this.categorias.forEach(a=>{e.includes(a.nome)&&(i+=a.itens.length)}),i}getRaridadeClass(t){return t?t.toLowerCase():"comum"}getEmojiFallback(t){if(!t)return"\u{1F4E6}";let e={recursos:"\u{1F33F}",equipamentos:"\u2694\uFE0F",pocoes:"\u{1F9EA}",outros:"\u{1F4E6}"};for(let i of Object.keys(this.mapaAbas))if(this.mapaAbas[i].includes(t))return e[i];return"\u{1F4E6}"}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}trocarItem(t,e){e.stopPropagation(),this.processando[t]="transferir",setTimeout(()=>{this.router.navigate(["/troca-de-itens",t]),this.processando[t]=null},400)}editarItem(t,e){e.stopPropagation(),this.processando[t]="editar",setTimeout(()=>{this.router.navigate(["/cadastro-inventario",t]),this.processando[t]=null},400)}excluirItem(t,e){return C(this,null,function*(){if(e.stopPropagation(),!!confirm("\u{1F5D1}\uFE0F Deseja excluir este item do invent\xE1rio?")){this.processando[t]="excluir";try{yield this.inventarioRepo.delete(t),alert("\u2705 Item exclu\xEDdo do invent\xE1rio!"),this.categorias=this.categorias.map(a=>y(D({},a),{itens:a.itens.filter(r=>r.id!==t)})),this.aplicarFiltro(),this.calcularResumo()}catch(a){console.error("[Invent\xE1rio] Erro ao excluir:",a),alert("\u274C Erro ao excluir item")}finally{this.processando[t]=null}}})}static \u0275fac=function(e){return new(e||n)(S(H))};static \u0275cmp=T({type:n,selectors:[["app-inventario-jogador"]],decls:16,vars:6,consts:[["transferirIcon",""],["editarIcon",""],["excluirIcon",""],[1,"inventario-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0","z-10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","search-bar",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],[4,"ngFor","ngForOf"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-container","w-100"],[1,"fw-bold","mb-3"],["class","card resumo-card mb-4 p-3 shadow-sm",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],["class","nav-item","role","presentation",4,"ngIf"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"card","resumo-card","mb-4","p-3","shadow-sm"],[1,"mb-1","text-light"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-secondary","py-5"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-3"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","h-100","p-3","shadow-sm","position-relative"],[3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","mb-1","text-light"],[1,"item-meta"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[1,"text-end","mt-2","d-flex","justify-content-end","gap-1"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[1,"spinner-border","spinner-border-sm"]],template:function(e,i){e&1&&(s(0,"div",3)(1,"div",4)(2,"input",5),z("ngModelChange",function(r){return q(i.filtro,r)||(i.filtro=r),r}),u("input",function(){return i.aplicarFiltro()}),c()(),s(3,"ul",6),p(4,oe,2,1,"ng-container",7),c(),s(5,"div",8)(6,"div",9)(7,"h4",10),_(8,"\u{1F392} Invent\xE1rio"),c(),p(9,re,6,4,"div",11)(10,le,4,0,"div",12)(11,se,2,0,"div",13)(12,De,2,1,"div",14),c()(),s(13,"div",15)(14,"button",16),u("click",function(){return i.novoItemInventario()}),_(15,"\uFF0B"),c()()()),e&2&&(o(2),j("ngModel",i.filtro),o(2),m("ngForOf",i.abas),o(5),m("ngIf",!i.carregando&&i.categoriasFiltradas.length>0),o(),m("ngIf",i.carregando),o(),m("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),o(),m("ngIf",!i.carregando))},dependencies:[G,U,Q,Z,K,X,Y,W],styles:[".nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}.inventario-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.inventario-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:20px;padding:.5rem 1rem}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.raridade-label[_ngcontent-%COMP%]{position:absolute;top:8px;right:12px;font-size:.8rem;font-weight:700}.raridade-label.comum[_ngcontent-%COMP%]{color:#ccc}.raridade-label.incomum[_ngcontent-%COMP%]{color:#00bcd4}.raridade-label.raro[_ngcontent-%COMP%]{color:#673ab7}.raridade-label.\\e9pico[_ngcontent-%COMP%]{color:#9c27b0}.raridade-label.lend\\e1rio[_ngcontent-%COMP%]{color:gold}.item-meta[_ngcontent-%COMP%]{color:#bbb;font-size:.85rem}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.resumo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px}.inventario-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;cursor:pointer;transition:transform .15s ease}.inventario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}"]})};export{te as InventarioJogador};
