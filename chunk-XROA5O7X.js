import{a as j,b as D}from"./chunk-FLOHM7ZW.js";import{c as O,g as w,j as k,q as F,s as A}from"./chunk-WLM7QTUH.js";import{$b as C,Db as m,Eb as f,Jb as _,Lb as b,Pa as y,Qa as o,Va as E,Vb as N,Zb as t,_b as d,a as v,ab as I,d as u,fb as g,fc as P,mc as M,wb as l,xb as e,yb as i,zb as x}from"./chunk-QQSIVCMV.js";function R(a,r){a&1&&(e(0,"div",13),x(1,"div",14),e(2,"p",15),t(3,"Carregando NPC..."),i()())}function z(a,r){if(a&1&&(m(0),x(1,"img",27),f()),a&2){let c=b(2);o(),l("alt",P(c.npc.nome))("src",c.npc.imagem,y)}}function q(a,r){a&1&&(e(0,"div",28),t(1," \u{1F479} "),i())}function L(a,r){if(a&1&&(e(0,"div",29)(1,"h6",30),t(2,"\u{1F4DD} Descri\xE7\xE3o"),i(),e(3,"p",31),t(4),i()()),a&2){let c=b(2);o(4),d(c.npc.descricao)}}function $(a,r){if(a&1&&(e(0,"div",29)(1,"h6",30),t(2,"\u2694\uFE0F Ataques"),i(),e(3,"p",32),t(4),i()()),a&2){let c=b(2);o(4),d(c.npc.ataques)}}function J(a,r){if(a&1&&(e(0,"div",16)(1,"div",17)(2,"h5",18),t(3),i()(),e(4,"div",19),g(5,z,2,3,"ng-container",20)(6,q,2,0,"ng-template",null,0,M),i(),e(8,"div",21)(9,"ul",22)(10,"li"),t(11,"\u{1F3F7}\uFE0F "),e(12,"span"),t(13,"Classifica\xE7\xE3o:"),i(),t(14),i(),e(15,"li"),t(16,"\u{1F3AD} "),e(17,"span"),t(18,"Tipo:"),i(),t(19),i(),e(20,"li"),t(21,"\u2696\uFE0F "),e(22,"span"),t(23,"Alinhamento:"),i(),t(24),i()(),e(25,"h6",23),t(26,"\u{1F4CA} Atributos"),i(),e(27,"div",24)(28,"div",25),t(29,"\u2764\uFE0F "),e(30,"span"),t(31,"Vida"),i(),e(32,"b"),t(33),i()(),e(34,"div",25),t(35,"\u{1F6E1}\uFE0F "),e(36,"span"),t(37,"Armadura"),i(),e(38,"b"),t(39),i()(),e(40,"div",25),t(41,"\u2B50 "),e(42,"span"),t(43,"XP"),i(),e(44,"b"),t(45),i()(),e(46,"div",25),t(47,"\u{1F4AA} "),e(48,"span"),t(49,"For\xE7a"),i(),e(50,"b"),t(51),i()(),e(52,"div",25),t(53,"\u{1FAA8} "),e(54,"span"),t(55,"Constitui\xE7\xE3o"),i(),e(56,"b"),t(57),i()(),e(58,"div",25),t(59,"\u{1F938}\u200D\u2642\uFE0F "),e(60,"span"),t(61,"Destreza"),i(),e(62,"b"),t(63),i()(),e(64,"div",25),t(65,"\u{1F4D6} "),e(66,"span"),t(67,"Sabedoria"),i(),e(68,"b"),t(69),i()(),e(70,"div",25),t(71,"\u{1F9E0} "),e(72,"span"),t(73,"Intelig\xEAncia"),i(),e(74,"b"),t(75),i()(),e(76,"div",25),t(77,"\u26A1 "),e(78,"span"),t(79,"Energia"),i(),e(80,"b"),t(81),i()()(),g(82,L,5,1,"div",26)(83,$,5,1,"div",26),i()()),a&2){let c=N(7),n=b();o(3),d(n.npc.nome),o(2),l("ngIf",n.npc.imagem&&n.npc.imagem!=="-")("ngIfElse",c),o(9),C(" ",n.npc.classificacao),o(5),C(" ",n.npc.tipo),o(5),C(" ",n.npc.alinhamento||"N\xE3o definido"),o(9),d(n.npc.pontos_de_vida),o(6),d(n.npc.classe_armadura),o(6),d(n.npc.xp),o(6),d(n.npc.forca),o(6),d(n.npc.constituicao),o(6),d(n.npc.destreza),o(6),d(n.npc.sabedoria),o(6),d(n.npc.inteligencia),o(6),d(n.npc.energia),o(),l("ngIf",n.npc.descricao),o(),l("ngIf",n.npc.ataques)}}function B(a,r){a&1&&(e(0,"div",33),t(1," NPC n\xE3o encontrado. "),i())}function U(a,r){a&1&&(m(0),t(1,"\u2694\uFE0F"),f())}function V(a,r){a&1&&(m(0),x(1,"div",34),f())}function X(a,r){a&1&&(m(0),t(1,"\u270F\uFE0F"),f())}function G(a,r){a&1&&(m(0),x(1,"span",35),f())}function H(a,r){a&1&&(m(0),t(1,"\u{1F5D1}\uFE0F"),f())}function K(a,r){a&1&&(m(0),x(1,"span",35),f())}var T=class a{constructor(r,c,n){this.route=r;this.router=c;this.location=n}npc=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;processandoAdicionar=!1;npcRepo=new D("NPCs","NPCs");jogadorRepo=new D("Personagem","Personagem");ngOnInit(){return u(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(!r){this.router.navigate(["/npcs"]);return}try{this.carregando=!0;let n=(yield this.npcRepo.getLocal()).find(p=>String(p.id)===String(r))||null;n&&(this.npc=v({},n)),this.npcRepo.sync().then(p=>u(this,null,function*(){if(p){let s=(yield this.npcRepo.getLocal()).find(S=>String(S.id)===String(r));s&&(this.npc?Object.assign(this.npc,s):this.npc=v({},s))}})),n||(n=(yield this.npcRepo.forceFetch()).find(h=>String(h.id)===String(r))||null,n&&(this.npc=v({},n)))}catch(c){console.error("[NpcDetalhes] Erro ao carregar NPC:",c)}finally{this.carregando=!1}})}cancelar(){this.location.back()}editarNpc(){this.npc&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-npc",this.npc.id]),this.processandoEditar=!1},300))}excluirNpc(){return u(this,null,function*(){if(!(!this.npc||!confirm(`\u{1F5D1}\uFE0F Deseja realmente excluir "${this.npc.nome}"?`))){this.processandoExcluir=!0;try{yield this.npcRepo.delete(this.npc.index),alert("\u2705 NPC exclu\xEDdo com sucesso!"),this.router.navigate(["/npcs"])}catch(c){console.error("[NpcDetalhes] Erro ao excluir NPC:",c),alert("\u274C Erro ao excluir NPC. Veja o console.")}finally{this.processandoExcluir=!1}}})}adicionarAoCampo(){return u(this,null,function*(){if(this.npc){this.processandoAdicionar=!0;try{let r=yield this.jogadorRepo.getLocal();this.jogadorRepo.sync().then(s=>u(this,null,function*(){s&&(r=yield this.jogadorRepo.getLocal())}));let c=this.npc.nome.trim(),n=r.map(s=>String(s.personagem||"").trim().match(/^(\d+) - (.+)$/)).filter(s=>s&&s[2]===c).map(s=>parseInt(s[1],10)),p=n.length>0?Math.max(...n)+1:1,h={index:0,id:j.generateULID(),email:"",imagem:this.npc.imagem||"",nome_do_jogador:"NPC",personagem:`${p} - ${c}`,alinhamento:this.npc.alinhamento||"",pontos_de_vida:this.npc.pontos_de_vida,classe_de_armadura:this.npc.classe_armadura,forca:this.npc.forca,destreza:this.npc.destreza,constituicao:this.npc.constituicao,inteligencia:this.npc.inteligencia,sabedoria:this.npc.sabedoria,carisma:0,energia:this.npc.energia,nivel:1,xp:this.npc.xp,dano_tomado:0,tipo_jogador:"NPC",efeitos_temporarios:"",registo_de_jogo:"",classificacao:this.npc.classificacao,tipo:this.npc.tipo,descricao:this.npc.descricao,ataques:this.npc.ataques};yield this.jogadorRepo.create(h),alert(`\u2705 ${h.personagem} adicionado ao campo de batalha!`)}catch(r){console.error("[NpcDetalhes] Erro ao adicionar NPC no campo de batalha:",r),alert("\u274C Erro ao adicionar NPC. Veja o console.")}finally{this.processandoAdicionar=!1}}})}static \u0275fac=function(c){return new(c||a)(E(F),E(A),E(O))};static \u0275cmp=I({type:a,selectors:[["app-npc-detalhes"]],decls:18,vars:12,consts:[["noImagem",""],[1,"npc-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"npc-detalhe-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","card detalhe-card shadow-lg border-0",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-warning",3,"click","disabled"],[1,"fab","fab-danger",3,"click","disabled"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body","p-3"],[1,"info-list","mb-3"],[1,"fw-bold","mt-3","text-light"],[1,"atributos-grid","compact","mb-3"],[1,"atributo-item"],["class","mt-3",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mt-3"],[1,"fw-bold","text-light"],[1,"descricao-text"],[1,"ataques-text"],[1,"text-center","text-secondary","py-5"],["role","status",1,"spinner-border","text-light",2,"width","2rem","height","2rem"],[1,"spinner-border","spinner-border-sm"]],template:function(c,n){c&1&&(e(0,"div",1)(1,"div",2)(2,"div",3),g(3,R,4,0,"div",4)(4,J,84,17,"div",5)(5,B,2,0,"div",6),i()(),e(6,"div",7)(7,"button",8),_("click",function(){return n.adicionarAoCampo()}),g(8,U,2,0,"ng-container",9)(9,V,2,0,"ng-container",9),i(),e(10,"button",10),_("click",function(){return n.editarNpc()}),g(11,X,2,0,"ng-container",9)(12,G,2,0,"ng-container",9),i(),e(13,"button",11),_("click",function(){return n.excluirNpc()}),g(14,H,2,0,"ng-container",9)(15,K,2,0,"ng-container",9),i(),e(16,"button",12),_("click",function(){return n.cancelar()}),t(17," \u2B05\uFE0F "),i()()()),c&2&&(o(3),l("ngIf",n.carregando),o(),l("ngIf",!n.carregando&&n.npc),o(),l("ngIf",!n.carregando&&!n.npc),o(2),l("disabled",n.processandoAdicionar),o(),l("ngIf",!n.processandoAdicionar),o(),l("ngIf",n.processandoAdicionar),o(),l("disabled",n.processandoEditar),o(),l("ngIf",!n.processandoEditar),o(),l("ngIf",n.processandoEditar),o(),l("disabled",n.processandoExcluir),o(),l("ngIf",!n.processandoExcluir),o(),l("ngIf",n.processandoExcluir))},dependencies:[k,w],styles:[".npc-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.npc-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.info-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.95rem}.info-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;color:#f1f1f1}.info-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px 12px;font-size:.9rem;color:#f1f1f1}.atributo-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;white-space:nowrap;font-size:.9rem;background:#2a2a2a;border-radius:6px;padding:6px 10px}.atributo-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#ccc}.atributo-item[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#fff}.descricao-text[_ngcontent-%COMP%], .ataques-text[_ngcontent-%COMP%]{white-space:pre-line;background:#2a2a2a;border-radius:6px;padding:10px 12px;line-height:1.5;font-size:.95rem}.descricao-text[_ngcontent-%COMP%]{color:#f1f1f1}.ataques-text[_ngcontent-%COMP%]{color:#f8d775}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.npc-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{T as NpcDetalhes};
