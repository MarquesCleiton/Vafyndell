import{v as c}from"./chunk-YWTK67XE.js";import{a as u,b as T,d as i}from"./chunk-DIJLFEPN.js";var g=class d{DB_NAME="VafyndellDB";DB_VERSION=1;db=null;storeNames=new Set;static DEFAULT_STORES=["Catalogo","Inventario","Receitas","Personagem","Npcs","Anotacoes","metadados"];static create(){return i(this,null,function*(){let e=new d;return yield e.init(),e})}constructor(){}init(){return i(this,null,function*(){if(!this.db)return new Promise((e,s)=>{console.log(`[IndexedDBClient] Abrindo banco ${this.DB_NAME} v${this.DB_VERSION}...`);let r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=()=>s(r.error),r.onsuccess=()=>{this.db=r.result,this.storeNames=new Set(Array.from(this.db.objectStoreNames)),console.log("[IndexedDBClient] Banco aberto com stores:",Array.from(this.storeNames)),e()},r.onupgradeneeded=n=>{let t=n.target.result;console.log("[IndexedDBClient] Upgrade \u2192 garantindo stores..."),d.DEFAULT_STORES.forEach(o=>{t.objectStoreNames.contains(o)||(t.createObjectStore(o,{keyPath:"id"}),console.log(`[IndexedDBClient] Store criada: ${o}`))})}})})}put(e,s){return i(this,null,function*(){return new Promise((r,n)=>{let t=this.db.transaction(e,"readwrite");t.objectStore(e).put(s),t.oncomplete=()=>r(),t.onerror=()=>n(t.error)})})}bulkPut(e,s){return i(this,null,function*(){return new Promise((r,n)=>{let t=this.db.transaction(e,"readwrite"),o=t.objectStore(e);s.forEach(a=>o.put(a)),t.oncomplete=()=>r(),t.onerror=()=>n(t.error)})})}get(e,s){return i(this,null,function*(){return new Promise((r,n)=>{let o=this.db.transaction(e,"readonly").objectStore(e).get(s);o.onsuccess=()=>r(o.result||null),o.onerror=()=>n(o.error)})})}getAll(e){return i(this,null,function*(){return new Promise((s,r)=>{let t=this.db.transaction(e,"readonly").objectStore(e).getAll();t.onsuccess=()=>s(t.result),t.onerror=()=>r(t.error)})})}delete(e,s){return i(this,null,function*(){return new Promise((r,n)=>{let t=this.db.transaction(e,"readwrite");t.objectStore(e).delete(s),t.oncomplete=()=>r(),t.onerror=()=>n(t.error)})})}clear(e){return i(this,null,function*(){return new Promise((s,r)=>{let n=this.db.transaction(e,"readwrite");n.objectStore(e).clear(),n.oncomplete=()=>s(),n.onerror=()=>r(n.error)})})}deleteDatabase(){return i(this,null,function*(){return console.log("[IndexedDBClient] deleteDatabase \u2192 resetando banco..."),this.db&&(this.db.close(),this.db=null),new Promise((e,s)=>{let r=indexedDB.deleteDatabase(this.DB_NAME);r.onsuccess=()=>{this.storeNames.clear(),this.DB_VERSION=1,console.log("[IndexedDBClient] Banco deletado com sucesso."),e()},r.onerror=()=>s(r.error)})})}};var h=class{static ENDPOINT="https://script.google.com/macros/s/AKfycby-ec_h6sljntLAgoWhpeyBFGTkWygqS7Xx1Yvkx8RKDKiXDHPxtHZ8hhh6vrN91JEL/exec";static SHEET_ID="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g";static call(e,s,r=!0){return i(this,null,function*(){let n=c.getIdToken();if(!n||!c.isAuthenticated()){let l=yield c.refreshIdToken();if(!l)throw new Error("Usu\xE1rio precisa fazer login novamente.");n=l.idToken}let t={idToken:n,action:e,payload:T(u({},s),{sheetId:this.SHEET_ID})};console.log("\u27A1\uFE0F Enviando para Script:",this.ENDPOINT,t);let o=yield fetch(this.ENDPOINT,{method:"POST",body:JSON.stringify(t)}),a=yield o.text();if(!o.ok){if(console.error("\u274C Erro bruto do Script:",a),o.status===401&&r){if(console.warn("[ScriptClient] Token inv\xE1lido, tentando renovar..."),!(yield c.refreshIdToken()))throw new Error("Usu\xE1rio precisa se autenticar novamente.");return this.call(e,s,!1)}throw new Error(`Erro no Script: ${o.status} - ${o.statusText}
${a}`)}try{return JSON.parse(a)}catch(l){throw console.error("\u274C Resposta n\xE3o-JSON:",a),l}})}static createRow(e){return this.call("sheet.createRow",e)}static getAll(e){return this.call("sheet.getAll",e)}static getByIndex(e){return this.call("sheet.getByIndex",e)}static getCell(e){return this.call("sheet.getCell",e)}static updateByIndex(e){return this.call("sheet.updateByIndex",e)}static updateCell(e){return this.call("sheet.updateCell",e)}static deleteByIndex(e){return this.call("sheet.deleteByIndex",e)}static upload(e){return this.call("drive.upload",e)}static update(e){return this.call("drive.update",e)}static remove(e){return this.call("drive.delete",e)}static controllerCreate(e){return this.call("controller.create",e)}static controllerGetAll(e){return this.call("controller.getAll",e)}static controllerGetByIndex(e){return this.call("controller.getByIndex",e)}static controllerGetCell(e){return this.call("controller.getCell",e)}static controllerUpdateByIndex(e){return this.call("controller.updateByIndex",e)}static controllerUpdateCell(e){return this.call("controller.updateCell",e)}static controllerDeleteByIndex(e){return this.call("controller.deleteByIndex",e)}};export{g as a,h as b};
