import{a as k}from"./chunk-QWKS73CC.js";import{a as ae}from"./chunk-XQNWO7VY.js";import{c as L,f as G,g as H,h as K,i as Q,j as X,k as Y,q as Z,r as ee,s as te}from"./chunk-NOURQFKT.js";import{a as j}from"./chunk-W2L5F7JW.js";import{f as U,h as J}from"./chunk-P5XSKUQX.js";import{i as q,q as z}from"./chunk-UNL43WIN.js";import{Ab as f,Bb as t,Cb as r,Db as O,Hb as E,Ib as y,Jb as F,Nb as g,Pb as I,Sa as $,Ua as c,Za as P,Zb as D,a as A,bc as o,cc as N,dc as R,eb as T,ec as W,g as M,gc as b,hc as v,ic as w,jb as x,la as u,ma as m,sc as B}from"./chunk-XPYPFFIJ.js";function de(s,l){if(s&1&&(E(0),O(1,"img",32),y()),s&2){let i=I(2);c(),f("src",i.jogador.imagem,$)}}function ce(s,l){s&1&&(t(0,"div",33),o(1," \u{1F464} "),r())}function se(s,l){if(s&1&&(t(0,"div",23)(1,"div",24),x(2,de,2,1,"ng-container",25)(3,ce,2,0,"ng-template",null,1,B),t(5,"div")(6,"h5",26),o(7),r(),t(8,"div",27)(9,"span",28),o(10),r(),t(11,"span",29),o(12),r(),t(13,"span",30),o(14),r(),t(15,"span",31),o(16),r()()()()()),s&2){let i=D(4),e=I();c(2),f("ngIf",e.jogador.imagem&&e.jogador.imagem!=="-")("ngIfElse",i),c(5),N(e.jogador.personagem),c(3),W(" \u2764\uFE0F ",e.JogadorUtils.getVidaBase(e.jogador)-(e.jogador.dano_tomado||0),"/",e.JogadorUtils.getVidaBase(e.jogador)," "),c(2),R("\u{1F6E1}\uFE0F ",e.jogador.classe_de_armadura||0),c(2),R("\u{1F530} ",e.jogador.escudo||0),c(2),R("\u{1F4A5} ",e.jogador.dano_tomado||0)}}function le(s,l){s&1&&(E(0),o(1,"\u{1F48A} Recuperar"),y())}function ue(s,l){s&1&&(E(0),O(1,"span",34),o(2," Salvando... "),y())}var re=class s{constructor(l,i){this.route=l;this.router=i}jogador=null;recuperar=0;armadura=0;escudo=0;descricao="";salvando=!1;JogadorUtils=k;repo=new j("Personagem");repoRegistro=new j("Registro");ngOnInit(){return M(this,null,function*(){let l=this.route.snapshot.paramMap.get("id");if(!l){this.router.navigate(["/batalha"]);return}try{let i=yield this.repo.getLocal();if(this.jogador=i.find(e=>String(e.id)===l)||null,this.jogador)this.repo.sync().then(e=>M(this,null,function*(){if(e){let d=(yield this.repo.getLocal()).find(a=>String(a.id)===l);d&&(this.jogador=d)}}));else{let e=yield this.repo.forceFetch();this.jogador=e.find(n=>String(n.id)===l)||null}}catch(i){console.error("[Recuperacao] Erro ao carregar jogador:",i)}})}incrementarVida(){this.recuperar++}decrementarVida(){this.recuperar=Math.max(0,this.recuperar-1)}incrementarArmadura(){this.armadura++}decrementarArmadura(){this.armadura=Math.max(0,this.armadura-1)}incrementarEscudo(){this.escudo++}decrementarEscudo(){this.escudo=Math.max(0,this.escudo-1)}cancelar(){this.router.navigate(["/batalha"])}registrarRecuperacao(l){return M(this,null,function*(){if(this.jogador){this.salvando=!0;try{let i=k.getVidaBase(this.jogador),e=this.jogador.dano_tomado||0,n=i-e,d=this.jogador.classe_de_armadura||0,a=this.jogador.escudo||0,C=e;if(C<=0&&this.recuperar>0){alert(`\u26A0\uFE0F ${this.jogador.personagem} j\xE1 est\xE1 com a vida cheia!`);return}if(this.recuperar>C){alert(`\u26A0\uFE0F N\xE3o \xE9 poss\xEDvel recuperar mais do que ${C} de vida!`);return}if(this.recuperar<=0&&this.armadura<=0&&this.escudo<=0&&!this.descricao.trim()){alert("\u26A0\uFE0F Nenhuma altera\xE7\xE3o realizada. Ajuste vida, armadura, escudo ou adicione uma descri\xE7\xE3o.");return}let p=Math.min(this.recuperar,C),ie=n+p,S=d+this.armadura,V=a+this.escudo,h=`\u{1F4CB} PR\xC9VIA DA RECUPERA\xC7\xC3O

\u{1F496} ${this.jogador.personagem} se recuperar\xE1:
`;if(p>0&&(h+=`\u2764\uFE0F Vida: ${n}/${i} \u2192 ${ie}/${i} (+${p})
`),this.armadura>0&&(h+=`\u{1F6E1}\uFE0F Armadura: ${d} \u2192 ${S} (+${this.armadura})
`),this.escudo>0&&(h+=`\u{1F530} Escudo: ${a} \u2192 ${V} (+${this.escudo})
`),this.descricao?.trim()&&(h+=`\u{1F4DD} ${this.descricao}
`),!confirm(h+`
Deseja confirmar a recupera\xE7\xE3o?`)){this.salvando=!1;return}p>0&&(this.jogador.dano_tomado=Math.max(0,e-p)),this.armadura>0&&(this.jogador.classe_de_armadura=S),this.escudo>0&&(this.jogador.escudo=V);let ne=i-this.jogador.dano_tomado,_=`\u{1F496} ${this.jogador.personagem} se recuperou!
`;p>0&&(_+=`\u2764\uFE0F Vida: ${n}/${i} \u2192 ${ne}/${i} (+${p})
`),this.armadura>0&&(_+=`\u{1F6E1}\uFE0F Armadura: ${d} \u2192 ${S} (+${this.armadura})
`),this.escudo>0&&(_+=`\u{1F530} Escudo: ${a} \u2192 ${V} (+${this.escudo})
`),this.descricao?.trim()&&(_+=`\u{1F4DD} ${this.descricao}`);let oe={id:ae.generateULID(),jogador:this.jogador.email,alvo:this.jogador.email,tipo:"recuperacao",acao:"cura",detalhes:_,data:new Date().toISOString()};yield j.batch({updateById:{Personagem:[A({},this.jogador)]},create:{Registro:[oe]}}),alert(`\u2705 Recupera\xE7\xE3o salva!

`+_),this.router.navigate(["/batalha"])}catch(i){console.error("[Recuperacao] Erro ao registrar (batch):",i),alert("\u274C Erro ao registrar recupera\xE7\xE3o.")}finally{this.salvando=!1}}})}static \u0275fac=function(i){return new(i||s)(P(U),P(J))};static \u0275cmp=T({type:s,selectors:[["app-recuperacao"]],decls:45,vars:8,consts:[["form","ngForm"],["noImg",""],[1,"recuperacao-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"recuperacao-container","w-100"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","recuperar","min","0","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],["type","number","name","armadura","min","0",1,"quantidade-input",3,"ngModelChange","ngModel"],["type","number","name","escudo","min","0",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["rows","2","name","descricao","placeholder","Ex: recupera\xE7\xE3o de mana, po\xE7\xE3o de defesa...",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"preview-card","mb-3"],[1,"d-flex","align-items-center","justify-content-center"],[4,"ngIf","ngIfElse"],[1,"fw-bold","text-light","mb-1"],[1,"status-line","mt-2"],[1,"vida"],[1,"armadura"],[1,"escudo"],[1,"dano"],[1,"me-3","rounded",2,"width","60px","height","60px","object-fit","cover",3,"src"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-secondary","rounded",2,"width","60px","height","60px","font-size","1.5rem"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,e){if(i&1){let n=F();t(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),g("ngSubmit",function(){u(n);let a=D(4);return m(e.registrarRecuperacao(a))}),t(5,"div",6)(6,"div",7),x(7,se,17,8,"div",8),t(8,"div",9)(9,"label",10),o(10,"\u{1F48A} Recuperar Vida"),r(),t(11,"div",11)(12,"button",12),g("click",function(){return u(n),m(e.decrementarVida())}),o(13,"\u2212"),r(),t(14,"input",13),w("ngModelChange",function(a){return u(n),v(e.recuperar,a)||(e.recuperar=a),m(a)}),r(),t(15,"button",12),g("click",function(){return u(n),m(e.incrementarVida())}),o(16,"+"),r()()(),t(17,"div",9)(18,"label",10),o(19,"\u{1F6E1}\uFE0F Recuperar Armadura"),r(),t(20,"div",11)(21,"button",12),g("click",function(){return u(n),m(e.decrementarArmadura())}),o(22,"\u2212"),r(),t(23,"input",14),w("ngModelChange",function(a){return u(n),v(e.armadura,a)||(e.armadura=a),m(a)}),r(),t(24,"button",12),g("click",function(){return u(n),m(e.incrementarArmadura())}),o(25,"+"),r()()(),t(26,"div",9)(27,"label",10),o(28,"\u{1F530} Recuperar Escudo"),r(),t(29,"div",11)(30,"button",12),g("click",function(){return u(n),m(e.decrementarEscudo())}),o(31,"\u2212"),r(),t(32,"input",15),w("ngModelChange",function(a){return u(n),v(e.escudo,a)||(e.escudo=a),m(a)}),r(),t(33,"button",12),g("click",function(){return u(n),m(e.incrementarEscudo())}),o(34,"+"),r()()(),t(35,"div",16)(36,"label",17),o(37,"\u{1F4DD} Descri\xE7\xE3o"),r(),t(38,"textarea",18),w("ngModelChange",function(a){return u(n),v(e.descricao,a)||(e.descricao=a),m(a)}),r()(),t(39,"div",19)(40,"button",20),g("click",function(){return u(n),m(e.cancelar())}),o(41,"\u2B05 Cancelar"),r(),t(42,"button",21),x(43,le,2,0,"ng-container",22)(44,ue,3,0,"ng-container",22),r()()()()()()()()}if(i&2){let n=D(4);c(7),f("ngIf",e.jogador),c(7),b("ngModel",e.recuperar),c(9),b("ngModel",e.armadura),c(9),b("ngModel",e.escudo),c(6),b("ngModel",e.descricao),c(4),f("disabled",n.invalid||e.salvando),c(),f("ngIf",!e.salvando),c(),f("ngIf",e.salvando)}},dependencies:[z,q,te,X,L,Y,G,H,ee,Z,Q,K],styles:[".recuperacao-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.recuperacao-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px}.status-line[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#dc3545}.status-line[_ngcontent-%COMP%]   .dano[_ngcontent-%COMP%], .status-line[_ngcontent-%COMP%]   .escudo[_ngcontent-%COMP%]{color:#ffc107}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#0dcaf0}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.75rem 1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d}.status-line[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;font-weight:600;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#ff4d6d}.status-line[_ngcontent-%COMP%]   .dano[_ngcontent-%COMP%]{color:#ffc107}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#4da6ff}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}"]})};export{re as Recuperacao};
