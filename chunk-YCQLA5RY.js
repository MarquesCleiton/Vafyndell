import{c as U,f as W,i as G,r as H}from"./chunk-GFP7435U.js";import{b as k}from"./chunk-FLOHM7ZW.js";import{f as L,g as V,i as N,j as $,s as B,w as K}from"./chunk-WLM7QTUH.js";import{$b as h,Db as F,Eb as S,Fb as y,Jb as u,Lb as g,Pa as M,Qa as r,Va as O,Xb as f,Zb as c,_b as P,a as D,ab as E,b as C,bc as T,cc as A,d as b,dc as J,ec as R,fb as _,fc as z,ia as x,ja as I,kc as j,lc as q,wb as m,xb as a,yb as o,zb as w}from"./chunk-QQSIVCMV.js";function Z(i,t){if(i&1&&(a(0,"div",16)(1,"p",17),c(2," \u2696\uFE0F Peso total: "),a(3,"b"),c(4),j(5,"number"),o()()()),i&2){let e=g();r(4),h("",q(5,1,e.resumo.pesoTotal,"1.0-2")," kg")}}function ee(i,t){i&1&&(a(0,"div",18),w(1,"div",19),a(2,"p",20),c(3,"Carregando invent\xE1rio..."),o()())}function te(i,t){i&1&&(a(0,"div",21),c(1," Nenhum item encontrado. "),o())}function ne(i,t){if(i&1&&w(0,"img",41),i&2){let e=g().$implicit;m("alt",z(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,M)}}function ie(i,t){i&1&&(a(0,"span"),c(1,"\u{1F4E6}"),o())}function ae(i,t){if(i&1&&(a(0,"p",42),c(1),o()),i&2){let e=g().$implicit;r(),h("\u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito," ")}}function oe(i,t){if(i&1&&(a(0,"p",43),c(1),o()),i&2){let e=g().$implicit;r(),h("\u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function re(i,t){if(i&1){let e=y();a(0,"div",29)(1,"div",30)(2,"div",31),u("click",function(){let l=x(e).$implicit,s=g(5);return I(s.abrirItem(l.id))}),a(3,"div",32)(4,"div",33),_(5,ne,1,3,"img",34)(6,ie,2,0,"span",12),o(),a(7,"div")(8,"h6",35),c(9),o(),a(10,"small",36),c(11),o()()(),_(12,ae,2,1,"p",37)(13,oe,2,1,"p",38),o(),a(14,"div",39)(15,"button",40),u("click",function(l){let s=x(e).$implicit,d=g(5);return I(d.trocarItem(s.id,l))}),c(16," \u{1F504} Trocar "),o()()()()}if(i&2){let e=t.$implicit;r(5),m("ngIf",(e.itemDetalhe==null?null:e.itemDetalhe.imagem)&&(e.itemDetalhe==null?null:e.itemDetalhe.imagem)!=="-"),r(),m("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)||(e.itemDetalhe==null?null:e.itemDetalhe.imagem)==="-"),r(3),h(" ",(e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"," "),r(2),T(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",(e.itemDetalhe==null?null:e.itemDetalhe.peso)||0," kg "),r(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),r(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function le(i,t){if(i&1&&(a(0,"div",20)(1,"div",27),_(2,re,17,8,"div",28),o()()),i&2){let e=g(2).$implicit;r(2),m("ngForOf",e.itens)}}function se(i,t){if(i&1){let e=y();a(0,"div",24)(1,"button",25),u("click",function(){x(e);let l=g().$implicit,s=g(2);return I(s.toggleCategoria(l))}),a(2,"span"),c(3),o(),a(4,"span"),c(5),o()(),_(6,le,3,1,"div",26),o()}if(i&2){let e=g().$implicit;r(3),P(e.nome),r(2),P(e.expandido?"\u2212":"+"),r(),m("ngIf",e.expandido)}}function ce(i,t){if(i&1&&(F(0),_(1,se,7,3,"div",23),S()),i&2){let e=t.$implicit,n=g(2);r(),m("ngIf",n.pertenceAba(e.nome))}}function de(i,t){if(i&1&&(a(0,"div"),_(1,ce,2,1,"ng-container",22),o()),i&2){let e=g();r(),m("ngForOf",e.categoriasFiltradas)}}var Q=class i{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="recursos";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};catalogoRepo=new k("Catalogo","Catalogo");inventarioRepo=new k("Inventario","Inventario");mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return b(this,null,function*(){try{this.carregando=!0;let t=K.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");yield this.loadLocalAndSync(t.email)}catch(t){console.error("[InventarioJogador] \u274C Erro ao carregar invent\xE1rio:",t)}finally{this.carregando=!1}})}loadLocalAndSync(t){return b(this,null,function*(){let[e,n]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),l=n.filter(s=>s.jogador===t);if(this.processarInventario(l,e),b(this,null,function*(){let s=yield this.catalogoRepo.sync(),d=yield this.inventarioRepo.sync();if(s||d){let[p,v]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),X=v.filter(Y=>Y.jogador===t);this.processarInventario(X,p)}}),!l.length){yield this.catalogoRepo.forceFetch(),yield this.inventarioRepo.forceFetch();let[s,d]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),p=d.filter(v=>v.jogador===t);this.processarInventario(p,s)}})}processarInventario(t,e){let n=t.map(d=>{let p=e.find(v=>String(v.id)===String(d.item_catalogo));return C(D({},d),{itemDetalhe:p})}),l=new Map(this.categorias.map(d=>[d.nome,d.expandido])),s=new Map;n.forEach(d=>{let p=d.itemDetalhe?.categoria||"Outros";s.has(p)||s.set(p,[]),s.get(p).push(d)}),this.categorias=Array.from(s.entries()).sort(([d],[p])=>d.localeCompare(p)).map(([d,p])=>({nome:d,itens:p,expandido:l.get(d)??!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,n)=>e+(n.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,n)=>e+(n.quantidade||0)*(n.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>{let n=e.itens.filter(l=>[l.itemDetalhe?.nome,l.itemDetalhe?.raridade,l.itemDetalhe?.efeito,l.itemDetalhe?.colateral,l.itemDetalhe?.categoria].map(s=>this.normalizarTexto(String(s||""))).some(s=>s.includes(t)));return C(D({},e),{itens:n,expandido:n.length>0})}).filter(e=>e.itens.length>0)}normalizarTexto(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(t){this.abaAtiva=t}pertenceAba(t){return t?this.mapaAbas[this.abaAtiva].includes(t):this.abaAtiva==="outros"}toggleCategoria(t){t.expandido=!t.expandido}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}abrirTroca(){this.router.navigate(["/troca-de-itens"])}trocarItem(t,e){e.stopPropagation(),this.router.navigate(["/troca-de-itens",t])}static \u0275fac=function(e){return new(e||i)(O(B))};static \u0275cmp=E({type:i,selectors:[["app-inventario-jogador"]],decls:29,vars:13,consts:[[1,"inventario-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0","z-10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","search-bar",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-container","w-100"],[1,"fw-bold","mb-3"],["class","card resumo-card mb-4 p-3 shadow-sm",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"fab","fab-success",3,"click"],[1,"card","resumo-card","mb-4","p-3","shadow-sm"],[1,"mb-1","text-light"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-secondary","py-5"],[4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-3"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","h-100","p-3","shadow-sm"],[3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","mb-1","text-light"],[1,"item-meta"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[1,"text-end","mt-2"],[1,"btn","btn-sm","btn-success",3,"click"],[3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"input",2),R("ngModelChange",function(s){return J(n.filtro,s)||(n.filtro=s),s}),u("input",function(){return n.aplicarFiltro()}),o()(),a(3,"ul",3)(4,"li",4)(5,"button",5),u("click",function(){return n.selecionarAba("recursos")}),c(6,"\u{1F33F} Recursos"),o()(),a(7,"li",4)(8,"button",5),u("click",function(){return n.selecionarAba("equipamentos")}),c(9,"\u2694\uFE0F Equipamentos"),o()(),a(10,"li",4)(11,"button",5),u("click",function(){return n.selecionarAba("pocoes")}),c(12,"\u{1F9EA} Po\xE7\xF5es"),o()(),a(13,"li",4)(14,"button",5),u("click",function(){return n.selecionarAba("outros")}),c(15,"\u{1F4E6} Outros"),o()()(),a(16,"div",6)(17,"div",7)(18,"h4",8),c(19,"\u{1F392} Invent\xE1rio"),o(),_(20,Z,6,4,"div",9)(21,ee,4,0,"div",10)(22,te,2,0,"div",11)(23,de,2,1,"div",12),o()(),a(24,"div",13)(25,"button",14),u("click",function(){return n.novoItemInventario()}),c(26,"\uFF0B"),o(),a(27,"button",15),u("click",function(){return n.abrirTroca()}),c(28," \u{1F504} "),o()()()),e&2&&(r(2),A("ngModel",n.filtro),r(3),f("active",n.abaAtiva==="recursos"),r(3),f("active",n.abaAtiva==="equipamentos"),r(3),f("active",n.abaAtiva==="pocoes"),r(3),f("active",n.abaAtiva==="outros"),r(6),m("ngIf",!n.carregando&&n.categoriasFiltradas.length>0),r(),m("ngIf",n.carregando),r(),m("ngIf",!n.carregando&&n.categoriasFiltradas.length===0),r(),m("ngIf",!n.carregando))},dependencies:[$,L,V,H,U,W,G,N],styles:[".nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}.inventario-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.inventario-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:20px;padding:.5rem 1rem}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.resumo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.inventario-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;cursor:pointer;transition:transform .15s ease}.inventario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.inventario-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.item-meta[_ngcontent-%COMP%]{color:#bbb;font-size:.85rem}.inventario-card[_ngcontent-%COMP%]   .btn-success[_ngcontent-%COMP%]{font-size:.85rem;padding:4px 8px;border-radius:6px}.fab-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.fab-success[_ngcontent-%COMP%]:hover{background:#218838}"]})};export{Q as InventarioJogador};
