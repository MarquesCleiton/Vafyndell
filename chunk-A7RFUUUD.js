import{a as W,b as pe}from"./chunk-3E4ZF6LB.js";import{a as R}from"./chunk-XQNWO7VY.js";import{c as Y,f as $,g as ee,h as ie,i as te,j as ne,m as ae,n as re,o as oe,r as de,s as le}from"./chunk-IQUV2DCR.js";import{a as M}from"./chunk-SL4CV3BB.js";import{f as K,h as X}from"./chunk-XMJCILQE.js";import{h as U,i as G,p as J}from"./chunk-ZOZAG657.js";import{Ab as c,Bb as l,Cb as d,Db as P,Hb as H,Ib as O,Jb as x,Nb as _,Pb as u,Tb as j,Ua as r,Ub as Q,Vb as Z,Za as V,Zb as N,a as k,b as I,ba as z,bc as s,cc as F,dc as D,eb as L,f as me,g as S,gc as w,hc as C,ic as y,jb as b,la as p,ma as g,nb as B,za as q}from"./chunk-YAKM3PEZ.js";var ce=me(pe());W.use(ce.default);var A=class a{repoCaminho=new M("Caminhos");repoArvore=new M("Arvores");repoHab=new M("Habilidades");caminhos=[];arvores=[];habilidades=[];carregarTudo(){return S(this,null,function*(){this.caminhos=(yield this.repoCaminho.getLocal()).map(i=>I(k({},i),{id:String(i.id)})),this.arvores=(yield this.repoArvore.getLocal()).map(i=>I(k({},i),{id:String(i.id),caminho:String(i.caminho)})),this.habilidades=(yield this.repoHab.getLocal()).map(i=>I(k({},i),{id:String(i.id),caminho:String(i.caminho),arvore:String(i.arvore),dependencia:i.dependencia?String(i.dependencia):null}))})}getArvoresDoCaminho(i){return i?this.arvores.filter(e=>String(e.caminho)===String(i)):[]}getHabilidadesDaArvore(i){return i&&i!=="nova"?this.habilidades.filter(e=>String(e.arvore)===String(i)):[]}renderPreview(i,e,t,n,o,v){let h=[];if(e.forEach(m=>{t.id&&String(m.id)===String(t.id)||(h.push({data:{id:String(m.id),label:`${m.habilidade}`}}),m.dependencia&&h.push({data:{source:String(m.dependencia),target:String(m.id)}}))}),t.caminho&&t.arvore){let m=t.id||"novaHab",T=t.habilidade?`${t.habilidade}`:"Nova Habilidade";h.push({data:{id:String(m),label:T},classes:o?"habilidade-edit":"nova-habilidade"}),n&&h.push({data:{source:String(n),target:String(m)}})}let f=W({container:i,elements:h,style:[{selector:"node",style:{"background-color":"#222","border-color":"#555","border-width":2,label:"data(label)",color:"#eee","text-valign":"center","text-halign":"center",width:"65px",height:"65px","font-size":"10px","text-wrap":"wrap","text-max-width":"90px",shape:"ellipse"}},{selector:"node.habilidade-edit",style:{"background-color":"#0056b3","border-color":"#0d6efd","border-width":4,color:"#fff"}},{selector:"node.nova-habilidade",style:{"background-color":"#007bff","border-color":"#fff","border-width":3,color:"#fff"}},{selector:"edge",style:{width:2,"line-color":"#666","curve-style":"unbundled-bezier","control-point-distances":[-30,30],"control-point-weights":[.5,.5]}}],layout:{name:"dagre",rankDir:"TB",nodeSep:100,rankSep:80},autoungrabify:!0,userZoomingEnabled:!0,userPanningEnabled:!0});return f.on("tap","node",m=>{let T=String(m.target.id()),E=e.find(ue=>String(ue.id)===T)||null;v(E)}),f}salvarHabilidade(i,e,t,n,o,v,h){return S(this,null,function*(){let f={},m={},T={};if(t==="nova"&&o.trim()){let E={id:R.generateULID(),caminho:String(e||""),arvore:o.trim()};v.push(E),t=E.id,f.Arvores=[E]}return i.id=String(i.id||R.generateULID()),i.caminho=String(e||""),i.arvore=String(t||""),i.dependencia=n?String(n):null,h.find(E=>String(E.id)===i.id)?(m.Habilidades||(m.Habilidades=[]),m.Habilidades.push(i)):(f.Habilidades||(f.Habilidades=[]),f.Habilidades.push(i)),yield M.batch({create:Object.keys(f).length?f:void 0,updateById:Object.keys(m).length?m:void 0,deleteById:Object.keys(T).length?T:void 0})})}excluirHabilidade(i){return S(this,null,function*(){return yield M.batch({deleteById:{Habilidades:[{id:String(i)}]}})})}excluirHabilidadeComDependencias(i,e){return S(this,null,function*(){let t=e.filter(o=>String(o.dependencia)===String(i));if(t.length>0){let o=t.map(h=>`- ${h.habilidade}`).join(`
`);if(!confirm(`\u26A0\uFE0F Esta habilidade possui dependentes:

${o}

Se continuar, esses v\xEDnculos ser\xE3o removidos. Deseja prosseguir?`))return!1;t.forEach(h=>{h.dependencia=null,h.id=String(h.id);let f=e.findIndex(m=>String(m.id)===String(h.id));f!==-1&&(e[f]=k({},h))})}let n={};return t.length>0&&(n.Habilidades=t),yield M.batch({deleteById:{Habilidades:[{id:String(i)}]},updateById:Object.keys(n).length?n:void 0}),!0})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=z({token:a,factory:a.\u0275fac,providedIn:"root"})};var ve=["cyPreview"];function fe(a,i){if(a&1&&(l(0,"div",27)(1,"span"),s(2,"\u{1F4CC} Requisito:"),d(),s(3),d()),a&2){let e=u(2);r(3),D(" ",e.habilidadeSelecionada.requisitos," ")}}function _e(a,i){if(a&1&&(l(0,"div",23)(1,"h4",24),s(2),d(),l(3,"p",25),s(4),d(),b(5,fe,4,1,"div",26),d()),a&2){let e=u();r(2),D(" ",e.habilidadeSelecionada.habilidade," "),r(2),F(e.habilidadeSelecionada.descricao),r(),c("ngIf",e.habilidadeSelecionada.requisitos)}}function be(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;c("ngValue",e.id),r(),F(e.caminho)}}function Se(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;c("ngValue",e.id),r(),D(" ",e.arvore," ")}}function xe(a,i){if(a&1){let e=x();l(0,"div",31)(1,"input",32),y("ngModelChange",function(n){p(e);let o=u(2);return C(o.novaArvoreNome,n)||(o.novaArvoreNome=n),g(n)}),_("ngModelChange",function(){p(e);let n=u(2);return g(n.atualizarPreview())}),d()()}if(a&2){let e=u(2);r(),w("ngModel",e.novaArvoreNome)}}function we(a,i){if(a&1){let e=x();l(0,"div",11)(1,"label",12),s(2,"\u{1F333} \xC1rvore"),d(),l(3,"select",29),y("ngModelChange",function(n){p(e);let o=u();return C(o.arvoreSelecionada,n)||(o.arvoreSelecionada=n),g(n)}),_("ngModelChange",function(n){p(e);let o=u();return g(o.onArvoreChange(n))}),l(4,"option",14),s(5,"Selecione..."),d(),b(6,Se,2,2,"option",15),l(7,"option",28),s(8,"\u2795 Nova \xC1rvore"),d()(),b(9,xe,2,1,"div",30),d()}if(a&2){let e=u();r(3),w("ngModel",e.arvoreSelecionada),r(),c("ngValue",null),r(2),c("ngForOf",e.arvoresDoCaminho),r(),c("ngValue","nova"),r(2),c("ngIf",e.arvoreSelecionada==="nova")}}function Ce(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;c("ngValue",e.id),r(),D(" ",e.habilidade," ")}}function ye(a,i){if(a&1){let e=x();l(0,"div",11)(1,"label",12),s(2,"\u{1F517} Depend\xEAncia"),d(),l(3,"select",33),y("ngModelChange",function(n){p(e);let o=u();return C(o.dependenciaSelecionada,n)||(o.dependenciaSelecionada=n),g(n)}),_("ngModelChange",function(){p(e);let n=u();return g(n.atualizarPreview())}),l(4,"option",28),s(5,"Nenhuma"),d(),b(6,Ce,2,2,"option",15),d()()}if(a&2){let e=u();r(3),w("ngModel",e.dependenciaSelecionada),r(),c("ngValue",null),r(2),c("ngForOf",e.habilidadesDaArvore)}}function Ee(a,i){if(a&1){let e=x();l(0,"div",11)(1,"label",12),s(2,"\u{1F3F7}\uFE0F Nome"),d(),l(3,"input",34),y("ngModelChange",function(n){p(e);let o=u();return C(o.habilidadeEdit.habilidade,n)||(o.habilidadeEdit.habilidade=n),g(n)}),_("ngModelChange",function(){p(e);let n=u();return g(n.atualizarPreview())}),d()()}if(a&2){let e=u();r(3),w("ngModel",e.habilidadeEdit.habilidade)}}function ke(a,i){if(a&1){let e=x();l(0,"div",11)(1,"label",12),s(2,"\u{1F4CC} Requisitos"),d(),l(3,"textarea",35),y("ngModelChange",function(n){p(e);let o=u();return C(o.habilidadeEdit.requisitos,n)||(o.habilidadeEdit.requisitos=n),g(n)}),_("ngModelChange",function(){p(e);let n=u();return g(n.atualizarPreview())}),d()()}if(a&2){let e=u();r(3),w("ngModel",e.habilidadeEdit.requisitos)}}function De(a,i){if(a&1){let e=x();l(0,"div",11)(1,"label",12),s(2,"\u{1F4DD} Descri\xE7\xE3o"),d(),l(3,"textarea",36),y("ngModelChange",function(n){p(e);let o=u();return C(o.habilidadeEdit.descricao,n)||(o.habilidadeEdit.descricao=n),g(n)}),_("ngModelChange",function(){p(e);let n=u();return g(n.atualizarPreview())}),d()()}if(a&2){let e=u();r(3),w("ngModel",e.habilidadeEdit.descricao)}}function Me(a,i){a&1&&(H(0),s(1,"\u{1F4BE}"),O())}function Te(a,i){a&1&&(H(0),P(1,"span",37),O())}function Ve(a,i){if(a&1){let e=x();l(0,"button",38),_("click",function(){p(e);let n=u();return g(n.excluir())}),s(1,"\u{1F5D1}\uFE0F"),d()}}var se=class a{constructor(i,e,t,n,o){this.route=i;this.router=e;this.habilidadeService=t;this.el=n;this.zone=o}cyPreviewRef;cyInstance=null;carregando=!0;salvando=!1;editMode=!1;caminhoSelecionado=null;arvoreSelecionada=null;dependenciaSelecionada=null;novaArvoreNome="";habilidadeEdit={id:"",caminho:"",arvore:"",habilidade:"",requisitos:"",descricao:"",dependencia:null};habilidadeSelecionada=null;ngAfterViewInit(){this.renderPreview(),this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(e=>{e.style.height="auto";let t=200;e.style.height=Math.min(e.scrollHeight,t)+"px",e.removeEventListener("input",this.autoResize),e.addEventListener("input",this.autoResize)})}autoResize=i=>{let e=i.target;e.style.height="auto";let t=200;e.style.height=Math.min(e.scrollHeight,t)+"px"};ngOnInit(){return S(this,null,function*(){yield this.habilidadeService.carregarTudo();let i=this.route.snapshot.paramMap.get("id");if(i){let e=this.habilidadeService.habilidades.find(t=>String(t.id)===String(i));e&&(this.habilidadeEdit={id:String(e.id),caminho:String(e.caminho),arvore:String(e.arvore),habilidade:e.habilidade,requisitos:e.requisitos||"",descricao:e.descricao||"",dependencia:e.dependencia?String(e.dependencia):null},this.caminhoSelecionado=this.habilidadeEdit.caminho,this.arvoreSelecionada=this.habilidadeEdit.arvore,this.dependenciaSelecionada=this.habilidadeEdit.dependencia,this.editMode=!0,this.onCaminhoChange(this.caminhoSelecionado,!1),this.onArvoreChange(this.arvoreSelecionada),this.atualizarPreview())}this.renderPreview()})}get arvoresDoCaminho(){return this.habilidadeService.getArvoresDoCaminho(this.caminhoSelecionado)}get habilidadesDaArvore(){return this.habilidadeService.getHabilidadesDaArvore(this.arvoreSelecionada)}onCaminhoChange(i,e=!0){this.caminhoSelecionado=i?String(i):null,e&&(this.arvoreSelecionada=null),this.atualizarPreview()}onArvoreChange(i){this.arvoreSelecionada=i?String(i):null,i==="nova"&&(this.novaArvoreNome=""),this.atualizarPreview()}renderPreview(){this.cyPreviewRef&&(this.cyInstance&&this.cyInstance.destroy(),this.cyInstance=this.habilidadeService.renderPreview(this.cyPreviewRef.nativeElement,this.habilidadesDaArvore,this.habilidadeEdit,this.dependenciaSelecionada,this.editMode,i=>this.habilidadeSelecionada=i))}salvar(i){return S(this,null,function*(){if(!i.invalid)try{this.salvando=!0,yield this.habilidadeService.salvarHabilidade(this.habilidadeEdit,this.caminhoSelecionado,this.arvoreSelecionada,this.dependenciaSelecionada,this.novaArvoreNome,this.habilidadeService.arvores,this.habilidadeService.habilidades),alert("\u2705 Habilidade salva com sucesso!"),this.router.navigate(["/skilltree"])}catch(e){console.error(e),alert("\u274C Erro ao salvar")}finally{this.salvando=!1}})}excluir(){return S(this,null,function*(){if(this.habilidadeEdit.id)try{this.salvando=!0,(yield this.habilidadeService.excluirHabilidadeComDependencias(this.habilidadeEdit.id,this.habilidadeService.habilidades))&&(alert("\u{1F5D1}\uFE0F Habilidade exclu\xEDda com sucesso!"),this.router.navigate(["/skilltree"]))}catch(i){console.error("[EdicaoSkillTree] \u274C Erro ao excluir:",i),alert("\u274C Erro ao excluir")}finally{this.salvando=!1}})}atualizarPreview(){setTimeout(()=>{this.habilidadeEdit.caminho=this.caminhoSelecionado||"",this.habilidadeEdit.arvore=this.arvoreSelecionada||"",this.renderPreview(),this.habilidadeSelecionada=k({},this.habilidadeEdit),this.scheduleAutoExpand()},0)}get arvoreSelecionadaNome(){if(this.arvoreSelecionada==="nova")return this.novaArvoreNome||"Nova \xC1rvore";let i=this.habilidadeService.arvores.find(e=>String(e.id)===String(this.arvoreSelecionada));return i?i.arvore:"Sem \xE1rvore"}get caminhos(){return this.habilidadeService.caminhos}get arvores(){return this.habilidadeService.arvores}get habilidades(){return this.habilidadeService.habilidades}static \u0275fac=function(e){return new(e||a)(V(K),V(X),V(A),V(q),V(B))};static \u0275cmp=L({type:a,selectors:[["app-edicao-skilltree"]],viewQuery:function(e,t){if(e&1&&j(ve,5),e&2){let n;Q(n=Z())&&(t.cyPreviewRef=n.first)}},decls:34,vars:15,consts:[["cyPreview",""],["form","ngForm"],[1,"edicao-skilltree-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"edicao-skilltree-container","w-100"],[1,"page-title"],[1,"preview-wrapper","mt-4"],[1,"text-light"],[1,"cy-preview"],["class","detalhe-card shadow-lg mt-4 p-3",4,"ngIf"],["id","formSkillTree",3,"ngSubmit"],[1,"mb-3"],[1,"form-label"],["name","caminhoSelecionado","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"fab-stack"],["type","submit","form","formSkillTree",1,"fab","fab-success",3,"disabled"],[4,"ngIf"],["type","button","class","fab fab-danger",3,"click",4,"ngIf"],["type","button",1,"fab","fab-warning",3,"click"],[1,"pb-5","mb-5"],[1,"detalhe-card","shadow-lg","mt-4","p-3"],[1,"detalhe-nome"],[1,"detalhe-descricao"],["class","detalhe-extra",4,"ngIf"],[1,"detalhe-extra"],[3,"ngValue"],["name","arvoreSelecionada","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["class","mt-2",4,"ngIf"],[1,"mt-2"],["type","text","name","novaArvoreNome","placeholder","Digite o nome da nova \xE1rvore",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","dependenciaSelecionada",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["type","text","name","habilidade","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["rows","3","name","requisitos",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["rows","3","name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"spinner-border","spinner-border-sm"],["type","button",1,"fab","fab-danger",3,"click"]],template:function(e,t){if(e&1){let n=x();l(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),s(4),d(),l(5,"div",6)(6,"h4",7),s(7),d(),P(8,"div",8,0),d(),b(10,_e,6,3,"div",9),l(11,"form",10,1),_("ngSubmit",function(){p(n);let v=N(12);return g(t.salvar(v))}),l(13,"div",11)(14,"label",12),s(15,"\u{1F310} Caminho"),d(),l(16,"select",13),y("ngModelChange",function(v){return p(n),C(t.caminhoSelecionado,v)||(t.caminhoSelecionado=v),g(v)}),_("ngModelChange",function(v){return p(n),g(t.onCaminhoChange(v))}),l(17,"option",14),s(18,"Selecione..."),d(),b(19,be,2,2,"option",15),d()(),b(20,we,10,5,"div",16)(21,ye,7,3,"div",16)(22,Ee,4,1,"div",16)(23,ke,4,1,"div",16)(24,De,4,1,"div",16),d()()(),l(25,"div",17)(26,"button",18),b(27,Me,2,0,"ng-container",19)(28,Te,2,0,"ng-container",19),d(),b(29,Ve,2,0,"button",20),l(30,"button",21),_("click",function(){return p(n),g(t.router.navigate(["/skilltree"]))}),s(31,"\u2B05\uFE0F"),d()()(),P(32,"div",22)(33,"div",22)}if(e&2){let n=N(12);r(4),D("\u{1F6E0}\uFE0F ",t.editMode?"Editar":"Cadastro"," da SkillTree"),r(3),D("\u{1F50E} Pr\xE9via \u2014 ",t.arvoreSelecionadaNome),r(3),c("ngIf",t.habilidadeSelecionada),r(6),w("ngModel",t.caminhoSelecionado),r(),c("ngValue",null),r(2),c("ngForOf",t.caminhos),r(),c("ngIf",t.caminhoSelecionado),r(),c("ngIf",t.arvoreSelecionada),r(),c("ngIf",t.arvoreSelecionada),r(),c("ngIf",t.arvoreSelecionada),r(),c("ngIf",t.arvoreSelecionada),r(2),c("disabled",(n==null?null:n.invalid)||t.salvando),r(),c("ngIf",!t.salvando),r(),c("ngIf",t.salvando),r(),c("ngIf",t.editMode)}},dependencies:[J,U,G,le,ne,re,oe,Y,ae,$,ee,de,te,ie],styles:[".edicao-skilltree-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden;border:1px solid #333}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border:1px solid #444!important;border-radius:6px;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd!important;box-shadow:0 0 0 .2rem #0d6efd40!important;outline:none!important}textarea[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px;resize:vertical}textarea[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.cy-preview[_ngcontent-%COMP%]{width:100%;height:400px;min-height:300px;background:#111;border:1px solid #333;border-radius:8px;margin-top:10px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545,#a71d2a);color:#fff}node.habilidade-edit[_ngcontent-%COMP%]{background-color:#0056b3!important;border:3px solid #0d6efd!important;color:#fff!important}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}"]})};export{se as EdicaoSkillTree};
