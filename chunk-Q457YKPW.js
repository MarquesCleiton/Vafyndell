import{a as p}from"./chunk-ABDDRN72.js";import{q as T}from"./chunk-PF4VWC54.js";import"./chunk-LACG63BB.js";import{Ga as c,Ha as r,Ia as d,Ja as _,Kb as j,Lb as F,Na as C,Oa as y,Ob as J,Pa as M,Ra as x,S as f,T as b,Ta as s,Xb as S,bb as O,d as m,fb as l,gb as E,ha as P,hb as h,ia as o,ib as B,ma as I,nb as k,qa as D,tb as w,ua as g}from"./chunk-MZUA6OGT.js";var v=class{static getVidaBase(t){return t.pontos_de_vida>0?t.pontos_de_vida:t.energia+t.constituicao}static getVidaTotal(t){let e=this.getVidaBase(t),n=t.classe_de_armadura||0,i=t.dano_tomado||0;return e+n-i}static getVidaAtual(t){let e=this.getVidaBase(t),n=t.dano_tomado||0;return e-n}static estaMorto(t){return this.getVidaTotal(t)<=0}};function N(a,t){a&1&&(r(0,"div",7),_(1,"div",8),r(2,"p",9),l(3,"Carregando jogadores..."),d()())}function $(a,t){a&1&&(r(0,"span",31),l(1,"\u{1F480}"),d())}function A(a,t){if(a&1&&_(0,"img",32),a&2){let e=s().$implicit;c("alt",k(e.personagem))("src",e.imagem,P)}}function L(a,t){a&1&&(r(0,"span",19),l(1,"\u{1F464}"),d())}function U(a,t){if(a&1&&(r(0,"span"),l(1),d()),a&2){let e=s().$implicit;o(),h("| ",e.tipo)}}function R(a,t){a&1&&(C(0),_(1,"span",34),y())}function z(a,t){a&1&&l(0,"\u{1F5D1}\uFE0F")}function q(a,t){if(a&1){let e=M();r(0,"button",33),x("click",function(){f(e);let i=s().$implicit,u=s(2);return b(u.excluirNpcDaBatalha(i))}),g(1,R,2,0,"ng-container",30)(2,z,1,0,"ng-template",null,1,w),d()}if(a&2){let e=O(3),n=s().$implicit,i=s(2);c("disabled",i.processando[n.id]==="excluir"),o(),c("ngIf",i.processando[n.id]==="excluir")("ngIfElse",e)}}function Y(a,t){a&1&&_(0,"div",35)}function G(a,t){a&1&&(C(0),_(1,"span",34),y())}function H(a,t){a&1&&l(0,"\u2694\uFE0F")}function K(a,t){if(a&1){let e=M();r(0,"div",11),x("click",function(){let i=f(e).$implicit,u=s(2);return b(u.abrirDetalhes(i))}),r(1,"div",12)(2,"div",13),g(3,$,2,0,"span",14)(4,A,1,3,"img",15)(5,L,2,0,"span",16),d(),r(6,"div",17)(7,"h6",18),l(8),d(),r(9,"small",19),l(10),g(11,U,2,1,"span",5),d()(),r(12,"div",20),x("click",function(i){return f(e),b(i.stopPropagation())}),r(13,"div",21)(14,"div",22),l(15),d(),r(16,"div",23),l(17),d()(),r(18,"div",24),l(19),d(),r(20,"div",25)(21,"div",26),g(22,q,4,3,"button",27)(23,Y,1,0,"div",28),d(),r(24,"button",29),x("click",function(){let i=f(e).$implicit,u=s(2);return b(u.acaoEspada(i))}),g(25,G,2,0,"ng-container",30)(26,H,1,0,"ng-template",null,0,w),d()()()()()}if(a&2){let e=t.$implicit,n=O(27),i=s(2);o(3),c("ngIf",i.JogadorUtils.estaMorto(e)),o(),c("ngIf",e.imagem&&!i.JogadorUtils.estaMorto(e)),o(),c("ngIf",!e.imagem&&!i.JogadorUtils.estaMorto(e)),o(3),E(e.personagem),o(2),h(" ",e.classificacao||"Jogador"," "),o(),c("ngIf",e.tipo),o(4),B(" \u2764\uFE0F ",i.JogadorUtils.getVidaTotal(e),"/",i.JogadorUtils.getVidaBase(e)+(e.classe_de_armadura||0)," "),o(2),h("\u{1F6E1}\uFE0F ",e.classe_de_armadura),o(2),h(" \u{1F4A5} Dano tomado: ",e.dano_tomado||0," "),o(3),c("ngIf",!e.email),o(),c("ngIf",e.email),o(),c("disabled",i.processando[e.id]==="espada"),o(),c("ngIf",i.processando[e.id]==="espada")("ngIfElse",n)}}function Q(a,t){if(a&1&&(r(0,"div"),g(1,K,28,15,"div",10),d()),a&2){let e=s();o(),c("ngForOf",e.jogadoresFiltrados)}}function W(a,t){a&1&&(r(0,"div",36),l(1," Nenhum jogador encontrado. "),d())}var V=class a{constructor(t){this.router=t}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=v;ngOnInit(){return m(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let t=yield p.getLocalJogadores();if(t.length>0&&(this.jogadores=t,this.aplicarFiltro(),this.carregando=!1),p.syncJogadores().then(e=>m(this,null,function*(){if(e){let n=yield p.getLocalJogadores();this.jogadores=n,this.aplicarFiltro()}})),t.length===0){let e=yield p.forceFetchJogador();e&&(this.jogadores=Array.isArray(e)?e:[e],this.aplicarFiltro()),this.carregando=!1}}catch(t){console.error("[Batalha] Erro ao carregar jogadores:",t),this.carregando=!1}})}aplicarFiltro(){let t=this.filtro.toLowerCase().trim();if(!t){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(e=>String(e.personagem||"").toLowerCase().includes(t)||String(e.nome_do_jogador||"").toLowerCase().includes(t)||String(e.classificacao||"").toLowerCase().includes(t)||String(e.tipo||"").toLowerCase().includes(t))}abrirDetalhes(t){return m(this,null,function*(){this.processando[t.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",t.id]),this.processando[t.id]=null},400)})}acaoEspada(t){return m(this,null,function*(){this.router.navigate(["/combate",t.id])})}excluirNpcDaBatalha(t){return m(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${t.personagem}" do campo de batalha?`)){this.processando[t.id]="excluir";try{yield p.deleteJogador(t.id),this.jogadores=this.jogadores.filter(n=>n.id!==t.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(n){console.error("[Batalha] Erro ao excluir NPC:",n),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[t.id]=null}}})}static \u0275fac=function(e){return new(e||a)(I(S))};static \u0275cmp=D({type:a,selectors:[["app-batalha"]],decls:5,vars:3,consts:[["espadaIcon",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["class","fs-3",4,"ngIf"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"fs-3"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(e,n){e&1&&(r(0,"div",2)(1,"div",3),g(2,N,4,0,"div",4)(3,Q,2,1,"div",5)(4,W,2,0,"div",6),d()()),e&2&&(o(2),c("ngIf",n.carregando),o(),c("ngIf",!n.carregando&&n.jogadoresFiltrados.length>0),o(),c("ngIf",!n.carregando&&n.jogadoresFiltrados.length===0))},dependencies:[J,j,F,T],styles:[".catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem;border:1px solid rgba(255,255,255,.05)}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d26;border-radius:.5rem;padding:.75rem 1rem;text-align:center;margin-bottom:1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d;width:50px;height:50px;object-fit:cover}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#6c757d;color:#fff}"]})};export{V as Batalha};
