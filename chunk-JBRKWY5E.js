import{a as _}from"./chunk-X6WXRV32.js";import{b as O,e as B,f as q,g as z,h as U,i as j,j as H,l as G,m as J,n as K,o as Q,p as X,q as Y}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as Z}from"./chunk-HS244SCX.js";import{Ga as u,Ha as a,Ia as o,Ib as L,Ja as F,Jb as R,Mb as A,Na as S,Oa as v,Pa as x,Ra as E,S as g,T as c,Ta as I,Tb as N,Vb as k,a as y,aa as D,bb as V,d as M,fb as m,gb as w,ha as W,ia as d,kb as p,lb as f,ma as b,mb as C,qa as T,sb as P,ua as h}from"./chunk-ILJPX4RU.js";function te(l,r){if(l&1){let i=x();S(0),F(1,"img",26),a(2,"button",27),E("click",function(){g(i);let n=I();return c(n.removerImagem())}),m(3,"\u2716"),o(),v()}if(l&2){let i=I();d(),u("src",i.item.imagem,W)}}function ie(l,r){if(l&1){let i=x();a(0,"label",28)(1,"span",29),m(2,"\u{1F4F7}"),o(),a(3,"input",30),E("change",function(n){g(i);let s=I();return c(s.onFileChange(n))}),o()()}}function ae(l,r){if(l&1&&(a(0,"option"),m(1),o()),l&2){let i=r.$implicit;d(),w(i)}}function oe(l,r){if(l&1&&(a(0,"option"),m(1),o()),l&2){let i=r.$implicit;d(),w(i)}}function ne(l,r){if(l&1&&(a(0,"option"),m(1),o()),l&2){let i=r.$implicit;d(),w(i)}}function re(l,r){if(l&1&&(a(0,"option"),m(1),o()),l&2){let i=r.$implicit;d(),w(i)}}function le(l,r){l&1&&(S(0),m(1,"\u{1F4BE} Salvar"),v())}function de(l,r){l&1&&(S(0),F(1,"span",31),m(2," Salvando... "),v())}var $=class l{constructor(r,i,e){this.router=r;this.el=i;this.route=e}item={index:0,id:0,nome:"",unidade_medida:"",peso:0,categoria:"",origem:"",raridade:"",efeito:"",colateral:"",descricao:"",imagem:"",email:""};salvando=!1;editMode=!1;unidadesMedida=["g","kg","ml","l","cm","m","unidade"];origens=["Fabric\xE1vel","Natural"];raridades=["Comum","Incomum","Raro","\xC9pico","Lend\xE1rio"];categorias=["Recursos bot\xE2nicos","Mineral","Equipamento","Moeda","Tesouro","Componentes bestiais e animalescos","Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos","Ferramentas","Outros"];ngOnInit(){return M(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield _.getLocalItens()).find(n=>String(n.id)===r);if(e&&(this.item=y({},e)),_.syncItens().then(n=>M(this,null,function*(){if(n){console.log("[CadastroItemCatalogo] Sync trouxe altera\xE7\xF5es. Recarregando item...");let t=(yield _.getLocalItens()).find(ee=>String(ee.id)===r);t&&(this.item=y({},t))}})),!e){let s=(yield _.forceFetchItens()).find(t=>String(t.id)===r);s&&(this.item=y({},s))}}catch(i){console.error("[CadastroItemCatalogo] Erro ao carregar item:",i)}}})}ngAfterViewInit(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(i=>{let e=()=>{i.style.height="auto",i.style.height=Math.min(i.scrollHeight,200)+"px"};i.addEventListener("input",e),e()})}onFileChange(r){let i=r.target;if(i.files&&i.files.length>0){let e=i.files[0],n=new FileReader;n.onload=()=>{this.item.imagem=n.result},n.readAsDataURL(e)}}removerImagem(){this.item.imagem=""}salvar(r){return M(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let i=Z.getUser();if(!i?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.item.email=i.email,this.editMode)yield _.updateItem(this.item),window.alert("\u2705 Item atualizado com sucesso!");else{let n=yield _.getLocalItens(),s=n.length>0?Math.max(...n.map(t=>t.index||0)):0;this.item.index=s+1,this.item.id=s+1,yield _.createItem(this.item),window.alert("\u2705 Item criado com sucesso!")}let e=this.route.snapshot.queryParamMap.get("returnUrl")||"/catalogo";this.router.navigateByUrl(e)}catch(i){console.error("[CadastroItemCatalogo] Erro ao salvar:",i),window.alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(i){return new(i||l)(b(k),b(D),b(N))};static \u0275cmp=T({type:l,selectors:[["app-cadastro-item-catalogo"]],decls:64,vars:18,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","mb-5"],[1,"flex-grow-1"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","bg-dark","border-0","shadow-sm"],[1,"card-body"],[1,"fw-bold","mb-3","text-white"],[1,"mb-3"],[1,"form-label","text-white"],["type","text","name","nome","required","",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","unidadeMedida","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[4,"ngFor","ngForOf"],["type","number","name","peso","min","0",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","categoria","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","origem","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","raridade","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","descricao",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],["name","efeito",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],["name","colateral",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-success","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","shadow-sm",2,"height","250px","object-fit","cover",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"d-flex","align-items-center","justify-content-center","border","rounded","w-100",2,"height","150px","background","#1e1e1e","cursor","pointer"],[1,"text-success","fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,e){if(i&1){let n=x();a(0,"div",2)(1,"div",3)(2,"form",4,0),E("ngSubmit",function(){g(n);let t=V(3);return c(e.salvar(t))}),a(4,"div",5),h(5,te,4,1,"ng-container",6)(6,ie,4,0,"ng-template",null,1,P),o(),a(8,"div",7)(9,"div",8)(10,"h4",9),m(11,"\u{1F4E6} Cadastro de Item do Cat\xE1logo"),o(),a(12,"div",10)(13,"label",11),m(14,"\u{1F3F7}\uFE0F Nome *"),o(),a(15,"input",12),C("ngModelChange",function(t){return g(n),f(e.item.nome,t)||(e.item.nome=t),c(t)}),o()(),a(16,"div",10)(17,"label",11),m(18,"\u2696\uFE0F Unidade de Medida *"),o(),a(19,"select",13),C("ngModelChange",function(t){return g(n),f(e.item.unidade_medida,t)||(e.item.unidade_medida=t),c(t)}),a(20,"option",14),m(21,"Selecione..."),o(),h(22,ae,2,1,"option",15),o()(),a(23,"div",10)(24,"label",11),m(25,"\u2696\uFE0F Peso"),o(),a(26,"input",16),C("ngModelChange",function(t){return g(n),f(e.item.peso,t)||(e.item.peso=t),c(t)}),o()(),a(27,"div",10)(28,"label",11),m(29,"\u{1F4C2} Categoria *"),o(),a(30,"select",17),C("ngModelChange",function(t){return g(n),f(e.item.categoria,t)||(e.item.categoria=t),c(t)}),a(31,"option",14),m(32,"Selecione..."),o(),h(33,oe,2,1,"option",15),o()(),a(34,"div",10)(35,"label",11),m(36,"\u{1F331} Origem *"),o(),a(37,"select",18),C("ngModelChange",function(t){return g(n),f(e.item.origem,t)||(e.item.origem=t),c(t)}),a(38,"option",14),m(39,"Selecione..."),o(),h(40,ne,2,1,"option",15),o()(),a(41,"div",10)(42,"label",11),m(43,"\u{1F48E} Raridade *"),o(),a(44,"select",19),C("ngModelChange",function(t){return g(n),f(e.item.raridade,t)||(e.item.raridade=t),c(t)}),a(45,"option",14),m(46,"Selecione..."),o(),h(47,re,2,1,"option",15),o()(),a(48,"div",10)(49,"label",11),m(50,"\u{1F4DD} Descri\xE7\xE3o"),o(),a(51,"textarea",20),C("ngModelChange",function(t){return g(n),f(e.item.descricao,t)||(e.item.descricao=t),c(t)}),o()(),a(52,"div",10)(53,"label",11),m(54,"\u2728 Efeito"),o(),a(55,"textarea",21),C("ngModelChange",function(t){return g(n),f(e.item.efeito,t)||(e.item.efeito=t),c(t)}),o()(),a(56,"div",10)(57,"label",11),m(58,"\u26A0\uFE0F Colateral"),o(),a(59,"textarea",22),C("ngModelChange",function(t){return g(n),f(e.item.colateral,t)||(e.item.colateral=t),c(t)}),o()()()(),a(60,"div",23)(61,"button",24),h(62,le,2,0,"ng-container",25)(63,de,3,0,"ng-container",25),o()()()()()}if(i&2){let n=V(3),s=V(7);d(5),u("ngIf",e.item.imagem)("ngIfElse",s),d(10),p("ngModel",e.item.nome),d(4),p("ngModel",e.item.unidade_medida),d(3),u("ngForOf",e.unidadesMedida),d(4),p("ngModel",e.item.peso),d(4),p("ngModel",e.item.categoria),d(3),u("ngForOf",e.categorias),d(4),p("ngModel",e.item.origem),d(3),u("ngForOf",e.origens),d(4),p("ngModel",e.item.raridade),d(3),u("ngForOf",e.raridades),d(4),p("ngModel",e.item.descricao),d(4),p("ngModel",e.item.efeito),d(4),p("ngModel",e.item.colateral),d(2),u("disabled",n.invalid||e.salvando),d(),u("ngIf",!e.salvando),d(),u("ngIf",e.salvando)}},dependencies:[A,L,R,Y,j,J,K,O,H,G,B,q,X,Q,U,z],styles:["textarea.auto-expand[_ngcontent-%COMP%]{min-height:60px;max-height:200px;overflow-y:auto;resize:none}"]})};export{$ as CadastroItemCatalogo};
