import{a as x}from"./chunk-W4ZRYS5G.js";import{a as v}from"./chunk-76QEAP6D.js";import"./chunk-2CFPKSUU.js";import{c as L,g as z,j as A,q as N,s as R,v as V}from"./chunk-YWTK67XE.js";import{$b as s,Db as p,Eb as f,Fb as k,Jb as C,Lb as d,Pa as P,Qa as a,Va as E,Zb as t,_b as F,ab as M,ac as T,d as I,fb as g,fc as j,ia as h,ja as b,wb as l,xb as o,yb as n,zb as u}from"./chunk-DIJLFEPN.js";function B(i,r){i&1&&(o(0,"div",3),u(1,"div",4),o(2,"p",5),t(3,"Carregando item..."),n()())}function J(i,r){if(i&1&&u(0,"img",21),i&2){let e=d(2);l("alt",j(e.item.catalogo==null?null:e.item.catalogo.nome))("src",e.item.catalogo==null?null:e.item.catalogo.imagem,P)}}function Q(i,r){i&1&&(o(0,"div",22)(1,"span",23),t(2,"\u{1F4E6} Sem imagem"),n()())}function $(i,r){if(i&1&&(o(0,"p",24),t(1," \u2728 "),o(2,"b"),t(3,"Efeito:"),n(),t(4),n()),i&2){let e=d(2);a(4),s(" ",e.item.catalogo==null?null:e.item.catalogo.efeito," ")}}function G(i,r){if(i&1&&(o(0,"p",25),t(1," \u26A0\uFE0F "),o(2,"b"),t(3,"Colateral:"),n(),t(4),n()),i&2){let e=d(2);a(4),s(" ",e.item.catalogo==null?null:e.item.catalogo.colateral," ")}}function H(i,r){if(i&1&&(o(0,"p",26),t(1),n()),i&2){let e=d(2);a(),s(" \u{1F4DD} ",e.item.catalogo==null?null:e.item.catalogo.descricao," ")}}function K(i,r){i&1&&(p(0),t(1,"\u270F\uFE0F Editar"),f())}function W(i,r){i&1&&(p(0),u(1,"span",27),t(2," Editando... "),f())}function X(i,r){i&1&&(p(0),t(1,"\u{1F5D1}\uFE0F Excluir"),f())}function Y(i,r){i&1&&(p(0),u(1,"span",27),t(2," Excluindo... "),f())}function Z(i,r){if(i&1){let e=k();p(0),o(1,"div",6),g(2,J,1,3,"img",7)(3,Q,3,0,"div",8),n(),o(4,"div",9)(5,"h4",10),t(6),n(),o(7,"div",11)(8,"p")(9,"span",12),t(10,"\u{1F4C2}"),n(),o(11,"b"),t(12,"Categoria: "),n(),t(13),n(),o(14,"p")(15,"span",12),t(16,"\u{1F331}"),n(),o(17,"b"),t(18,"Origem:"),n(),t(19),n(),o(20,"p")(21,"span",12),t(22,"\u{1F48E}"),n(),o(23,"b"),t(24,"Raridade:"),n(),t(25),n(),o(26,"p")(27,"span",12),t(28,"\u{1F522}"),n(),o(29,"b"),t(30,"Quantidade:"),n(),t(31),n(),o(32,"p")(33,"span",12),t(34,"\u2696\uFE0F"),n(),o(35,"b"),t(36,"Peso total:"),n(),t(37),n()(),u(38,"hr",13),g(39,$,5,1,"p",14)(40,G,5,1,"p",15)(41,H,2,1,"p",16),n(),o(42,"div",17)(43,"button",18),C("click",function(){h(e);let m=d();return b(m.cancelar())}),t(44," \u2B05\uFE0F Cancelar "),n(),o(45,"button",19),C("click",function(){h(e);let m=d();return b(m.editarItem())}),g(46,K,2,0,"ng-container",2)(47,W,3,0,"ng-container",2),n(),o(48,"button",20),C("click",function(){h(e);let m=d();return b(m.excluirItem())}),g(49,X,2,0,"ng-container",2)(50,Y,3,0,"ng-container",2),n()(),f()}if(i&2){let e=d();a(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.imagem),a(),l("ngIf",!(e.item.catalogo!=null&&e.item.catalogo.imagem)),a(3),F((e.item.catalogo==null?null:e.item.catalogo.nome)||"Item desconhecido"),a(7),s(" ",(e.item.catalogo==null?null:e.item.catalogo.categoria)||"\u2014"),a(6),s(" ",(e.item.catalogo==null?null:e.item.catalogo.origem)||"\u2014"),a(6),s(" ",(e.item.catalogo==null?null:e.item.catalogo.raridade)||"\u2014"),a(6),T(" ",e.item.inventario.quantidade," ",(e.item.catalogo==null?null:e.item.catalogo.unidade_medida)||""," "),a(6),s(" ",(e.item.inventario.quantidade||0)*((e.item.catalogo==null?null:e.item.catalogo.peso)||0)," kg "),a(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.efeito),a(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.colateral),a(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.descricao),a(4),l("disabled",e.processandoEditar),a(),l("ngIf",!e.processandoEditar),a(),l("ngIf",e.processandoEditar),a(),l("disabled",e.processandoExcluir),a(),l("ngIf",!e.processandoExcluir),a(),l("ngIf",e.processandoExcluir)}}var U=class i{constructor(r,e,c){this.route=r;this.router=e;this.location=c}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;ngOnInit(){return I(this,null,function*(){try{console.log("[ItemInventario] Iniciando carregamento..."),this.carregando=!0;let r=this.route.snapshot.paramMap.get("id"),e=r?Number(r):NaN;if(isNaN(e))throw new Error("ID inv\xE1lido para item do invent\xE1rio");let c=V.getUser();if(!c?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let m=yield v.getLocalItens(),y=(yield x.getLocalInventarioByJogador(c.email)).find(_=>_.id===e);if(y&&(this.item=this.montarDetalhe(y,m),this.carregando=!1),Promise.all([v.syncItens(),x.syncInventario()]).then(S=>I(this,[S],function*([_,w]){if(_||w){console.log("[ItemInventario] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let D=yield v.getLocalItens(),O=(yield x.getLocalInventarioByJogador(c.email)).find(q=>q.id===e);O&&(this.item=this.montarDetalhe(O,D))}else console.log("[ItemInventario] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!y){console.log("[ItemInventario] Item n\xE3o encontrado localmente. For\xE7ando fetch online...");let _=yield v.forceFetchItens(),S=(yield x.forceFetchInventario()).find(D=>D.id===e);if(S)this.item=this.montarDetalhe(S,_);else throw new Error("Item n\xE3o encontrado nem online.");this.carregando=!1}}catch(r){console.error("[ItemInventario] Erro ao carregar item:",r),this.carregando=!1}})}montarDetalhe(r,e){let c=e.find(m=>m.id===r.item_catalogo);return{inventario:r,catalogo:c}}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-inventario",this.item.inventario.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},400))}excluirItem(){return I(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja remover "${this.item.catalogo?.nome}" do invent\xE1rio?`))){this.processandoExcluir=!0;try{yield x.deleteInventario(this.item.inventario.id),alert("\u2705 Item removido do invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(e){console.error("[ItemInventario] Erro ao excluir item:",e),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}static \u0275fac=function(e){return new(e||i)(E(N),E(R),E(L))};static \u0275cmp=M({type:i,selectors:[["app-item-inventario"]],decls:3,vars:2,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","mb-3"],["class","img-fluid rounded shadow-sm","style","max-height: 280px; object-fit: cover; width: 100%;",3,"src","alt",4,"ngIf"],["class","bg-secondary d-flex align-items-center justify-content-center rounded","style","height: 200px; width: 100%;",4,"ngIf"],[1,"card","bg-dark","border-0","shadow-sm","p-3"],[1,"fw-bold","mb-3","text-light"],[1,"meta-info"],[1,"icon"],[1,"border-secondary"],["class","efeito-text mt-2",4,"ngIf"],["class","colateral mt-2",4,"ngIf"],["class","descricao-text mt-2 fst-italic",4,"ngIf"],[1,"d-flex","gap-2","mt-4"],[1,"btn","btn-secondary","flex-fill",3,"click"],[1,"btn","btn-outline-warning","flex-fill",3,"click","disabled"],[1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"img-fluid","rounded","shadow-sm",2,"max-height","280px","object-fit","cover","width","100%",3,"src","alt"],[1,"bg-secondary","d-flex","align-items-center","justify-content-center","rounded",2,"height","200px","width","100%"],[1,"text-light"],[1,"efeito-text","mt-2"],[1,"colateral","mt-2"],[1,"descricao-text","mt-2","fst-italic"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,c){e&1&&(o(0,"div",0),g(1,B,4,0,"div",1)(2,Z,51,18,"ng-container",2),n()),e&2&&(a(),l("ngIf",c.carregando),a(),l("ngIf",!c.carregando&&c.item))},dependencies:[A,z],styles:[".card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;border:1px solid #2c2c2c}.img-fluid[_ngcontent-%COMP%]{border-radius:10px}.bg-secondary[_ngcontent-%COMP%]{background:#2c2c2c!important;color:#ccc;font-size:1rem;border-radius:10px}.meta-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:6px;font-size:.95rem;color:#eaeaea}.meta-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:4px}.efeito-text[_ngcontent-%COMP%]{color:#0dcaf0;font-weight:500}.colateral[_ngcontent-%COMP%]{color:#ff6b6b;font-weight:500}.descricao-text[_ngcontent-%COMP%]{color:#bbb;font-size:.9rem;line-height:1.4}.btn[_ngcontent-%COMP%]{font-weight:600;border-radius:8px;padding:10px}.btn-secondary[_ngcontent-%COMP%]{background:#444;border:none}.btn-secondary[_ngcontent-%COMP%]:hover{background:#555}.btn-outline-warning[_ngcontent-%COMP%]{border-color:#ffc107;color:#ffc107}.btn-outline-warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffc107;color:#1e1e1e}.btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.btn-outline-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#ff4d6d;color:#fff}"]})};export{U as ItemInventario};
