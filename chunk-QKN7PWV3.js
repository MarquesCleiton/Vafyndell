import{a as Z}from"./chunk-QWKS73CC.js";import{c as G,f as K,i as Q,s as X}from"./chunk-AE35642N.js";import{a as j}from"./chunk-J5FBOTGS.js";import{h as q}from"./chunk-SEBSZRO5.js";import{h as U,i as $,n as L,o as W,q as Y}from"./chunk-IJWXOQAR.js";import{$b as k,Ab as d,Bb as o,Cb as r,Db as h,Hb as D,Ib as w,Jb as E,Nb as f,Pb as _,Sa as M,Ua as n,Za as J,Zb as b,_b as z,a as B,b as S,bc as s,cc as y,dc as v,eb as H,ec as I,g as x,gc as F,hc as P,ic as V,jb as m,jc as R,la as g,ma as u,oc as O,pc as N,qc as A,rc as C}from"./chunk-O42C4TWY.js";function te(i,t){i&1&&(o(0,"div",20),h(1,"div",21),o(2,"p",22),s(3,"Carregando jogadores..."),r()())}function ie(i,t){i&1&&(o(0,"span",41),s(1,"\u{1F480}"),r())}function ae(i,t){if(i&1&&h(0,"img",42),i&2){let e=_().$implicit;d("alt",R(e.personagem))("src",e.imagem,M)}}function ne(i,t){i&1&&(o(0,"span"),s(1,"\u{1F464}"),r())}function oe(i,t){if(i&1&&(o(0,"span"),s(1),r()),i&2){let e=_().$implicit;n(),v("| ",e.tipo)}}function re(i,t){i&1&&(D(0),h(1,"span",43),w())}function le(i,t){i&1&&s(0,"\u{1F48A}")}function ce(i,t){i&1&&(D(0),h(1,"span",43),w())}function se(i,t){i&1&&s(0,"\u2694\uFE0F")}function de(i,t){if(i&1){let e=E();o(0,"div",24),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.abrirDetalhes(a))}),o(1,"div",25)(2,"div",26),m(3,ie,2,0,"span",27)(4,ae,1,3,"img",28)(5,ne,2,0,"span",29),r(),o(6,"div",30)(7,"h6",31),s(8),r(),o(9,"small",32),s(10),m(11,oe,2,1,"span",29),r()(),o(12,"div",33),f("click",function(a){return g(e),u(a.stopPropagation())}),o(13,"div",34)(14,"div",35),s(15),r(),o(16,"div",36),s(17),r()(),o(18,"div",37),s(19),r(),o(20,"div",38)(21,"button",39),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.acaoRecuperacao(a))}),m(22,re,2,0,"ng-container",18)(23,le,1,0,"ng-template",null,2,C),r(),o(25,"button",40),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.acaoEspada(a))}),m(26,ce,2,0,"ng-container",18)(27,se,1,0,"ng-template",null,3,C),r()()()()()}if(i&2){let e=t.$implicit,l=b(24),a=b(28),c=_(3);n(3),d("ngIf",c.JogadorUtils.estaMorto(e)),n(),d("ngIf",e.imagem&&e.imagem!=="-"&&!c.JogadorUtils.estaMorto(e)),n(),d("ngIf",(!e.imagem||e.imagem==="-")&&!c.JogadorUtils.estaMorto(e)),n(3),y(e.personagem),n(2),v(" ",e.classificacao||"Jogador"," "),n(),d("ngIf",e.tipo),n(4),I(" \u2764\uFE0F ",c.JogadorUtils.getVidaAtual(e),"/",c.JogadorUtils.getVidaBase(e)," "),n(2),v("\u{1F6E1}\uFE0F ",e.classe_de_armadura),n(2),v(" \u{1F4A5} Dano: ",e.dano_tomado||0," "),n(2),d("disabled",c.processando[e.id]==="recuperar"),n(),d("ngIf",c.processando[e.id]==="recuperar")("ngIfElse",l),n(3),d("disabled",c.processando[e.id]==="espada"),n(),d("ngIf",c.processando[e.id]==="espada")("ngIfElse",a)}}function _e(i,t){if(i&1&&(o(0,"div"),m(1,de,29,16,"div",23),r()),i&2){let e=_(2);n(),d("ngForOf",e.jogadoresNormais)}}function pe(i,t){i&1&&(o(0,"div",44),s(1,"Nenhum jogador encontrado."),r())}function me(i,t){i&1&&(o(0,"span",41),s(1,"\u{1F480}"),r())}function ge(i,t){if(i&1&&h(0,"img",42),i&2){let e=_().$implicit;d("alt",R(e.personagem))("src",e.imagem,M)}}function ue(i,t){i&1&&(o(0,"span"),s(1,"\u{1F464}"),r())}function fe(i,t){if(i&1&&(o(0,"span"),s(1),r()),i&2){let e=_().$implicit;n(),v("| ",e.tipo)}}function ve(i,t){i&1&&(D(0),h(1,"span",43),w())}function xe(i,t){i&1&&s(0,"\u{1F48A}")}function he(i,t){i&1&&(D(0),h(1,"span",43),w())}function be(i,t){i&1&&s(0,"\u2694\uFE0F")}function Ce(i,t){i&1&&(D(0),h(1,"span",43),w())}function De(i,t){i&1&&s(0,"\u{1F5D1}\uFE0F")}function we(i,t){if(i&1){let e=E();o(0,"div",24),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.abrirDetalhes(a))}),o(1,"div",25)(2,"div",26),m(3,me,2,0,"span",27)(4,ge,1,3,"img",28)(5,ue,2,0,"span",29),r(),o(6,"div",30)(7,"h6",31),s(8),r(),o(9,"small",32),s(10),m(11,fe,2,1,"span",29),r()(),o(12,"div",33),f("click",function(a){return g(e),u(a.stopPropagation())}),o(13,"div",34)(14,"div",35),s(15),r(),o(16,"div",36),s(17),r()(),o(18,"div",37),s(19),r(),o(20,"div",38)(21,"button",39),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.acaoRecuperacao(a))}),m(22,ve,2,0,"ng-container",18)(23,xe,1,0,"ng-template",null,4,C),r(),o(25,"button",40),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.acaoEspada(a))}),m(26,he,2,0,"ng-container",18)(27,be,1,0,"ng-template",null,5,C),r(),o(29,"button",45),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.excluirNpcDaBatalha(a))}),m(30,Ce,2,0,"ng-container",18)(31,De,1,0,"ng-template",null,6,C),r()()()()()}if(i&2){let e=t.$implicit,l=b(24),a=b(28),c=b(32),p=_(3);n(3),d("ngIf",p.JogadorUtils.estaMorto(e)),n(),d("ngIf",e.imagem&&e.imagem!=="-"&&!p.JogadorUtils.estaMorto(e)),n(),d("ngIf",(!e.imagem||e.imagem==="-")&&!p.JogadorUtils.estaMorto(e)),n(3),y(e.personagem),n(2),v(" ",e.classificacao||"Inimigo"," "),n(),d("ngIf",e.tipo),n(4),I(" \u2764\uFE0F ",p.JogadorUtils.getVidaAtual(e),"/",p.JogadorUtils.getVidaBase(e)," "),n(2),v("\u{1F6E1}\uFE0F ",e.classe_de_armadura),n(2),v(" \u{1F4A5} Dano: ",e.dano_tomado||0," "),n(2),d("disabled",p.processando[e.id]==="recuperar"),n(),d("ngIf",p.processando[e.id]==="recuperar")("ngIfElse",l),n(3),d("disabled",p.processando[e.id]==="espada"),n(),d("ngIf",p.processando[e.id]==="espada")("ngIfElse",a),n(3),d("disabled",p.processando[e.id]==="excluir"),n(),d("ngIf",p.processando[e.id]==="excluir")("ngIfElse",c)}}function Ee(i,t){if(i&1&&(o(0,"div"),m(1,we,33,19,"div",23),r()),i&2){let e=_(2);n(),d("ngForOf",e.bestiais)}}function ye(i,t){i&1&&(o(0,"div",46),s(1,"Nenhum inimigo encontrado."),r())}function Ie(i,t){if(i&1){let e=E();o(0,"div",12)(1,"div",13),m(2,te,4,0,"div",14),o(3,"div",15)(4,"input",16),V("ngModelChange",function(a){g(e);let c=_();return P(c.filtro,a)||(c.filtro=a),u(a)}),f("input",function(){g(e);let a=_();return u(a.aplicarFiltro())}),r()(),o(5,"h5",17),s(6,"\u{1F9D9} Jogadores"),r(),m(7,_e,2,1,"div",18)(8,pe,2,0,"ng-template",null,0,C),o(10,"h5",19),s(11,"\u{1F40D} Bestiais e Inimigos"),r(),m(12,Ee,2,1,"div",18)(13,ye,2,0,"ng-template",null,1,C),r()()}if(i&2){let e=b(9),l=b(14),a=_();n(2),d("ngIf",a.carregando),n(2),F("ngModel",a.filtro),n(3),d("ngIf",a.jogadoresNormais.length>0)("ngIfElse",e),n(5),d("ngIf",a.bestiais.length>0)("ngIfElse",l)}}function Te(i,t){i&1&&(o(0,"div",20),h(1,"div",21),o(2,"p",22),s(3,"Carregando hist\xF3rico..."),r()())}function Be(i,t){i&1&&(o(0,"div",51),s(1," Nenhum registro encontrado. "),r())}function Se(i,t){if(i&1&&(o(0,"div",58)(1,"div",59)(2,"div",60)(3,"h6",61),s(4),O(5,"titlecase"),r(),o(6,"small",62),s(7),O(8,"date"),r()(),o(9,"p",63),s(10),r()()()),i&2){let e=t.$implicit;n(),z("border-left","6px solid "+(e.cor||"#666")),n(3),I("",e.icone," ",N(5,6,e.tipo)),n(3),y(A(8,8,e.data,"HH:mm")),n(3),v(" ",e.detalhes," ")}}function Me(i,t){if(i&1&&(o(0,"div",22)(1,"div",56),m(2,Se,11,11,"div",57),r()()),i&2){let e=_().$implicit;n(2),d("ngForOf",e.itens)}}function ke(i,t){if(i&1){let e=E();o(0,"div",15)(1,"button",53),f("click",function(){let a=g(e).$implicit,c=_(3);return u(c.toggleSecao(a))}),o(2,"span",54),s(3),r(),o(4,"span"),s(5),r()(),m(6,Me,3,1,"div",55),r()}if(i&2){let e=t.$implicit,l=_(3);n(3),v("\u{1F4C5} ",l.formatarData(e.data)),n(2),y(e.expandido?"\u2212":"+"),n(),d("ngIf",e.expandido)}}function Fe(i,t){if(i&1&&(o(0,"div"),m(1,ke,7,3,"div",52),r()),i&2){let e=_(2);n(),d("ngForOf",e.secoesHistoricoFiltradas)}}function Pe(i,t){if(i&1){let e=E();o(0,"div",12)(1,"div",47)(2,"h4",48),s(3,"\u{1F4DC} Hist\xF3rico de Batalha e Recupera\xE7\xE3o"),r(),o(4,"input",49),V("ngModelChange",function(a){g(e);let c=_();return P(c.filtroHistorico,a)||(c.filtroHistorico=a),u(a)}),f("input",function(){g(e);let a=_();return u(a.aplicarFiltroHistorico())}),r(),m(5,Te,4,0,"div",14)(6,Be,2,0,"div",50)(7,Fe,2,1,"div",29),r()()}if(i&2){let e=_();n(4),F("ngModel",e.filtroHistorico),n(),d("ngIf",e.carregandoHistorico),n(),d("ngIf",!e.carregandoHistorico&&e.secoesHistoricoFiltradas.length===0),n(),d("ngIf",!e.carregandoHistorico)}}var ee=class i{constructor(t){this.router=t}abaAtiva="campo";jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=Z;secoesHistorico=[];secoesHistoricoFiltradas=[];carregandoHistorico=!0;filtroHistorico="";repoJogadores=new j("Personagem");repoRegistros=new j("Registro");ngOnInit(){return x(this,null,function*(){yield Promise.all([this.carregarJogadores(),this.carregarHistorico()])})}carregarJogadores(){return x(this,null,function*(){try{let t=yield this.repoJogadores.getLocal();this.jogadores=t,this.aplicarFiltro(),this.carregando=!1,x(this,null,function*(){if(yield this.repoJogadores.sync()){let l=yield this.repoJogadores.getLocal();this.jogadores=l,this.aplicarFiltro()}})}catch(t){console.error("[Batalha] Erro ao carregar jogadores:",t),this.carregando=!1}})}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);this.jogadoresFiltrados=t?this.jogadores.filter(e=>this.normalizarTexto(e.personagem).includes(t)||this.normalizarTexto(e.nome_do_jogador).includes(t)||this.normalizarTexto(e.classificacao).includes(t)||this.normalizarTexto(e.tipo).includes(t)):[...this.jogadores]}get jogadoresNormais(){return this.jogadoresFiltrados.filter(t=>t.nome_do_jogador!=="NPC")}get bestiais(){return this.jogadoresFiltrados.filter(t=>t.nome_do_jogador==="NPC")}abrirDetalhes(t){return x(this,null,function*(){this.processando[t.id]="abrir",setTimeout(()=>{this.router.navigate(["/visao-jogadores",t.id]),this.processando[t.id]=null},400)})}acaoEspada(t){return x(this,null,function*(){this.processando[t.id]="espada",setTimeout(()=>{this.router.navigate(["/combate",t.id]),this.processando[t.id]=null},400)})}acaoRecuperacao(t){return x(this,null,function*(){this.processando[t.id]="recuperar",setTimeout(()=>{this.router.navigate(["/recuperacao",t.id]),this.processando[t.id]=null},400)})}excluirNpcDaBatalha(t){return x(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${t.personagem}" do campo de batalha?`)){this.processando[t.id]="excluir";try{yield this.repoJogadores.delete(t.id),this.jogadores=this.jogadores.filter(l=>l.id!==t.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(l){console.error("[Batalha] Erro ao excluir NPC:",l),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[t.id]=null}}})}carregarHistorico(){return x(this,null,function*(){this.carregandoHistorico=!0;try{let e=(yield this.repoRegistros.getLocal()).filter(l=>l.tipo==="batalha"||l.tipo==="recuperacao");this.processarSecoesHistorico(e),this.repoRegistros.sync().then(l=>x(this,null,function*(){if(l){let c=(yield this.repoRegistros.getLocal()).filter(p=>p.tipo==="batalha"||p.tipo==="recuperacao");this.processarSecoesHistorico(c)}}))}catch(t){console.error("[Batalha] Erro ao carregar hist\xF3rico:",t)}finally{this.carregandoHistorico=!1}})}processarSecoesHistorico(t){let e=new Map(this.secoesHistorico.map(a=>[a.data,a.expandido])),l=new Map;t.forEach(a=>{let c=a.data||"",p=c.includes("T")?c.split("T")[0]:c,T=S(B({},a),{icone:this.getIconeTipo(a.tipo),cor:this.getCorTipo(a.tipo)});l.has(p)||l.set(p,[]),l.get(p).push(T)}),this.secoesHistorico=Array.from(l.entries()).sort(([a],[c])=>new Date(c).getTime()-new Date(a).getTime()).map(([a,c])=>({data:a,itens:c.sort((p,T)=>new Date(T.data||0).getTime()-new Date(p.data||0).getTime()),expandido:e.get(a)??!0})),this.aplicarFiltroHistorico()}aplicarFiltroHistorico(){let t=this.normalizarTexto(this.filtroHistorico);this.secoesHistoricoFiltradas=this.secoesHistorico.map(e=>S(B({},e),{itens:e.itens.filter(l=>!t||this.normalizarTexto(l.detalhes).includes(t))})).filter(e=>e.itens.length>0)}selecionarAba(t){this.abaAtiva=t}toggleSecao(t){t.expandido=!t.expandido}normalizarTexto(t){return t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():""}getIconeTipo(t=""){return{batalha:"\u2694\uFE0F",recuperacao:"\u{1F48A}"}[t]||"\u{1F4DC}"}getCorTipo(t=""){return{batalha:"#f87171",recuperacao:"#4ade80"}[t]||"#9ca3af"}formatarData(t){try{return(t.includes("T")?new Date(t):new Date(t+"T00:00:00")).toLocaleDateString("pt-BR")}catch{return t}}static \u0275fac=function(e){return new(e||i)(J(q))};static \u0275cmp=H({type:i,selectors:[["app-batalha"]],decls:10,vars:6,consts:[["vazioJogadores",""],["vazioBestiais",""],["recupIcon",""],["espIcon",""],["recupInimigo",""],["espadaInimigo",""],["exclIcon",""],[1,"batalha-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],["role","tablist",1,"nav","nav-tabs","bg-dark","border-bottom","px-3"],[1,"nav-item"],[1,"nav-link",3,"click"],["class","flex-grow-1 p-3 d-flex justify-content-center overflow-auto",4,"ngIf"],[1,"flex-grow-1","p-3","d-flex","justify-content-center","overflow-auto"],[1,"batalha-container","w-100"],["class","text-center py-5",4,"ngIf"],[1,"mb-3"],["type","text","placeholder","\u{1F50D} Buscar personagem...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"fw-bold","text-primary","mb-2"],[4,"ngIf","ngIfElse"],[1,"fw-bold","text-danger","mt-4","mb-2"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card jogador-card mb-2 shadow-sm p-3",3,"click",4,"ngFor","ngForOf"],[1,"card","jogador-card","mb-2","shadow-sm","p-3",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded","img-container"],["class","fs-3",4,"ngIf"],["class","img-fluid",3,"src","alt",4,"ngIf"],[4,"ngIf"],[1,"flex-grow-1"],[1,"fw-bold","text-light","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger","fw-bold"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex","gap-1"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[1,"fs-3"],[1,"img-fluid",3,"src","alt"],[1,"spinner-border","spinner-border-sm"],[1,"text-muted","small","mb-3"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"text-muted","small"],[1,"registro-container","w-100"],[1,"fw-bold","mb-3"],["type","text","placeholder","\u{1F50D} Pesquisar no hist\xF3rico...",1,"form-control","search-bar","rounded-pill","px-3","mb-3",3,"ngModelChange","input","ngModel"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"btn-categoria","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"registro-card","card","shadow-sm","p-3","text-light"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"fw-bold","mb-0"],[1,"registro-hora"],[1,"small","descricao-text","fst-italic","mb-0",2,"white-space","pre-line"]],template:function(e,l){e&1&&(o(0,"div",7)(1,"ul",8)(2,"li",9)(3,"button",10),f("click",function(){return l.selecionarAba("campo")}),s(4," \u2694\uFE0F Campo de Batalha "),r()(),o(5,"li",9)(6,"button",10),f("click",function(){return l.selecionarAba("historico")}),s(7," \u{1F4DC} Hist\xF3rico "),r()()(),m(8,Ie,15,6,"div",11)(9,Pe,8,4,"div",11),r()),e&2&&(n(3),k("active",l.abaAtiva==="campo"),n(3),k("active",l.abaAtiva==="historico"),n(2),d("ngIf",l.abaAtiva==="campo"),n(),d("ngIf",l.abaAtiva==="historico"))},dependencies:[Y,U,$,X,G,K,Q,L,W],styles:[".batalha-wrapper[_ngcontent-%COMP%]{background:#121212;color:#fff}.batalha-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid #333}.nav-link[_ngcontent-%COMP%]{color:#ccc;border:none;border-bottom:3px solid transparent;font-weight:600;transition:all .2s ease}.nav-link.active[_ngcontent-%COMP%]{color:#fff;border-bottom:3px solid #a78bfa;background-color:transparent}.nav-link[_ngcontent-%COMP%]:hover{color:#fff;background:#ffffff0d}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444}.search-bar[_ngcontent-%COMP%]:focus{border-color:#666;box-shadow:0 0 0 2px #a78bfa33}.jogador-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;border:1px solid #333;transition:all .2s ease}.jogador-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0006}.img-container[_ngcontent-%COMP%]{width:55px;height:55px;overflow:hidden}.img-fluid[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745}.btn-outline-success[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.registro-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;border:1px solid #333;transition:transform .15s ease,box-shadow .15s ease}.registro-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #444;border-radius:8px;padding:8px 12px;color:#fff;font-weight:700;margin-bottom:5px}.btn-categoria[_ngcontent-%COMP%]:hover{background:#333}.descricao-text[_ngcontent-%COMP%]{color:#eee;line-height:1.5}.registro-hora[_ngcontent-%COMP%]{color:#bbb;font-size:.85rem}"]})};export{ee as Batalha};
