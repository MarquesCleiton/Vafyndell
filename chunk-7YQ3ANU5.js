import{a as V}from"./chunk-SPQF6BCK.js";import{g as P,j,s as B,v as m,w as s}from"./chunk-S65SB5BW.js";import{Db as L,Eb as S,Fb as A,Jb as k,Lb as h,Qa as u,Va as f,Vb as D,Zb as o,_ as w,_b as F,ab as E,d as c,fb as C,ia as I,ja as y,mc as M,wb as _,xb as i,yb as a,zb as g}from"./chunk-QQSIVCMV.js";var p=class n{preloadAll(e){return c(this,null,function*(){let t=["Catalogo","Inventario","Receitas","Personagem","NPCs","Anotacoes","Metadados"],d=["\u{1F52E} Invocando grim\xF3rios...","\u{1F30C} Consultando os astros...","\u{1F4DC} Decifrando runas antigas...","\u26A1 Canalizando energia arcana..."],l=0,R=setInterval(()=>{e?.(d[l%d.length]),l++},1200),v=yield V.multiFetch(t);clearInterval(R);let x=yield m.create();for(let r of t){let b=[`\u{1F4D6} Estudando os pergaminhos de ${r}...`,`\u2692\uFE0F Forjando dados para ${r}...`,`\u{1F9EA} Misturando po\xE7\xF5es em ${r}...`,`\u{1F409} Invocando criaturas de ${r}...`];e?.(b[Math.floor(Math.random()*b.length)]),yield x.clear(r),v[r]?.length&&(yield x.bulkPut(r,v[r]))}e?.("\u2728 Mundo preparado!")})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=w({token:n,factory:n.\u0275fac,providedIn:"root"})};function N(n,e){if(n&1){let t=A();L(0),i(1,"div",3)(2,"h1",4),o(3,"\u2694\uFE0F Vafyndell"),a(),i(4,"p",5),o(5," Bem-vindo, aventureiro! "),g(6,"br"),o(7," O seu RPG agora na palma das m\xE3os. "),a(),i(8,"div",6)(9,"button",7),k("click",function(){I(t);let l=h();return y(l.login())}),g(10,"img",8),i(11,"span",9),o(12,"Entrar na Taverna"),a()()()(),i(13,"div",10)(14,"p",11),o(15,"\u2728 Forje po\xE7\xF5es, enfrente bestas e registre suas aventuras"),a(),i(16,"p",11),o(17,"\u{1F3B2} Que os dados rolem sempre a seu favor!"),a()(),S()}}function $(n,e){if(n&1&&(i(0,"div",12),g(1,"div",13),i(2,"p",9),o(3),a(),i(4,"small",14),o(5,"Preparando o mundo..."),a()()),n&2){let t=h();u(3),F(t.mensagem)}}var O=class n{constructor(e,t){this.router=e;this.bootstrap=t}carregando=!1;mensagem="";ngOnInit(){return c(this,null,function*(){let e=s.getUser();if(e&&!s.isAuthenticated()){console.warn("[Login] Token expirado \u2192 limpando credenciais e banco"),yield s.logoutHard(),yield(yield m.create()).deleteDatabase();return}e||(yield(yield m.create()).deleteDatabase(),console.warn("[Login] Nenhum usu\xE1rio \u2192 banco local limpo")),s.isAuthenticated()&&this.inicializarApp()})}login(){return c(this,null,function*(){if(s.isAuthenticated()){yield this.inicializarApp();return}try{this.carregando=!0,this.mensagem="Invocando grim\xF3rios...";let e=yield s.signInWithGoogle();e?(console.log("[Login] Login OK:",e),yield this.inicializarApp()):alert("Falha no login, tente novamente.")}catch(e){console.error("[Login] Erro no login:",e),alert("Erro no login. Verifique sua conex\xE3o e tente novamente.")}})}inicializarApp(){return c(this,null,function*(){this.carregando=!0,this.mensagem="Carregando tomos antigos...";try{yield this.bootstrap.preloadAll(e=>this.mensagem=e),console.log("[Login] Preload conclu\xEDdo!"),this.router.navigate(["/jogador"])}catch(e){console.error("[Login] Erro no preload:",e),alert("Erro ao carregar os dados iniciais. Tente novamente.")}finally{this.carregando=!1}})}static \u0275fac=function(t){return new(t||n)(f(B),f(p))};static \u0275cmp=E({type:n,selectors:[["app-login"]],decls:4,vars:2,consts:[["loading",""],[1,"d-flex","flex-column","justify-content-center","align-items-center","vh-100","bg-dark","text-light","text-center","p-4",2,"background","linear-gradient(135deg, #1a1a1a, #2b1d0e)"],[4,"ngIf","ngIfElse"],[1,"p-4","rounded","shadow-lg",2,"background","rgba(0,0,0,0.6)","max-width","420px","width","100%"],[1,"fw-bold","display-4","text-warning","mb-2"],[1,"fst-italic","mb-4","text-light"],[1,"d-flex","justify-content-center"],[1,"btn","btn-warning","px-4","py-2","rounded-pill","d-flex","align-items-center","gap-2","shadow",3,"click"],["src","https://developers.google.com/identity/images/g-logo.png","alt","Google","width","20","height","20"],[1,"fw-bold"],[1,"mt-4","small","text-light-emphasis"],[1,"m-0"],[1,"text-center"],["role","status",1,"spinner-border","text-warning","mb-3"],[1,"text-muted"]],template:function(t,d){if(t&1&&(i(0,"div",1),C(1,N,18,0,"ng-container",2)(2,$,6,1,"ng-template",null,0,M),a()),t&2){let l=D(3);u(),_("ngIf",!d.carregando)("ngIfElse",l)}},dependencies:[j,P],styles:["body[_ngcontent-%COMP%]{background-color:#212529}h1[_ngcontent-%COMP%]{font-size:2.5rem;letter-spacing:1px}"]})};export{O as Login};
