import{a as K,b as Q,c as X,d as Y,e as Z,f as ee,g as te,h as ie,i as oe}from"./chunk-PJ2EVE5F.js";import{A as P,N}from"./chunk-C6PC2EW2.js";import{a as E}from"./chunk-OMXCDONK.js";import{b as R,e as W,f as j,g as L,h as q,i as B,j as U,o as z,p as G,q as $}from"./chunk-SBITE6UI.js";import"./chunk-FL3Z7HVM.js";import{Ga as m,Ha as n,Ia as r,Ja as _,Kb as T,Lb as D,Na as V,Oa as O,Ob as k,Pa as I,Ra as f,S as p,T as g,Ta as b,Vb as J,Xb as A,_b as H,bb as v,d as y,fb as s,gb as S,ha as h,ia as l,kb as C,lb as w,ma as x,mb as M,qa as F,ua as u}from"./chunk-D4SJKQCR.js";function ae(o,i){if(o&1&&_(0,"img",28),o&2){let e=b().$implicit;m("src",e.imagem,h)}}function re(o,i){if(o&1&&(n(0,"mat-option",25)(1,"div",26),u(2,ae,1,1,"img",27),n(3,"span"),s(4),r()()()),o&2){let e=i.$implicit;m("value",e),l(2),m("ngIf",e.imagem),l(2),S(e.personagem)}}function le(o,i){if(o&1&&_(0,"img",28),o&2){let e=b().$implicit;m("src",e.imagem,h)}}function me(o,i){if(o&1&&(n(0,"mat-option",25)(1,"div",26),u(2,le,1,1,"img",27),n(3,"span"),s(4),r()()()),o&2){let e=i.$implicit;m("value",e),l(2),m("ngIf",e.imagem),l(2),S(e.personagem)}}function de(o,i){if(o&1&&_(0,"img",35),o&2){let e=b(2);m("src",e.ofensorSelecionado.imagem,h)}}function se(o,i){if(o&1&&_(0,"img",35),o&2){let e=b(2);m("src",e.vitimaSelecionada.imagem,h)}}function ce(o,i){if(o&1&&(n(0,"div",29)(1,"div",30)(2,"div",26),u(3,de,1,1,"img",31),n(4,"div")(5,"h6",32),s(6),r(),n(7,"small",33),s(8,"Ofensor"),r()()(),n(9,"span",34),s(10,"\u2716"),r(),n(11,"div",26),u(12,se,1,1,"img",31),n(13,"div")(14,"h6",32),s(15),r(),n(16,"small",33),s(17,"V\xEDtima"),r()()()()()),o&2){let e=b();l(3),m("ngIf",e.ofensorSelecionado.imagem),l(3),S(e.ofensorSelecionado.personagem),l(6),m("ngIf",e.vitimaSelecionada.imagem),l(3),S(e.vitimaSelecionada.personagem)}}function pe(o,i){o&1&&(V(0),s(1,"\u2694\uFE0F Registrar"),O())}function ge(o,i){o&1&&(V(0),_(1,"span",36),s(2," Registrando... "),O())}var ne=class o{constructor(i,e){this.router=i;this.route=e}todosJogadores=[];ofensorSelecionado=null;vitimaSelecionada=null;filtroOfensor="";filtroVitima="";ofensoresFiltrados=[];vitimasFiltradas=[];dano=0;efeitos="";salvando=!1;ngOnInit(){return y(this,null,function*(){this.todosJogadores=yield E.getLocalJogadores();let i=H.getUser();this.ofensorSelecionado=this.todosJogadores.find(t=>t.email===i?.email)||null,this.filtroOfensor=this.ofensorSelecionado?.personagem||"",this.ofensoresFiltrados=[...this.todosJogadores];let e=this.route.snapshot.paramMap.get("id");e&&(this.vitimaSelecionada=this.todosJogadores.find(t=>String(t.id)===e)||null,this.filtroVitima=this.vitimaSelecionada?.personagem||""),this.vitimasFiltradas=[...this.todosJogadores]})}filtrarOfensores(){let i=this.filtroOfensor.toLowerCase().trim();this.ofensoresFiltrados=i?this.todosJogadores.filter(e=>e.personagem.toLowerCase().includes(i)):[...this.todosJogadores]}filtrarVitimas(){let i=this.filtroVitima.toLowerCase().trim();this.vitimasFiltradas=i?this.todosJogadores.filter(e=>e.personagem.toLowerCase().includes(i)):[...this.todosJogadores]}selecionarOfensor(i){this.ofensorSelecionado=i,this.filtroOfensor=i.personagem}selecionarVitima(i){this.vitimaSelecionada=i,this.filtroVitima=i.personagem}incrementar(){this.dano++}decrementar(){this.dano=Math.max(0,this.dano-1)}cancelar(){this.router.navigate(["/batalha"])}registrarCombate(i){return y(this,null,function*(){if(!(i.invalid||!this.ofensorSelecionado||!this.vitimaSelecionada)){this.salvando=!0;try{let e=this.dano,t=this.vitimaSelecionada.classe_de_armadura||0,d=this.vitimaSelecionada.dano_tomado||0;t>0?e<=t?(this.vitimaSelecionada.classe_de_armadura=t-e,e=0):(this.vitimaSelecionada.classe_de_armadura=0,e-=t,this.vitimaSelecionada.dano_tomado=d+e):this.vitimaSelecionada.dano_tomado=d+e,yield E.updateJogador(this.vitimaSelecionada),console.log("\u2694\uFE0F Combate registrado:",{ofensor:this.ofensorSelecionado,vitima:this.vitimaSelecionada,danoRecebido:this.dano,caRestante:this.vitimaSelecionada.classe_de_armadura,danoTomadoTotal:this.vitimaSelecionada.dano_tomado,efeitos:this.efeitos}),alert(`\u2705 ${this.ofensorSelecionado.personagem} causou ${this.dano} de dano em ${this.vitimaSelecionada.personagem}!
\u{1F6E1}\uFE0F Armadura restante: ${this.vitimaSelecionada.classe_de_armadura}
\u{1F4A5} Dano total sofrido: ${this.vitimaSelecionada.dano_tomado}`),this.router.navigate(["/batalha"])}catch(e){console.error("[Combate] Erro ao registrar:",e),alert("\u274C Erro ao registrar combate.")}finally{this.salvando=!1}}})}static \u0275fac=function(e){return new(e||o)(x(A),x(J))};static \u0275cmp=F({type:o,selectors:[["app-combate"]],decls:41,vars:12,consts:[["form","ngForm"],["autoOfensor","matAutocomplete"],["autoVitima","matAutocomplete"],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","outline",1,"w-100","input-dark"],["type","text","matInput","","placeholder","Selecione o ofensor...","name","filtroOfensor",3,"ngModelChange","input","ngModel","matAutocomplete"],[3,"optionSelected"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","placeholder","Selecione a v\xEDtima...","name","filtroVitima",3,"ngModelChange","input","ngModel","matAutocomplete"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","dano","min","0","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],["rows","2","name","efeitos","placeholder","Ex: sangramento, atordoamento...",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],["class","me-2 rounded","style","width: 28px; height: 28px; object-fit: cover;",3,"src",4,"ngIf"],[1,"me-2","rounded",2,"width","28px","height","28px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],[1,"d-flex","align-items-center","justify-content-around"],["class","me-2 rounded","style","width: 50px; height: 50px; object-fit: cover;",3,"src",4,"ngIf"],[1,"fw-bold","text-light","mb-1"],[1,"text-light","opacity-75"],[1,"fw-bold","text-danger","mx-3"],[1,"me-2","rounded",2,"width","50px","height","50px","object-fit","cover",3,"src"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,t){if(e&1){let d=I();n(0,"div",3)(1,"form",4,0),f("ngSubmit",function(){p(d);let a=v(2);return g(t.registrarCombate(a))}),n(3,"div",5)(4,"div",6)(5,"div",7)(6,"label",8),s(7,"\u2694\uFE0F Ofensor *"),r(),n(8,"mat-form-field",9)(9,"input",10),M("ngModelChange",function(a){return p(d),w(t.filtroOfensor,a)||(t.filtroOfensor=a),g(a)}),f("input",function(){return p(d),g(t.filtrarOfensores())}),r(),n(10,"mat-autocomplete",11,1),f("optionSelected",function(a){return p(d),g(t.selecionarOfensor(a.option.value))}),u(12,re,5,3,"mat-option",12),r()()(),n(13,"div",7)(14,"label",8),s(15,"\u{1F6E1}\uFE0F V\xEDtima *"),r(),n(16,"mat-form-field",9)(17,"input",13),M("ngModelChange",function(a){return p(d),w(t.filtroVitima,a)||(t.filtroVitima=a),g(a)}),f("input",function(){return p(d),g(t.filtrarVitimas())}),r(),n(18,"mat-autocomplete",11,2),f("optionSelected",function(a){return p(d),g(t.selecionarVitima(a.option.value))}),u(20,me,5,3,"mat-option",12),r()()(),u(21,ce,18,4,"div",14),n(22,"div",15)(23,"label",16),s(24,"\u{1F4A5} Dano *"),r(),n(25,"div",17)(26,"button",18),f("click",function(){return p(d),g(t.decrementar())}),s(27,"\u2212"),r(),n(28,"input",19),M("ngModelChange",function(a){return p(d),w(t.dano,a)||(t.dano=a),g(a)}),r(),n(29,"button",18),f("click",function(){return p(d),g(t.incrementar())}),s(30,"+"),r()()(),n(31,"div",7)(32,"label",8),s(33,"\u2728 Efeitos adicionais"),r(),n(34,"textarea",20),M("ngModelChange",function(a){return p(d),w(t.efeitos,a)||(t.efeitos=a),g(a)}),r()(),n(35,"div",21)(36,"button",22),f("click",function(){return p(d),g(t.cancelar())}),s(37,"\u2B05 Cancelar"),r(),n(38,"button",23),u(39,pe,2,0,"ng-container",24)(40,ge,3,0,"ng-container",24),r()()()()()()}if(e&2){let d=v(2),c=v(11),a=v(19);l(9),C("ngModel",t.filtroOfensor),m("matAutocomplete",c),l(3),m("ngForOf",t.ofensoresFiltrados),l(5),C("ngModel",t.filtroVitima),m("matAutocomplete",a),l(3),m("ngForOf",t.vitimasFiltradas),l(),m("ngIf",t.ofensorSelecionado&&t.vitimaSelecionada),l(7),C("ngModel",t.dano),l(6),C("ngModel",t.efeitos),l(4),m("disabled",d.invalid||t.salvando),l(),m("ngIf",!t.salvando),l(),m("ngIf",t.salvando)}},dependencies:[k,T,D,$,B,R,U,W,j,G,z,q,L,Q,K,te,Z,X,ee,oe,ie,Y,P,N],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.75rem;text-align:center}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.75rem 1rem;text-align:center}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d}"]})};export{ne as Combate};
