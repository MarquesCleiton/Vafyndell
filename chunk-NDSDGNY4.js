import{a as et,b as it,c as nt,d as at,e as ot,f as rt,g as lt,h as dt,i as st}from"./chunk-PJ2EVE5F.js";import{A as B,N as W,z as L}from"./chunk-C6PC2EW2.js";import{a as f}from"./chunk-BIKZT75S.js";import{a as C}from"./chunk-AH4ZKKXF.js";import{b as J,e as G,f as Q,g as Y,h as H,i as K,j as X,o as Z,p as $,q as tt}from"./chunk-SBITE6UI.js";import"./chunk-FL3Z7HVM.js";import{Ga as c,Ha as r,Ia as d,Ja as I,Kb as N,Lb as j,Na as M,Oa as S,Ob as R,Pa as k,Ra as g,S as u,T as p,Ta as _,Vb as U,Xb as z,_b as O,a as D,b as E,bb as b,d as h,fb as m,gb as q,ha as w,ia as s,ib as T,kb as F,lb as V,ma as y,mb as A,qa as P,ua as v}from"./chunk-D4SJKQCR.js";function mt(a,i){if(a&1){let t=k();r(0,"mat-option",23),g("click",function(){u(t);let n=_();return p(n.novoItem())}),r(1,"mat-icon",24),m(2,"add_circle"),d(),m(3," Novo "),d()}}function ut(a,i){if(a&1&&I(0,"img",28),a&2){let t=_().$implicit;c("src",t.imagem,w)}}function pt(a,i){if(a&1&&(r(0,"mat-option",25)(1,"div",26),v(2,ut,1,1,"img",27),r(3,"span"),m(4),d()()()),a&2){let t=i.$implicit;c("value",t),s(2),c("ngIf",t.imagem),s(2),q(t.nome)}}function gt(a,i){if(a&1&&I(0,"img",33),a&2){let t=_(2);c("src",t.selecionado.imagem,w)}}function ft(a,i){if(a&1&&(r(0,"div",29)(1,"div",26),v(2,gt,1,1,"img",30),r(3,"div")(4,"h6",31),m(5),d(),r(6,"small",32),m(7),d()()()()),a&2){let t=_();s(2),c("ngIf",t.selecionado.imagem),s(3),q(t.selecionado.nome),s(2),T(" ",t.selecionado.categoria," | ",t.selecionado.raridade," ")}}function vt(a,i){a&1&&(M(0),m(1,"\u{1F4BE} Salvar"),S())}function ht(a,i){a&1&&(M(0),I(1,"span",34),m(2," Salvando... "),S())}var ct=class a{constructor(i,t){this.router=i;this.route=t}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;salvando=!1;editando=!1;inventarioAtual=null;returnUrl=null;ngOnInit(){return h(this,null,function*(){try{console.log("[CadastroInventario] Iniciando carregamento..."),this.catalogoItens=yield C.getLocalItens(),this.catalogoFiltrado=this.catalogoItens,C.syncItens().then(t=>h(this,null,function*(){t&&(console.log("[CadastroInventario] Cat\xE1logo atualizado. Recarregando..."),this.catalogoItens=yield C.getLocalItens(),this.catalogoFiltrado=this.catalogoItens)})),this.returnUrl=this.route.snapshot.queryParamMap.get("returnUrl");let i=Number(this.route.snapshot.paramMap.get("id"));if(i){this.editando=!0;let t=O.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield f.getLocalInventarioByJogador(t.email);if(this.inventarioAtual=e.find(n=>n.id===i)||null,this.inventarioAtual&&(this.selecionado=this.catalogoItens.find(n=>n.id===this.inventarioAtual.item_catalogo)||null,this.quantidade=this.inventarioAtual.quantidade,this.filtro=this.selecionado?.nome||""),f.syncInventario().then(n=>h(this,null,function*(){if(n){console.log("[CadastroInventario] Invent\xE1rio atualizado. Recarregando item...");let o=(yield f.getLocalInventarioByJogador(t.email)).find(x=>x.id===i);o&&(this.inventarioAtual=o,this.selecionado=this.catalogoItens.find(x=>x.id===o.item_catalogo)||null,this.quantidade=o.quantidade,this.filtro=this.selecionado?.nome||"")}})),!this.inventarioAtual){let n=yield f.forceFetchInventario();this.inventarioAtual=n.find(l=>l.id===i)||null,this.inventarioAtual&&(this.selecionado=this.catalogoItens.find(l=>l.id===this.inventarioAtual.item_catalogo)||null,this.quantidade=this.inventarioAtual.quantidade,this.filtro=this.selecionado?.nome||"")}}}catch(i){console.error("[CadastroInventario] Erro ao carregar:",i)}})}filtrarItens(){let i=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),t=i(this.filtro||"");if(!t){this.catalogoFiltrado=[...this.catalogoItens];return}this.catalogoFiltrado=this.catalogoItens.filter(e=>i(e.nome).includes(t))}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(1,this.quantidade-1)}cancelar(){this.router.navigate([this.returnUrl||"/inventario-jogador"])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"],{queryParams:{returnUrl:"/cadastro-inventario"}})}salvar(i){return h(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let t=O.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.editando&&this.inventarioAtual){let e=E(D({},this.inventarioAtual),{jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade});yield f.updateInventario(e)}else{let e=yield f.getLocalInventarioByJogador(t.email),n=e.length>0?Math.max(...e.map(o=>o.index||0)):0,l={id:n+1,index:n+1,jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade};yield f.createInventario(l)}alert("\u2705 Item salvo no invent\xE1rio!"),this.router.navigate([this.returnUrl||"/inventario-jogador"])}catch(t){console.error("[CadastroInventario] Erro ao salvar:",t),alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(t){return new(t||a)(y(z),y(U))};static \u0275cmp=P({type:a,selectors:[["app-cadastro-inventario"]],decls:30,vars:10,consts:[["form","ngForm"],["auto","matAutocomplete"],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","outline",1,"w-100","input-dark"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","quantidade","min","1","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],["class","me-2 rounded","style","width: 28px; height: 28px; object-fit: cover;",3,"src",4,"ngIf"],[1,"me-2","rounded",2,"width","28px","height","28px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],["class","me-3 rounded","style","width: 50px; height: 50px; object-fit: cover;",3,"src",4,"ngIf"],[1,"fw-bold","text-light","mb-1"],[1,"text-light"],[1,"me-3","rounded",2,"width","50px","height","50px","object-fit","cover",3,"src"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,e){if(t&1){let n=k();r(0,"div",2)(1,"form",3,0),g("ngSubmit",function(){u(n);let o=b(2);return p(e.salvar(o))}),r(3,"div",4)(4,"div",5)(5,"div",6)(6,"label",7),m(7,"\u{1F3F7}\uFE0F Item *"),d(),r(8,"mat-form-field",8)(9,"input",9),A("ngModelChange",function(o){return u(n),V(e.filtro,o)||(e.filtro=o),p(o)}),g("input",function(){return u(n),p(e.filtrarItens())}),d(),r(10,"mat-autocomplete",10,1),g("optionSelected",function(o){return u(n),p(e.selecionarItem(o.option.value))}),v(12,mt,4,0,"mat-option",11)(13,pt,5,3,"mat-option",12),d()()(),v(14,ft,8,4,"div",13),r(15,"div",14)(16,"label",15),m(17,"\u{1F522} Quantidade *"),d(),r(18,"div",16)(19,"button",17),g("click",function(){return u(n),p(e.decrementar())}),m(20,"\u2212"),d(),r(21,"input",18),A("ngModelChange",function(o){return u(n),V(e.quantidade,o)||(e.quantidade=o),p(o)}),d(),r(22,"button",17),g("click",function(){return u(n),p(e.incrementar())}),m(23,"+"),d()()(),r(24,"div",19)(25,"button",20),g("click",function(){return u(n),p(e.cancelar())}),m(26,"\u2B05 Cancelar"),d(),r(27,"button",21),v(28,vt,2,0,"ng-container",22)(29,ht,3,0,"ng-container",22),d()()()()()()}if(t&2){let n=b(2),l=b(11);s(9),F("ngModel",e.filtro),c("matAutocomplete",l)("readonly",e.editando),s(3),c("ngIf",!e.editando),s(),c("ngForOf",e.catalogoFiltrado),s(),c("ngIf",e.selecionado),s(7),F("ngModel",e.quantidade),s(6),c("disabled",n.invalid||e.salvando),s(),c("ngIf",!e.salvando),s(),c("ngIf",e.salvando)}},dependencies:[R,N,j,tt,K,J,X,G,Q,$,Z,H,Y,it,et,lt,ot,nt,rt,st,dt,at,B,L,W],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.input-dark[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background:#1e1e1e;color:#f8f9fa;border-radius:6px}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#444!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline-thick[_ngcontent-%COMP%]{stroke:#0d6efd!important}.preview-card[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:8px;padding:10px;border:1px solid #444}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;color:#fff;background:#1e1e1e;border:1px solid #444;border-radius:6px;padding:4px}.quantidade-input[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}"]})};export{ct as CadastroInventario};
