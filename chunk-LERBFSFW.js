import{a as h}from"./chunk-2FOSI275.js";import{a as B,b as O,c as q,d as U,e as j,f as z,g as H,h as G,i as J,j as K,k as Q,l as X,m as Y}from"./chunk-CWUN6S5M.js";import"./chunk-5QAPYOWQ.js";import{a as Z}from"./chunk-5J7TBXYM.js";import{$ as W,Ba as M,Ca as b,Da as v,Fa as E,Ha as S,M as g,N as c,Oa as x,Sa as d,Ta as w,V as D,Wa as p,Xa as f,Ya as C,a as F,aa as l,ab as P,d as I,da as y,fa as T,ja as _,mb as R,nb as N,ob as k,ua as u,va as a,vb as A,wa as n,xa as V,xb as L}from"./chunk-AITSM7GI.js";function ee(r,m){if(r&1){let i=v();M(0),V(1,"img",26),a(2,"button",27),E("click",function(){g(i);let o=S();return c(o.removerImagem())}),d(3,"\u2716"),n(),b()}if(r&2){let i=S();l(),u("src",i.item.imagem,W)}}function te(r,m){if(r&1){let i=v();a(0,"label",28)(1,"span",29),d(2,"\u{1F4F7}"),n(),a(3,"input",30),E("change",function(o){g(i);let s=S();return c(s.onFileChange(o))}),n()()}}function ie(r,m){if(r&1&&(a(0,"option"),d(1),n()),r&2){let i=m.$implicit;l(),w(i)}}function ae(r,m){if(r&1&&(a(0,"option"),d(1),n()),r&2){let i=m.$implicit;l(),w(i)}}function ne(r,m){if(r&1&&(a(0,"option"),d(1),n()),r&2){let i=m.$implicit;l(),w(i)}}function oe(r,m){if(r&1&&(a(0,"option"),d(1),n()),r&2){let i=m.$implicit;l(),w(i)}}function re(r,m){r&1&&(M(0),d(1,"\u{1F4BE} Salvar"),b())}function le(r,m){r&1&&(M(0),V(1,"span",31),d(2," Salvando... "),b())}var $=class r{constructor(m,i,e){this.router=m;this.el=i;this.route=e}item={index:0,id:0,nome:"",unidade_medida:"",peso:0,categoria:"",origem:"",raridade:"",efeito:"",colateral:"",descricao:"",imagem:"",email:""};salvando=!1;editMode=!1;unidadesMedida=["g","kg","ml","l","cm","m","unidade"];origens=["Fabric\xE1vel","Natural"];raridades=["Comum","Incomum","Raro","\xC9pico","Lend\xE1rio"];categorias=["Recursos bot\xE2nicos","Mineral","Equipamento","Moeda","Tesouro","Componentes bestiais e animalescos","Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos","Ferramentas","Outros"];ngOnInit(){return I(this,null,function*(){let m=this.route.snapshot.paramMap.get("id");if(m){this.editMode=!0;try{yield h.syncItens();let e=(yield h.getLocalItens()).find(o=>String(o.id)===m);e&&(this.item=F({},e))}catch(i){console.error("[CadastroItemCatalogo] Erro ao carregar item:",i)}}})}ngAfterViewInit(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(i=>{let e=()=>{i.style.height="auto",i.style.height=Math.min(i.scrollHeight,200)+"px"};i.addEventListener("input",e),e()})}onFileChange(m){let i=m.target;if(i.files&&i.files.length>0){let e=i.files[0],o=new FileReader;o.onload=()=>{this.item.imagem=o.result},o.readAsDataURL(e)}}removerImagem(){this.item.imagem=""}salvar(m){return I(this,null,function*(){if(!m.invalid)try{this.salvando=!0;let i=Z.getUser();if(!i?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.item.email=i.email,this.editMode)yield h.updateItem(this.item),window.alert("\u2705 Item atualizado com sucesso!");else{yield h.syncItens();let o=yield h.getAllItens(),s=o.length>0?Math.max(...o.map(t=>t.index||0)):0;this.item.index=s+1,this.item.id=s+1,yield h.createItem(this.item),window.alert("\u2705 Item criado com sucesso!")}let e=this.route.snapshot.queryParamMap.get("returnUrl")||"/catalogo";this.router.navigateByUrl(e)}catch(i){console.error("[CadastroItemCatalogo] Erro ao salvar:",i),window.alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(i){return new(i||r)(y(L),y(D),y(A))};static \u0275cmp=T({type:r,selectors:[["app-cadastro-item-catalogo"]],decls:64,vars:18,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","mb-5"],[1,"flex-grow-1"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","bg-dark","border-0","shadow-sm"],[1,"card-body"],[1,"fw-bold","mb-3","text-white"],[1,"mb-3"],[1,"form-label","text-white"],["type","text","name","nome","required","",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","unidadeMedida","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[4,"ngFor","ngForOf"],["type","number","name","peso","min","0",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","categoria","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","origem","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","raridade","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","descricao",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],["name","efeito",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],["name","colateral",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-success","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","shadow-sm",2,"height","250px","object-fit","cover",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"d-flex","align-items-center","justify-content-center","border","rounded","w-100",2,"height","150px","background","#1e1e1e","cursor","pointer"],[1,"text-success","fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,e){if(i&1){let o=v();a(0,"div",2)(1,"div",3)(2,"form",4,0),E("ngSubmit",function(){g(o);let t=x(3);return c(e.salvar(t))}),a(4,"div",5),_(5,ee,4,1,"ng-container",6)(6,te,4,0,"ng-template",null,1,P),n(),a(8,"div",7)(9,"div",8)(10,"h4",9),d(11,"\u{1F4E6} Cadastro de Item do Cat\xE1logo"),n(),a(12,"div",10)(13,"label",11),d(14,"\u{1F3F7}\uFE0F Nome *"),n(),a(15,"input",12),C("ngModelChange",function(t){return g(o),f(e.item.nome,t)||(e.item.nome=t),c(t)}),n()(),a(16,"div",10)(17,"label",11),d(18,"\u2696\uFE0F Unidade de Medida *"),n(),a(19,"select",13),C("ngModelChange",function(t){return g(o),f(e.item.unidade_medida,t)||(e.item.unidade_medida=t),c(t)}),a(20,"option",14),d(21,"Selecione..."),n(),_(22,ie,2,1,"option",15),n()(),a(23,"div",10)(24,"label",11),d(25,"\u2696\uFE0F Peso"),n(),a(26,"input",16),C("ngModelChange",function(t){return g(o),f(e.item.peso,t)||(e.item.peso=t),c(t)}),n()(),a(27,"div",10)(28,"label",11),d(29,"\u{1F4C2} Categoria *"),n(),a(30,"select",17),C("ngModelChange",function(t){return g(o),f(e.item.categoria,t)||(e.item.categoria=t),c(t)}),a(31,"option",14),d(32,"Selecione..."),n(),_(33,ae,2,1,"option",15),n()(),a(34,"div",10)(35,"label",11),d(36,"\u{1F331} Origem *"),n(),a(37,"select",18),C("ngModelChange",function(t){return g(o),f(e.item.origem,t)||(e.item.origem=t),c(t)}),a(38,"option",14),d(39,"Selecione..."),n(),_(40,ne,2,1,"option",15),n()(),a(41,"div",10)(42,"label",11),d(43,"\u{1F48E} Raridade *"),n(),a(44,"select",19),C("ngModelChange",function(t){return g(o),f(e.item.raridade,t)||(e.item.raridade=t),c(t)}),a(45,"option",14),d(46,"Selecione..."),n(),_(47,oe,2,1,"option",15),n()(),a(48,"div",10)(49,"label",11),d(50,"\u{1F4DD} Descri\xE7\xE3o"),n(),a(51,"textarea",20),C("ngModelChange",function(t){return g(o),f(e.item.descricao,t)||(e.item.descricao=t),c(t)}),n()(),a(52,"div",10)(53,"label",11),d(54,"\u2728 Efeito"),n(),a(55,"textarea",21),C("ngModelChange",function(t){return g(o),f(e.item.efeito,t)||(e.item.efeito=t),c(t)}),n()(),a(56,"div",10)(57,"label",11),d(58,"\u26A0\uFE0F Colateral"),n(),a(59,"textarea",22),C("ngModelChange",function(t){return g(o),f(e.item.colateral,t)||(e.item.colateral=t),c(t)}),n()()()(),a(60,"div",23)(61,"button",24),_(62,re,2,0,"ng-container",25)(63,le,3,0,"ng-container",25),n()()()()()}if(i&2){let o=x(3),s=x(7);l(5),u("ngIf",e.item.imagem)("ngIfElse",s),l(10),p("ngModel",e.item.nome),l(4),p("ngModel",e.item.unidade_medida),l(3),u("ngForOf",e.unidadesMedida),l(4),p("ngModel",e.item.peso),l(4),p("ngModel",e.item.categoria),l(3),u("ngForOf",e.categorias),l(4),p("ngModel",e.item.origem),l(3),u("ngForOf",e.origens),l(4),p("ngModel",e.item.raridade),l(3),u("ngForOf",e.raridades),l(4),p("ngModel",e.item.descricao),l(4),p("ngModel",e.item.efeito),l(4),p("ngModel",e.item.colateral),l(2),u("disabled",o.invalid||e.salvando),l(),u("ngIf",!e.salvando),l(),u("ngIf",e.salvando)}},dependencies:[k,R,N,Y,z,J,K,B,H,G,O,q,X,Q,j,U],styles:["textarea.auto-expand[_ngcontent-%COMP%]{min-height:60px;max-height:200px;overflow-y:auto;resize:none}"]})};export{$ as CadastroItemCatalogo};
