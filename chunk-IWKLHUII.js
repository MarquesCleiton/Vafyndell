import{a as g}from"./chunk-G46V626D.js";import{b as j,e as z,f as R,g as q,h as G,i as U,j as H,l as X,m as Y,n as J,o as K,p as Q,q as Z}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as $}from"./chunk-HS244SCX.js";import{Ga as u,Ha as i,Ia as n,Ib as I,Ja as V,Jb as T,Mb as L,Na as M,Oa as N,Pa as w,Ra as _,S as p,T as m,Ta as f,Tb as W,Vb as B,a as v,bb as E,d as y,fb as l,gb as k,ha as D,ia as s,ib as F,kb as b,lb as C,ma as S,mb as h,nb as O,qa as P,sb as A,ua as x}from"./chunk-ILJPX4RU.js";function ie(d,r){if(d&1){let t=w();M(0),V(1,"img",27),i(2,"button",28),_("click",function(){p(t);let a=f();return m(a.removerImagem())}),l(3,"\u2716"),n(),N()}if(d&2){let t=f();s(),u("src",t.npc.imagem,D)}}function ne(d,r){if(d&1){let t=w();i(0,"label",29)(1,"span",30),l(2,"\u{1F4F7}"),n(),i(3,"input",31),_("change",function(a){p(t);let c=f();return m(c.onFileChange(a))}),n()()}}function ae(d,r){if(d&1&&(i(0,"option"),l(1),n()),d&2){let t=r.$implicit;s(),k(t)}}function oe(d,r){if(d&1&&(i(0,"option"),l(1),n()),d&2){let t=r.$implicit;s(),k(t)}}function re(d,r){if(d&1){let t=w();i(0,"div",32)(1,"div",33),l(2),n(),i(3,"div",34)(4,"button",35),_("click",function(){let a=p(t).$implicit,c=f();return m(c.ajustarValor(a.key,-1))}),l(5,"\u2212"),n(),i(6,"input",36),_("ngModelChange",function(a){let c=p(t).$implicit,o=f();return m(o.setValor(c.key,a))}),n(),i(7,"button",35),_("click",function(){let a=p(t).$implicit,c=f();return m(c.ajustarValor(a.key,1))}),l(8,"+"),n()()()}if(d&2){let t=r.$implicit,e=f();s(2),F(" ",t.icon," ",t.label," "),s(4),u("name",O(t.key))("ngModel",e.getValor(t.key))}}function le(d,r){d&1&&(M(0),l(1,"\u{1F4BE} Salvar"),N())}function ce(d,r){d&1&&(M(0),V(1,"span",37),l(2," Salvando... "),N())}var ee=class d{constructor(r,t){this.router=r;this.route=t}npc={id:0,index:0,imagem:"",nome:"",classificacao:"Inimigo",tipo:"Comum",descricao:"",alinhamento:"",pontos_de_vida:0,classe_armadura:0,forca:0,constituicao:0,destreza:0,sabedoria:0,inteligencia:0,energia:0,ataques:"",xp:0,email:""};atributosNumericos=[{key:"xp",label:"XP",icon:"\u2B50"},{key:"pontos_de_vida",label:"Vida",icon:"\u2764\uFE0F"},{key:"classe_armadura",label:"Armadura",icon:"\u{1F6E1}\uFE0F"},{key:"forca",label:"For\xE7a",icon:"\u{1F4AA}"},{key:"constituicao",label:"Constitui\xE7\xE3o",icon:"\u{1FAA8}"},{key:"destreza",label:"Destreza",icon:"\u{1F938}\u200D\u2642\uFE0F"},{key:"sabedoria",label:"Sabedoria",icon:"\u{1F4D6}"},{key:"inteligencia",label:"Intelig\xEAncia",icon:"\u{1F9E0}"},{key:"energia",label:"Energia",icon:"\u26A1"}];classificacoes=["Inimigo","Bestial"];tipos=["Comum","Elite","M\xE1gico","Lend\xE1rio"];salvando=!1;editMode=!1;ngOnInit(){return y(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield g.getLocalNpcs()).find(a=>String(a.id)===r);if(e&&(this.npc=v({},e)),g.syncNpcs().then(a=>y(this,null,function*(){if(a){let o=(yield g.getLocalNpcs()).find(te=>String(te.id)===r);o&&(this.npc=v({},o))}})),!e){let c=(yield g.forceFetchNpcs()).find(o=>String(o.id)===r);c&&(this.npc=v({},c))}}catch(t){console.error("[CadastroNpc] Erro ao carregar NPC:",t)}}})}getValor(r){return this.npc[r]}setValor(r,t){this.npc[r]=Math.max(0,t)}ajustarValor(r,t){this.setValor(r,this.getValor(r)+t)}onFileChange(r){let t=r.target;if(t.files&&t.files.length>0){let e=t.files[0],a=new FileReader;a.onload=()=>{this.npc.imagem=a.result},a.readAsDataURL(e)}}removerImagem(){this.npc.imagem=""}salvar(r){return y(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let t=$.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.npc.email=t.email,yield g.syncNpcs(),this.editMode)yield g.updateNpc(this.npc),window.alert("\u2705 NPC atualizado com sucesso!");else{let e=yield g.getLocalNpcs(),a=0;e.length>0&&(a=Math.max(...e.map(c=>c.index||0))),this.npc.index=a+1,this.npc.id=a+1,yield g.createNpc(this.npc),window.alert("\u2705 NPC criado com sucesso!")}this.router.navigate(["/npcs"])}catch(t){console.error("[CadastroNpc] Erro ao salvar NPC:",t),window.alert("\u274C Erro ao salvar NPC. Veja o console.")}finally{this.salvando=!1}})}cancelar(){this.router.navigate(["/npcs"])}static \u0275fac=function(t){return new(t||d)(S(B),S(W))};static \u0275cmp=P({type:d,selectors:[["app-cadastro-npc"]],decls:66,vars:14,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","pb-5"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold","mb-3","text-light"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","nome","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","classificacao","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["name","tipo","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","alinhamento",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["rows","3","name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"mb-3","mt-4"],["rows","3","name","ataques",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"fw-bold","mt-4","text-light"],[1,"atributos-grid-edit","mb-3"],["class","atributo-item-edit",4,"ngFor","ngForOf"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"atributo-item-edit"],[1,"atributo-label","text-center"],[1,"atributo-controls"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","min","0",1,"atributo-input",3,"ngModelChange","ngModel","name"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,e){if(t&1){let a=w();i(0,"div",2)(1,"div",3)(2,"form",4,0),_("ngSubmit",function(){p(a);let o=E(3);return m(e.salvar(o))}),i(4,"div",5),x(5,ie,4,1,"ng-container",6)(6,ne,4,0,"ng-template",null,1,A),n(),i(8,"div",7)(9,"div",8)(10,"h4",9),l(11,"\u{1F479} Cadastro de Feras & Vil\xF5es"),n(),i(12,"div",10)(13,"label",11),l(14,"\u{1F64D} Nome *"),n(),i(15,"input",12),h("ngModelChange",function(o){return p(a),C(e.npc.nome,o)||(e.npc.nome=o),m(o)}),n()(),i(16,"div",10)(17,"label",11),l(18,"\u{1F3F7}\uFE0F Classifica\xE7\xE3o *"),n(),i(19,"select",13),h("ngModelChange",function(o){return p(a),C(e.npc.classificacao,o)||(e.npc.classificacao=o),m(o)}),x(20,ae,2,1,"option",14),n()(),i(21,"div",10)(22,"label",11),l(23,"\u{1F3AD} Tipo *"),n(),i(24,"select",15),h("ngModelChange",function(o){return p(a),C(e.npc.tipo,o)||(e.npc.tipo=o),m(o)}),x(25,oe,2,1,"option",14),n()(),i(26,"div",10)(27,"label",11),l(28,"\u2696\uFE0F Alinhamento"),n(),i(29,"select",16),h("ngModelChange",function(o){return p(a),C(e.npc.alinhamento,o)||(e.npc.alinhamento=o),m(o)}),i(30,"option",17),l(31,"Selecione..."),n(),i(32,"option"),l(33,"Leal e Bom (Lawful Good)"),n(),i(34,"option"),l(35,"Neutro e Bom (Neutral Good)"),n(),i(36,"option"),l(37,"Ca\xF3tico e Bom (Chaotic Good)"),n(),i(38,"option"),l(39,"Leal e Neutro (Lawful Neutral)"),n(),i(40,"option"),l(41,"Neutro (Neutral)"),n(),i(42,"option"),l(43,"Ca\xF3tico e Neutro (Chaotic Neutral)"),n(),i(44,"option"),l(45,"Leal e Mau (Lawful Evil)"),n(),i(46,"option"),l(47,"Neutro e Mau (Neutral Evil)"),n(),i(48,"option"),l(49,"Ca\xF3tico e Mau (Chaotic Evil)"),n()()(),i(50,"div",10)(51,"label",11),l(52,"\u{1F4DD} Descri\xE7\xE3o"),n(),i(53,"textarea",18),h("ngModelChange",function(o){return p(a),C(e.npc.descricao,o)||(e.npc.descricao=o),m(o)}),n()(),i(54,"div",19)(55,"label",11),l(56,"\u2694\uFE0F Ataques"),n(),i(57,"textarea",20),h("ngModelChange",function(o){return p(a),C(e.npc.ataques,o)||(e.npc.ataques=o),m(o)}),n()(),i(58,"h6",21),l(59,"\u{1F4CA} Atributos Num\xE9ricos"),n(),i(60,"div",22),x(61,re,9,5,"div",23),n(),i(62,"div",24)(63,"button",25),x(64,le,2,0,"ng-container",26)(65,ce,3,0,"ng-container",26),n()()()()()()()}if(t&2){let a=E(3),c=E(7);s(5),u("ngIf",e.npc.imagem)("ngIfElse",c),s(10),b("ngModel",e.npc.nome),s(4),b("ngModel",e.npc.classificacao),s(),u("ngForOf",e.classificacoes),s(4),b("ngModel",e.npc.tipo),s(),u("ngForOf",e.tipos),s(4),b("ngModel",e.npc.alinhamento),s(24),b("ngModel",e.npc.descricao),s(4),b("ngModel",e.npc.ataques),s(4),u("ngForOf",e.atributosNumericos),s(2),u("disabled",a.invalid||e.salvando),s(),u("ngIf",!e.salvando),s(),u("ngIf",e.salvando)}},dependencies:[L,I,T,Z,U,Y,J,j,H,X,z,R,Q,K,G,q],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#dc3545;color:#dc3545}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributos-grid-edit[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}@media (min-width: 768px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (min-width: 992px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}}.atributo-item-edit[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:6px;padding:8px 10px;display:flex;flex-direction:column;align-items:center}.atributo-label[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa;margin-bottom:6px;text-align:center}.atributo-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px}.atributo-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;color:#fff;background:#1e1e1e;border:1px solid #444;border-radius:4px;padding:2px 4px}.atributo-input[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributo-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:2px 8px;font-size:.9rem;line-height:1}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}"]})};export{ee as CadastroNpc};
