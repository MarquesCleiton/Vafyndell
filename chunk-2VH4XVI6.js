import{a as x}from"./chunk-G46V626D.js";import{a as w}from"./chunk-FJZA3HMC.js";import"./chunk-W7DVKRY2.js";import"./chunk-HS244SCX.js";import{Ga as l,Gb as z,Ha as t,Ia as i,Ja as f,Jb as j,Mb as V,Na as p,Oa as m,Pa as T,Ra as E,S as D,T as S,Ta as u,Tb as R,Vb as q,a as C,d as v,fb as e,gb as d,ha as F,hb as y,ia as a,ma as N,nb as k,qa as A,ua as g}from"./chunk-ILJPX4RU.js";function $(r,o){r&1&&(t(0,"div",7),f(1,"div",8),t(2,"p",9),e(3,"Carregando NPC..."),i()())}function L(r,o){if(r&1&&(p(0),f(1,"img",22),m()),r&2){let n=u(2);a(),l("alt",k(n.npc.nome))("src",n.npc.imagem,F)}}function B(r,o){if(r&1&&(t(0,"div",23)(1,"h6",24),e(2,"\u{1F4DD} Descri\xE7\xE3o"),i(),t(3,"p",25),e(4),i()()),r&2){let n=u(2);a(4),d(n.npc.descricao)}}function U(r,o){if(r&1&&(t(0,"div",23)(1,"h6",24),e(2,"\u2694\uFE0F Ataques"),i(),t(3,"p",26),e(4),i()()),r&2){let n=u(2);a(4),d(n.npc.ataques)}}function X(r,o){r&1&&(p(0),e(1,"\u270F\uFE0F Editar"),m())}function G(r,o){r&1&&(p(0),f(1,"span",27),e(2," Editando... "),m())}function H(r,o){r&1&&(p(0),e(1,"\u{1F5D1}\uFE0F Excluir"),m())}function K(r,o){r&1&&(p(0),f(1,"span",27),e(2," Excluindo... "),m())}function Q(r,o){if(r&1){let n=T();t(0,"div",10),g(1,L,2,3,"ng-container",6),t(2,"div",11)(3,"h5",12),e(4),i(),t(5,"ul",13)(6,"li"),e(7,"\u{1F3F7}\uFE0F "),t(8,"span"),e(9,"Classifica\xE7\xE3o:"),i(),e(10),i(),t(11,"li"),e(12,"\u{1F3AD} "),t(13,"span"),e(14,"Tipo:"),i(),e(15),i(),t(16,"li"),e(17,"\u2696\uFE0F "),t(18,"span"),e(19,"Alinhamento:"),i(),e(20),i()(),t(21,"h6",14),e(22,"\u{1F4CA} Atributos"),i(),t(23,"div",15)(24,"div",16),e(25,"\u2764\uFE0F "),t(26,"span"),e(27,"Vida"),i(),t(28,"b"),e(29),i()(),t(30,"div",16),e(31,"\u{1F6E1}\uFE0F "),t(32,"span"),e(33,"Armadura"),i(),t(34,"b"),e(35),i()(),t(36,"div",16),e(37,"\u2B50 "),t(38,"span"),e(39,"XP"),i(),t(40,"b"),e(41),i()(),t(42,"div",16),e(43,"\u{1F4AA} "),t(44,"span"),e(45,"For\xE7a"),i(),t(46,"b"),e(47),i()(),t(48,"div",16),e(49,"\u{1FAA8} "),t(50,"span"),e(51,"Constitui\xE7\xE3o"),i(),t(52,"b"),e(53),i()(),t(54,"div",16),e(55,"\u{1F938}\u200D\u2642\uFE0F "),t(56,"span"),e(57,"Destreza"),i(),t(58,"b"),e(59),i()(),t(60,"div",16),e(61,"\u{1F4D6} "),t(62,"span"),e(63,"Sabedoria"),i(),t(64,"b"),e(65),i()(),t(66,"div",16),e(67,"\u{1F9E0} "),t(68,"span"),e(69,"Intelig\xEAncia"),i(),t(70,"b"),e(71),i()(),t(72,"div",16),e(73,"\u26A1 "),t(74,"span"),e(75,"Energia"),i(),t(76,"b"),e(77),i()()(),g(78,B,5,1,"div",17)(79,U,5,1,"div",17),t(80,"div",18)(81,"button",19),E("click",function(){D(n);let s=u();return S(s.cancelar())}),e(82,"\u2B05 Voltar"),i(),t(83,"div")(84,"button",20),E("click",function(){D(n);let s=u();return S(s.editarNpc())}),g(85,X,2,0,"ng-container",6)(86,G,3,0,"ng-container",6),i(),t(87,"button",21),E("click",function(){D(n);let s=u();return S(s.excluirNpc())}),g(88,H,2,0,"ng-container",6)(89,K,3,0,"ng-container",6),i()()()()()}if(r&2){let n=u();a(),l("ngIf",n.npc.imagem),a(3),d(n.npc.nome),a(6),y(" ",n.npc.classificacao),a(5),y(" ",n.npc.tipo),a(5),y(" ",n.npc.alinhamento||"N\xE3o definido"),a(9),d(n.npc.pontos_de_vida),a(6),d(n.npc.classe_armadura),a(6),d(n.npc.xp),a(6),d(n.npc.forca),a(6),d(n.npc.constituicao),a(6),d(n.npc.destreza),a(6),d(n.npc.sabedoria),a(6),d(n.npc.inteligencia),a(6),d(n.npc.energia),a(),l("ngIf",n.npc.descricao),a(),l("ngIf",n.npc.ataques),a(5),l("disabled",n.processandoEditar),a(),l("ngIf",!n.processandoEditar),a(),l("ngIf",n.processandoEditar),a(),l("disabled",n.processandoExcluir),a(),l("ngIf",!n.processandoExcluir),a(),l("ngIf",n.processandoExcluir)}}function W(r,o){r&1&&(t(0,"div",28),e(1," NPC n\xE3o encontrado. "),i())}function Y(r,o){r&1&&(p(0),e(1,"\u2694\uFE0F"),m())}function Z(r,o){r&1&&(p(0),f(1,"div",29),m())}var J=class r{constructor(o,n,c){this.route=o;this.router=n;this.location=c}npc=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;processandoAdicionar=!1;ngOnInit(){return v(this,null,function*(){let o=this.route.snapshot.paramMap.get("id");if(!o){this.router.navigate(["/npcs"]);return}try{this.carregando=!0;let c=(yield x.getLocalNpcs()).find(s=>String(s.id)===String(o))||null;c&&(this.npc=C({},c)),x.syncNpcs().then(s=>v(this,null,function*(){if(s){let I=(yield x.getLocalNpcs()).find(b=>String(b.id)===String(o));I&&(this.npc=C({},I))}})),c||(c=(yield x.forceFetchNpcs()).find(_=>String(_.id)===String(o))||null,c&&(this.npc=C({},c)))}catch(n){console.error("[NpcDetalhes] Erro ao carregar NPC:",n)}finally{this.carregando=!1}})}cancelar(){this.location.back()}editarNpc(){this.npc&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-npc",this.npc.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},300))}excluirNpc(){return v(this,null,function*(){if(!(!this.npc||!confirm(`\u{1F5D1}\uFE0F Deseja realmente excluir "${this.npc.nome}"?`))){this.processandoExcluir=!0;try{yield x.deleteNpc(this.npc.id),alert("\u2705 NPC exclu\xEDdo com sucesso!"),this.router.navigate(["/npcs"])}catch(n){console.error("[NpcDetalhes] Erro ao excluir NPC:",n),alert("\u274C Erro ao excluir NPC. Veja o console.")}finally{this.processandoExcluir=!1}}})}adicionarAoCampo(){return v(this,null,function*(){if(this.npc){this.processandoAdicionar=!0;try{let o=yield w.getAllJogadores(),n=this.npc.nome.trim(),c=new RegExp(`^(\\d+) - ${n}$`,"i"),s=o.filter(h=>c.test(h.personagem)),_=1;if(s.length>0){let h=s.map(P=>{let O=P.personagem.match(/^(\d+) -/);return O?parseInt(O[1],10):0}).filter(P=>!isNaN(P));_=Math.max(...h)+1}let b=(o.length>0?Math.max(...o.map(h=>h.id||0)):0)+1,M={index:b,id:b,email:"",imagem:this.npc.imagem||"",nome_do_jogador:"NPC",personagem:`${_} - ${n}`,alinhamento:this.npc.alinhamento||"",pontos_de_vida:this.npc.pontos_de_vida,classe_de_armadura:this.npc.classe_armadura,forca:this.npc.forca,destreza:this.npc.destreza,constituicao:this.npc.constituicao,inteligencia:this.npc.inteligencia,sabedoria:this.npc.sabedoria,carisma:0,energia:this.npc.energia,nivel:1,xp:this.npc.xp,dano_tomado:0,tipo_jogador:"NPC",efeitos_temporarios:"",registo_de_jogo:"",classificacao:this.npc.classificacao,tipo:this.npc.tipo,descricao:this.npc.descricao,ataques:this.npc.ataques};yield w.createJogador(M),alert(`\u2705 ${M.personagem} adicionado ao campo de batalha!`)}catch(o){console.error("[NpcDetalhes] Erro ao adicionar NPC no campo de batalha:",o),alert("\u274C Erro ao adicionar NPC. Veja o console.")}finally{this.processandoAdicionar=!1}}})}static \u0275fac=function(n){return new(n||r)(N(R),N(q),N(z))};static \u0275cmp=A({type:r,selectors:[["app-npc-detalhes"]],decls:8,vars:6,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3"],["class","text-center py-5",4,"ngIf"],["class","card detalhe-card shadow-lg border-0",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[1,"fab","fab-danger",3,"click","disabled"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3"],[1,"fw-bold","mb-3"],[1,"info-list","mb-3"],[1,"fw-bold","mt-3"],[1,"atributos-grid","compact","mb-3"],[1,"atributo-item"],["class","mt-3",4,"ngIf"],[1,"d-flex","justify-content-between","mt-4"],[1,"btn","btn-outline-light","btn-sm",3,"click"],[1,"btn","btn-warning","btn-sm","me-2",3,"click","disabled"],[1,"btn","btn-danger","btn-sm",3,"click","disabled"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"mt-3"],[1,"fw-bold"],[1,"descricao-text"],[1,"ataques-text"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","text-secondary","py-5"],["role","status",1,"spinner-border","text-light",2,"width","2rem","height","2rem"]],template:function(n,c){n&1&&(t(0,"div",0)(1,"div",1),g(2,$,4,0,"div",2)(3,Q,90,22,"div",3)(4,W,2,0,"div",4),i(),t(5,"button",5),E("click",function(){return c.adicionarAoCampo()}),g(6,Y,2,0,"ng-container",6)(7,Z,2,0,"ng-container",6),i()()),n&2&&(a(2),l("ngIf",c.carregando),a(),l("ngIf",!c.carregando&&c.npc),a(),l("ngIf",!c.carregando&&!c.npc),a(),l("disabled",c.processandoAdicionar),a(),l("ngIf",!c.processandoAdicionar),a(),l("ngIf",c.processandoAdicionar))},dependencies:[V,j],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{max-height:220px;object-fit:cover}.info-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.95rem}.info-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;color:#f1f1f1}.info-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#ffc107}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:.9rem;color:#e0e0e0}.atributos-grid.compact[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.descricao-text[_ngcontent-%COMP%]{color:#ddd;font-size:.95rem}.ataques-text[_ngcontent-%COMP%]{color:#f8d775;font-size:.9rem}.card-body[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#f1f1f1;margin-bottom:6px}.fab[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px 12px;font-size:.9rem;color:#f1f1f1}.atributo-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;white-space:nowrap;font-size:.9rem;background:#2a2a2a;border-radius:6px;padding:4px 8px}.atributo-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#ccc;margin-right:2px}.atributo-item[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#fff}"]})};export{J as NpcDetalhes};
