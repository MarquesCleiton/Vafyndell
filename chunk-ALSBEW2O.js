import{c as H,f as K,i as Q,r as X}from"./chunk-UJUF775I.js";import{a as J}from"./chunk-SL4CV3BB.js";import{h as G}from"./chunk-XMJCILQE.js";import{h as N,i as B,o as U,p as W,w as Y}from"./chunk-ZOZAG657.js";import{$b as y,Ab as m,Bb as c,Cb as s,Db as h,Hb as C,Ib as D,Jb as w,Nb as p,Pb as g,Sa as S,Ua as l,Za as T,Zb as O,a as P,b as M,bc as d,cc as k,dc as x,eb as A,fc as R,g as I,gc as j,hc as z,ic as V,jb as u,jc as q,la as f,ma as b,pc as L,qc as $,rc as E}from"./chunk-YAKM3PEZ.js";function te(n,t){if(n&1&&(c(0,"div",18)(1,"p",19),d(2," \u2696\uFE0F Peso total: "),c(3,"b"),d(4),L(5,"number"),s()()()),n&2){let e=g();l(4),x("",$(5,1,e.resumo.pesoTotal,"1.0-2")," kg")}}function ne(n,t){n&1&&(c(0,"div",20),h(1,"div",21),c(2,"p",22),d(3,"Carregando invent\xE1rio..."),s()())}function ie(n,t){n&1&&(c(0,"div",23),d(1," Nenhum item encontrado. "),s())}function oe(n,t){if(n&1&&h(0,"img",46),n&2){let e=g().$implicit;m("alt",q(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,S)}}function ae(n,t){if(n&1&&(c(0,"span"),d(1),s()),n&2){let e=g().$implicit,i=g(5);l(),x(" ",i.getEmojiFallback(e.itemDetalhe==null?null:e.itemDetalhe.categoria)," ")}}function re(n,t){if(n&1&&(c(0,"p",47),d(1),s()),n&2){let e=g().$implicit;l(),x("\u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito," ")}}function le(n,t){if(n&1&&(c(0,"p",48),d(1),s()),n&2){let e=g().$implicit;l(),x("\u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function ce(n,t){n&1&&(C(0),h(1,"span",49),D())}function se(n,t){n&1&&d(0,"\u{1F4E4}")}function de(n,t){n&1&&(C(0),h(1,"span",49),D())}function me(n,t){n&1&&d(0,"\u270F\uFE0F")}function ge(n,t){n&1&&(C(0),h(1,"span",49),D())}function _e(n,t){n&1&&d(0,"\u{1F5D1}\uFE0F")}function pe(n,t){if(n&1){let e=w();c(0,"div",31)(1,"div",32)(2,"div",33),p("click",function(){let o=f(e).$implicit,a=g(5);return b(a.abrirItem(o.id))}),c(3,"div",34)(4,"div",35),u(5,oe,1,3,"img",36)(6,ae,2,1,"span",15),s(),c(7,"div")(8,"h6",37),d(9),s(),c(10,"small",38),d(11),s()()(),u(12,re,2,1,"p",39)(13,le,2,1,"p",40),s(),c(14,"div",41)(15,"button",42),p("click",function(o){let a=f(e).$implicit,r=g(5);return b(r.trocarItem(a.id,o))}),u(16,ce,2,0,"ng-container",43)(17,se,1,0,"ng-template",null,0,E),s(),c(19,"button",44),p("click",function(o){let a=f(e).$implicit,r=g(5);return b(r.editarItem(a.id,o))}),u(20,de,2,0,"ng-container",43)(21,me,1,0,"ng-template",null,1,E),s(),c(23,"button",45),p("click",function(o){let a=f(e).$implicit,r=g(5);return b(r.excluirItem(a.id,o))}),u(24,ge,2,0,"ng-container",43)(25,_e,1,0,"ng-template",null,2,E),s()()()()}if(n&2){let e=t.$implicit,i=O(18),o=O(22),a=O(26),r=g(5);l(5),m("ngIf",(e.itemDetalhe==null?null:e.itemDetalhe.imagem)&&(e.itemDetalhe==null?null:e.itemDetalhe.imagem)!=="-"),l(),m("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)||(e.itemDetalhe==null?null:e.itemDetalhe.imagem)==="-"),l(3),x(" ",(e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"," "),l(2),R(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",e.quantidade*((e.itemDetalhe==null?null:e.itemDetalhe.peso)||0)," kg "),l(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),l(),m("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral),l(2),m("disabled",r.processando[e.id]==="transferir"),l(),m("ngIf",r.processando[e.id]==="transferir")("ngIfElse",i),l(3),m("disabled",r.processando[e.id]==="editar"),l(),m("ngIf",r.processando[e.id]==="editar")("ngIfElse",o),l(3),m("disabled",r.processando[e.id]==="excluir"),l(),m("ngIf",r.processando[e.id]==="excluir")("ngIfElse",a)}}function ue(n,t){if(n&1&&(c(0,"div",22)(1,"div",29),u(2,pe,27,17,"div",30),s()()),n&2){let e=g(2).$implicit;l(2),m("ngForOf",e.itens)}}function ve(n,t){if(n&1){let e=w();c(0,"div",26)(1,"button",27),p("click",function(){f(e);let o=g().$implicit,a=g(2);return b(a.toggleCategoria(o))}),c(2,"span"),d(3),s(),c(4,"span"),d(5),s()(),u(6,ue,3,1,"div",28),s()}if(n&2){let e=g().$implicit;l(3),k(e.nome),l(2),k(e.expandido?"\u2212":"+"),l(),m("ngIf",e.expandido)}}function fe(n,t){if(n&1&&(C(0),u(1,ve,7,3,"div",25),D()),n&2){let e=t.$implicit,i=g(2);l(),m("ngIf",i.pertenceAba(e.nome))}}function be(n,t){if(n&1&&(c(0,"div"),u(1,fe,2,1,"ng-container",24),s()),n&2){let e=g();l(),m("ngForOf",e.categoriasFiltradas)}}var Z=class n{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="recursos";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};catalogoRepo=new J("Catalogo");inventarioRepo=new J("Inventario");mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return I(this,null,function*(){try{this.carregando=!0;let t=Y.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");yield this.loadLocalAndSync(t.email)}catch(t){console.error("[InventarioJogador] \u274C Erro ao carregar invent\xE1rio:",t)}finally{this.carregando=!1}})}loadLocalAndSync(t){return I(this,null,function*(){console.log("[InventarioJogador] \u{1F511} Email do jogador:",t);let[e,i]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]);console.log("[InventarioJogador] \u{1F4C2} Catalogo Local:",e),console.log("[InventarioJogador] \u{1F4C2} Inventario Local:",i);let o=i.filter(a=>a.jogador===t);if(console.log("[InventarioJogador] \u{1F3AF} Meus Itens (local):",o),this.processarInventario(o,e),I(this,null,function*(){let[a,r]=yield Promise.all([this.catalogoRepo.sync(),this.inventarioRepo.sync()]);if(console.log("[InventarioJogador] \u{1F504} Sync conclu\xEDdo:",{catSync:a,invSync:r}),a||r){let[_,v]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]);console.log("[InventarioJogador] \u{1F4C2} Catalogo Atualizado:",_),console.log("[InventarioJogador] \u{1F4C2} Inventario Atualizado:",v);let F=v.filter(ee=>ee.jogador===t);console.log("[InventarioJogador] \u{1F3AF} Meus Itens (sync):",F),this.processarInventario(F,_)}}),!o.length){console.log("[InventarioJogador] \u26A0\uFE0F Nenhum item local \u2192 buscando online...");let[a,r]=yield Promise.all([this.catalogoRepo.forceFetch(),this.inventarioRepo.forceFetch()]);console.log("[InventarioJogador] \u{1F310} Catalogo Online:",a),console.log("[InventarioJogador] \u{1F310} Inventario Online:",r);let _=r.filter(v=>v.jogador===t);console.log("[InventarioJogador] \u{1F3AF} Meus Itens (online):",_),this.processarInventario(_,a)}})}processarInventario(t,e){console.log("[InventarioJogador] \u{1F6E0}\uFE0F processarInventario \u2192",{inventarioBruto:t,catalogo:e});let i=t.map(r=>{let _=e.find(v=>String(v.id)===String(r.item_catalogo)||String(v.id)===String(r.item_catalogo));return _||console.warn("[InventarioJogador] \u26A0\uFE0F Sem detalhe encontrado para item:",r),M(P({},r),{itemDetalhe:_})});console.log("[InventarioJogador] \u{1F4E6} Inventario Detalhado:",i);let o=new Map(this.categorias.map(r=>[r.nome,r.expandido])),a=new Map;i.forEach(r=>{let _=r.itemDetalhe?.categoria||"Outros";a.has(_)||a.set(_,[]),a.get(_).push(r)}),this.categorias=Array.from(a.entries()).sort(([r],[_])=>r.localeCompare(_)).map(([r,_])=>({nome:r,itens:_,expandido:o.get(r)??!1})),console.log("[InventarioJogador] \u{1F4CA} Categorias:",this.categorias),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,i)=>e+(i.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,i)=>e+(i.quantidade||0)*(i.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>{let i=e.itens.filter(o=>[o.itemDetalhe?.nome,o.itemDetalhe?.raridade,o.itemDetalhe?.efeito,o.itemDetalhe?.colateral,o.itemDetalhe?.categoria].map(a=>this.normalizarTexto(String(a||""))).some(a=>a.includes(t)));return M(P({},e),{itens:i,expandido:i.length>0})}).filter(e=>e.itens.length>0)}normalizarTexto(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(t){this.abaAtiva=t}pertenceAba(t){return t?this.mapaAbas[this.abaAtiva].includes(t):this.abaAtiva==="outros"}toggleCategoria(t){t.expandido=!t.expandido}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}abrirTroca(){this.router.navigate(["/troca-de-itens"])}trocarItem(t,e){e.stopPropagation(),this.router.navigate(["/troca-de-itens",t])}getEmojiFallback(t){if(!t)return"\u{1F4E6}";let e={recursos:"\u{1F33F}",equipamentos:"\u2694\uFE0F",pocoes:"\u{1F9EA}",outros:"\u{1F4E6}"};for(let i of Object.keys(this.mapaAbas))if(this.mapaAbas[i].includes(t))return e[i];return"\u{1F4E6}"}processando={};editarItem(t,e){e.stopPropagation(),this.processando[t]="editar",setTimeout(()=>{this.router.navigate(["/cadastro-inventario",t]),this.processando[t]=null},400)}excluirItem(t,e){return I(this,null,function*(){if(e.stopPropagation(),!!confirm("\u{1F5D1}\uFE0F Deseja excluir este item do invent\xE1rio?")){this.processando[t]="excluir";try{yield this.inventarioRepo.delete(t),alert("\u2705 Item exclu\xEDdo do invent\xE1rio!"),this.categoriasFiltradas=this.categoriasFiltradas.map(o=>M(P({},o),{itens:o.itens.filter(a=>a.id!==t)}))}catch(o){console.error("[Invent\xE1rio] Erro ao excluir:",o),alert("\u274C Erro ao excluir item")}finally{this.processando[t]=null}}})}static \u0275fac=function(e){return new(e||n)(T(G))};static \u0275cmp=A({type:n,selectors:[["app-inventario-jogador"]],decls:27,vars:13,consts:[["transferirIcon",""],["editarIcon",""],["excluirIcon",""],[1,"inventario-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0","z-10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","search-bar",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-container","w-100"],[1,"fw-bold","mb-3"],["class","card resumo-card mb-4 p-3 shadow-sm",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"card","resumo-card","mb-4","p-3","shadow-sm"],[1,"mb-1","text-light"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-secondary","py-5"],[4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-3"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","h-100","p-3","shadow-sm"],[3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","mb-1","text-light"],[1,"item-meta"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[1,"text-end","mt-2","d-flex","justify-content-end","gap-1"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[1,"spinner-border","spinner-border-sm"]],template:function(e,i){e&1&&(c(0,"div",3)(1,"div",4)(2,"input",5),V("ngModelChange",function(a){return z(i.filtro,a)||(i.filtro=a),a}),p("input",function(){return i.aplicarFiltro()}),s()(),c(3,"ul",6)(4,"li",7)(5,"button",8),p("click",function(){return i.selecionarAba("recursos")}),d(6,"\u{1F33F} Recursos"),s()(),c(7,"li",7)(8,"button",8),p("click",function(){return i.selecionarAba("equipamentos")}),d(9,"\u2694\uFE0F Equipamentos"),s()(),c(10,"li",7)(11,"button",8),p("click",function(){return i.selecionarAba("pocoes")}),d(12,"\u{1F9EA} Po\xE7\xF5es"),s()(),c(13,"li",7)(14,"button",8),p("click",function(){return i.selecionarAba("outros")}),d(15,"\u{1F4E6} Outros"),s()()(),c(16,"div",9)(17,"div",10)(18,"h4",11),d(19,"\u{1F392} Invent\xE1rio"),s(),u(20,te,6,4,"div",12)(21,ne,4,0,"div",13)(22,ie,2,0,"div",14)(23,be,2,1,"div",15),s()(),c(24,"div",16)(25,"button",17),p("click",function(){return i.novoItemInventario()}),d(26,"\uFF0B"),s()()()),e&2&&(l(2),j("ngModel",i.filtro),l(3),y("active",i.abaAtiva==="recursos"),l(3),y("active",i.abaAtiva==="equipamentos"),l(3),y("active",i.abaAtiva==="pocoes"),l(3),y("active",i.abaAtiva==="outros"),l(6),m("ngIf",!i.carregando&&i.categoriasFiltradas.length>0),l(),m("ngIf",i.carregando),l(),m("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),l(),m("ngIf",!i.carregando))},dependencies:[W,N,B,X,H,K,Q,U],styles:[".nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}.inventario-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.inventario-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:20px;padding:.5rem 1rem}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.resumo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.inventario-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;cursor:pointer;transition:transform .15s ease}.inventario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.inventario-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.item-meta[_ngcontent-%COMP%]{color:#bbb;font-size:.85rem}.inventario-card[_ngcontent-%COMP%]   .btn-success[_ngcontent-%COMP%]{font-size:.85rem;padding:4px 8px;border-radius:6px}.fab-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.fab-success[_ngcontent-%COMP%]:hover{background:#218838}.inventario-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%], .inventario-card[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%], .inventario-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.inventario-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745}.inventario-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff}.inventario-card[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%]{border-color:#0d6efd;color:#0d6efd}.inventario-card[_ngcontent-%COMP%]   .btn-outline-primary[_ngcontent-%COMP%]:hover{background:#0d6efd;color:#fff}.inventario-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.inventario-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}"]})};export{Z as InventarioJogador};
