import{c as tt,d as et,g as it,n as nt,o as at,p as ot,q as rt,t as lt,u as dt}from"./chunk-CXWQS3DX.js";import{A as L,B as z,O as B}from"./chunk-XV5MBKEE.js";import{a as f}from"./chunk-QSXRPDPU.js";import{a as I}from"./chunk-HXJSPHLL.js";import{c as W,f as J,g as G,h as Q,i as Y,j as H,k as K,p as X,q as Z,r as $}from"./chunk-2MTP6EBK.js";import"./chunk-2P6BNU5L.js";import{f as T,g as N,j,q as R,s as U,v as q}from"./chunk-HRLERFBW.js";import{Db as y,Eb as M,Fb as S,Jb as g,Lb as _,Pa as w,Qa as s,Va as x,Vb as C,Zb as m,_b as k,a as A,ab as E,ac as P,b as D,cc as F,d as v,dc as V,ec as O,fb as h,ia as u,ja as p,wb as c,xb as o,yb as l,zb as b}from"./chunk-QQSIVCMV.js";function mt(n,i){if(n&1){let t=S();o(0,"mat-option",23),g("click",function(){u(t);let a=_();return p(a.novoItem())}),o(1,"mat-icon",24),m(2,"add_circle"),l(),m(3," Novo "),l()}}function ut(n,i){if(n&1&&b(0,"img",28),n&2){let t=_().$implicit;c("src",t.imagem,w)}}function pt(n,i){if(n&1&&(o(0,"mat-option",25)(1,"div",26),h(2,ut,1,1,"img",27),o(3,"span"),m(4),l()()()),n&2){let t=i.$implicit;c("value",t),s(2),c("ngIf",t.imagem),s(2),k(t.nome)}}function gt(n,i){if(n&1&&b(0,"img",33),n&2){let t=_(2);c("src",t.selecionado.imagem,w)}}function ft(n,i){if(n&1&&(o(0,"div",29)(1,"div",26),h(2,gt,1,1,"img",30),o(3,"div")(4,"h6",31),m(5),l(),o(6,"small",32),m(7),l()()()()),n&2){let t=_();s(2),c("ngIf",t.selecionado.imagem),s(3),k(t.selecionado.nome),s(2),P(" ",t.selecionado.categoria," | ",t.selecionado.raridade," ")}}function vt(n,i){n&1&&(y(0),m(1,"\u{1F4BE} Salvar"),M())}function ht(n,i){n&1&&(y(0),b(1,"span",34),m(2," Salvando... "),M())}var st=class n{constructor(i,t){this.router=i;this.route=t}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;salvando=!1;editando=!1;inventarioAtual=null;returnUrl=null;ngOnInit(){return v(this,null,function*(){try{console.log("[CadastroInventario] Iniciando carregamento..."),this.catalogoItens=yield I.getLocalItens(),this.catalogoFiltrado=this.catalogoItens,v(this,null,function*(){(yield I.syncItens())&&(console.log("[CadastroInventario] Cat\xE1logo atualizado. Recarregando..."),this.catalogoItens=yield I.getLocalItens(),this.catalogoFiltrado=this.catalogoItens)}),this.returnUrl=this.route.snapshot.queryParamMap.get("returnUrl");let i=Number(this.route.snapshot.paramMap.get("id"));if(i){this.editando=!0;let t=q.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield f.getLocalInventarioByJogador(t.email);if(this.inventarioAtual=e.find(a=>a.id===i)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual)),v(this,null,function*(){if(yield f.syncInventario()){console.log("[CadastroInventario] Invent\xE1rio atualizado. Recarregando item...");let r=(yield f.getLocalInventarioByJogador(t.email)).find(ct=>ct.id===i);r&&(this.inventarioAtual=r,yield this.carregarItemSelecionado(this.inventarioAtual))}}),!this.inventarioAtual){let a=yield f.forceFetchInventario();this.inventarioAtual=a.find(d=>d.id===i)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual))}}}catch(i){console.error("[CadastroInventario] Erro ao carregar:",i)}})}carregarItemSelecionado(i){return v(this,null,function*(){this.catalogoItens.length||(this.catalogoItens=yield I.getLocalItens(),this.catalogoFiltrado=this.catalogoItens),this.selecionado=this.catalogoItens.find(t=>t.id===i.item_catalogo)||null,this.quantidade=i.quantidade,this.filtro=this.selecionado?.nome||""})}filtrarItens(){let i=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),t=i(this.filtro||"");if(!t){this.catalogoFiltrado=[...this.catalogoItens];return}this.catalogoFiltrado=this.catalogoItens.filter(e=>i(e.nome).includes(t))}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(1,this.quantidade-1)}cancelar(){this.router.navigate([this.returnUrl||"/inventario-jogador"])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"],{queryParams:{returnUrl:"/cadastro-inventario"}})}salvar(i){return v(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let t=q.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.editando&&this.inventarioAtual){let e=D(A({},this.inventarioAtual),{jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade});yield f.updateInventario(e)}else{let e=yield f.getLocalInventarioByJogador(t.email),a=e.length>0?Math.max(...e.map(r=>r.index||0)):0,d={id:a+1,index:a+1,jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade};yield f.createInventario(d)}alert("\u2705 Item salvo no invent\xE1rio!"),this.router.navigate([this.returnUrl||"/inventario-jogador"])}catch(t){console.error("[CadastroInventario] Erro ao salvar:",t),alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(t){return new(t||n)(x(U),x(R))};static \u0275cmp=E({type:n,selectors:[["app-cadastro-inventario"]],decls:30,vars:10,consts:[["form","ngForm"],["auto","matAutocomplete"],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","outline",1,"w-100","input-dark"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","quantidade","min","1","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],["class","me-2 rounded","style","width: 28px; height: 28px; object-fit: cover;",3,"src",4,"ngIf"],[1,"me-2","rounded",2,"width","28px","height","28px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],["class","me-3 rounded","style","width: 50px; height: 50px; object-fit: cover;",3,"src",4,"ngIf"],[1,"fw-bold","text-light","mb-1"],[1,"text-light"],[1,"me-3","rounded",2,"width","50px","height","50px","object-fit","cover",3,"src"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,e){if(t&1){let a=S();o(0,"div",2)(1,"form",3,0),g("ngSubmit",function(){u(a);let r=C(2);return p(e.salvar(r))}),o(3,"div",4)(4,"div",5)(5,"div",6)(6,"label",7),m(7,"\u{1F3F7}\uFE0F Item *"),l(),o(8,"mat-form-field",8)(9,"input",9),O("ngModelChange",function(r){return u(a),V(e.filtro,r)||(e.filtro=r),p(r)}),g("input",function(){return u(a),p(e.filtrarItens())}),l(),o(10,"mat-autocomplete",10,1),g("optionSelected",function(r){return u(a),p(e.selecionarItem(r.option.value))}),h(12,mt,4,0,"mat-option",11)(13,pt,5,3,"mat-option",12),l()()(),h(14,ft,8,4,"div",13),o(15,"div",14)(16,"label",15),m(17,"\u{1F522} Quantidade *"),l(),o(18,"div",16)(19,"button",17),g("click",function(){return u(a),p(e.decrementar())}),m(20,"\u2212"),l(),o(21,"input",18),O("ngModelChange",function(r){return u(a),V(e.quantidade,r)||(e.quantidade=r),p(r)}),l(),o(22,"button",17),g("click",function(){return u(a),p(e.incrementar())}),m(23,"+"),l()()(),o(24,"div",19)(25,"button",20),g("click",function(){return u(a),p(e.cancelar())}),m(26,"\u2B05 Cancelar"),l(),o(27,"button",21),h(28,vt,2,0,"ng-container",22)(29,ht,3,0,"ng-container",22),l()()()()()()}if(t&2){let a=C(2),d=C(11);s(9),F("ngModel",e.filtro),c("matAutocomplete",d)("readonly",e.editando),s(3),c("ngIf",!e.editando),s(),c("ngForOf",e.catalogoFiltrado),s(),c("ngIf",e.selecionado),s(7),F("ngModel",e.quantidade),s(6),c("disabled",a.invalid||e.salvando),s(),c("ngIf",!e.salvando),s(),c("ngIf",e.salvando)}},dependencies:[j,T,N,$,H,W,K,J,G,Z,X,Y,Q,et,tt,rt,at,it,ot,dt,lt,nt,z,L,B],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.input-dark[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background:#1e1e1e;color:#f8f9fa;border-radius:6px}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#444!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline-thick[_ngcontent-%COMP%]{stroke:#0d6efd!important}.preview-card[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:8px;padding:10px;border:1px solid #444}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;color:#fff;background:#1e1e1e;border:1px solid #444;border-radius:6px;padding:4px}.quantidade-input[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}"]})};export{st as CadastroInventario};
