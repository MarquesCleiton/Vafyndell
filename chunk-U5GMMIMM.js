import{b as B}from"./chunk-H7VFQHUE.js";import{g as j,j as D,s as F,v as g,w as s}from"./chunk-WLM7QTUH.js";import{Db as _,Eb as L,Fb as S,Jb as A,Lb as v,Qa as u,Va as f,Vb as M,Zb as a,_ as b,_b as k,ab as y,d as c,fb as E,ia as w,ja as I,mc as P,wb as C,xb as i,yb as o,zb as m}from"./chunk-QQSIVCMV.js";var p=class n{repo=new B("bootstrap");preloadAll(e){return c(this,null,function*(){let t=["Catalogo","Inventario","Receitas","Personagem","NPCs","Anotacoes","Metadados"],d=["\u{1F52E} Invocando grim\xF3rios...","\u{1F30C} Consultando os astros...","\u{1F4DC} Decifrando runas antigas...","\u26A1 Canalizando energia arcana..."],l=0,R=setInterval(()=>{e?.(d[l%d.length]),l++},1300),T=yield this.repo.getAllMulti(t);clearInterval(R);let h=yield g.create();for(let r of t){let x=[`\u{1F4D6} Estudando os pergaminhos de ${r}...`,`\u2692\uFE0F Forjando dados para ${r}...`,`\u{1F9EA} Misturando po\xE7\xF5es em ${r}...`,`\u{1F409} Invocando criaturas de ${r}...`],z=x[Math.floor(Math.random()*x.length)];e?.(z),yield h.clear(r),yield h.bulkPut(r,T[r]||[])}e?.("\u2728 Mundo preparado!")})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};function $(n,e){if(n&1){let t=S();_(0),i(1,"div",3)(2,"h1",4),a(3,"\u2694\uFE0F Vafyndell"),o(),i(4,"p",5),a(5," Bem-vindo, aventureiro! "),m(6,"br"),a(7," O seu RPG agora na palma das m\xE3os. "),o(),i(8,"div",6)(9,"button",7),A("click",function(){w(t);let l=v();return I(l.login())}),m(10,"img",8),i(11,"span",9),a(12,"Entrar na Taverna"),o()()()(),i(13,"div",10)(14,"p",11),a(15,"\u2728 Forje po\xE7\xF5es, enfrente bestas e registre suas aventuras"),o(),i(16,"p",11),a(17,"\u{1F3B2} Que os dados rolem sempre a seu favor!"),o()(),L()}}function G(n,e){if(n&1&&(i(0,"div",12),m(1,"div",13),i(2,"p",9),a(3),o(),i(4,"small",14),a(5,"Preparando o mundo..."),o()()),n&2){let t=v();u(3),k(t.mensagem)}}var O=class n{constructor(e,t){this.router=e;this.bootstrap=t}carregando=!1;mensagem="";ngOnInit(){return c(this,null,function*(){let e=s.getUser();if(e&&!s.isAuthenticated()){console.warn("[Login] Token expirado \u2192 limpando credenciais e banco"),yield s.logoutHard();return}e||(yield(yield g.create()).deleteDatabase(),console.warn("[Login] Nenhum usu\xE1rio \u2192 banco local limpo")),s.isAuthenticated()&&this.inicializarApp()})}login(){return c(this,null,function*(){if(s.isAuthenticated()){yield this.inicializarApp();return}try{this.carregando=!0,this.mensagem="Invocando grim\xF3rios...";let e=yield s.signInWithGoogle();e?(console.log("[Login] Login OK:",e),yield this.inicializarApp()):alert("Falha no login, tente novamente.")}catch(e){console.error("[Login] Erro no login:",e),alert("Erro no login. Verifique sua conex\xE3o e tente novamente.")}})}inicializarApp(){return c(this,null,function*(){this.carregando=!0,this.mensagem="Carregando tomos antigos...";try{yield this.bootstrap.preloadAll(e=>this.mensagem=e),console.log("[Login] Preload conclu\xEDdo!"),this.router.navigate(["/jogador"])}catch(e){console.error("[Login] Erro no preload:",e),alert("Erro ao carregar os dados iniciais. Tente novamente.")}finally{this.carregando=!1}})}static \u0275fac=function(t){return new(t||n)(f(F),f(p))};static \u0275cmp=y({type:n,selectors:[["app-login"]],decls:4,vars:2,consts:[["loading",""],[1,"d-flex","flex-column","justify-content-center","align-items-center","vh-100","bg-dark","text-light","text-center","p-4",2,"background","linear-gradient(135deg, #1a1a1a, #2b1d0e)"],[4,"ngIf","ngIfElse"],[1,"p-4","rounded","shadow-lg",2,"background","rgba(0,0,0,0.6)","max-width","420px","width","100%"],[1,"fw-bold","display-4","text-warning","mb-2"],[1,"fst-italic","mb-4","text-light"],[1,"d-flex","justify-content-center"],[1,"btn","btn-warning","px-4","py-2","rounded-pill","d-flex","align-items-center","gap-2","shadow",3,"click"],["src","https://developers.google.com/identity/images/g-logo.png","alt","Google","width","20","height","20"],[1,"fw-bold"],[1,"mt-4","small","text-light-emphasis"],[1,"m-0"],[1,"text-center"],["role","status",1,"spinner-border","text-warning","mb-3"],[1,"text-muted"]],template:function(t,d){if(t&1&&(i(0,"div",1),E(1,$,18,0,"ng-container",2)(2,G,6,1,"ng-template",null,0,P),o()),t&2){let l=M(3);u(),C("ngIf",!d.carregando)("ngIfElse",l)}},dependencies:[D,j],styles:["body[_ngcontent-%COMP%]{background-color:#212529}h1[_ngcontent-%COMP%]{font-size:2.5rem;letter-spacing:1px}"]})};export{O as Login};
