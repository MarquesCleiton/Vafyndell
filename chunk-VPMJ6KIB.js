import{a as N}from"./chunk-IKGGEFY2.js";import{a as w}from"./chunk-IDK3EA3G.js";import{c as F,f as z,g as j,m as q,t as A,v as L}from"./chunk-JZWR3MRG.js";import{Ab as d,Bb as r,Cb as a,Db as p,Hb as f,Ib as u,Jb as O,Nb as _,Pb as s,Sa as v,Ua as o,Za as h,Zb as I,ac as P,bc as c,cc as k,dc as g,eb as S,ec as E,g as x,jb as m,jc as R,kc as T,la as D,ma as M,qc as y}from"./chunk-HRDPHWQR.js";function $(e,n){e&1&&(r(0,"div",12),p(1,"div",13),r(2,"p",14),c(3,"Carregando item..."),a()())}function U(e,n){if(e&1){let t=O();f(0),r(1,"img",30),_("click",function(){D(t);let l=s(2);return M(l.abrirImagem(l.item.imagem))}),a(),u()}if(e&2){let t=s(2);o(),d("alt",R(t.item.nome||"Item"))("src",t.item.imagem,v)}}function G(e,n){e&1&&(r(0,"div",31),c(1," \u{1F4E6} "),a())}function H(e,n){if(e&1&&(r(0,"p",32),c(1," \u2728 "),r(2,"b"),c(3,"Efeito:"),a(),c(4),a()),e&2){let t=s(2);o(4),g(" ",t.item.efeito," ")}}function J(e,n){if(e&1&&(r(0,"p",33),c(1," \u26A0\uFE0F "),r(2,"b"),c(3,"Colateral:"),a(),c(4),a()),e&2){let t=s(2);o(4),g(" ",t.item.colateral," ")}}function K(e,n){if(e&1&&(r(0,"p",34),c(1," \u{1F4DD} "),r(2,"b"),c(3,"Descri\xE7\xE3o:"),a(),c(4),a()),e&2){let t=s(2);o(4),g(" ",t.item.descricao," ")}}function Q(e,n){if(e&1&&(f(0),p(1,"img",46),u()),e&2){let t=s().$implicit;o(),d("src",t.item.imagem,v)}}function W(e,n){e&1&&(r(0,"span",47),c(1,"\u{1F4E6}"),a())}function X(e,n){if(e&1&&(r(0,"div",42)(1,"div",43),m(2,Q,2,1,"ng-container",21)(3,W,2,0,"ng-template",null,1,y),r(5,"span",44),c(6),a()(),r(7,"span",45),c(8),a()()),e&2){let t=n.$implicit,i=I(4);o(2),d("ngIf",t.item.imagem&&(t.item==null?null:t.item.imagem)!=="-")("ngIfElse",i),o(4),k(t.item.nome||"Ingrediente"),o(2),g("x",t.quantidade)}}function Y(e,n){if(e&1&&(r(0,"div",35)(1,"h5",36),c(2,"\u{1F963} Receita"),a(),r(3,"div",37),m(4,X,9,4,"div",38),a(),r(5,"div",39)(6,"div",40),c(7,"\u2692\uFE0F Produz"),a(),r(8,"div",41),c(9),a()()()),e&2){let t=s(2);o(4),d("ngForOf",t.ingredientesDetalhados),o(5),E(" ",t.item.quantidade_fabricavel||1," ",t.item.unidade_medida||"unidade(s)"," ")}}function Z(e,n){if(e&1&&(r(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",18)(4,"h4",19),c(5),a()(),r(6,"div",20),m(7,U,2,3,"ng-container",21)(8,G,2,0,"ng-template",null,0,y),a(),r(10,"div",22)(11,"p",23)(12,"b"),c(13,"\u{1F4C2} Categoria:"),a(),c(14),a(),r(15,"p",23)(16,"b"),c(17,"\u{1F331} Origem:"),a(),c(18),a(),r(19,"p",23)(20,"b"),c(21,"\u{1F48E} Raridade:"),a(),r(22,"span"),c(23),a()(),r(24,"p",24)(25,"b"),c(26,"\u2696\uFE0F Peso:"),a(),c(27),a(),p(28,"hr",25),m(29,H,5,1,"p",26)(30,J,5,1,"p",27)(31,K,5,1,"p",28),a(),m(32,Y,10,3,"div",29),a()()()),e&2){let t=I(9),i=s();o(5),g(" \u{1F4E6} ",i.item.nome||"Sem nome"," "),o(2),d("ngIf",i.item.imagem&&i.item.imagem!=="-")("ngIfElse",t),o(7),g(" ",i.item.categoria),o(4),g(" ",i.item.origem),o(4),P(T("raridade ",i.getRaridadeClass(i.item.raridade))),o(),g(" ",i.item.raridade||"Comum"," "),o(4),E(" ",i.item.peso," ",i.item.unidade_medida),o(2),d("ngIf",i.item.efeito),o(),d("ngIf",i.item.colateral),o(),d("ngIf",i.item.descricao),o(),d("ngIf",i.ingredientesDetalhados.length>0)}}function ee(e,n){e&1&&(f(0),c(1,"\u270F\uFE0F"),u())}function te(e,n){e&1&&(f(0),p(1,"span",48),u())}function ie(e,n){e&1&&(f(0),c(1,"\u{1F5D1}\uFE0F"),u())}function ne(e,n){e&1&&(f(0),p(1,"span",48),u())}var V=class e{constructor(n,t,i){this.route=n;this.router=t;this.location=i}item=null;ingredientesDetalhados=[];carregando=!0;processandoEditar=!1;processandoExcluir=!1;imagemSelecionada=null;modalAberto=!1;repoCatalogo=new w("Catalogo");repoReceitas=new w("Receitas");ngOnInit(){return x(this,null,function*(){try{console.log("[ItemCatalogo] Iniciando carregamento..."),this.carregando=!0;let n=this.route.snapshot.paramMap.get("id");if(!n){this.router.navigate(["/catalogo"]);return}let t=yield this.repoCatalogo.getById(n,!0);if(t&&(this.item=t,this.carregando=!1,yield this.carregarReceita(n)),Promise.all([this.repoCatalogo.sync(),this.repoReceitas.sync()]).then(i=>x(this,null,function*(){let l=yield this.repoCatalogo.getById(n,!0);l&&(this.item=l,yield this.carregarReceita(n))})),!t){console.log("[ItemCatalogo] N\xE3o encontrado localmente \u2192 for\xE7ando fetch online");let l=(yield this.repoCatalogo.forceFetch()).find(b=>String(b.id)===n);l?(this.item=l,yield this.carregarReceita(n,!0)):(console.warn("[ItemCatalogo] Item n\xE3o encontrado nem online"),this.router.navigate(["/catalogo"])),this.carregando=!1}}catch(n){console.error("[ItemCatalogo] Erro ao carregar item:",n),this.carregando=!1}})}carregarReceita(n,t=!1){return x(this,null,function*(){let l=(t?yield this.repoReceitas.forceFetch():yield this.repoReceitas.getLocal()).filter(C=>String(C.fabricavel)===String(n));if(l.length===0){this.ingredientesDetalhados=[];return}let b=yield this.repoCatalogo.getLocal();this.ingredientesDetalhados=l.map(C=>({item:b.find(B=>String(B.id)===String(C.catalogo))||{},quantidade:C.quantidade}))})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-item-catalogo",this.item.id]),this.processandoEditar=!1},300))}excluirItem(){return x(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja excluir o item "${this.item.nome}"?`))){this.processandoExcluir=!0;try{yield this.repoCatalogo.delete(this.item.id),alert("\u2705 Item exclu\xEDdo com sucesso!"),this.router.navigate(["/catalogo"])}catch(t){console.error("[ItemCatalogo] Erro ao excluir item:",t),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}getRaridadeClass(n){switch((n||"").toLowerCase()){case"comum":return"raridade-comum";case"incomum":return"raridade-incomum";case"raro":return"raridade-raro";case"\xE9pico":case"epico":return"raridade-epico";case"lend\xE1rio":case"lendario":return"raridade-lendario";default:return"raridade-comum"}}abrirImagem(n){this.imagemSelecionada=n,this.modalAberto=!0}static \u0275fac=function(t){return new(t||e)(h(A),h(L),h(F))};static \u0275cmp=S({type:e,selectors:[["app-item-catalogo"]],decls:14,vars:10,consts:[["noImagem",""],["noImgIng",""],[1,"item-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],["class","text-center py-5",4,"ngIf"],["class","flex-grow-1 p-3 d-flex justify-content-center",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-warning",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-danger",3,"click","disabled"],[1,"fab","fab-primary",3,"click"],[1,"mb-5","py-5"],[3,"fecharModal","imagem","aberto"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"item-detalhe-container","w-100"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-capitalize","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"text-light","mb-1"],[1,"text-light","mb-3"],[1,"border-secondary"],["class","mb-1 text-info",4,"ngIf"],["class","mb-1 text-danger",4,"ngIf"],["class","fst-italic text-light descricao-text",4,"ngIf"],["class","ingredientes-wrapper p-3 border-top",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"click","src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mb-1","text-info"],[1,"mb-1","text-danger"],[1,"fst-italic","text-light","descricao-text"],[1,"ingredientes-wrapper","p-3","border-top"],[1,"fw-bold","text-light","mb-3"],[1,"ingredientes-grid","mb-3"],["class","ingrediente-card",4,"ngFor","ngForOf"],[1,"producao-card","text-center"],[1,"titulo"],[1,"quantidade"],[1,"ingrediente-card"],[1,"d-flex","align-items-center","gap-2"],[1,"nome"],[1,"qtd"],[1,"thumb-mini","rounded",3,"src"],[1,"fs-5"],[1,"spinner-border","spinner-border-sm"]],template:function(t,i){t&1&&(r(0,"div",2),m(1,$,4,0,"div",3)(2,Z,33,15,"div",4),r(3,"div",5)(4,"button",6),_("click",function(){return i.editarItem()}),m(5,ee,2,0,"ng-container",7)(6,te,2,0,"ng-container",7),a(),r(7,"button",8),_("click",function(){return i.excluirItem()}),m(8,ie,2,0,"ng-container",7)(9,ne,2,0,"ng-container",7),a(),r(10,"button",9),_("click",function(){return i.cancelar()}),c(11," \u2B05\uFE0F "),a()()(),p(12,"div",10),r(13,"app-image-modal",11),_("fecharModal",function(){return i.modalAberto=!1}),a()),t&2&&(o(),d("ngIf",i.carregando),o(),d("ngIf",!i.carregando&&i.item),o(2),d("disabled",i.processandoEditar),o(),d("ngIf",!i.processandoEditar),o(),d("ngIf",i.processandoEditar),o(),d("disabled",i.processandoExcluir),o(),d("ngIf",!i.processandoExcluir),o(),d("ngIf",i.processandoExcluir),o(4),d("imagem",i.imagemSelecionada)("aberto",i.modalAberto))},dependencies:[q,z,j,N],styles:[".item-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.raridade[_ngcontent-%COMP%]{font-weight:700;padding:2px 8px;border-radius:6px}.raridade.comum[_ngcontent-%COMP%]{color:#ccc}.raridade.incomum[_ngcontent-%COMP%]{color:#00bcd4}.raridade.raro[_ngcontent-%COMP%]{color:#673ab7}.raridade.lendario[_ngcontent-%COMP%]{color:gold}.descricao-text[_ngcontent-%COMP%]{white-space:pre-line;color:#ddd;font-size:.95rem;background:#2a2a2a;border-radius:6px;padding:8px 10px;line-height:1.4;margin-top:8px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.item-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.ingredientes-wrapper[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:8px;margin-top:15px}.ingredientes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.ingrediente-card[_ngcontent-%COMP%]{background:#212529;border:1px solid #333;border-radius:8px;padding:8px 12px;display:flex;align-items:center;justify-content:space-between}.ingrediente-card[_ngcontent-%COMP%]   .nome[_ngcontent-%COMP%]{color:#f8f9fa;font-size:.9rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ingrediente-card[_ngcontent-%COMP%]   .qtd[_ngcontent-%COMP%]{font-weight:700;color:#0dcaf0;font-size:.85rem}.thumb-mini[_ngcontent-%COMP%]{width:28px;height:28px;object-fit:cover;border-radius:6px;border:1px solid #555}.producao-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:10px;padding:12px;margin-top:10px}.producao-card[_ngcontent-%COMP%]   .titulo[_ngcontent-%COMP%]{font-weight:600;color:#0dcaf0;margin-bottom:4px;font-size:.9rem}.producao-card[_ngcontent-%COMP%]   .quantidade[_ngcontent-%COMP%]{font-weight:700;color:#28a745;font-size:1rem}"]})};export{V as ItemCatalogo};
