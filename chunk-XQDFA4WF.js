import{a as Q}from"./chunk-DK4BJW43.js";import{c as z,f as R,g as L,h as W,i as U,j as H,q,r as Z}from"./chunk-GFP7435U.js";import{a as J,b as K}from"./chunk-UJSUP3BC.js";import{g as F,j as B,q as j,s as N,w as G}from"./chunk-WLM7QTUH.js";import{$b as P,Db as h,Eb as x,Fb as y,Jb as _,Lb as b,Pa as T,Qa as s,Va as C,Vb as E,Zb as m,a as g,ab as k,cc as A,d as f,dc as M,ec as D,fb as w,ia as u,ja as p,jb as O,mc as V,wa as I,wb as d,xb as r,yb as c,zb as v}from"./chunk-QQSIVCMV.js";function Y(i,n){if(i&1){let e=y();h(0),v(1,"img",23),r(2,"button",24),_("click",function(){u(e);let a=b();return p(a.removerImagem())}),m(3,"\u2716"),c(),x()}if(i&2){let e=b();s(),d("src",e.imagemBase64Temp||e.anotacao.imagem,T)}}function $(i,n){if(i&1){let e=y();r(0,"label",25)(1,"span",26),m(2,"\u{1F4F7}"),c(),r(3,"input",27),_("change",function(a){u(e);let l=b();return p(l.onFileChange(a))}),c()()}}function ee(i,n){i&1&&(h(0),m(1,"\u{1F4BE}"),x())}function te(i,n){i&1&&(h(0),v(1,"span",28),x())}function ae(i,n){i&1&&(h(0),m(1,"\u{1F5D1}\uFE0F"),x())}function ne(i,n){i&1&&(h(0),v(1,"span",28),x())}function oe(i,n){if(i&1){let e=y();r(0,"button",29),_("click",function(){u(e);let a=b();return p(a.excluir())}),w(1,ae,2,0,"ng-container",20)(2,ne,2,0,"ng-container",20),c()}if(i&2){let e=b();d("disabled",e.excluindo),s(),d("ngIf",!e.excluindo),s(),d("ngIf",e.excluindo)}}var X=class i{constructor(n,e,t,a){this.router=n;this.route=e;this.el=t;this.zone=a}anotacao={id:"",index:0,jogador:"",autor:"",titulo:"",descricao:"",imagem:"",data:"",tags:""};imagemBase64Temp=null;salvando=!1;excluindo=!1;editMode=!1;repo=new K("Anotacoes","Anotacoes");ngOnInit(){return f(this,null,function*(){let n=this.route.snapshot.paramMap.get("id");if(n){this.editMode=!0;try{let t=(yield this.repo.getLocal()).find(a=>String(a.id)===n);if(t&&(this.anotacao=g({},t),this.scheduleAutoExpand()),this.repo.sync().then(a=>f(this,null,function*(){if(a){let o=(yield this.repo.getLocal()).find(S=>String(S.id)===n);o&&(this.anotacao=g({},o),this.scheduleAutoExpand())}})),!t){let l=(yield this.repo.forceFetch()).find(o=>String(o.id)===n);l&&(this.anotacao=g({},l),this.scheduleAutoExpand())}}catch(e){console.error("[CriarAnotacao] Erro ao carregar anota\xE7\xE3o:",e)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(e=>{let a=()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,300)+"px"};a(),e.addEventListener("input",a)})}onFileChange(n){return f(this,null,function*(){let e=n.target;if(e.files?.length){let t=e.files[0];try{this.imagemBase64Temp=yield Q.toOptimizedBase64(t,.7,1024)}catch(a){console.error("[CriarAnotacao] Erro ao otimizar imagem:",a)}}})}removerImagem(){this.anotacao.imagem="-",this.imagemBase64Temp=null}salvar(n){return f(this,null,function*(){if(!n.invalid)try{this.salvando=!0;let e=G.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");this.anotacao.autor=e.email,this.anotacao.jogador=e.email,(!this.editMode||!this.anotacao.data)&&(this.anotacao.data=new Date().toISOString());let t=g({},this.anotacao);if(this.imagemBase64Temp&&(t.imagem=this.imagemBase64Temp),this.editMode){let a=yield this.repo.update(t);this.anotacao=g({},a),window.alert("\u2705 Anota\xE7\xE3o atualizada!")}else{this.anotacao.id=J.generateULID();let a=yield this.repo.getLocal(),l=a.length>0?Math.max(...a.map(S=>S.index||0)):0;this.anotacao.index=l+1;let o=yield this.repo.create(t);this.anotacao=g({},o),window.alert("\u2705 Anota\xE7\xE3o criada!")}this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao salvar anota\xE7\xE3o:",e),window.alert("\u274C Erro ao salvar anota\xE7\xE3o.")}finally{this.salvando=!1,this.imagemBase64Temp=null}})}cancelar(){this.router.navigate(["/anotacoes"])}excluir(){return f(this,null,function*(){if(!(!this.anotacao.id||!confirm(`\u{1F5D1} Deseja realmente excluir a anota\xE7\xE3o "${this.anotacao.titulo}"?`)))try{this.excluindo=!0,yield this.repo.delete(this.anotacao.index),window.alert("\u2705 Anota\xE7\xE3o exclu\xEDda com sucesso!"),this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao excluir anota\xE7\xE3o:",e),window.alert("\u274C Erro ao excluir anota\xE7\xE3o.")}finally{this.excluindo=!1}})}static \u0275fac=function(e){return new(e||i)(C(N),C(j),C(I),C(O))};static \u0275cmp=k({type:i,selectors:[["app-criar-anotacao"]],decls:34,vars:10,consts:[["form","ngForm"],["uploadBox",""],[1,"anotacao-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"anotacao-detalhe-container","w-100"],["id","formAnotacao",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","titulo","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["rows","3","name","descricao","required","",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["type","text","name","tags","placeholder","ex: miss\xE3o, npc, combate...",1,"form-control","input-dark","text-light",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","submit","form","formAnotacao",1,"fab","fab-primary",3,"disabled"],[4,"ngIf"],["type","button","class","fab fab-danger",3,"disabled","click",4,"ngIf"],["type","button",1,"fab","fab-warning",3,"click"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm"],["type","button",1,"fab","fab-danger",3,"click","disabled"]],template:function(e,t){if(e&1){let a=y();r(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),_("ngSubmit",function(){u(a);let o=E(4);return p(t.salvar(o))}),r(5,"div",6)(6,"div",7)(7,"div",8)(8,"h4",9),m(9),c()()(),r(10,"div",10),w(11,Y,4,1,"ng-container",11)(12,$,4,0,"ng-template",null,1,V),c(),r(14,"div",12)(15,"div",13)(16,"label",14),m(17,"\u{1F4CC} T\xEDtulo *"),c(),r(18,"input",15),D("ngModelChange",function(o){return u(a),M(t.anotacao.titulo,o)||(t.anotacao.titulo=o),p(o)}),c()(),r(19,"div",13)(20,"label",14),m(21,"\u{1F4D6} Descri\xE7\xE3o *"),c(),r(22,"textarea",16),D("ngModelChange",function(o){return u(a),M(t.anotacao.descricao,o)||(t.anotacao.descricao=o),p(o)}),c()(),r(23,"div",13)(24,"label",14),m(25,"\u{1F3F7}\uFE0F Tags"),c(),r(26,"input",17),D("ngModelChange",function(o){return u(a),M(t.anotacao.tags,o)||(t.anotacao.tags=o),p(o)}),c()()()()()()(),r(27,"div",18)(28,"button",19),w(29,ee,2,0,"ng-container",20)(30,te,2,0,"ng-container",20),c(),w(31,oe,3,3,"button",21),r(32,"button",22),_("click",function(){return u(a),p(t.cancelar())}),m(33," \u2B05\uFE0F "),c()()()}if(e&2){let a=E(4),l=E(13);s(9),P(" ",t.editMode?"\u270F\uFE0F Editar Anota\xE7\xE3o":"\u{1F4DD} Nova Anota\xE7\xE3o"," "),s(2),d("ngIf",t.imagemBase64Temp||t.anotacao.imagem&&t.anotacao.imagem!=="-")("ngIfElse",l),s(7),A("ngModel",t.anotacao.titulo),s(4),A("ngModel",t.anotacao.descricao),s(4),A("ngModel",t.anotacao.tags),s(2),d("disabled",a.invalid||t.salvando),s(),d("ngIf",!t.salvando),s(),d("ngIf",t.salvando),s(),d("ngIf",t.editMode)}},dependencies:[B,F,Z,H,z,R,L,q,U,W],styles:[".anotacao-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.anotacao-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{max-height:280px;object-fit:cover;width:100%}.upload-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px dashed #666;border-radius:8px;padding:20px;cursor:pointer;color:#aaa}.upload-box[_ngcontent-%COMP%]:hover{border-color:#fff;color:#fff}.input-dark[_ngcontent-%COMP%]{background:#2a2a2a;color:#f1f1f1;border:1px solid #444}.input-dark[_ngcontent-%COMP%]:focus{background:#2a2a2a;color:#fff;border-color:#0d6efd;box-shadow:none}textarea.auto-expand[_ngcontent-%COMP%]{overflow-y:hidden;resize:none;min-height:60px;max-height:200px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.anotacao-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{X as CriarAnotacao};
