import{a as f}from"./chunk-QWKS73CC.js";import{c as F,f as W,g as q,h as z,i as B,j as J,k as L,p as U,q as G,r as $}from"./chunk-63E4UXQ5.js";import{a as H}from"./chunk-34ZGBLOX.js";import{g as k,j as A,q as T,s as N}from"./chunk-S65SB5BW.js";import{$b as R,Db as b,Eb as v,Fb as D,Jb as p,Lb as E,Pa as V,Qa as l,Va as y,Vb as w,Zb as i,_b as P,ab as S,ac as O,cc as x,d as _,dc as C,ec as M,fb as h,ia as u,ja as m,mc as I,wb as g,xb as t,yb as n,zb as j}from"./chunk-QQSIVCMV.js";function Q(d,s){if(d&1&&(b(0),j(1,"img",30),v()),d&2){let r=E(2);l(),g("src",r.jogador.imagem,V)}}function X(d,s){d&1&&(t(0,"div",31),i(1," \u{1F464} "),n())}function Y(d,s){if(d&1&&(t(0,"div",22)(1,"div",23),h(2,Q,2,1,"ng-container",24)(3,X,2,0,"ng-template",null,1,I),t(5,"div")(6,"h5",25),i(7),n(),t(8,"div",26)(9,"span",27),i(10),n(),t(11,"span",28),i(12),n(),t(13,"span",29),i(14),n()()()()()),d&2){let r=w(4),e=E();l(2),g("ngIf",e.jogador.imagem&&e.jogador.imagem!=="-")("ngIfElse",r),l(5),P(e.jogador.personagem),l(3),O(" \u2764\uFE0F ",e.JogadorUtils.getVidaAtual(e.jogador),"/",e.JogadorUtils.getVidaBase(e.jogador)," "),l(2),R("\u{1F4A5} ",e.jogador.dano_tomado||0),l(2),R("\u{1F6E1}\uFE0F ",e.jogador.classe_de_armadura||0)}}function Z(d,s){d&1&&(b(0),i(1,"\u{1F48A} Recuperar"),v())}function ee(d,s){d&1&&(b(0),j(1,"span",32),i(2," Salvando... "),v())}var K=class d{constructor(s,r){this.route=s;this.router=r}jogador=null;recuperar=0;armadura=0;descricao="";salvando=!1;JogadorUtils=f;repo=new H("Personagem");ngOnInit(){return _(this,null,function*(){let s=this.route.snapshot.paramMap.get("id");if(!s){this.router.navigate(["/batalha"]);return}try{let r=yield this.repo.getLocal();if(this.jogador=r.find(e=>String(e.id)===s)||null,this.jogador)this.repo.sync().then(e=>_(this,null,function*(){if(e){let c=(yield this.repo.getLocal()).find(o=>String(o.id)===s);c&&(this.jogador=c)}}));else{let e=yield this.repo.forceFetch();this.jogador=e.find(a=>String(a.id)===s)||null}}catch(r){console.error("[Recuperacao] Erro ao carregar jogador:",r)}})}incrementarVida(){this.recuperar++}decrementarVida(){this.recuperar=Math.max(0,this.recuperar-1)}incrementarArmadura(){this.armadura++}decrementarArmadura(){this.armadura=Math.max(0,this.armadura-1)}cancelar(){this.router.navigate(["/batalha"])}registrarRecuperacao(s){return _(this,null,function*(){if(this.jogador){this.salvando=!0;try{let r=f.getVidaBase(this.jogador),e=f.getVidaAtual(this.jogador),a=r-e;if(a<=0&&this.recuperar>0){alert(`\u26A0\uFE0F ${this.jogador.personagem} j\xE1 est\xE1 com a vida cheia!`);return}if(this.recuperar>a){alert(`\u26A0\uFE0F N\xE3o \xE9 poss\xEDvel recuperar mais do que ${a} de vida!`);return}if(this.recuperar<=0&&this.armadura<=0&&!this.descricao.trim()){alert("\u26A0\uFE0F Nenhuma altera\xE7\xE3o realizada. Ajuste a vida, armadura ou informe uma descri\xE7\xE3o.");return}let c=Math.min(this.recuperar,a);c>0&&(this.jogador.dano_tomado=Math.max(0,(this.jogador.dano_tomado||0)-c)),this.armadura>0&&(this.jogador.classe_de_armadura=(this.jogador.classe_de_armadura||0)+this.armadura),yield this.repo.update(this.jogador),alert(`\u2705 ${this.jogador.personagem} se recuperou!
\u2764\uFE0F Vida: ${f.getVidaAtual(this.jogador)}/${r}
\u{1F6E1}\uFE0F Armadura: ${this.jogador.classe_de_armadura}
`+(this.descricao?`\u{1F4DD} ${this.descricao}`:"")),this.router.navigate(["/batalha"])}catch(r){console.error("[Recuperacao] Erro ao registrar:",r),alert("\u274C Erro ao registrar recupera\xE7\xE3o.")}finally{this.salvando=!1}}})}static \u0275fac=function(r){return new(r||d)(y(T),y(N))};static \u0275cmp=S({type:d,selectors:[["app-recuperacao"]],decls:36,vars:7,consts:[["form","ngForm"],["noImg",""],[1,"recuperacao-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"recuperacao-container","w-100"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","recuperar","min","0","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],["type","number","name","armadura","min","0",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["rows","2","name","descricao","placeholder","Ex: Recupera\xE7\xE3o lenta, magia de cura...",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"preview-card","mb-3"],[1,"d-flex","align-items-center","justify-content-center"],[4,"ngIf","ngIfElse"],[1,"fw-bold","text-light","mb-1"],[1,"status-line","mt-2"],[1,"vida"],[1,"dano"],[1,"armadura"],[1,"me-3","rounded",2,"width","60px","height","60px","object-fit","cover",3,"src"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-secondary","rounded",2,"width","60px","height","60px","font-size","1.5rem"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(r,e){if(r&1){let a=D();t(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),p("ngSubmit",function(){u(a);let o=w(4);return m(e.registrarRecuperacao(o))}),t(5,"div",6)(6,"div",7),h(7,Y,15,7,"div",8),t(8,"div",9)(9,"label",10),i(10,"\u{1F48A} Recuperar Vida"),n(),t(11,"div",11)(12,"button",12),p("click",function(){return u(a),m(e.decrementarVida())}),i(13,"\u2212"),n(),t(14,"input",13),M("ngModelChange",function(o){return u(a),C(e.recuperar,o)||(e.recuperar=o),m(o)}),n(),t(15,"button",12),p("click",function(){return u(a),m(e.incrementarVida())}),i(16,"+"),n()()(),t(17,"div",9)(18,"label",10),i(19,"\u{1F6E1}\uFE0F Recuperar Armadura"),n(),t(20,"div",11)(21,"button",12),p("click",function(){return u(a),m(e.decrementarArmadura())}),i(22,"\u2212"),n(),t(23,"input",14),M("ngModelChange",function(o){return u(a),C(e.armadura,o)||(e.armadura=o),m(o)}),n(),t(24,"button",12),p("click",function(){return u(a),m(e.incrementarArmadura())}),i(25,"+"),n()()(),t(26,"div",15)(27,"label",16),i(28,"\u{1F4DD} Descri\xE7\xE3o"),n(),t(29,"textarea",17),M("ngModelChange",function(o){return u(a),C(e.descricao,o)||(e.descricao=o),m(o)}),n()(),t(30,"div",18)(31,"button",19),p("click",function(){return u(a),m(e.cancelar())}),i(32,"\u2B05 Cancelar"),n(),t(33,"button",20),h(34,Z,2,0,"ng-container",21)(35,ee,3,0,"ng-container",21),n()()()()()()()()}if(r&2){let a=w(4);l(7),g("ngIf",e.jogador),l(7),x("ngModel",e.recuperar),l(9),x("ngModel",e.armadura),l(6),x("ngModel",e.descricao),l(4),g("disabled",a.invalid||e.salvando),l(),g("ngIf",!e.salvando),l(),g("ngIf",e.salvando)}},dependencies:[A,k,$,J,F,L,W,q,G,U,B,z],styles:[".recuperacao-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.recuperacao-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px}.status-line[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#dc3545}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#0dcaf0}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.75rem 1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d}.status-line[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;font-weight:600;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#ff4d6d}.status-line[_ngcontent-%COMP%]   .dano[_ngcontent-%COMP%]{color:#ffc107}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#4da6ff}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}"]})};export{K as Recuperacao};
