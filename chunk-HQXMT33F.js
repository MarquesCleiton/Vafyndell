import{a as f}from"./chunk-G46V626D.js";import{a as F}from"./chunk-FJZA3HMC.js";import"./chunk-W7DVKRY2.js";import"./chunk-HS244SCX.js";import{Ga as l,Gb as O,Ha as n,Ia as r,Ja as p,Jb as z,Mb as V,Na as m,Oa as u,Pa as M,Ra as b,S as N,T as S,Ta as g,Tb as R,Vb as q,a as C,d as v,fb as t,gb as d,ha as T,hb as E,ia as i,ma as I,nb as j,qa as k,ua as x}from"./chunk-ILJPX4RU.js";function $(a,o){a&1&&(n(0,"div",7),p(1,"div",8),n(2,"p",9),t(3,"Carregando NPC..."),r()())}function L(a,o){if(a&1&&(m(0),p(1,"img",19),u()),a&2){let e=g(2);i(),l("alt",j(e.npc.nome))("src",e.npc.imagem,T)}}function B(a,o){if(a&1&&(n(0,"p",20),t(1),r()),a&2){let e=g(2);i(),E(" ",e.npc.descricao," ")}}function U(a,o){if(a&1&&(n(0,"div")(1,"h6",21),t(2,"\u2694\uFE0F Ataques"),r(),n(3,"p",22),t(4),r()()),a&2){let e=g(2);i(4),d(e.npc.ataques)}}function X(a,o){a&1&&(m(0),t(1,"\u270F\uFE0F Editar"),u())}function G(a,o){a&1&&(m(0),p(1,"span",23),t(2," Editando... "),u())}function H(a,o){a&1&&(m(0),t(1,"\u{1F5D1}\uFE0F Excluir"),u())}function K(a,o){a&1&&(m(0),p(1,"span",23),t(2," Excluindo... "),u())}function Q(a,o){if(a&1){let e=M();n(0,"div",10),x(1,L,2,3,"ng-container",6),n(2,"div",11)(3,"h4",12),t(4),r(),n(5,"p",13)(6,"b"),t(7,"\u{1F3F7}\uFE0F Classifica\xE7\xE3o:"),r(),t(8),r(),n(9,"p",13)(10,"b"),t(11,"\u{1F3AD} Tipo:"),r(),t(12),r(),n(13,"p",13)(14,"b"),t(15,"\u2696\uFE0F Alinhamento:"),r(),t(16),r(),p(17,"hr"),n(18,"p"),t(19,"\u2764\uFE0F Vida: "),n(20,"b"),t(21),r()(),n(22,"p"),t(23,"\u{1F6E1}\uFE0F Armadura: "),n(24,"b"),t(25),r()(),n(26,"p"),t(27,"\u2B50 XP: "),n(28,"b"),t(29),r()(),n(30,"p"),t(31,"\u{1F4AA} For\xE7a: "),n(32,"b"),t(33),r()(),n(34,"p"),t(35,"\u{1FAA8} Constitui\xE7\xE3o: "),n(36,"b"),t(37),r()(),n(38,"p"),t(39,"\u{1F938}\u200D\u2642\uFE0F Destreza: "),n(40,"b"),t(41),r()(),n(42,"p"),t(43,"\u{1F4D6} Sabedoria: "),n(44,"b"),t(45),r()(),n(46,"p"),t(47,"\u{1F9E0} Intelig\xEAncia: "),n(48,"b"),t(49),r()(),n(50,"p"),t(51,"\u26A1 Energia: "),n(52,"b"),t(53),r()(),p(54,"hr"),x(55,B,2,1,"p",14)(56,U,5,1,"div",6),n(57,"div",15)(58,"button",16),b("click",function(){N(e);let s=g();return S(s.cancelar())}),t(59,"\u2B05 Voltar"),r(),n(60,"div")(61,"button",17),b("click",function(){N(e);let s=g();return S(s.editarNpc())}),x(62,X,2,0,"ng-container",6)(63,G,3,0,"ng-container",6),r(),n(64,"button",18),b("click",function(){N(e);let s=g();return S(s.excluirNpc())}),x(65,H,2,0,"ng-container",6)(66,K,3,0,"ng-container",6),r()()()()()}if(a&2){let e=g();i(),l("ngIf",e.npc.imagem),i(3),d(e.npc.nome),i(4),E(" ",e.npc.classificacao),i(4),E(" ",e.npc.tipo),i(4),E(" ",e.npc.alinhamento||"N\xE3o definido"),i(5),d(e.npc.pontos_de_vida),i(4),d(e.npc.classe_armadura),i(4),d(e.npc.xp),i(4),d(e.npc.forca),i(4),d(e.npc.constituicao),i(4),d(e.npc.destreza),i(4),d(e.npc.sabedoria),i(4),d(e.npc.inteligencia),i(4),d(e.npc.energia),i(2),l("ngIf",e.npc.descricao),i(),l("ngIf",e.npc.ataques),i(5),l("disabled",e.processandoEditar),i(),l("ngIf",!e.processandoEditar),i(),l("ngIf",e.processandoEditar),i(),l("disabled",e.processandoExcluir),i(),l("ngIf",!e.processandoExcluir),i(),l("ngIf",e.processandoExcluir)}}function W(a,o){a&1&&(n(0,"div",24),t(1," NPC n\xE3o encontrado. "),r())}function Y(a,o){a&1&&(m(0),t(1,"\u2694\uFE0F"),u())}function Z(a,o){a&1&&(m(0),p(1,"div",25),u())}var J=class a{constructor(o,e,c){this.route=o;this.router=e;this.location=c}npc=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;processandoAdicionar=!1;ngOnInit(){return v(this,null,function*(){let o=this.route.snapshot.paramMap.get("id");if(!o){this.router.navigate(["/npcs"]);return}try{this.carregando=!0;let c=(yield f.getLocalNpcs()).find(s=>String(s.id)===String(o))||null;c&&(this.npc=C({},c)),f.syncNpcs().then(s=>v(this,null,function*(){if(s){let y=(yield f.getLocalNpcs()).find(D=>String(D.id)===String(o));y&&(this.npc=C({},y))}})),c||(c=(yield f.forceFetchNpcs()).find(_=>String(_.id)===String(o))||null,c&&(this.npc=C({},c)))}catch(e){console.error("[NpcDetalhes] Erro ao carregar NPC:",e)}finally{this.carregando=!1}})}cancelar(){this.location.back()}editarNpc(){this.npc&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-npc",this.npc.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},300))}excluirNpc(){return v(this,null,function*(){if(!(!this.npc||!confirm(`\u{1F5D1}\uFE0F Deseja realmente excluir "${this.npc.nome}"?`))){this.processandoExcluir=!0;try{yield f.deleteNpc(this.npc.id),alert("\u2705 NPC exclu\xEDdo com sucesso!"),this.router.navigate(["/npcs"])}catch(e){console.error("[NpcDetalhes] Erro ao excluir NPC:",e),alert("\u274C Erro ao excluir NPC. Veja o console.")}finally{this.processandoExcluir=!1}}})}adicionarAoCampo(){return v(this,null,function*(){if(this.npc){this.processandoAdicionar=!0;try{let o=yield F.getAllJogadores(),e=this.npc.nome.trim(),c=new RegExp(`^(\\d+) - ${e}$`,"i"),s=o.filter(h=>c.test(h.personagem)),_=1;if(s.length>0){let h=s.map(w=>{let A=w.personagem.match(/^(\d+) -/);return A?parseInt(A[1],10):0}).filter(w=>!isNaN(w));_=Math.max(...h)+1}let D=(o.length>0?Math.max(...o.map(h=>h.id||0)):0)+1,P={index:D,id:D,email:"",imagem:this.npc.imagem||"",nome_do_jogador:"NPC",personagem:`${_} - ${e}`,alinhamento:this.npc.alinhamento||"",pontos_de_vida:this.npc.pontos_de_vida,classe_de_armadura:this.npc.classe_armadura,forca:this.npc.forca,destreza:this.npc.destreza,constituicao:this.npc.constituicao,inteligencia:this.npc.inteligencia,sabedoria:this.npc.sabedoria,carisma:0,energia:this.npc.energia,nivel:1,xp:this.npc.xp,dano_tomado:0,tipo_jogador:"NPC",efeitos_temporarios:"",registo_de_jogo:"",classificacao:this.npc.classificacao,tipo:this.npc.tipo,descricao:this.npc.descricao,ataques:this.npc.ataques};yield F.createJogador(P),alert(`\u2705 ${P.personagem} adicionado ao campo de batalha!`)}catch(o){console.error("[NpcDetalhes] Erro ao adicionar NPC no campo de batalha:",o),alert("\u274C Erro ao adicionar NPC. Veja o console.")}finally{this.processandoAdicionar=!1}}})}static \u0275fac=function(e){return new(e||a)(I(R),I(q),I(O))};static \u0275cmp=k({type:a,selectors:[["app-npc-detalhes"]],decls:8,vars:6,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3"],["class","text-center py-5",4,"ngIf"],["class","card bg-secondary text-light shadow-lg border-0",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"fab","btn","btn-danger","rounded-circle","shadow-lg","d-flex","align-items-center","justify-content-center",2,"position","fixed","bottom","70px","right","20px","z-index","20","width","70px","height","70px","font-size","2rem",3,"click","disabled"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"card","bg-secondary","text-light","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold"],[1,"mb-1"],["class","descricao-text",4,"ngIf"],[1,"d-flex","justify-content-between","mt-4"],[1,"btn","btn-outline-light","btn-sm",3,"click"],[1,"btn","btn-warning","btn-sm","me-2",3,"click","disabled"],[1,"btn","btn-danger","btn-sm",3,"click","disabled"],[1,"card-img-top","object-fit-cover",2,"max-height","300px",3,"src","alt"],[1,"descricao-text"],[1,"fw-bold","mt-3"],[1,"ataques-text"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","text-muted","py-5"],["role","status",1,"spinner-border","text-light",2,"width","2rem","height","2rem"]],template:function(e,c){e&1&&(n(0,"div",0)(1,"div",1),x(2,$,4,0,"div",2)(3,Q,67,22,"div",3)(4,W,2,0,"div",4),r(),n(5,"button",5),b("click",function(){return c.adicionarAoCampo()}),x(6,Y,2,0,"ng-container",6)(7,Z,2,0,"ng-container",6),r()()),e&2&&(i(2),l("ngIf",c.carregando),i(),l("ngIf",!c.carregando&&c.npc),i(),l("ngIf",!c.carregando&&!c.npc),i(),l("disabled",c.processandoAdicionar),i(),l("ngIf",!c.processandoAdicionar),i(),l("ngIf",c.processandoAdicionar))},dependencies:[V,z],styles:[".btn[_ngcontent-%COMP%]{font-weight:500;border-radius:6px;padding:.35rem .75rem;transition:all .2s ease-in-out}.btn-sm[_ngcontent-%COMP%]{font-size:.85rem}.btn-outline-light[_ngcontent-%COMP%], .btn-outline-warning[_ngcontent-%COMP%], .btn-outline-danger[_ngcontent-%COMP%]{background:transparent}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#ffffff1a}.btn-outline-warning[_ngcontent-%COMP%]:hover{background:#ffc1071a}.btn-outline-danger[_ngcontent-%COMP%]:hover{background:#dc35451a}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem;vertical-align:text-bottom}"]})};export{J as NpcDetalhes};
