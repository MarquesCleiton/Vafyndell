import{a as _}from"./chunk-Y6SM3S4N.js";import"./chunk-VZT3XYFG.js";import{Ia as l,Ja as r,Jb as O,Ka as n,La as p,Nb as k,Pa as u,Qa as f,Qb as M,Ra as w,T as I,Ta as v,U as C,Va as s,Xb as P,Zb as R,d as b,hb as i,ib as D,ja as y,jb as d,ka as a,kb as T,oa as E,pb as F,sa as S,wa as g}from"./chunk-Y44Y2XZC.js";function j(t,o){t&1&&(r(0,"div",3),p(1,"div",4),r(2,"p",5),i(3,"Carregando item..."),n()())}function A(t,o){if(t&1&&p(0,"img",14),t&2){let e=s(2);l("alt",F(e.item.nome))("src",e.item.imagem,y)}}function z(t,o){if(t&1&&(r(0,"p")(1,"span",15),i(2,"\u2728"),n(),r(3,"b"),i(4,"Efeito:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.efeito)}}function N(t,o){if(t&1&&(r(0,"p")(1,"span",16),i(2,"\u26A0\uFE0F"),n(),r(3,"b"),i(4,"Colateral:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.colateral)}}function U(t,o){if(t&1&&(r(0,"p")(1,"span",17),i(2,"\u{1F4DD}"),n(),r(3,"b"),i(4,"Descri\xE7\xE3o:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.descricao)}}function q(t,o){t&1&&(u(0),i(1,"\u{1F5D1}\uFE0F Excluir"),f())}function B(t,o){t&1&&(u(0),p(1,"span",18),i(2," Excluindo... "),f())}function Y(t,o){t&1&&(u(0),i(1,"\u270F\uFE0F Editar"),f())}function $(t,o){t&1&&(u(0),p(1,"span",18),i(2," Editando... "),f())}function G(t,o){if(t&1){let e=w();u(0),r(1,"div",6),g(2,A,1,3,"img",7),n(),r(3,"h4",8),i(4),n(),r(5,"p")(6,"b"),i(7,"Categoria:"),n(),i(8),n(),r(9,"p")(10,"b"),i(11,"Origem:"),n(),i(12),n(),r(13,"p")(14,"b"),i(15,"Raridade:"),n(),i(16),n(),r(17,"p")(18,"b"),i(19,"Peso:"),n(),i(20),n(),p(21,"hr",9),g(22,z,6,1,"p",2)(23,N,6,1,"p",2)(24,U,6,1,"p",2),r(25,"div",10)(26,"button",11),v("click",function(){I(e);let m=s();return C(m.cancelar())}),i(27," \u2B05\uFE0F Cancelar "),n(),r(28,"button",12),v("click",function(){I(e);let m=s();return C(m.excluirItem())}),g(29,q,2,0,"ng-container",2)(30,B,3,0,"ng-container",2),n(),r(31,"button",13),v("click",function(){I(e);let m=s();return C(m.editarItem())}),g(32,Y,2,0,"ng-container",2)(33,$,3,0,"ng-container",2),n()(),f()}if(t&2){let e=s();a(2),l("ngIf",e.item.imagem),a(2),D(e.item.nome),a(4),d(" ",e.item.categoria),a(4),d(" ",e.item.origem),a(4),d(" ",e.item.raridade),a(4),T(" ",e.item.peso," ",e.item.unidade_medida),a(2),l("ngIf",e.item.efeito),a(),l("ngIf",e.item.colateral),a(),l("ngIf",e.item.descricao),a(4),l("disabled",e.processandoExcluir),a(),l("ngIf",!e.processandoExcluir),a(),l("ngIf",e.processandoExcluir),a(),l("disabled",e.processandoEditar),a(),l("ngIf",!e.processandoEditar),a(),l("ngIf",e.processandoEditar)}}var V=class t{constructor(o,e,c){this.route=o;this.router=e;this.location=c}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;ngOnInit(){return b(this,null,function*(){try{console.log("[ItemCatalogo] Iniciando carregamento..."),this.carregando=!0;let o=this.route.snapshot.paramMap.get("id");if(!o){this.router.navigate(["/catalogo"]);return}let c=(yield _.getLocalItens()).find(m=>String(m.id)===String(o))||null;if(c&&(this.item=c,this.carregando=!1),_.syncItens().then(m=>b(this,null,function*(){if(m){console.log("[ItemCatalogo] Sync trouxe altera\xE7\xF5es. Recarregando...");let x=(yield _.getLocalItens()).find(L=>String(L.id)===String(o))||null;x&&(this.item=x)}else console.log("[ItemCatalogo] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!c){console.log("[ItemCatalogo] Item n\xE3o encontrado localmente. For\xE7ando fetch online...");let h=(yield _.forceFetchItens()).find(x=>String(x.id)===String(o))||null;h?this.item=h:(console.warn("[ItemCatalogo] Item n\xE3o encontrado nem online."),this.router.navigate(["/catalogo"])),this.carregando=!1}}catch(o){console.error("[ItemCatalogo] Erro ao carregar item:",o),this.carregando=!1}})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-item-catalogo",this.item.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},300))}excluirItem(){!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja realmente excluir o item "${this.item.nome}"?`)||(this.processandoExcluir=!0,_.deleteItem(this.item.id).then(()=>{alert("\u2705 Item exclu\xEDdo com sucesso!"),this.router.navigate(["/catalogo"])}).catch(e=>{console.error("[ItemCatalogo] Erro ao excluir item:",e),alert("\u274C Erro ao excluir item. Veja o console.")}).finally(()=>{this.processandoExcluir=!1}))}static \u0275fac=function(e){return new(e||t)(E(P),E(R),E(O))};static \u0275cmp=S({type:t,selectors:[["app-item-catalogo"]],decls:3,vars:2,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"item-image","mb-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","text-capitalize"],[1,"border-secondary"],[1,"d-flex","gap-2","mt-4"],[1,"btn","btn-secondary","flex-fill",3,"click"],[1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"btn","btn-outline-warning","flex-fill",3,"click","disabled"],[3,"src","alt"],[1,"text-warning"],[1,"text-danger"],[1,"text-info"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,c){e&1&&(r(0,"div",0),g(1,j,4,0,"div",1)(2,G,34,16,"ng-container",2),n()),e&2&&(a(),l("ngIf",c.carregando),a(),l("ngIf",!c.carregando&&c.item))},dependencies:[M,k],styles:[".item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:220px;object-fit:cover;border-radius:10px}h4[_ngcontent-%COMP%]{color:#fff;margin-bottom:.5rem}p[_ngcontent-%COMP%]{color:#ddd;margin-bottom:.4rem}hr[_ngcontent-%COMP%]{opacity:.3;margin:1rem 0}button[_ngcontent-%COMP%]{font-weight:500;border-radius:8px;padding:.5rem;transition:all .2s ease-in-out}button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}"]})};export{V as ItemCatalogo};
