import{c as J,f as $,i as B,s as U}from"./chunk-IQUV2DCR.js";import{a as R}from"./chunk-SL4CV3BB.js";import{g as N,h as V,i as q,n as L,p as A}from"./chunk-ZOZAG657.js";import{Ab as c,Bb as o,Cb as s,Db as f,Hb as v,Ib as x,Jb as F,Nb as E,Pb as m,Sa as w,Ua as r,Zb as h,a as S,b as y,bc as l,cc as p,dc as C,eb as T,g as u,gc as M,hc as O,ic as P,jb as g,la as b,ma as I,oc as z,pc as j,qc as k,rc as D}from"./chunk-YAKM3PEZ.js";var Y=(i,t,e)=>({"titulo-ataque":i,"titulo-recuperacao":t,"titulo-default":e});function G(i,t){i&1&&(o(0,"div",13),f(1,"div",14),o(2,"p",15),l(3,"Carregando registros..."),s()())}function K(i,t){i&1&&(o(0,"div",16),l(1," Nenhum registro encontrado. "),s())}function Q(i,t){if(i&1&&(v(0),f(1,"img",36),x()),i&2){let e=m(2).$implicit;r(),c("src",e.ofensor==null?null:e.ofensor.imagem,w)}}function X(i,t){i&1&&(o(0,"span",37),l(1,"\u{1F464}"),s())}function Z(i,t){if(i&1&&(v(0),f(1,"img",36),x()),i&2){let e=m(2).$implicit;r(),c("src",e.vitima==null?null:e.vitima.imagem,w)}}function ee(i,t){i&1&&(o(0,"span",37),l(1,"\u{1F464}"),s())}function te(i,t){if(i&1&&(v(0),o(1,"div",32),g(2,Q,2,1,"ng-container",30)(3,X,2,0,"ng-template",null,1,D),o(5,"span",33),l(6),s()(),o(7,"span",34),l(8,"\u2716"),s(),o(9,"div",35),g(10,Z,2,1,"ng-container",30)(11,ee,2,0,"ng-template",null,2,D),o(13,"span",33),l(14),s()(),x()),i&2){let e=h(4),n=h(12),a=m().$implicit;r(2),c("ngIf",(a.ofensor==null?null:a.ofensor.imagem)&&(a.ofensor==null?null:a.ofensor.imagem)!=="-")("ngIfElse",e),r(4),p((a.ofensor==null?null:a.ofensor.personagem)||"Desconhecido"),r(4),c("ngIf",(a.vitima==null?null:a.vitima.imagem)&&(a.vitima==null?null:a.vitima.imagem)!=="-")("ngIfElse",n),r(4),p((a.vitima==null?null:a.vitima.personagem)||"Desconhecido")}}function ie(i,t){if(i&1&&(v(0),f(1,"img",36),x()),i&2){let e=m(2).$implicit;r(),c("src",e.vitima==null?null:e.vitima.imagem,w)}}function ne(i,t){i&1&&(o(0,"span",37),l(1,"\u{1F464}"),s())}function ae(i,t){if(i&1&&(o(0,"div",35),g(1,ie,2,1,"ng-container",30)(2,ne,2,0,"ng-template",null,3,D),o(4,"span",33),l(5),s()(),o(6,"span",38),l(7,"\u27A1\uFE0F"),s(),o(8,"span",39),l(9,"Recupera\xE7\xE3o"),s()),i&2){let e=h(3),n=m().$implicit;r(),c("ngIf",(n.vitima==null?null:n.vitima.imagem)&&(n.vitima==null?null:n.vitima.imagem)!=="-")("ngIfElse",e),r(4),p((n.vitima==null?null:n.vitima.personagem)||"Desconhecido")}}function oe(i,t){if(i&1&&(o(0,"div",24)(1,"div",25)(2,"div",26)(3,"h6",27),l(4),s(),o(5,"small",28),l(6),j(7,"date"),s()(),o(8,"div",29),g(9,te,15,6,"ng-container",30)(10,ae,10,3,"ng-template",null,0,D),s(),o(12,"p",31),l(13),s()()()),i&2){let e=t.$implicit,n=h(11);r(3),c("ngClass",z(9,Y,e.acao==="ataque",e.acao==="cura",e.acao!=="ataque"&&e.acao!=="cura")),r(),C(" ",e.acao==="ataque"?"\u2694\uFE0F Ataque":e.acao==="cura"?"\u{1F48A} Recupera\xE7\xE3o":e.acao," "),r(2),p(k(7,6,e.data,"HH:mm")),r(3),c("ngIf",e.acao==="ataque")("ngIfElse",n),r(4),C(" ",e.detalhes," ")}}function re(i,t){if(i&1&&(o(0,"div",15)(1,"div",22),g(2,oe,14,13,"div",23),s()()),i&2){let e=m().$implicit;r(2),c("ngForOf",e.itens)}}function se(i,t){if(i&1){let e=F();o(0,"div",18)(1,"button",19),E("click",function(){let a=b(e).$implicit,d=m(2);return I(d.toggleSecao(a))}),o(2,"span",20),l(3),s(),o(4,"span"),l(5),s()(),g(6,re,3,1,"div",21),s()}if(i&2){let e=t.$implicit,n=m(2);r(3),C("\u{1F4C5} ",n.formatarData(e.data)),r(2),p(e.expandido?"\u2212":"+"),r(),c("ngIf",e.expandido)}}function le(i,t){if(i&1&&(o(0,"div"),g(1,se,7,3,"div",17),s()),i&2){let e=m();r(),c("ngForOf",e.secoesFiltradas)}}var W=class i{secoes=[];secoesFiltradas=[];carregando=!0;filtro="";repo=new R("Registro");jogadoresRepo=new R("Personagem");ngOnInit(){return u(this,null,function*(){this.carregando=!0;try{yield this.loadLocalAndSync()}catch(t){console.error("[Registro] Erro ao carregar:",t)}finally{this.carregando=!1}})}loadLocalAndSync(){return u(this,null,function*(){let t=yield this.repo.getLocal();if(yield this.resolveJogadores(t),this.processarSecoes(t),this.repo.sync().then(e=>u(this,null,function*(){if(e){let n=yield this.repo.getLocal();yield this.resolveJogadores(n),this.processarSecoes(n)}})),t.length===0){let e=yield this.repo.forceFetch();yield this.resolveJogadores(e),this.processarSecoes(e)}})}resolveJogadores(t){return u(this,null,function*(){let e=yield this.jogadoresRepo.getLocal();t.forEach(n=>{n.ofensor=e.find(a=>a.email===n.jogador)||null,n.vitima=e.find(a=>a.email===n.alvo)||null})})}processarSecoes(t){let e=new Map(this.secoes.map(a=>[a.data,a.expandido])),n=new Map;t.forEach(a=>{let d=a.data||"",_=d.includes("T")?d.split("T")[0]:d;n.has(_)||n.set(_,[]),n.get(_).push(a)}),this.secoes=Array.from(n.entries()).sort(([a],[d])=>new Date(d).getTime()-new Date(a).getTime()).map(([a,d])=>({data:a,itens:d.sort((_,H)=>new Date(H.data||0).getTime()-new Date(_.data||0).getTime()),expandido:e.get(a)??!1})),this.secoesFiltradas=[...this.secoes]}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.secoesFiltradas=[...this.secoes];return}this.secoesFiltradas=this.secoes.map(e=>y(S({},e),{itens:e.itens.filter(n=>this.normalizarTexto(n.detalhes).includes(t)),expandido:!0})).filter(e=>e.itens.length>0)}toggleSecao(t){t.expandido=!t.expandido}formatarData(t){try{return(t.includes("T")?new Date(t):new Date(t+"T00:00:00")).toLocaleDateString("pt-BR")}catch{return t}}normalizarTexto(t){return t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():""}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-registro"]],decls:10,vars:4,consts:[["recuperacaoView",""],["noOfensorImg",""],["noVitimaImg",""],["noRecuperaImg",""],[1,"registro-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar registros...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"registro-container","w-100"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn-categoria","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"registro-card","card","shadow-sm","p-3"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"fw-bold","mb-0",3,"ngClass"],[1,"registro-hora"],[1,"d-flex","align-items-center","justify-content-center","mb-2"],[4,"ngIf","ngIfElse"],[1,"small","descricao-text","fst-italic","mb-0",2,"white-space","pre-line"],[1,"d-flex","align-items-center","me-3"],[1,"fw-bold","text-light"],[1,"fw-bold","text-danger","mx-2"],[1,"d-flex","align-items-center"],[1,"me-2","rounded","registro-img",3,"src"],[1,"me-2"],[1,"fw-bold","text-success","mx-2"],[1,"fw-bold","text-success"]],template:function(e,n){e&1&&(o(0,"div",4)(1,"div",5)(2,"input",6),P("ngModelChange",function(d){return O(n.filtro,d)||(n.filtro=d),d}),E("input",function(){return n.aplicarFiltro()}),s()(),o(3,"div",7)(4,"div",8)(5,"h4",9),l(6,"\u{1F4DC} Registro de Jogo"),s(),g(7,G,4,0,"div",10)(8,K,2,0,"div",11)(9,le,2,1,"div",12),s()()()),e&2&&(r(2),M("ngModel",n.filtro),r(5),c("ngIf",n.carregando),r(),c("ngIf",!n.carregando&&n.secoesFiltradas.length===0),r(),c("ngIf",!n.carregando))},dependencies:[A,N,V,q,U,J,$,B,L],styles:[".registro-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;border:1px solid #333;margin-bottom:.75rem;transition:transform .15s ease,box-shadow .15s ease}.registro-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.registro-img[_ngcontent-%COMP%]{width:32px;height:32px;object-fit:cover;border-radius:50%}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #444;border-radius:8px;padding:8px 12px;color:#fff;font-weight:700}.btn-categoria[_ngcontent-%COMP%]:hover{background:#333}.titulo-ataque[_ngcontent-%COMP%]{color:#f87171}.titulo-recuperacao[_ngcontent-%COMP%]{color:#4ade80}.titulo-default[_ngcontent-%COMP%]{color:#60a5fa}.registro-hora[_ngcontent-%COMP%]{color:#ccc;font-size:.85rem}.descricao-text[_ngcontent-%COMP%]{line-height:1.5;color:#eee}"]})};export{W as Registro};
