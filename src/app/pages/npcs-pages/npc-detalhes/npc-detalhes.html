<div class="npc-detalhe-wrapper d-flex flex-column min-vh-100 bg-dark text-light pb-5 mb-5">
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="npc-detalhe-container w-100">

      <!-- Loading -->
      <div *ngIf="carregando" class="text-center py-5">
        <div class="spinner-border text-light" role="status"></div>
        <p class="mt-2">Carregando NPC...</p>
      </div>

      <!-- ConteÃºdo -->
      <div *ngIf="!carregando && npc" class="card detalhe-card shadow-lg border-0">

        <!-- CabeÃ§alho -->
        <div class="card-body p-3 border-bottom d-flex align-items-center gap-2">
          <h5 class="fw-bold mb-0 text-light">{{ npc.nome }}</h5>
        </div>

        <!-- Imagem ou fallback -->
        <div class="position-relative">
          <ng-container *ngIf="npc.imagem && npc.imagem !== '-'; else noImagem">
            <img [src]="npc.imagem"
                 class="card-img-top detalhe-img"
                 alt="{{ npc.nome }}"
                 (click)="abrirImagem(npc.imagem)" />
          </ng-container>
          <ng-template #noImagem>
            <div
              class="d-flex align-items-center justify-content-center bg-secondary text-dark detalhe-img fallback-icone">
              ğŸ‘¹
            </div>
          </ng-template>
        </div>

        <div class="card-body p-3">
          <!-- Info bÃ¡sica -->
          <ul class="info-list mb-3">
            <li>ğŸ·ï¸ <span>ClassificaÃ§Ã£o:</span> {{ npc.classificacao }}</li>
            <li>ğŸ­ <span>Tipo:</span> {{ npc.tipo }}</li>
            <li>âš–ï¸ <span>Alinhamento:</span> {{ npc.alinhamento || 'NÃ£o definido' }}</li>
          </ul>

          <!-- Atributos -->
          <h6 class="fw-bold mt-3 text-light">ğŸ“Š Atributos</h6>
          <div class="atributos-grid compact mb-3">
            <div class="atributo-item">â¤ï¸ <span>Vida</span> <b>{{ npc.pontos_de_vida }}</b></div>
            <div class="atributo-item">â­ <span>XP</span> <b>{{ npc.xp }}</b></div>
            <div class="atributo-item">ğŸ›¡ï¸ <span>Armadura</span> <b>{{ npc.classe_armadura }}</b></div>
            <div class="atributo-item">ğŸ”° <span>Escudo</span> <b>{{ npc.escudo || 0 }}</b></div>
            <div class="atributo-item">ğŸ’ª <span>ForÃ§a</span> <b>{{ npc.forca }}</b></div>
            <div class="atributo-item">ğŸª¨ <span>ConstituiÃ§Ã£o</span> <b>{{ npc.constituicao }}</b></div>
            <div class="atributo-item">ğŸ¤¸â€â™‚ï¸ <span>Destreza</span> <b>{{ npc.destreza }}</b></div>
            <div class="atributo-item">ğŸ“– <span>Sabedoria</span> <b>{{ npc.sabedoria }}</b></div>
            <div class="atributo-item">ğŸ§  <span>InteligÃªncia</span> <b>{{ npc.inteligencia }}</b></div>
            <div class="atributo-item">âš¡ <span>Energia</span> <b>{{ npc.energia }}</b></div>
          </div>

          <!-- DescriÃ§Ã£o -->
          <div *ngIf="npc.descricao" class="mt-3">
            <h6 class="fw-bold text-light">ğŸ“ DescriÃ§Ã£o</h6>
            <p class="descricao-text">{{ npc.descricao }}</p>
          </div>

          <!-- Ataques -->
          <div *ngIf="npc.ataques" class="mt-3">
            <h6 class="fw-bold text-light">âš”ï¸ Ataques</h6>
            <p class="ataques-text">{{ npc.ataques }}</p>
          </div>
        </div>
      </div>

      <!-- Se nÃ£o encontrou -->
      <div *ngIf="!carregando && !npc" class="text-center text-secondary py-5">
        NPC nÃ£o encontrado.
      </div>
    </div>
  </div>

  <!-- FABs -->
  <div class="fab-stack">

    <!-- Adicionar ao campo -->
    <button class="fab fab-primary" (click)="adicionarAoCampo()" [disabled]="processandoAdicionar">
      <ng-container *ngIf="!processandoAdicionar">âš”ï¸</ng-container>
      <ng-container *ngIf="processandoAdicionar">
        <div class="spinner-border text-light" role="status" style="width: 2rem; height: 2rem;"></div>
      </ng-container>
    </button>

    <!-- Editar -->
    <button class="fab fab-warning" (click)="editarNpc()" [disabled]="processandoEditar">
      <ng-container *ngIf="!processandoEditar">âœï¸</ng-container>
      <ng-container *ngIf="processandoEditar">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>

    <!-- Excluir -->
    <button class="fab fab-danger" (click)="excluirNpc()" [disabled]="processandoExcluir">
      <ng-container *ngIf="!processandoExcluir">ğŸ—‘ï¸</ng-container>
      <ng-container *ngIf="processandoExcluir">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>

    <!-- Cancelar -->
    <button class="fab fab-primary" (click)="cancelar()">
      â¬…ï¸
    </button>
  </div>
</div>

<!-- ğŸ” Modal de Imagem -->
<app-image-modal
  [imagem]="imagemSelecionada"
  [aberto]="modalAberto"
  (fecharModal)="modalAberto = false">
</app-image-modal>
