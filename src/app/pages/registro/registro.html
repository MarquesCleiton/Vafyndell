<div class="registro-wrapper d-flex flex-column min-vh-100 bg-dark text-light">

  <!-- Barra de pesquisa -->
  <div class="p-3 bg-black border-bottom position-sticky top-0" style="z-index: 10;">
    <input type="text" class="form-control search-bar rounded-pill px-3"
           placeholder="ğŸ” Pesquisar registros..."
           [(ngModel)]="filtro" (input)="aplicarFiltro()" />
  </div>

  <!-- ConteÃºdo -->
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="registro-container w-100">

      <h4 class="fw-bold mb-3">ğŸ“œ Registro de Jogo</h4>

      <!-- Loading -->
      <div *ngIf="carregando" class="text-center py-5">
        <div class="spinner-border text-light" role="status"></div>
        <p class="mt-2">Carregando registros...</p>
      </div>

      <!-- Vazio -->
      <div *ngIf="!carregando && secoesFiltradas.length === 0"
           class="text-center text-muted py-5">
        Nenhum registro encontrado.
      </div>

      <!-- SeÃ§Ãµes por data -->
      <div *ngIf="!carregando">
        <div *ngFor="let secao of secoesFiltradas" class="mb-3">

          <!-- CabeÃ§alho da seÃ§Ã£o -->
          <button class="btn-categoria w-100 text-start d-flex justify-content-between align-items-center"
                  (click)="toggleSecao(secao)">
            <span class="fw-bold">ğŸ“… {{ formatarData(secao.data) }}</span>
            <span>{{ secao.expandido ? 'âˆ’' : '+' }}</span>
          </button>

          <!-- Itens -->
          <div *ngIf="secao.expandido" class="mt-2">
            <div class="row row-cols-1 g-2">
              <div class="col" *ngFor="let registro of secao.itens">
                <div class="registro-card card shadow-sm p-3">

                  <!-- CabeÃ§alho do registro -->
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="fw-bold mb-0"
                        [ngClass]="{
                          'titulo-ataque': registro.acao === 'ataque',
                          'titulo-recuperacao': registro.acao === 'cura',
                          'titulo-default': registro.acao !== 'ataque' && registro.acao !== 'cura'
                        }">
                      {{ registro.acao === 'ataque' ? 'âš”ï¸ Ataque' :
                         (registro.acao === 'cura' ? 'ğŸ’Š RecuperaÃ§Ã£o' : registro.acao) }}
                    </h6>
                    <small class="registro-hora">{{ registro.data | date:'HH:mm' }}</small>
                  </div>

                  <!-- PrÃ©via -->
                  <div class="d-flex align-items-center justify-content-center mb-2">

                    <!-- Se ataque -->
                    <ng-container *ngIf="registro.acao === 'ataque'; else recuperacaoView">
                      <div class="d-flex align-items-center me-3">
                        <ng-container *ngIf="registro.ofensor?.imagem && registro.ofensor?.imagem !== '-'; else noOfensorImg">
                          <img [src]="registro.ofensor?.imagem" class="me-2 rounded registro-img">
                        </ng-container>
                        <ng-template #noOfensorImg><span class="me-2">ğŸ‘¤</span></ng-template>
                        <span class="fw-bold text-light">{{ registro.ofensor?.personagem || 'Desconhecido' }}</span>
                      </div>

                      <span class="fw-bold text-danger mx-2">âœ–</span>

                      <div class="d-flex align-items-center">
                        <ng-container *ngIf="registro.vitima?.imagem && registro.vitima?.imagem !== '-'; else noVitimaImg">
                          <img [src]="registro.vitima?.imagem" class="me-2 rounded registro-img">
                        </ng-container>
                        <ng-template #noVitimaImg><span class="me-2">ğŸ‘¤</span></ng-template>
                        <span class="fw-bold text-light">{{ registro.vitima?.personagem || 'Desconhecido' }}</span>
                      </div>
                    </ng-container>

                    <!-- Se recuperaÃ§Ã£o -->
                    <ng-template #recuperacaoView>
                      <div class="d-flex align-items-center">
                        <ng-container *ngIf="registro.vitima?.imagem && registro.vitima?.imagem !== '-'; else noRecuperaImg">
                          <img [src]="registro.vitima?.imagem" class="me-2 rounded registro-img">
                        </ng-container>
                        <ng-template #noRecuperaImg><span class="me-2">ğŸ‘¤</span></ng-template>
                        <span class="fw-bold text-light">{{ registro.vitima?.personagem || 'Desconhecido' }}</span>
                      </div>
                      <span class="fw-bold text-success mx-2">â¡ï¸</span>
                      <span class="fw-bold text-success">RecuperaÃ§Ã£o</span>
                    </ng-template>

                  </div>

                  <!-- Detalhes -->
                  <p class="small descricao-text fst-italic mb-0"
                     style="white-space: pre-line;">
                    {{ registro.detalhes }}
                  </p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
