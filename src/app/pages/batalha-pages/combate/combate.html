<div class="combate-wrapper d-flex flex-column min-vh-100 bg-dark text-light">
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="combate-container w-100">
      <form #form="ngForm" (ngSubmit)="registrarCombate(form)">
        <!-- Card principal -->
        <div class="card detalhe-card shadow-lg border-0">
          <div class="card-body">

            <!-- Ofensor -->
            <div>
              <label class="form-label text-light fw-bold">‚öîÔ∏è Ofensor *</label>
              <mat-form-field appearance="fill" class="w-100 input-dark compact-select text-light">
                <mat-select [(ngModel)]="ofensorSelecionado" name="ofensorSelecionado" required>
                  <mat-option *ngFor="let j of todosJogadores" [value]="j" class="text-light bg-dark">
                    <div class="d-flex align-items-center">
                      <ng-container *ngIf="j.imagem && j.imagem !== '-'; else noOfensorIcon">
                        <img [src]="j.imagem" class="me-2 rounded"
                          style="width: 24px; height: 24px; object-fit: cover;">
                      </ng-container>
                      <ng-template #noOfensorIcon>
                        <span class="me-2">üë§</span>
                      </ng-template>
                      <span>{{ j.personagem }}</span>
                    </div>
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- V√≠tima -->
            <div>
              <label class="form-label text-light fw-bold">üõ°Ô∏è V√≠tima *</label>
              <mat-form-field appearance="fill" class="w-100 input-dark compact-select text-light">
                <mat-select [(ngModel)]="vitimaSelecionada" name="vitimaSelecionada" required>
                  <mat-option *ngFor="let j of todosJogadores" [value]="j" class="text-light bg-dark">
                    <div class="d-flex align-items-center">
                      <ng-container *ngIf="j.imagem && j.imagem !== '-'; else noVitimaIcon">
                        <img [src]="j.imagem" class="me-2 rounded"
                          style="width: 24px; height: 24px; object-fit: cover;">
                      </ng-container>
                      <ng-template #noVitimaIcon>
                        <span class="me-2">üë§</span>
                      </ng-template>
                      <span>{{ j.personagem }}</span>
                    </div>
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Preview -->
            <div *ngIf="ofensorSelecionado && vitimaSelecionada" class="preview-card mb-3">
              <div class="d-flex align-items-center justify-content-around">
                <!-- Ofensor -->
                <div class="d-flex align-items-center">
                  <ng-container
                    *ngIf="ofensorSelecionado.imagem && ofensorSelecionado.imagem !== '-'; else noOfensorPreview">
                    <img [src]="ofensorSelecionado.imagem" class="me-2 rounded preview-img">
                  </ng-container>
                  <ng-template #noOfensorPreview>
                    <span class="me-2">üë§</span>
                  </ng-template>
                  <div>
                    <h6 class="fw-bold text-light mb-1">{{ ofensorSelecionado.personagem }}</h6>
                    <small class="text-light opacity-75">Ofensor</small>
                  </div>
                </div>

                <!-- Versus -->
                <span class="fw-bold text-danger mx-3">‚úñ</span>

                <!-- V√≠tima -->
                <div class="d-flex align-items-center">
                  <ng-container
                    *ngIf="vitimaSelecionada.imagem && vitimaSelecionada.imagem !== '-'; else noVitimaPreview">
                    <img [src]="vitimaSelecionada.imagem" class="me-2 rounded preview-img">
                  </ng-container>
                  <ng-template #noVitimaPreview>
                    <span class="me-2">üë§</span>
                  </ng-template>
                  <div>
                    <h6 class="fw-bold text-light mb-1">{{ vitimaSelecionada.personagem }}</h6>
                    <small class="text-light opacity-75">V√≠tima</small>
                  </div>
                </div>
              </div>
            </div>


            <!-- Tipo de dano -->
            <div *ngIf="vitimaSelecionada" class="mb-3">
              <label class="form-label text-light fw-bold">üéØ Tipo de dano *</label>
              <mat-form-field appearance="fill" class="w-100 input-dark compact-select text-light">
                <mat-select [(ngModel)]="tipoDanoSelecionado" name="tipoDanoSelecionado" required
                  placeholder="Selecione onde aplicar o dano">

                  <mat-option value="escolha" class="text-light bg-dark">Escolha o local do dano...</mat-option>

                  <mat-option *ngIf="(vitimaSelecionada.escudo || 0) > 0" [value]="'escudo'" class="text-light bg-dark">
                    üî∞ Escudo ({{ vitimaSelecionada.escudo }})
                  </mat-option>

                  <mat-option *ngIf="(vitimaSelecionada.classe_de_armadura || 0) > 0" [value]="'armadura'" class="text-light bg-dark">
                    üõ°Ô∏è Armadura ({{ vitimaSelecionada.classe_de_armadura }})
                  </mat-option>

                  <mat-option [value]="'vida'" class="text-light bg-dark">
                    ‚ù§Ô∏è Vida ({{ JogadorUtils.getVidaAtual(vitimaSelecionada) }}/{{
                    JogadorUtils.getVidaBase(vitimaSelecionada) }})
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>


            <!-- Dano -->
            <div class="d-flex align-items-center justify-content-between mb-3">
              <label class="form-label text-light fw-bold mb-0 me-3">üí• Dano *</label>
              <div class="quantidade-box">
                <button type="button" class="btn btn-sm btn-outline-light" (click)="decrementar()">‚àí</button>
                <input type="number" class="quantidade-input" [(ngModel)]="dano" name="dano" min="0" required />
                <button type="button" class="btn btn-sm btn-outline-light" (click)="incrementar()">+</button>
              </div>
            </div>

            <!-- Efeitos -->
            <div class="mb-3">
              <label class="form-label text-light fw-bold">‚ú® Efeitos adicionais</label>
              <textarea class="form-control bg-dark text-light border-light compact-textarea" rows="2"
                [(ngModel)]="efeitos" name="efeitos" placeholder="Ex: sangramento, atordoamento..."></textarea>
            </div>

            <!-- Bot√µes -->
            <div class="d-flex justify-content-between mt-3">
              <button type="button" class="btn btn-outline-light px-3" (click)="cancelar()">‚¨Ö Cancelar</button>
              <button type="submit" class="btn btn-save px-3" [disabled]="form.invalid || salvando">
                <ng-container *ngIf="!salvando">‚öîÔ∏è Registrar</ng-container>
                <ng-container *ngIf="salvando">
                  <span class="spinner-border spinner-border-sm me-2"></span> Registrando...
                </ng-container>
              </button>
            </div>

          </div>
        </div>
      </form>
    </div>
  </div>
</div>