<div class="anotacao-detalhe-wrapper d-flex flex-column min-vh-100 bg-dark text-light pb-5 mb-5">
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="anotacao-detalhe-container w-100">

      <form #form="ngForm" (ngSubmit)="salvar(form)" id="formAnotacao">
        <div class="card detalhe-card shadow-lg border-0">
          
          <!-- Cabeçalho com voltar -->
          <div class="card-body p-3 border-bottom d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <button type="button" class="btn btn-outline-light btn-sm" (click)="cancelar()">⬅ Voltar</button>
              <h4 class="fw-bold mb-0 text-light">
                {{ editMode ? '✏️ Editar Anotação' : '📝 Nova Anotação' }}
              </h4>
            </div>
          </div>

          <!-- Upload imagem -->
          <div class="position-relative text-center mb-3">
            <ng-container *ngIf="(imagemBase64Temp || (anotacao.imagem && anotacao.imagem !== '-')); else uploadBox">
              <img [src]="imagemBase64Temp || anotacao.imagem"
                   class="w-100 rounded detalhe-img shadow-sm"
                   alt="Preview" />
              <button type="button"
                      class="btn btn-danger rounded-circle position-absolute d-flex align-items-center justify-content-center"
                      style="top: 10px; right: 10px; width: 40px; height: 40px;"
                      (click)="removerImagem()">✖</button>
            </ng-container>
            <ng-template #uploadBox>
              <label class="upload-box">
                <span class="fs-1">📷</span>
                <input type="file" class="d-none" (change)="onFileChange($event)" accept="image/*" />
              </label>
            </ng-template>
          </div>

          <!-- Campos -->
          <div class="card-body">
            <!-- Título -->
            <div class="mb-3">
              <label class="form-label text-light">📌 Título *</label>
              <input type="text"
                     class="form-control input-dark"
                     [(ngModel)]="anotacao.titulo"
                     name="titulo"
                     required />
            </div>

            <!-- Descrição -->
            <div class="mb-3">
              <label class="form-label text-light">📖 Descrição *</label>
              <textarea class="form-control input-dark auto-expand"
                        rows="3"
                        [(ngModel)]="anotacao.descricao"
                        name="descricao"
                        required></textarea>
            </div>

            <!-- Tags -->
            <div class="mb-3">
              <label class="form-label text-light">🏷️ Tags</label>
              <input type="text"
                     class="form-control input-dark text-light"
                     [(ngModel)]="anotacao.tags"
                     name="tags"
                     placeholder="ex: missão, npc, combate..." />
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- FABs -->
  <div class="fab-stack">
    <!-- Salvar -->
    <button type="submit" form="formAnotacao" class="fab fab-primary" [disabled]="form.invalid || salvando">
      <ng-container *ngIf="!salvando">💾</ng-container>
      <ng-container *ngIf="salvando">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>

    <!-- Excluir (só em modo edição) -->
    <button *ngIf="editMode" type="button" class="fab fab-danger" [disabled]="excluindo" (click)="excluir()">
      <ng-container *ngIf="!excluindo">🗑️</ng-container>
      <ng-container *ngIf="excluindo">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>

    <!-- Cancelar -->
    <button type="button" class="fab fab-warning" (click)="cancelar()">
      ⬅️
    </button>
  </div>
</div>
