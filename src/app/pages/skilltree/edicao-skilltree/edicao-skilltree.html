<div class="edicao-skilltree-wrapper d-flex flex-column min-vh-100 bg-dark text-light pb-5">
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="edicao-skilltree-container w-100">

      <h2 class="page-title">🛠️ {{ editMode ? 'Editar' : 'Cadastro' }} da SkillTree</h2>

      <!-- Prévia -->
      <div class="preview-wrapper mt-4">
        <h4 class="text-light">🔎 Prévia — {{ arvoreSelecionadaNome }}</h4>
        <div #cyPreview class="cy-preview"></div>
      </div>

      <!-- Detalhe -->
      <div *ngIf="habilidadeSelecionada" class="detalhe-card shadow-lg mt-4 p-3">
        <h4 class="detalhe-nome">
          {{ habilidadeSelecionada.habilidade }}
        </h4>
        <p class="detalhe-descricao">{{ habilidadeSelecionada.descricao }}</p>
        <div class="detalhe-extra" *ngIf="habilidadeSelecionada.requisitos">
          <span>📌 Requisito:</span> {{ habilidadeSelecionada.requisitos }}
        </div>
      </div>

      <form #form="ngForm" (ngSubmit)="salvar(form)" id="formSkillTree">
        <!-- Caminho -->
        <div class="mb-3">
          <label class="form-label">🌐 Caminho</label>
          <select class="form-select input-dark" [(ngModel)]="caminhoSelecionado" name="caminhoSelecionado"
            (ngModelChange)="onCaminhoChange($event)" required>
            <option [ngValue]="null" disabled>Selecione...</option>
            <option *ngFor="let c of caminhos" [ngValue]="c.id">{{ c.caminho }}</option>
          </select>
        </div>

        <!-- Árvore -->
        <div class="mb-3" *ngIf="caminhoSelecionado">
          <label class="form-label">🌳 Árvore</label>
          <select class="form-select input-dark" [(ngModel)]="arvoreSelecionada" name="arvoreSelecionada"
            (ngModelChange)="onArvoreChange($event)" required>
            <option [ngValue]="null" disabled>Selecione...</option>
            <option *ngFor="let a of arvoresDoCaminho" [ngValue]="a.id">
              {{ a.arvore }}
            </option>
            <option [ngValue]="'nova'">➕ Nova Árvore</option>
          </select>

          <div *ngIf="arvoreSelecionada === 'nova'" class="mt-2">
            <input type="text" class="form-control input-dark" [(ngModel)]="novaArvoreNome" name="novaArvoreNome"
              placeholder="Digite o nome da nova árvore" (ngModelChange)="atualizarPreview()" />
          </div>
        </div>

        <!-- Dependência -->
        <div class="mb-3" *ngIf="arvoreSelecionada">
          <label class="form-label">🔗 Dependência</label>
          <select class="form-select input-dark" [(ngModel)]="dependenciaSelecionada" name="dependenciaSelecionada"
            (ngModelChange)="atualizarPreview()">
            <option [ngValue]="null">Nenhuma</option>
            <option *ngFor="let h of habilidadesDaArvore" [ngValue]="h.id">
              {{ h.habilidade }}
            </option>
          </select>
        </div>

        <!-- Nome -->
        <div class="mb-3" *ngIf="arvoreSelecionada">
          <label class="form-label">🏷️ Nome</label>
          <input type="text" class="form-control input-dark" [(ngModel)]="habilidadeEdit.habilidade" name="habilidade"
            (ngModelChange)="atualizarPreview()" required />
        </div>

        <!-- Requisitos -->
        <div class="mb-3" *ngIf="arvoreSelecionada">
          <label class="form-label">📌 Requisitos</label>
          <textarea class="form-control input-dark auto-expand" rows="3" [(ngModel)]="habilidadeEdit.requisitos"
            name="requisitos" (ngModelChange)="atualizarPreview()"></textarea>
        </div>

        <!-- Descrição -->
        <div class="mb-3" *ngIf="arvoreSelecionada">
          <label class="form-label">📝 Descrição</label>
          <textarea class="form-control input-dark auto-expand" rows="3" [(ngModel)]="habilidadeEdit.descricao"
            name="descricao" (ngModelChange)="atualizarPreview()"></textarea>
        </div>

      </form>
    </div>
  </div>

  <!-- FABs -->
  <div class="fab-stack">
    <button type="submit" form="formSkillTree" class="fab fab-success" [disabled]="form?.invalid || salvando">
      <ng-container *ngIf="!salvando">💾</ng-container>
      <ng-container *ngIf="salvando">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>
    <button *ngIf="editMode" type="button" class="fab fab-danger" (click)="excluir()">🗑️</button>
    <button type="button" class="fab fab-warning" (click)="router.navigate(['/skilltree'])">⬅️</button>
  </div>
</div>