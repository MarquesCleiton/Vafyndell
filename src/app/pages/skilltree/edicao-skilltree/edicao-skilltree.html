<div class="edicao-skilltree-wrapper d-flex flex-column min-vh-100 bg-dark text-light pb-5">
  <div class="flex-grow-1 p-3 d-flex justify-content-center">
    <div class="edicao-skilltree-container w-100">

      <h2 class="page-title">ğŸ› ï¸ EdiÃ§Ã£o da SkillTree</h2>

      <!-- PrÃ©via em cima -->
      <div class="preview-wrapper mt-4">
        <h4 class="text-light">
          ğŸ” PrÃ©via â€” {{ arvoreSelecionadaNome }}
        </h4>
        <div #cyPreview class="cy-preview"></div>
      </div>

      <!-- Detalhe da Habilidade -->
      <div *ngIf="habilidadeSelecionada" class="detalhe-card shadow-lg mt-4 p-3">
        <h4 class="detalhe-nome">
          {{ habilidadeSelecionada.habilidade }}
          <span class="nivel">Lv {{ habilidadeSelecionada.nivel }}</span>
        </h4>
        <p class="detalhe-descricao">{{ habilidadeSelecionada.descricao }}</p>
        <div class="detalhe-extra" *ngIf="habilidadeSelecionada.requisitos">
          <span>ğŸ“Œ Requisito:</span> {{ habilidadeSelecionada.requisitos }}
        </div>
      </div>

      <form #form="ngForm" (ngSubmit)="salvar(form)" id="formSkillTree">
        <!-- SeleÃ§Ã£o do Caminho -->
        <div class="mb-3">
          <label class="form-label">ğŸŒ Caminho</label>
          <select class="form-select input-dark" [(ngModel)]="caminhoSelecionado" name="caminhoSelecionado"
            (ngModelChange)="onCaminhoChange($event)" required>
            <option [ngValue]="null" disabled>Selecione...</option>
            <option *ngFor="let c of caminhos" [ngValue]="c.id">{{ c.caminho }}</option>
          </select>
        </div>

        <!-- SeleÃ§Ã£o da Ãrvore -->
        <div class="mb-3" *ngIf="caminhoSelecionado">
          <label class="form-label">ğŸŒ³ Ãrvore</label>
          <select class="form-select input-dark" [(ngModel)]="arvoreSelecionada" name="arvoreSelecionada"
            (ngModelChange)="onArvoreChange($event)" required>
            <option [ngValue]="null" disabled>Selecione...</option>
            <option *ngFor="let a of arvoresDoCaminho" [ngValue]="a.id">{{ a.arvore }}</option>
            <option [ngValue]="'nova'">â• Nova Ãrvore</option>
          </select>
          <div *ngIf="arvoreSelecionada === 'nova'" class="mt-2">
            <input type="text" class="form-control input-dark" [(ngModel)]="novaArvoreNome" name="novaArvoreNome"
              placeholder="Digite o nome da nova Ã¡rvore" (input)="atualizarPreview()" />
          </div>
        </div>

        <!-- SeleÃ§Ã£o do Ramo -->
        <div class="mb-3" *ngIf="arvoreSelecionada">
          <label class="form-label">ğŸŒ¿ Ramo</label>
          <select class="form-select input-dark" [(ngModel)]="ramoSelecionado" name="ramoSelecionado"
            (ngModelChange)="onRamoChange($event)" required>
            <option [ngValue]="null" disabled>Selecione...</option>
            <option *ngFor="let r of ramosDaArvore" [ngValue]="r.id">{{ r.ramo }}</option>
            <option [ngValue]="'novo'">â• Novo Ramo</option>
          </select>
          <div *ngIf="ramoSelecionado === 'novo'" class="mt-2">
            <input type="text" class="form-control input-dark" [(ngModel)]="novoRamoNome" name="novoRamoNome"
              placeholder="Digite o nome do novo ramo" (input)="onNovoRamoInput()" />
          </div>
        </div>

        <!-- DependÃªncia -->
        <div class="mb-3" *ngIf="ramoSelecionado && ramoSelecionado !== 'novo'">
          <label class="form-label">ğŸ”— DependÃªncia</label>
          <select class="form-select input-dark" [(ngModel)]="dependenciaSelecionada" name="dependenciaSelecionada"
            (ngModelChange)="atualizarPreview()">
            <option [ngValue]="null">Nenhuma</option>
            <option *ngFor="let h of habilidadesDoRamo" [ngValue]="h.id">
              {{ h.habilidade }} (Lv {{ h.nivel }})
            </option>
          </select>
        </div>

        <!-- Nome -->
        <div class="mb-3" *ngIf="ramoSelecionado">
          <label class="form-label">ğŸ·ï¸ Nome</label>
          <input type="text" class="form-control input-dark" [(ngModel)]="habilidadeEdit.habilidade" name="habilidade"
            (input)="atualizarPreview()" required />
        </div>

        <!-- NÃ­vel -->
        <div class="mb-3" *ngIf="ramoSelecionado">
          <label class="form-label">ğŸ“ˆ NÃ­vel</label>
          <input type="number" class="form-control input-dark" [(ngModel)]="habilidadeEdit.nivel" name="nivel"
            (input)="atualizarPreview()" min="1" required />
        </div>

        <!-- Requisitos -->
        <div class="mb-3" *ngIf="ramoSelecionado">
          <label class="form-label">ğŸ“Œ Requisitos</label>
          <textarea class="form-control input-dark" [(ngModel)]="habilidadeEdit.requisitos" name="requisitos"
            (input)="atualizarPreview()"></textarea>
        </div>

        <!-- DescriÃ§Ã£o -->
        <div class="mb-3" *ngIf="ramoSelecionado">
          <label class="form-label">ğŸ“ DescriÃ§Ã£o</label>
          <textarea class="form-control input-dark" [(ngModel)]="habilidadeEdit.descricao" name="descricao"
            (input)="atualizarPreview()"></textarea>
        </div>
      </form>
    </div>
  </div>

  <!-- FABs -->
  <div class="fab-stack">
    <button type="submit" form="formSkillTree" class="fab fab-success" [disabled]="form?.invalid || salvando">
      <ng-container *ngIf="!salvando">ğŸ’¾</ng-container>
      <ng-container *ngIf="salvando">
        <span class="spinner-border spinner-border-sm"></span>
      </ng-container>
    </button>
  </div>
</div>
