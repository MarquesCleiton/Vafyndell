import{a as _}from"./chunk-W4ZRYS5G.js";import{a as u}from"./chunk-76QEAP6D.js";import{c as $,f as B,i as q,r as U}from"./chunk-CWQYRPQ6.js";import"./chunk-2CFPKSUU.js";import{f as j,g as z,i as A,j as R,s as V,v as W}from"./chunk-YWTK67XE.js";import{$b as h,Fb as S,Jb as v,Lb as g,Pa as M,Qa as r,Va as O,Zb as d,_b as f,a as I,ab as F,b,bc as E,cc as J,d as D,dc as k,ec as P,fb as p,fc as T,ia as C,ja as y,jc as L,kc as N,wb as s,xb as o,yb as l,zb as w}from"./chunk-DIJLFEPN.js";function G(i,t){if(i&1&&(o(0,"div",10)(1,"p",11),d(2,"\u2696\uFE0F Peso total: "),o(3,"b"),d(4),L(5,"number"),l()()()),i&2){let e=g();r(4),h("",N(5,1,e.resumo.pesoTotal,"1.0-2")," kg")}}function H(i,t){i&1&&(o(0,"div",12),w(1,"div",13),o(2,"p",14),d(3,"Carregando invent\xE1rio..."),l()())}function K(i,t){i&1&&(o(0,"div",15),d(1," Nenhum item encontrado. "),l())}function Q(i,t){if(i&1&&w(0,"img",30),i&2){let e=g().$implicit;s("alt",T(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,M)}}function X(i,t){i&1&&(o(0,"span"),d(1,"\u{1F4E6}"),l())}function Z(i,t){if(i&1&&(o(0,"p",31),d(1),l()),i&2){let e=g().$implicit;r(),h(" \u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito," ")}}function ee(i,t){if(i&1&&(o(0,"p",32),d(1),l()),i&2){let e=g().$implicit;r(),h(" \u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral," ")}}function te(i,t){if(i&1){let e=S();o(0,"div",22)(1,"div",23),v("click",function(){let c=C(e).$implicit,a=g(4);return y(a.abrirItem(c.id))}),o(2,"div",24)(3,"div",25),p(4,Q,1,3,"img",26)(5,X,2,0,"span",8),l(),o(6,"div")(7,"h6",27),d(8),l(),o(9,"small"),d(10),l()()(),p(11,Z,2,1,"p",28)(12,ee,2,1,"p",29),l()()}if(i&2){let e=t.$implicit;r(4),s("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.imagem),r(),s("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)),r(3),f((e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"),r(2),E(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",(e.itemDetalhe==null?null:e.itemDetalhe.peso)||0," kg "),r(),s("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),r(),s("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function ie(i,t){if(i&1&&(o(0,"div",14)(1,"div",20),p(2,te,13,8,"div",21),l()()),i&2){let e=g().$implicit;r(2),s("ngForOf",e.itens)}}function ne(i,t){if(i&1){let e=S();o(0,"div",17)(1,"button",18),v("click",function(){let c=C(e).$implicit,a=g(2);return y(a.toggleCategoria(c))}),o(2,"span"),d(3),l(),o(4,"span"),d(5),l()(),p(6,ie,3,1,"div",19),l()}if(i&2){let e=t.$implicit;r(3),f(e.nome),r(2),f(e.expandido?"\u2212":"+"),r(),s("ngIf",e.expandido)}}function ae(i,t){if(i&1&&(o(0,"div"),p(1,ne,7,3,"div",16),l()),i&2){let e=g();r(),s("ngForOf",e.categoriasFiltradas)}}var Y=class i{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,n)=>e+(n.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,n)=>e+(n.quantidade||0)*(n.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}ngOnInit(){return D(this,null,function*(){try{console.log("[InventarioJogador] Iniciando carregamento..."),this.carregando=!0;let t=W.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield u.getLocalItens(),n=yield _.getLocalInventarioByJogador(t.email);if(e?.length&&n?.length&&(console.log("[InventarioJogador] Dados locais encontrados."),this.processarInventario(n,e),this.carregando=!1),D(this,null,function*(){let c=yield u.syncItens(),a=yield _.syncInventario();if(c||a){console.log("[InventarioJogador] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let m=yield u.getLocalItens(),x=yield _.getLocalInventarioByJogador(t.email);this.processarInventario(x,m)}else console.log("[InventarioJogador] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")}),!n?.length){console.log("[InventarioJogador] Nenhum invent\xE1rio local. For\xE7ando fetch online..."),yield u.forceFetchItens();let c=yield u.getLocalItens(),a=yield _.forceFetchInventario();this.processarInventario(a,c),this.carregando=!1}}catch(t){console.error("[InventarioJogador] Erro ao carregar invent\xE1rio:",t),this.carregando=!1}})}processarInventario(t,e){let n=t.map(a=>{let m=e.find(x=>x.id===a.item_catalogo);return b(I({},a),{itemDetalhe:m})}),c=new Map;n.forEach(a=>{let m=a.itemDetalhe?.categoria||"Outros";c.has(m)||c.set(m,[]),c.get(m).push(a)}),this.categorias=Array.from(c.entries()).sort((a,m)=>String(a[0]||"").localeCompare(String(m[0]||""))).map(([a,m])=>({nome:String(a||"Outros"),itens:m,expandido:!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}toggleCategoria(t){t.expandido=!t.expandido}aplicarFiltro(){let t=this.filtro.toLowerCase();if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>b(I({},e),{itens:e.itens.filter(n=>String(n.itemDetalhe?.nome||"").toLowerCase().includes(t)||String(n.itemDetalhe?.raridade||"").toLowerCase().includes(t)||String(n.itemDetalhe?.categoria||"").toLowerCase().includes(t))})).filter(e=>e.itens.length>0)}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}static \u0275fac=function(e){return new(e||i)(O(V))};static \u0275cmp=F({type:i,selectors:[["app-inventario-jogador"]],decls:12,vars:5,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0","z-10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","search-bar",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3"],[1,"fw-bold","mb-3"],["class","card resumo-card mb-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[4,"ngIf"],[1,"fab","btn","btn-light","shadow-lg",3,"click"],[1,"card","resumo-card","mb-4"],[1,"mb-1","text-light"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-secondary","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","h-100","p-3",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","mb-1"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),P("ngModelChange",function(a){return k(n.filtro,a)||(n.filtro=a),a}),v("input",function(){return n.aplicarFiltro()}),l()(),o(3,"div",3)(4,"h4",4),d(5,"\u{1F392} Invent\xE1rio"),l(),p(6,G,6,4,"div",5)(7,H,4,0,"div",6)(8,K,2,0,"div",7)(9,ae,2,1,"div",8),l(),o(10,"button",9),v("click",function(){return n.novoItemInventario()}),d(11," \uFF0B "),l()()),e&2&&(r(2),J("ngModel",n.filtro),r(4),s("ngIf",!n.carregando&&n.categoriasFiltradas.length>0),r(),s("ngIf",n.carregando),r(),s("ngIf",!n.carregando&&n.categoriasFiltradas.length===0),r(),s("ngIf",!n.carregando))},dependencies:[R,j,z,U,$,B,q,A],styles:[".search-bar[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:12px;padding:.6rem 1rem}.search-bar[_ngcontent-%COMP%]::placeholder{color:#aaa}.resumo-card[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #444;border-radius:12px;padding:1rem}.inventario-card[_ngcontent-%COMP%]{border-radius:10px;background:#1e1e1e;border:1px solid #333;color:#f8f9fa;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease}.inventario-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0006}.item-thumb[_ngcontent-%COMP%]{width:45px;height:45px;background:#2a2a2a;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-thumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#777;font-size:1.2rem}.inventario-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#aaa}.text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.btn-categoria[_ngcontent-%COMP%]{border:1px solid #444;background:#1e1e1e;color:#f8f9fa;border-radius:10px;padding:.6rem 1rem;font-weight:600;transition:background .2s ease}.btn-categoria[_ngcontent-%COMP%]:hover{background:#2a2a2a}.fab[_ngcontent-%COMP%]{position:fixed;bottom:80px;right:20px;width:56px;height:56px;border-radius:50%;font-size:24px;display:flex;align-items:center;justify-content:center;background:#f8f9fa;color:#1e1e1e;transition:background .2s ease}.fab[_ngcontent-%COMP%]:hover{background:#ddd}"]})};export{Y as InventarioJogador};
