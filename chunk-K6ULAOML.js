import{a as et,b as it,c as ot,d as nt,e as at,f as rt,g as lt,h as st,i as dt}from"./chunk-EHPGXDFJ.js";import{A as B,N as W,z as L}from"./chunk-TRWM2F5J.js";import{a as f}from"./chunk-6NKPA5WO.js";import{a as b}from"./chunk-X6WXRV32.js";import{b as J,e as G,f as Q,g as H,h as K,i as X,j as Y,o as Z,p as $,q as tt}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as E}from"./chunk-HS244SCX.js";import{Ga as m,Ha as r,Ia as s,Ib as P,Ja as I,Jb as j,Mb as R,Na as M,Oa as S,Pa as V,Ra as g,S as u,T as p,Ta as _,Tb as U,Vb as z,a as T,b as O,bb as C,d as h,fb as c,gb as A,ha as x,ia as d,ib as D,kb as q,lb as k,ma as w,mb as F,qa as N,ua as v}from"./chunk-ILJPX4RU.js";function ct(n,i){if(n&1){let t=V();r(0,"mat-option",19),g("click",function(){u(t);let o=_();return p(o.novoItem())}),r(1,"mat-icon",20),c(2,"add_circle"),s(),c(3," Novo "),s()}}function ut(n,i){if(n&1&&I(0,"img",24),n&2){let t=_().$implicit;m("src",t.imagem,x)}}function pt(n,i){if(n&1&&(r(0,"mat-option",21)(1,"div",22),v(2,ut,1,1,"img",23),r(3,"span"),c(4),s()()()),n&2){let t=i.$implicit;m("value",t),d(2),m("ngIf",t.imagem),d(2),A(t.nome)}}function gt(n,i){if(n&1&&I(0,"img",29),n&2){let t=_(2);m("src",t.selecionado.imagem,x)}}function ft(n,i){if(n&1&&(r(0,"div",25)(1,"div",22),v(2,gt,1,1,"img",26),r(3,"div")(4,"h6",27),c(5),s(),r(6,"small",28),c(7),s()()()()),n&2){let t=_();d(2),m("ngIf",t.selecionado.imagem),d(3),A(t.selecionado.nome),d(2),D(" ",t.selecionado.categoria," | ",t.selecionado.raridade," ")}}function vt(n,i){n&1&&(M(0),c(1,"Salvar"),S())}function ht(n,i){n&1&&(M(0),I(1,"span",30),c(2," Salvando... "),S())}var mt=class n{constructor(i,t){this.router=i;this.route=t}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;salvando=!1;editando=!1;inventarioAtual=null;returnUrl=null;ngOnInit(){return h(this,null,function*(){try{console.log("[CadastroInventario] Iniciando carregamento..."),this.catalogoItens=yield b.getLocalItens(),this.catalogoFiltrado=this.catalogoItens,b.syncItens().then(t=>h(this,null,function*(){t&&(console.log("[CadastroInventario] Cat\xE1logo atualizado. Recarregando..."),this.catalogoItens=yield b.getLocalItens(),this.catalogoFiltrado=this.catalogoItens)})),this.returnUrl=this.route.snapshot.queryParamMap.get("returnUrl");let i=Number(this.route.snapshot.paramMap.get("id"));if(i){this.editando=!0;let t=E.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield f.getLocalInventarioByJogador(t.email);if(this.inventarioAtual=e.find(o=>o.id===i)||null,this.inventarioAtual&&(this.selecionado=this.catalogoItens.find(o=>o.id===this.inventarioAtual.item_catalogo)||null,this.quantidade=this.inventarioAtual.quantidade,this.filtro=this.selecionado?.nome||""),f.syncInventario().then(o=>h(this,null,function*(){if(o){console.log("[CadastroInventario] Invent\xE1rio atualizado. Recarregando item...");let a=(yield f.getLocalInventarioByJogador(t.email)).find(y=>y.id===i);a&&(this.inventarioAtual=a,this.selecionado=this.catalogoItens.find(y=>y.id===a.item_catalogo)||null,this.quantidade=a.quantidade,this.filtro=this.selecionado?.nome||"")}})),!this.inventarioAtual){let o=yield f.forceFetchInventario();this.inventarioAtual=o.find(l=>l.id===i)||null,this.inventarioAtual&&(this.selecionado=this.catalogoItens.find(l=>l.id===this.inventarioAtual.item_catalogo)||null,this.quantidade=this.inventarioAtual.quantidade,this.filtro=this.selecionado?.nome||"")}}}catch(i){console.error("[CadastroInventario] Erro ao carregar:",i)}})}filtrarItens(){let i=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),t=i(this.filtro||"");if(!t){this.catalogoFiltrado=[...this.catalogoItens];return}this.catalogoFiltrado=this.catalogoItens.filter(e=>i(e.nome).includes(t))}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(1,this.quantidade-1)}cancelar(){this.router.navigate([this.returnUrl||"/inventario-jogador"])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"],{queryParams:{returnUrl:"/cadastro-inventario"}})}salvar(i){return h(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let t=E.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.editando&&this.inventarioAtual){let e=O(T({},this.inventarioAtual),{jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade});yield f.updateInventario(e)}else{let e=yield f.getLocalInventarioByJogador(t.email),o=e.length>0?Math.max(...e.map(a=>a.index||0)):0,l={id:o+1,index:o+1,jogador:t.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade};yield f.createInventario(l)}alert("\u2705 Item salvo no invent\xE1rio!"),this.router.navigate([this.returnUrl||"/inventario-jogador"])}catch(t){console.error("[CadastroInventario] Erro ao salvar:",t),alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(t){return new(t||n)(w(z),w(U))};static \u0275cmp=N({type:n,selectors:[["app-cadastro-inventario"]],decls:28,vars:10,consts:[["form","ngForm"],["auto","matAutocomplete"],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],[3,"ngSubmit"],[1,"mb-3"],[1,"form-label","text-light"],["appearance","outline",1,"w-100"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",1,"text-light",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","card bg-dark border-secondary shadow-sm mb-3 p-2",4,"ngIf"],[1,"input-group"],["type","number","name","quantidade","min","1","required","",1,"form-control","bg-dark","text-light","border-light","text-center","fw-bold",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-light",3,"click"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-secondary","px-4",3,"click"],["type","submit",1,"btn","btn-success","px-4",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],["class","me-2 rounded","style","width: 28px; height: 28px; object-fit: cover;",3,"src",4,"ngIf"],[1,"me-2","rounded",2,"width","28px","height","28px","object-fit","cover",3,"src"],[1,"card","bg-dark","border-secondary","shadow-sm","mb-3","p-2"],["class","me-3 rounded","style","width: 50px; height: 50px; object-fit: cover;",3,"src",4,"ngIf"],[1,"fw-bold","text-light","mb-1"],[1,"text-muted"],[1,"me-3","rounded",2,"width","50px","height","50px","object-fit","cover",3,"src"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,e){if(t&1){let o=V();r(0,"div",2)(1,"form",3,0),g("ngSubmit",function(){u(o);let a=C(2);return p(e.salvar(a))}),r(3,"div",4)(4,"label",5),c(5,"Item *"),s(),r(6,"mat-form-field",6)(7,"input",7),F("ngModelChange",function(a){return u(o),k(e.filtro,a)||(e.filtro=a),p(a)}),g("input",function(){return u(o),p(e.filtrarItens())}),s(),r(8,"mat-autocomplete",8,1),g("optionSelected",function(a){return u(o),p(e.selecionarItem(a.option.value))}),v(10,ct,4,0,"mat-option",9)(11,pt,5,3,"mat-option",10),s()()(),v(12,ft,8,4,"div",11),r(13,"div",4)(14,"label",5),c(15,"Quantidade *"),s(),r(16,"div",12)(17,"input",13),F("ngModelChange",function(a){return u(o),k(e.quantidade,a)||(e.quantidade=a),p(a)}),s(),r(18,"button",14),g("click",function(){return u(o),p(e.decrementar())}),c(19,"\u2212"),s(),r(20,"button",14),g("click",function(){return u(o),p(e.incrementar())}),c(21,"+"),s()()(),r(22,"div",15)(23,"button",16),g("click",function(){return u(o),p(e.cancelar())}),c(24,"Cancelar"),s(),r(25,"button",17),v(26,vt,2,0,"ng-container",18)(27,ht,3,0,"ng-container",18),s()()()()}if(t&2){let o=C(2),l=C(9);d(7),q("ngModel",e.filtro),m("matAutocomplete",l)("readonly",e.editando),d(3),m("ngIf",!e.editando),d(),m("ngForOf",e.catalogoFiltrado),d(),m("ngIf",e.selecionado),d(5),q("ngModel",e.quantidade),d(8),m("disabled",o.invalid||e.salvando),d(),m("ngIf",!e.salvando),d(),m("ngIf",e.salvando)}},dependencies:[R,P,j,tt,X,J,Y,G,Q,$,Z,K,H,it,et,lt,at,ot,rt,dt,st,nt,B,L,W],styles:[".mat-autocomplete-panel[_ngcontent-%COMP%], .mat-select-panel[_ngcontent-%COMP%], .mat-mdc-autocomplete-panel[_ngcontent-%COMP%], .mat-mdc-select-panel[_ngcontent-%COMP%]{background-color:#1e1e1e!important;color:#f0f0f0!important;border:1px solid #333!important;border-radius:6px!important;box-shadow:0 4px 10px #0009!important}.mat-option[_ngcontent-%COMP%], .mdc-list-item__primary-text[_ngcontent-%COMP%]{color:#f0f0f0!important}.mat-option[_ngcontent-%COMP%]:hover, .mat-option.mdc-list-item--selected[_ngcontent-%COMP%]{background-color:#2a2a2a!important}"]})};export{mt as CadastroInventario};
