import{a as h}from"./chunk-DU24F7PH.js";import{a as b,b as S,c as l,e as I,f as d,g as P,h as j,i as x,j as y,l as c,m as a,n as w,o as A,q as f,r as s,s as v,t as g,y as B}from"./chunk-DNBBXYBI.js";var u=class{static DB_NAME="VafyndellDB";static DB_VERSION=1;static db=null;static storeConfigs=[];static init(){return l(this,arguments,function*(t=[]){if(!this.db)return this.storeConfigs=t,new Promise((e,i)=>{let r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=()=>i(r.error),r.onsuccess=()=>{this.db=r.result,e()},r.onupgradeneeded=n=>{let o=n.target.result;this.storeConfigs.forEach(p=>{o.objectStoreNames.contains(p.name)||o.createObjectStore(p.name,{keyPath:p.keyPath,autoIncrement:p.autoIncrement||!1})})}})})}static storeExists(t){return this.db?.objectStoreNames.contains(t)??!1}static ensureStore(t,e="id"){return l(this,null,function*(){this.storeExists(t)||(this.db?.close(),this.db=null,this.DB_VERSION++,this.storeConfigs.push({name:t,keyPath:e}),yield this.init(this.storeConfigs))})}static put(t,e,i="id"){return l(this,null,function*(){return yield this.ensureStore(t,i),new Promise((r,n)=>{let o=this.db.transaction(t,"readwrite");o.objectStore(t).put(e),o.oncomplete=()=>r(),o.onerror=()=>n(o.error)})})}static bulkPut(t,e,i="id"){return l(this,null,function*(){return yield this.ensureStore(t,i),new Promise((r,n)=>{let o=this.db.transaction(t,"readwrite"),p=o.objectStore(t);e.forEach(_=>p.put(_)),o.oncomplete=()=>r(),o.onerror=()=>n(o.error)})})}static get(t,e){return l(this,null,function*(){return this.storeExists(t)?new Promise((i,r)=>{let o=this.db.transaction(t,"readonly").objectStore(t).get(e);o.onsuccess=()=>i(o.result||null),o.onerror=()=>r(o.error)}):null})}static getAll(t){return l(this,null,function*(){return this.storeExists(t)?new Promise((e,i)=>{let n=this.db.transaction(t,"readonly").objectStore(t).getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>i(n.error)}):[]})}static delete(t,e,i="id"){return l(this,null,function*(){if(this.storeExists(t))return yield this.ensureStore(t,i),new Promise((r,n)=>{let o=this.db.transaction(t,"readwrite");o.objectStore(t).delete(e),o.oncomplete=()=>r(),o.onerror=()=>n(o.error)})})}static clear(t,e="id"){return l(this,null,function*(){if(this.storeExists(t))return yield this.ensureStore(t,e),new Promise((i,r)=>{let n=this.db.transaction(t,"readwrite");n.objectStore(t).clear(),n.oncomplete=()=>i(),n.onerror=()=>r(n.error)})})}};var E=class{static ENDPOINT=window.location.hostname==="localhost"?"/api":"https://script.google.com/macros/s/AKfycbyTLkU5F0bsSWnSJSUD95p96sGgoyyFYxaY_FwIIpJD3_cUMg6vjzTn_VLw2MbRJofL/exec";static SHEET_ID="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g";static call(t,e){return l(this,null,function*(){let i=h.getIdToken();if(!i)throw new Error("Usu\xE1rio n\xE3o autenticado.");let r={idToken:i,action:t,payload:S(b({},e),{sheetId:this.SHEET_ID})};console.log("\u27A1\uFE0F Enviando para Script:",this.ENDPOINT,r);let n=yield fetch(this.ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),o=yield n.text();if(!n.ok)throw console.error("\u274C Erro bruto do Script:",o),new Error(`Erro no Script: ${n.status} - ${n.statusText}
${o}`);try{return JSON.parse(o)}catch(p){throw console.error("\u274C Resposta n\xE3o-JSON:",o),p}})}static createRow(t){return this.call("sheet.createRow",t)}static getAll(t){return this.call("sheet.getAll",t)}static getByIndex(t){return this.call("sheet.getByIndex",t)}static getCell(t){return this.call("sheet.getCell",t)}static updateByIndex(t){return this.call("sheet.updateByIndex",t)}static updateCell(t){return this.call("sheet.updateCell",t)}static deleteByIndex(t){return this.call("sheet.deleteByIndex",t)}static upload(t){return this.call("drive.upload",t)}static update(t){return this.call("drive.update",t)}static remove(t){return this.call("drive.delete",t)}static controllerCreate(t){return this.call("controller.create",t)}static controllerGetAll(t){return this.call("controller.getAll",t)}static controllerGetByIndex(t){return this.call("controller.getByIndex",t)}static controllerGetCell(t){return this.call("controller.getCell",t)}static controllerUpdateByIndex(t){return this.call("controller.updateByIndex",t)}static controllerUpdateCell(t){return this.call("controller.updateCell",t)}static controllerDeleteByIndex(t){return this.call("controller.deleteByIndex",t)}};var T=class{static TAB="Personagem";static META_TAB="Metadados";static getCurrentJogador(){return l(this,null,function*(){let t=h.getUser();if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=t.email,i=yield u.getAll(this.TAB),r=i.find(n=>n.email===e)||null;return r?(this.validateAndSync(),r):(yield this.syncFromOnline(),i=yield u.getAll(this.TAB),r=i.find(n=>n.email===e)||null,r)})}static validateAndSync(){return l(this,null,function*(){try{let t=yield u.get(this.META_TAB,this.TAB),i=(yield E.controllerGetAll({tab:this.META_TAB})).find(o=>o.SheetName===this.TAB),r=t?.UltimaModificacao,n=i?.UltimaModificacao;(!r||r!==n)&&(yield this.syncFromOnline())}catch(t){console.error("Erro na valida\xE7\xE3o de sync de jogadores:",t)}})}static syncFromOnline(){return l(this,null,function*(){try{let t=yield E.controllerGetAll({tab:this.TAB});yield u.clear(this.TAB),yield u.bulkPut(this.TAB,t);let i=(yield E.controllerGetAll({tab:this.META_TAB})).find(r=>r.SheetName===this.TAB);i&&(yield u.put(this.META_TAB,{name:this.TAB,UltimaModificacao:i.UltimaModificacao}))}catch(t){console.error("Erro ao sincronizar jogadores online:",t)}})}};function D(m,t){if(m&1&&w(0,"img",4),m&2){let e=f(2);A("src",e.jogador==null?null:e.jogador.imagem,I)}}function M(m,t){if(m&1&&(c(0,"h2",2),s(1),a(),c(2,"p",3),s(3),a(),x(4,D,1,1,"img",4),c(5,"div",5)(6,"div",6)(7,"p")(8,"strong"),s(9,"Personagem:"),a(),s(10),a(),c(11,"p")(12,"strong"),s(13,"Classe de Armadura:"),a(),s(14),a(),c(15,"p")(16,"strong"),s(17,"Pontos de Vida:"),a(),s(18),a(),c(19,"p")(20,"strong"),s(21,"N\xEDvel:"),a(),s(22),a(),c(23,"p")(24,"strong"),s(25,"XP:"),a(),s(26),a(),c(27,"p")(28,"strong"),s(29,"For\xE7a:"),a(),s(30),a(),c(31,"p")(32,"strong"),s(33,"Destreza:"),a(),s(34),a(),c(35,"p")(36,"strong"),s(37,"Constitui\xE7\xE3o:"),a(),s(38),a(),c(39,"p")(40,"strong"),s(41,"Intelig\xEAncia:"),a(),s(42),a(),c(43,"p")(44,"strong"),s(45,"Sabedoria:"),a(),s(46),a(),c(47,"p")(48,"strong"),s(49,"Carisma:"),a(),s(50),a()()()),m&2){let e=f();d(),v(e.jogador==null?null:e.jogador.nome_do_jogador),d(2),v(e.jogador==null?null:e.jogador.email),d(),y(e.jogador!=null&&e.jogador.imagem?4:-1),d(6),g(" ",e.jogador==null?null:e.jogador.personagem),d(4),g(" ",e.jogador==null?null:e.jogador.classe_de_armadura),d(4),g(" ",e.jogador==null?null:e.jogador.pontos_de_vida),d(4),g(" ",e.jogador==null?null:e.jogador.nivel),d(4),g(" ",e.jogador==null?null:e.jogador.xp),d(4),g(" ",e.jogador==null?null:e.jogador.forca),d(4),g(" ",e.jogador==null?null:e.jogador.destreza),d(4),g(" ",e.jogador==null?null:e.jogador.constituicao),d(4),g(" ",e.jogador==null?null:e.jogador.inteligencia),d(4),g(" ",e.jogador==null?null:e.jogador.sabedoria),d(4),g(" ",e.jogador==null?null:e.jogador.carisma)}}function J(m,t){m&1&&(c(0,"div",1)(1,"div",7)(2,"span",8),s(3,"Carregando..."),a()()())}var C=class m{constructor(t){this.router=t}jogador=null;loading=!0;ngOnInit(){return l(this,null,function*(){try{if(!h.getUser()){this.router.navigate(["/login"]);return}let e=yield T.getCurrentJogador();if(!e){this.router.navigate(["/cadastro"]);return}this.jogador=e,this.loading=!1}catch(t){console.error("Erro ao carregar Jogador:",t),this.router.navigate(["/login"])}})}static \u0275fac=function(e){return new(e||m)(P(B))};static \u0275cmp=j({type:m,selectors:[["app-jogador"]],decls:3,vars:1,consts:[[1,"container","mt-5"],[1,"text-center","mt-5"],[1,"text-center"],[1,"text-center","text-muted"],["alt","Avatar",1,"img-thumbnail","mb-3",2,"max-width","150px","display","block","margin","auto",3,"src"],[1,"card","mt-4","shadow-sm"],[1,"card-body"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(e,i){e&1&&(c(0,"div",0),x(1,M,51,14)(2,J,4,0,"div",1),a()),e&2&&(d(),y(i.loading?2:1))},encapsulation:2})};export{C as Jogador};
