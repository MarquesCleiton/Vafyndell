import{c as j,f as L,i as B,r as $}from"./chunk-GFP7435U.js";import{b as R}from"./chunk-LNY6OAJF.js";import{f as T,g as A,j as z,s as V}from"./chunk-WLM7QTUH.js";import{$b as k,Db as P,Eb as O,Fb as b,Jb as m,Lb as g,Pa as w,Qa as c,Va as y,Xb as h,Zb as l,_b as f,a as C,ab as M,ac as E,b as N,cc as I,d as _,dc as F,ec as S,fb as d,fc as D,ia as u,ja as x,wb as p,xb as o,yb as r,zb as v}from"./chunk-QQSIVCMV.js";function q(a,e){a&1&&(o(0,"div",14),v(1,"div",15),o(2,"p",16),l(3,"Carregando NPCs..."),r()())}function U(a,e){a&1&&(o(0,"div",17),l(1," Nenhum NPC encontrado. "),r())}function G(a,e){if(a&1&&v(0,"img",34),a&2){let t=g().$implicit;p("alt",D(t.nome))("src",t.imagem,w)}}function H(a,e){a&1&&(o(0,"span"),l(1,"\u{1F479}"),r())}function J(a,e){if(a&1&&(o(0,"p",35),l(1),r()),a&2){let t=g().$implicit;c(),k(" ",t.descricao," ")}}function K(a,e){if(a&1){let t=b();o(0,"div",25)(1,"div",26),m("click",function(){let n=u(t).$implicit,s=g(4);return x(s.abrirItem(n))}),o(2,"div",27)(3,"div",28),d(4,G,1,3,"img",29)(5,H,2,0,"span",11),r(),o(6,"div")(7,"h6",30),l(8),r(),o(9,"small",31),l(10),r()()(),o(11,"p",32),l(12," \u2764\uFE0F "),o(13,"b"),l(14),r(),l(15," | \u{1F6E1}\uFE0F "),o(16,"b"),l(17),r(),l(18," | \u2B50 "),o(19,"b"),l(20),r()(),d(21,J,2,1,"p",33),r()()}if(a&2){let t=e.$implicit;c(4),p("ngIf",t.imagem&&t.imagem!=="-"),c(),p("ngIf",!t.imagem||t.imagem==="-"),c(3),f(t.nome),c(2),E(" ",t.tipo||"\u2014"," | ",t.alinhamento||"Sem alinhamento"," "),c(4),f(t.pontos_de_vida),c(3),f(t.classe_armadura),c(3),f(t.xp),c(),p("ngIf",t.descricao)}}function Q(a,e){if(a&1&&(o(0,"div",16)(1,"div",23),d(2,K,22,9,"div",24),r()()),a&2){let t=g().$implicit;c(2),p("ngForOf",t.itens)}}function X(a,e){if(a&1){let t=b();P(0),o(1,"div",19)(2,"button",20),m("click",function(){let n=u(t).$implicit,s=g(2);return x(s.toggleCategoria(n))}),o(3,"span",21),l(4),r(),o(5,"span"),l(6),r()(),d(7,Q,3,1,"div",22),r(),O()}if(a&2){let t=e.$implicit;c(4),f(t.nome),c(2),f(t.expandido?"\u2212":"+"),c(),p("ngIf",t.expandido)}}function Y(a,e){if(a&1&&(o(0,"div"),d(1,X,8,3,"ng-container",18),r()),a&2){let t=g();c(),p("ngForOf",t.categoriasFiltradas)}}var W=class a{constructor(e){this.router=e}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="bestiais";repo=new R("NPCs","NPCs");todosNpcs=[];ngOnInit(){return _(this,null,function*(){this.carregando=!0;try{yield this.loadLocalAndSync()}catch(e){console.error("[Npcs] Erro ao carregar NPCs:",e)}finally{this.carregando=!1}})}loadLocalAndSync(){return _(this,null,function*(){let e=yield this.repo.getLocal();if(this.todosNpcs=e,this.processarCategorias(this.todosNpcs),this.repo.sync().then(t=>_(this,null,function*(){if(t){let i=yield this.repo.getLocal();this.todosNpcs=i,this.processarCategorias(this.todosNpcs)}})),e.length===0){let t=yield this.repo.forceFetch();this.todosNpcs=t,this.processarCategorias(this.todosNpcs)}})}processarCategorias(e){let t=new Map(this.categorias.map(n=>[n.nome,n.expandido])),i=new Map;e.filter(n=>this.abaAtiva==="bestiais"?n.classificacao==="Bestial":n.classificacao==="Inimigo").forEach(n=>{let s=n.tipo||"Comum";i.has(s)||i.set(s,[]),i.get(s).push(n)}),this.categorias=Array.from(i.entries()).sort(([n],[s])=>this.ordemTipos(n)-this.ordemTipos(s)).map(([n,s])=>({nome:n,itens:s,expandido:t.get(n)??!1})),this.categoriasFiltradas=[...this.categorias]}ordemTipos(e){let i=["Comum","Elite","M\xE1gico","Lend\xE1rio"].indexOf(e);return i>=0?i:999}aplicarFiltro(){let e=this.normalizarTexto(this.filtro);if(!e){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(t=>{let i=t.itens.filter(n=>[n.nome,n.tipo,n.descricao,n.alinhamento,n.classificacao].map(s=>this.normalizarTexto(String(s||""))).some(s=>s.includes(e)));return N(C({},t),{itens:i,expandido:i.length>0})}).filter(t=>t.itens.length>0)}normalizarTexto(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(e){this.abaAtiva=e,this.processarCategorias(this.todosNpcs)}toggleCategoria(e){e.expandido=!e.expandido}abrirItem(e){this.router.navigate(["/npc-detalhes",e.id])}novoNpc(){this.router.navigate(["/cadastro-npc"])}static \u0275fac=function(t){return new(t||a)(y(V))};static \u0275cmp=M({type:a,selectors:[["app-npcs"]],decls:20,vars:8,consts:[[1,"npc-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar NPCs...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"npc-container","w-100"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],[4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","npc-card","shadow-sm","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-secondary"],[1,"small","mb-1","text-info"],["class","text-white small descricao-text fst-italic",4,"ngIf"],[3,"src","alt"],[1,"text-white","small","descricao-text","fst-italic"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),S("ngModelChange",function(s){return F(i.filtro,s)||(i.filtro=s),s}),m("input",function(){return i.aplicarFiltro()}),r()(),o(3,"ul",3)(4,"li",4)(5,"button",5),m("click",function(){return i.selecionarAba("bestiais")}),l(6,"\u{1F43E} Bestiais"),r()(),o(7,"li",4)(8,"button",5),m("click",function(){return i.selecionarAba("inimigos")}),l(9,"\u2694\uFE0F Inimigos"),r()()(),o(10,"div",6)(11,"div",7)(12,"h4",8),l(13,"\u{1F479} Feras & Vil\xF5es"),r(),d(14,q,4,0,"div",9)(15,U,2,0,"div",10)(16,Y,2,1,"div",11),r()(),o(17,"div",12)(18,"button",13),m("click",function(){return i.novoNpc()}),l(19,"\uFF0B"),r()()()),t&2&&(c(2),I("ngModel",i.filtro),c(3),h("active",i.abaAtiva==="bestiais"),c(3),h("active",i.abaAtiva==="inimigos"),c(6),p("ngIf",i.carregando),c(),p("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),c(),p("ngIf",!i.carregando))},dependencies:[z,T,A,$,j,L,B],styles:[".npc-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.npc-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:20px;padding:.5rem 1rem}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.npc-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease}.npc-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.npc-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.npc-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#cfcfcf!important}.descricao-text[_ngcontent-%COMP%]{color:#e0e0e0!important;white-space:pre-line;line-height:1.4;font-size:.9rem}.item-thumb[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden;color:#cfcfcf}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.npc-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}"]})};export{W as Npcs};
