import{a as g}from"./chunk-SVIDRPKD.js";import{c as L,f as W,g as B,h as H,i as q,j as U,q as Z,r as G}from"./chunk-W45U2HER.js";import"./chunk-VZT3XYFG.js";import{Ia as u,Ja as r,Ka as l,La as E,Nb as N,Pa as x,Qa as h,Qb as R,Ra as v,T as m,Ta as _,U as p,Va as f,Xb as j,Zb as z,a as A,ac as Y,ca as I,d as b,db as y,hb as s,ib as F,ja as V,jb as O,ka as d,mb as M,nb as S,oa as C,ob as D,sa as k,vb as P,wa as w,za as T}from"./chunk-Y44Y2XZC.js";function Q(o,a){if(o&1){let e=v();x(0),E(1,"img",20),r(2,"button",21),_("click",function(){m(e);let n=f();return p(n.removerImagem())}),s(3,"\u2716"),l(),h()}if(o&2){let e=f();d(),u("src",e.anotacao.imagem,V)}}function X(o,a){if(o&1){let e=v();r(0,"label",22)(1,"span",23),s(2,"\u{1F4F7}"),l(),r(3,"input",24),_("change",function(n){m(e);let c=f();return p(c.onFileChange(n))}),l()()}}function $(o,a){o&1&&(x(0),s(1,"\u{1F5D1} Excluir"),h())}function ee(o,a){o&1&&(x(0),E(1,"span",26),s(2," Excluindo... "),h())}function te(o,a){if(o&1){let e=v();r(0,"button",25),_("click",function(){m(e);let n=f();return p(n.excluir())}),w(1,$,2,0,"ng-container",19)(2,ee,3,0,"ng-container",19),l()}if(o&2){let e=f();u("disabled",e.excluindo),d(),u("ngIf",!e.excluindo),d(),u("ngIf",e.excluindo)}}function ne(o,a){if(o&1&&(x(0),s(1),h()),o&2){let e=f();d(),F(e.editMode?"\u{1F4BE} Atualizar":"\u2705 Salvar")}}function ae(o,a){o&1&&(x(0),E(1,"span",26),s(2," Salvando... "),h())}var J=class o{constructor(a,e,t,n){this.router=a;this.route=e;this.el=t;this.zone=n}anotacao={id:0,index:0,jogador:"",autor:"",titulo:"",descricao:"",imagem:"",data:"",tags:""};salvando=!1;excluindo=!1;editMode=!1;ngOnInit(){return b(this,null,function*(){let a=this.route.snapshot.paramMap.get("id");if(a){this.editMode=!0;try{let t=(yield g.getLocalAnotacoes()).find(n=>String(n.id)===a);if(t&&(this.anotacao=A({},t),this.scheduleAutoExpand()),g.syncAnotacoes().then(n=>b(this,null,function*(){if(n){let i=(yield g.getLocalAnotacoes()).find(K=>String(K.id)===a);i&&(this.anotacao=A({},i),this.scheduleAutoExpand())}})),!t){let c=(yield g.forceFetchAnotacoes()).find(i=>String(i.id)===a);c&&(this.anotacao=A({},c),this.scheduleAutoExpand())}}catch(e){console.error("[CriarAnotacao] Erro ao carregar anota\xE7\xE3o:",e)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(e=>{let n=()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,300)+"px"};n(),e.addEventListener("input",n)})}onFileChange(a){let e=a.target;if(e.files&&e.files.length>0){let t=e.files[0],n=new FileReader;n.onload=()=>{this.anotacao.imagem=n.result},n.readAsDataURL(t)}}removerImagem(){this.anotacao.imagem=""}salvar(a){return b(this,null,function*(){if(!a.invalid)try{this.salvando=!0;let e=Y.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.anotacao.autor=e.email,this.anotacao.jogador=e.email,this.anotacao.data=new Date().toISOString(),this.editMode)yield g.updateAnotacao(this.anotacao),window.alert("\u2705 Anota\xE7\xE3o atualizada!");else{let t=yield g.getAllAnotacoes(),n=t.length>0?Math.max(...t.map(c=>c.index||0)):0;this.anotacao.index=n+1,this.anotacao.id=n+1,yield g.createAnotacao(this.anotacao),window.alert("\u2705 Anota\xE7\xE3o criada!")}this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao salvar:",e),window.alert("\u274C Erro ao salvar anota\xE7\xE3o.")}finally{this.salvando=!1}})}cancelar(){this.router.navigate(["/anotacoes"])}excluir(){return b(this,null,function*(){if(!(!this.anotacao.id||!confirm(`\u{1F5D1} Deseja realmente excluir a anota\xE7\xE3o "${this.anotacao.titulo}"?`)))try{this.excluindo=!0,yield g.deleteAnotacao(this.anotacao.id),window.alert("\u2705 Anota\xE7\xE3o exclu\xEDda com sucesso!"),this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao excluir anota\xE7\xE3o:",e),window.alert("\u274C Erro ao excluir anota\xE7\xE3o.")}finally{this.excluindo=!1}})}static \u0275fac=function(e){return new(e||o)(C(z),C(j),C(I),C(T))};static \u0275cmp=k({type:o,selectors:[["app-criar-anotacao"]],decls:31,vars:10,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","pb-5"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold","mb-3","text-light"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","titulo","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["rows","3","name","descricao","required","",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["type","text","name","tags","placeholder","ex: miss\xE3o, npc, combate...",1,"form-control","input-dark","text-light",3,"ngModelChange","ngModel"],[1,"d-flex","gap-2","mt-4"],["type","button",1,"btn","btn-outline-light","flex-fill",3,"click"],["type","button","class","btn btn-outline-danger flex-fill",3,"disabled","click",4,"ngIf"],["type","submit",1,"btn","btn-save","flex-fill",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],["type","button",1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,t){if(e&1){let n=v();r(0,"div",2)(1,"div",3)(2,"form",4,0),_("ngSubmit",function(){m(n);let i=y(3);return p(t.salvar(i))}),r(4,"div",5),w(5,Q,4,1,"ng-container",6)(6,X,4,0,"ng-template",null,1,P),l(),r(8,"div",7)(9,"div",8)(10,"h4",9),s(11),l(),r(12,"div",10)(13,"label",11),s(14,"\u{1F4CC} T\xEDtulo *"),l(),r(15,"input",12),D("ngModelChange",function(i){return m(n),S(t.anotacao.titulo,i)||(t.anotacao.titulo=i),p(i)}),l()(),r(16,"div",10)(17,"label",11),s(18,"\u{1F4D6} Descri\xE7\xE3o *"),l(),r(19,"textarea",13),D("ngModelChange",function(i){return m(n),S(t.anotacao.descricao,i)||(t.anotacao.descricao=i),p(i)}),l()(),r(20,"div",10)(21,"label",11),s(22,"\u{1F3F7}\uFE0F Tags"),l(),r(23,"input",14),D("ngModelChange",function(i){return m(n),S(t.anotacao.tags,i)||(t.anotacao.tags=i),p(i)}),l()(),r(24,"div",15)(25,"button",16),_("click",function(){return m(n),p(t.cancelar())}),s(26," \u2B05 Cancelar "),l(),w(27,te,3,3,"button",17),r(28,"button",18),w(29,ne,2,1,"ng-container",19)(30,ae,3,0,"ng-container",19),l()()()()()()()}if(e&2){let n=y(3),c=y(7);d(5),u("ngIf",t.anotacao.imagem)("ngIfElse",c),d(6),O(" ",t.editMode?"\u270F\uFE0F Editar Anota\xE7\xE3o":"\u{1F4DD} Nova Anota\xE7\xE3o"," "),d(4),M("ngModel",t.anotacao.titulo),d(4),M("ngModel",t.anotacao.descricao),d(4),M("ngModel",t.anotacao.tags),d(4),u("ngIf",t.editMode),d(),u("disabled",n.invalid||t.salvando),d(),u("ngIf",!t.salvando),d(),u("ngIf",t.salvando)}},dependencies:[R,N,G,U,L,W,B,Z,q,H],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#0d6efd;color:#0d6efd}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa}.input-dark[_ngcontent-%COMP%]::placeholder{color:#aaa!important;opacity:1}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}.btn-outline-danger[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};export{J as CriarAnotacao};
