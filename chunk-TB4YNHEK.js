import{a as _}from"./chunk-QWKS73CC.js";import{a as ee}from"./chunk-XQNWO7VY.js";import{c as U,f as L,g as $,h as G,i as H,j as K,k as Q,q as X,r as Y,s as Z}from"./chunk-AE35642N.js";import{a as R}from"./chunk-J5FBOTGS.js";import{f as z,h as J}from"./chunk-SEBSZRO5.js";import{i as W,q}from"./chunk-IJWXOQAR.js";import{Ab as g,Bb as t,Cb as i,Db as E,Hb as v,Ib as w,Jb as T,Nb as p,Pb as S,Sa as k,Ua as l,Za as D,Zb as x,a as I,bc as d,cc as N,dc as V,eb as A,ec as F,g as h,gc as C,hc as M,ic as y,jb as b,la as u,ma as m,rc as B}from"./chunk-O42C4TWY.js";function ie(c,s){if(c&1&&(v(0),E(1,"img",30),w()),c&2){let a=S(2);l(),g("src",a.jogador.imagem,k)}}function ne(c,s){c&1&&(t(0,"div",31),d(1," \u{1F464} "),i())}function oe(c,s){if(c&1&&(t(0,"div",22)(1,"div",23),b(2,ie,2,1,"ng-container",24)(3,ne,2,0,"ng-template",null,1,B),t(5,"div")(6,"h5",25),d(7),i(),t(8,"div",26)(9,"span",27),d(10),i(),t(11,"span",28),d(12),i(),t(13,"span",29),d(14),i()()()()()),c&2){let a=x(4),e=S();l(2),g("ngIf",e.jogador.imagem&&e.jogador.imagem!=="-")("ngIfElse",a),l(5),N(e.jogador.personagem),l(3),F(" \u2764\uFE0F ",e.JogadorUtils.getVidaAtual(e.jogador),"/",e.JogadorUtils.getVidaBase(e.jogador)," "),l(2),V("\u{1F4A5} ",e.jogador.dano_tomado||0),l(2),V("\u{1F6E1}\uFE0F ",e.jogador.classe_de_armadura||0)}}function de(c,s){c&1&&(v(0),d(1,"\u{1F48A} Recuperar"),w())}function ce(c,s){c&1&&(v(0),E(1,"span",32),d(2," Salvando... "),w())}var te=class c{constructor(s,a){this.route=s;this.router=a}jogador=null;recuperar=0;armadura=0;descricao="";salvando=!1;JogadorUtils=_;repo=new R("Personagem");repoRegistro=new R("Registro");ngOnInit(){return h(this,null,function*(){let s=this.route.snapshot.paramMap.get("id");if(!s){this.router.navigate(["/batalha"]);return}try{let a=yield this.repo.getLocal();if(this.jogador=a.find(e=>String(e.id)===s)||null,this.jogador)this.repo.sync().then(e=>h(this,null,function*(){if(e){let o=(yield this.repo.getLocal()).find(r=>String(r.id)===s);o&&(this.jogador=o)}}));else{let e=yield this.repo.forceFetch();this.jogador=e.find(n=>String(n.id)===s)||null}}catch(a){console.error("[Recuperacao] Erro ao carregar jogador:",a)}})}incrementarVida(){this.recuperar++}decrementarVida(){this.recuperar=Math.max(0,this.recuperar-1)}incrementarArmadura(){this.armadura++}decrementarArmadura(){this.armadura=Math.max(0,this.armadura-1)}cancelar(){this.router.navigate(["/batalha"])}registrarRecuperacao(s){return h(this,null,function*(){if(this.jogador){this.salvando=!0;try{let a=_.getVidaBase(this.jogador),e=_.getVidaAtual(this.jogador),n=this.jogador.classe_de_armadura||0,o=a-e;if(o<=0&&this.recuperar>0){alert(`\u26A0\uFE0F ${this.jogador.personagem} j\xE1 est\xE1 com a vida cheia!`);return}if(this.recuperar>o){alert(`\u26A0\uFE0F N\xE3o \xE9 poss\xEDvel recuperar mais do que ${o} de vida!`);return}if(this.recuperar<=0&&this.armadura<=0&&!this.descricao.trim()){alert("\u26A0\uFE0F Nenhuma altera\xE7\xE3o realizada. Ajuste a vida, armadura ou informe uma descri\xE7\xE3o.");return}let r=Math.min(this.recuperar,o);r>0&&(this.jogador.dano_tomado=Math.max(0,(this.jogador.dano_tomado||0)-r)),this.armadura>0&&(this.jogador.classe_de_armadura=(this.jogador.classe_de_armadura||0)+this.armadura);let P=_.getVidaAtual(this.jogador),O=this.jogador.classe_de_armadura||0,f=`\u{1F496} ${this.jogador.personagem} se recuperou!
`;if(r>0){let j=P-e;f+=`\u2764\uFE0F Vida: ${e}/${a} \u2192 ${P}/${a} (+${j})
`}if(this.armadura>0){let j=O-n;f+=`\u{1F6E1}\uFE0F Armadura: ${n} \u2192 ${O} (+${j})
`}this.descricao?.trim()&&(f+=`\u{1F4DD} ${this.descricao}`);let ae={id:ee.generateULID(),jogador:this.jogador.email,alvo:this.jogador.email,tipo:"recuperacao",acao:"cura",detalhes:f,data:new Date().toISOString()},re=yield R.batch({updateById:{Personagem:[I({},this.jogador)]},create:{Registro:[ae]}});console.log("\u{1F48A} Recupera\xE7\xE3o registrada (batch):",re),alert(`\u2705 Recupera\xE7\xE3o salva!

`+f),this.router.navigate(["/batalha"])}catch(a){console.error("[Recuperacao] Erro ao registrar (batch):",a),alert("\u274C Erro ao registrar recupera\xE7\xE3o.")}finally{this.salvando=!1}}})}static \u0275fac=function(a){return new(a||c)(D(z),D(J))};static \u0275cmp=A({type:c,selectors:[["app-recuperacao"]],decls:36,vars:7,consts:[["form","ngForm"],["noImg",""],[1,"recuperacao-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"recuperacao-container","w-100"],[3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","recuperar","min","0","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],["type","number","name","armadura","min","0",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["rows","2","name","descricao","placeholder","Ex: Recupera\xE7\xE3o lenta, magia de cura...",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-light","px-4",3,"click"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],[1,"preview-card","mb-3"],[1,"d-flex","align-items-center","justify-content-center"],[4,"ngIf","ngIfElse"],[1,"fw-bold","text-light","mb-1"],[1,"status-line","mt-2"],[1,"vida"],[1,"dano"],[1,"armadura"],[1,"me-3","rounded",2,"width","60px","height","60px","object-fit","cover",3,"src"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-secondary","rounded",2,"width","60px","height","60px","font-size","1.5rem"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(a,e){if(a&1){let n=T();t(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),p("ngSubmit",function(){u(n);let r=x(4);return m(e.registrarRecuperacao(r))}),t(5,"div",6)(6,"div",7),b(7,oe,15,7,"div",8),t(8,"div",9)(9,"label",10),d(10,"\u{1F48A} Recuperar Vida"),i(),t(11,"div",11)(12,"button",12),p("click",function(){return u(n),m(e.decrementarVida())}),d(13,"\u2212"),i(),t(14,"input",13),y("ngModelChange",function(r){return u(n),M(e.recuperar,r)||(e.recuperar=r),m(r)}),i(),t(15,"button",12),p("click",function(){return u(n),m(e.incrementarVida())}),d(16,"+"),i()()(),t(17,"div",9)(18,"label",10),d(19,"\u{1F6E1}\uFE0F Recuperar Armadura"),i(),t(20,"div",11)(21,"button",12),p("click",function(){return u(n),m(e.decrementarArmadura())}),d(22,"\u2212"),i(),t(23,"input",14),y("ngModelChange",function(r){return u(n),M(e.armadura,r)||(e.armadura=r),m(r)}),i(),t(24,"button",12),p("click",function(){return u(n),m(e.incrementarArmadura())}),d(25,"+"),i()()(),t(26,"div",15)(27,"label",16),d(28,"\u{1F4DD} Descri\xE7\xE3o"),i(),t(29,"textarea",17),y("ngModelChange",function(r){return u(n),M(e.descricao,r)||(e.descricao=r),m(r)}),i()(),t(30,"div",18)(31,"button",19),p("click",function(){return u(n),m(e.cancelar())}),d(32,"\u2B05 Cancelar"),i(),t(33,"button",20),b(34,de,2,0,"ng-container",21)(35,ce,3,0,"ng-container",21),i()()()()()()()()}if(a&2){let n=x(4);l(7),g("ngIf",e.jogador),l(7),C("ngModel",e.recuperar),l(9),C("ngModel",e.armadura),l(6),C("ngModel",e.descricao),l(4),g("disabled",n.invalid||e.salvando),l(),g("ngIf",!e.salvando),l(),g("ngIf",e.salvando)}},dependencies:[q,W,Z,K,U,Q,L,$,Y,X,H,G],styles:[".recuperacao-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.recuperacao-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px}.status-line[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#dc3545}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#0dcaf0}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.75rem 1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d}.status-line[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;font-weight:600;font-size:.9rem}.status-line[_ngcontent-%COMP%]   .vida[_ngcontent-%COMP%]{color:#ff4d6d}.status-line[_ngcontent-%COMP%]   .dano[_ngcontent-%COMP%]{color:#ffc107}.status-line[_ngcontent-%COMP%]   .armadura[_ngcontent-%COMP%]{color:#4da6ff}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}"]})};export{te as Recuperacao};
