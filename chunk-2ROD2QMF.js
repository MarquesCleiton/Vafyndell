import{a as oe}from"./chunk-DK4BJW43.js";import{c as j,f as q,g as U,h as H,i as Z,j as G,k as J,m as K,n as Q,o as X,p as Y,q as $,r as ee}from"./chunk-GFP7435U.js";import{a as ie,b as ae}from"./chunk-KJ5OHPYV.js";import{c as B,f as L,g as A,j as N,q as z,s as R,w as te}from"./chunk-WLM7QTUH.js";import{$b as k,Db as y,Eb as v,Fb as E,Jb as x,Lb as S,Pa as F,Qa as l,Va as w,Vb as I,Zb as m,_b as M,a as h,ab as D,cc as u,d as b,dc as f,ec as C,fb as _,ia as c,ja as g,jb as O,mc as W,wa as P,wb as p,xb as a,yb as o,zb as T}from"./chunk-QQSIVCMV.js";function re(d,r){if(d&1){let i=E();y(0),T(1,"img",29),a(2,"button",30),x("click",function(){c(i);let n=S();return g(n.removerImagem())}),m(3,"\u2716"),o(),v()}if(d&2){let i=S();l(),p("src",i.imagemBase64Temp||i.item.imagem,F)}}function le(d,r){if(d&1){let i=E();a(0,"label",31)(1,"span",32),m(2,"\u{1F4F7}"),o(),a(3,"input",33),x("change",function(n){c(i);let s=S();return g(s.onFileChange(n))}),o()()}}function de(d,r){if(d&1&&(a(0,"option"),m(1),o()),d&2){let i=r.$implicit;l(),M(i)}}function me(d,r){if(d&1&&(a(0,"option"),m(1),o()),d&2){let i=r.$implicit;l(),M(i)}}function se(d,r){if(d&1&&(a(0,"option"),m(1),o()),d&2){let i=r.$implicit;l(),M(i)}}function ce(d,r){if(d&1&&(a(0,"option"),m(1),o()),d&2){let i=r.$implicit;l(),M(i)}}function ge(d,r){d&1&&(y(0),m(1,"\u{1F4BE}"),v())}function pe(d,r){d&1&&(y(0),T(1,"span",34),v())}var ne=class d{constructor(r,i,e,n,s){this.router=r;this.el=i;this.route=e;this.zone=n;this.location=s}item={id:"",index:0,nome:"",unidade_medida:"",peso:0,categoria:"",origem:"",raridade:"",efeito:"",colateral:"",descricao:"",imagem:"-",email:""};imagemBase64Temp=null;salvando=!1;editMode=!1;unidadesMedida=["g","kg","ml","l","cm","m","unidade"];origens=["Fabric\xE1vel","Natural"];raridades=["Comum","Incomum","Raro","\xC9pico","Lend\xE1rio"];categorias=["Recursos bot\xE2nicos","Mineral","Equipamento","Moeda","Tesouro","Componentes bestiais e animalescos","Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos","Ferramentas","Outros"];repo=new ae("Catalogo","Catalogo");ngOnInit(){return b(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield this.repo.getLocal()).find(n=>String(n.id)===r);if(e&&(this.item=h({},e)),this.repo.sync().then(n=>b(this,null,function*(){if(n){let t=(yield this.repo.getLocal()).find(V=>String(V.id)===r);t&&(this.item=h({},t))}})),!e){let s=(yield this.repo.forceFetch()).find(t=>String(t.id)===r);s&&(this.item=h({},s))}}catch(i){console.error("[CadastroItemCatalogo] Erro ao carregar item:",i)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(i=>{let n=()=>{i.style.height="auto",i.style.height=Math.min(i.scrollHeight,200)+"px"};n(),i.addEventListener("input",n)})}onFileChange(r){return b(this,null,function*(){let i=r.target;if(i.files?.length){let e=i.files[0];try{this.imagemBase64Temp=yield oe.toOptimizedBase64(e,.72,800)}catch(n){console.error("[CadastroItemCatalogo] Erro ao otimizar imagem:",n)}}})}removerImagem(){this.item.imagem="-",this.imagemBase64Temp=null}salvar(r){return b(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let i=te.getUser();if(!i?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.item.email=i.email,this.editMode){let e=h({},this.item);this.imagemBase64Temp&&(e.imagem=this.imagemBase64Temp);let n=yield this.repo.update(e);this.item=h({},n),window.alert("\u2705 Item atualizado com sucesso!")}else{let e=yield this.repo.getLocal(),n=e.length>0?Math.max(...e.map(V=>V.index||0)):0;this.item.id=ie.generateULID(),this.item.index=n+1;let s=h({},this.item);this.imagemBase64Temp&&(s.imagem=this.imagemBase64Temp);let t=yield this.repo.create(s);this.item=h({},t),window.alert("\u2705 Item criado com sucesso!")}this.cancelar()}catch(i){console.error("[CadastroItemCatalogo] Erro ao salvar:",i),window.alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1,this.imagemBase64Temp=null}})}cancelar(){this.location.back()}static \u0275fac=function(i){return new(i||d)(w(R),w(P),w(z),w(O),w(B))};static \u0275cmp=D({type:d,selectors:[["app-cadastro-item-catalogo"]],decls:68,vars:19,consts:[["form","ngForm"],["uploadBox",""],[1,"catalogo-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"catalogo-detalhe-container","w-100"],["id","formCatalogo",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","nome","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","unidadeMedida","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[4,"ngFor","ngForOf"],["type","number","name","peso","min","0",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","categoria","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","origem","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","raridade","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["name","efeito",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["name","colateral",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","submit","form","formCatalogo",1,"fab","fab-success",3,"disabled"],[4,"ngIf"],["type","button",1,"fab","fab-warning",3,"click"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm"]],template:function(i,e){if(i&1){let n=E();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),x("ngSubmit",function(){c(n);let t=I(4);return g(e.salvar(t))}),a(5,"div",6)(6,"div",7)(7,"h4",8),m(8),o()(),a(9,"div",9),_(10,re,4,1,"ng-container",10)(11,le,4,0,"ng-template",null,1,W),o(),a(13,"div",11)(14,"div",12)(15,"label",13),m(16,"\u{1F3F7}\uFE0F Nome *"),o(),a(17,"input",14),C("ngModelChange",function(t){return c(n),f(e.item.nome,t)||(e.item.nome=t),g(t)}),o()(),a(18,"div",12)(19,"label",13),m(20,"\u2696\uFE0F Unidade de Medida *"),o(),a(21,"select",15),C("ngModelChange",function(t){return c(n),f(e.item.unidade_medida,t)||(e.item.unidade_medida=t),g(t)}),a(22,"option",16),m(23,"Selecione..."),o(),_(24,de,2,1,"option",17),o()(),a(25,"div",12)(26,"label",13),m(27,"\u2696\uFE0F Peso"),o(),a(28,"input",18),C("ngModelChange",function(t){return c(n),f(e.item.peso,t)||(e.item.peso=t),g(t)}),o()(),a(29,"div",12)(30,"label",13),m(31,"\u{1F4C2} Categoria *"),o(),a(32,"select",19),C("ngModelChange",function(t){return c(n),f(e.item.categoria,t)||(e.item.categoria=t),g(t)}),a(33,"option",16),m(34,"Selecione..."),o(),_(35,me,2,1,"option",17),o()(),a(36,"div",12)(37,"label",13),m(38,"\u{1F331} Origem *"),o(),a(39,"select",20),C("ngModelChange",function(t){return c(n),f(e.item.origem,t)||(e.item.origem=t),g(t)}),a(40,"option",16),m(41,"Selecione..."),o(),_(42,se,2,1,"option",17),o()(),a(43,"div",12)(44,"label",13),m(45,"\u{1F48E} Raridade *"),o(),a(46,"select",21),C("ngModelChange",function(t){return c(n),f(e.item.raridade,t)||(e.item.raridade=t),g(t)}),a(47,"option",16),m(48,"Selecione..."),o(),_(49,ce,2,1,"option",17),o()(),a(50,"div",12)(51,"label",13),m(52,"\u{1F4DD} Descri\xE7\xE3o"),o(),a(53,"textarea",22),C("ngModelChange",function(t){return c(n),f(e.item.descricao,t)||(e.item.descricao=t),g(t)}),o()(),a(54,"div",12)(55,"label",13),m(56,"\u2728 Efeito"),o(),a(57,"textarea",23),C("ngModelChange",function(t){return c(n),f(e.item.efeito,t)||(e.item.efeito=t),g(t)}),o()(),a(58,"div",12)(59,"label",13),m(60,"\u26A0\uFE0F Colateral"),o(),a(61,"textarea",24),C("ngModelChange",function(t){return c(n),f(e.item.colateral,t)||(e.item.colateral=t),g(t)}),o()()()()()()(),a(62,"div",25)(63,"button",26),_(64,ge,2,0,"ng-container",27)(65,pe,2,0,"ng-container",27),o(),a(66,"button",28),x("click",function(){return c(n),g(e.cancelar())}),m(67," \u2B05\uFE0F "),o()()()}if(i&2){let n=I(4),s=I(12);l(8),k(" \u{1F4E6} ",e.editMode?"Editar Item do Cat\xE1logo":"Cadastro de Item do Cat\xE1logo"," "),l(2),p("ngIf",e.imagemBase64Temp||e.item.imagem&&e.item.imagem!=="-")("ngIfElse",s),l(7),u("ngModel",e.item.nome),l(4),u("ngModel",e.item.unidade_medida),l(3),p("ngForOf",e.unidadesMedida),l(4),u("ngModel",e.item.peso),l(4),u("ngModel",e.item.categoria),l(3),p("ngForOf",e.categorias),l(4),u("ngModel",e.item.origem),l(3),p("ngForOf",e.origens),l(4),u("ngModel",e.item.raridade),l(3),p("ngForOf",e.raridades),l(4),u("ngModel",e.item.descricao),l(4),u("ngModel",e.item.efeito),l(4),u("ngModel",e.item.colateral),l(2),p("disabled",(n==null?null:n.invalid)||e.salvando),l(),p("ngIf",!e.salvando),l(),p("ngIf",e.salvando)}},dependencies:[N,L,A,ee,G,Q,X,j,J,K,q,U,$,Y,Z,H],styles:[".catalogo-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#0d6efd;color:#0d6efd}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border:1px solid #444!important;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd!important;box-shadow:0 0 0 .2rem #0d6efd40!important;outline:none!important}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease;border:none;cursor:pointer}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}@media (min-width: 992px){.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.fab-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.fab-success[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}"]})};export{ne as CadastroItemCatalogo};
