import{c as j,f as L,i as N,r as V}from"./chunk-GFP7435U.js";import{b as R}from"./chunk-FLOHM7ZW.js";import{f as I,g as F,j as k,s as z,w as $}from"./chunk-WLM7QTUH.js";import{$b as g,Fb as C,Jb as _,Lb as p,Pa as D,Qa as s,Va as M,Zb as d,_b as w,a as y,ab as O,b as A,cc as S,d as u,dc as T,ec as P,fb as f,fc as E,ia as v,ja as h,wb as l,xb as o,yb as r,zb as b}from"./chunk-QQSIVCMV.js";function W(n,t){n&1&&(o(0,"div",11),b(1,"div",12),o(2,"p",13),d(3,"Carregando anota\xE7\xF5es..."),r()())}function U(n,t){n&1&&(o(0,"div",14),d(1," Nenhuma anota\xE7\xE3o encontrada. "),r())}function q(n,t){if(n&1&&b(0,"img",30),n&2){let e=p().$implicit;l("alt",E(e.titulo||"Anota\xE7\xE3o"))("src",e.imagem,D)}}function G(n,t){n&1&&(o(0,"span"),d(1,"\u{1F4DD}"),r())}function H(n,t){if(n&1&&(o(0,"span"),d(1),r()),n&2){let e=p().$implicit;s(),g(" | #",e.tags)}}function J(n,t){if(n&1&&(o(0,"p",31),d(1),r()),n&2){let e=p().$implicit;s(),g(" ",e.descricao," ")}}function K(n,t){if(n&1){let e=C();o(0,"div",22)(1,"div",23),_("click",function(){let a=v(e).$implicit,c=p(4);return h(c.abrirAnotacao(a))}),o(2,"div",24)(3,"div",25),f(4,q,1,3,"img",26)(5,G,2,0,"span",8),r(),o(6,"div")(7,"h6",27),d(8),r(),o(9,"small",28),d(10),f(11,H,2,1,"span",8),r()()(),f(12,J,2,1,"p",29),r()()}if(n&2){let e=t.$implicit;s(4),l("ngIf",e.imagem&&e.imagem!=="-"),s(),l("ngIf",!e.imagem||e.imagem==="-"),s(3),w(e.titulo||"Sem t\xEDtulo"),s(2),g(" \u270D ",e.autor," "),s(),l("ngIf",e.tags),s(),l("ngIf",e.descricao)}}function Q(n,t){if(n&1&&(o(0,"div",13)(1,"div",20),f(2,K,13,6,"div",21),r()()),n&2){let e=p().$implicit;s(2),l("ngForOf",e.itens)}}function X(n,t){if(n&1){let e=C();o(0,"div",16)(1,"button",17),_("click",function(){let a=v(e).$implicit,c=p(2);return h(c.toggleSecao(a))}),o(2,"span",18),d(3),r(),o(4,"span"),d(5),r()(),f(6,Q,3,1,"div",19),r()}if(n&2){let e=t.$implicit,i=p(2);s(3),g("\u{1F4C5} ",i.formatarData(e.data)),s(2),w(e.expandido?"\u2212":"+"),s(),l("ngIf",e.expandido)}}function Y(n,t){if(n&1&&(o(0,"div"),f(1,X,7,3,"div",15),r()),n&2){let e=p();s(),l("ngForOf",e.secoesFiltradas)}}var B=class n{constructor(t){this.router=t}secoes=[];secoesFiltradas=[];carregando=!0;filtro="";repo=new R("Anotacoes","Anotacoes");ngOnInit(){return u(this,null,function*(){this.carregando=!0;try{yield this.loadLocalAndSync()}catch(t){console.error("[Anotacoes] Erro ao carregar:",t)}finally{this.carregando=!1}})}loadLocalAndSync(){return u(this,null,function*(){let t=$.getUser();if(!t?.email)return;let i=(yield this.repo.getLocal()).filter(a=>a.jogador===t.email);if(this.processarSecoes(i),this.repo.sync().then(a=>u(this,null,function*(){if(a){let m=(yield this.repo.getLocal()).filter(x=>x.jogador===t.email);this.processarSecoes(m)}})),i.length===0){let c=(yield this.repo.forceFetch()).filter(m=>m.jogador===t.email);this.processarSecoes(c)}})}processarSecoes(t){let e=new Map(this.secoes.map(a=>[a.data,a.expandido])),i=new Map;t.forEach(a=>{let c=a.data||"",m=c.includes("T")?c.split("T")[0]:c;i.has(m)||i.set(m,[]),i.get(m).push(a)}),this.secoes=Array.from(i.entries()).sort(([a],[c])=>new Date(c).getTime()-new Date(a).getTime()).map(([a,c])=>({data:a,itens:c.sort((m,x)=>new Date(x.data||0).getTime()-new Date(m.data||0).getTime()),expandido:e.get(a)??!1})),this.secoesFiltradas=[...this.secoes]}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.secoesFiltradas=[...this.secoes];return}this.secoesFiltradas=this.secoes.map(e=>A(y({},e),{itens:e.itens.filter(i=>this.normalizarTexto(i.titulo||"").includes(t)||this.normalizarTexto(i.descricao||"").includes(t)||this.normalizarTexto(i.tags||"").includes(t)||this.normalizarTexto(i.autor||"").includes(t)),expandido:!0})).filter(e=>e.itens.length>0)}toggleSecao(t){t.expandido=!t.expandido}formatarData(t){try{return(t.includes("T")?new Date(t):new Date(t+"T00:00:00")).toLocaleDateString("pt-BR")}catch{return t}}novaAnotacao(){this.router.navigate(["/criar-anotacao"])}abrirAnotacao(t){this.router.navigate(["/criar-anotacao",t.id])}normalizarTexto(t){return t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():""}static \u0275fac=function(e){return new(e||n)(M(z))};static \u0275cmp=O({type:n,selectors:[["app-anotacoes"]],decls:13,vars:4,consts:[[1,"anotacoes-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar anota\xE7\xF5es...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"anotacoes-container","w-100"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","anotacao-card","shadow-sm","h-100","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-light"],["class","small descricao-text fst-italic",4,"ngIf"],[3,"src","alt"],[1,"small","descricao-text","fst-italic"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),P("ngModelChange",function(c){return T(i.filtro,c)||(i.filtro=c),c}),_("input",function(){return i.aplicarFiltro()}),r()(),o(3,"div",3)(4,"div",4)(5,"h4",5),d(6,"\u{1F4DD} Minhas Anota\xE7\xF5es"),r(),f(7,W,4,0,"div",6)(8,U,2,0,"div",7)(9,Y,2,1,"div",8),r()(),o(10,"div",9)(11,"button",10),_("click",function(){return i.novaAnotacao()}),d(12,"\uFF0B"),r()()()),e&2&&(s(2),S("ngModel",i.filtro),s(5),l("ngIf",i.carregando),s(),l("ngIf",!i.carregando&&i.secoesFiltradas.length===0),s(),l("ngIf",!i.carregando))},dependencies:[k,I,F,V,j,L,N],styles:[".anotacoes-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.anotacoes-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#f8f9fa;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40;color:#fff}.anotacao-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease;color:#f1f1f1}.anotacao-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-thumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.4rem;color:#bbb}.anotacao-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.anotacao-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ddd}.anotacao-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e0e0e0;white-space:pre-line}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.anotacoes-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}"]})};export{B as Anotacoes};
