import{a as L,b as pe}from"./chunk-R66HVWNJ.js";import{a as W}from"./chunk-XQNWO7VY.js";import{c as X,f as Y,g as $,h as ee,i as ie,j as te,k as ne,m as ae,n as re,o as oe,p as de,q as le,r as ce}from"./chunk-7HYCYAOW.js";import{a as M}from"./chunk-DET3QFJ6.js";import{f as U,g as G,j as Z,q as J,s as K}from"./chunk-7SGEPDVZ.js";import{Ab as l,Bb as d,Cb as H,Gb as A,Hb as N,Ib as S,Mb as _,Ob as c,Sb as R,Ta as r,Tb as j,Ub as z,Ya as I,Yb as O,a as k,ac as s,b as V,ba as q,bc as F,cc as D,db as B,dc as Q,f as ge,fc as C,g as x,gc as w,hc as y,ib as b,la as g,ma as p,zb as m}from"./chunk-DNZPJZVY.js";var se=ge(pe());L.use(se.default);var P=class a{repoCaminho=new M("Caminhos");repoArvore=new M("Arvores");repoHab=new M("Habilidades");caminhos=[];arvores=[];habilidades=[];carregarTudo(){return x(this,null,function*(){this.caminhos=(yield this.repoCaminho.getLocal()).map(i=>V(k({},i),{id:String(i.id)})),this.arvores=(yield this.repoArvore.getLocal()).map(i=>V(k({},i),{id:String(i.id),caminho:String(i.caminho)})),this.habilidades=(yield this.repoHab.getLocal()).map(i=>V(k({},i),{id:String(i.id),caminho:String(i.caminho),arvore:String(i.arvore),dependencia:i.dependencia?String(i.dependencia):null}))})}getArvoresDoCaminho(i){return i?this.arvores.filter(e=>String(e.caminho)===String(i)):[]}getHabilidadesDaArvore(i){return i&&i!=="nova"?this.habilidades.filter(e=>String(e.arvore)===String(i)):[]}renderPreview(i,e,n,t,o,h){let v=[];if(e.forEach(u=>{n.id&&String(u.id)===String(n.id)||(v.push({data:{id:String(u.id),label:`${u.habilidade}
Lv ${u.nivel}`}}),u.dependencia&&v.push({data:{source:String(u.dependencia),target:String(u.id)}}))}),n.caminho&&n.arvore){let u=n.id||"novaHab",T=n.habilidade?`${n.habilidade}
Lv ${n.nivel}`:`Nova Habilidade
Lv ${n.nivel}`;v.push({data:{id:String(u),label:T},classes:o?"habilidade-edit":"nova-habilidade"}),t&&v.push({data:{source:String(t),target:String(u)}})}let f=L({container:i,elements:v,style:[{selector:"node",style:{"background-color":"#222","border-color":"#555","border-width":2,label:"data(label)",color:"#eee","text-valign":"center","text-halign":"center",width:"65px",height:"65px","font-size":"10px","text-wrap":"wrap","text-max-width":"90px",shape:"ellipse"}},{selector:"node.habilidade-edit",style:{"background-color":"#0056b3","border-color":"#0d6efd","border-width":4,color:"#fff"}},{selector:"node.nova-habilidade",style:{"background-color":"#007bff","border-color":"#fff","border-width":3,color:"#fff"}},{selector:"edge",style:{width:2,"line-color":"#666","curve-style":"unbundled-bezier","control-point-distances":[-30,30],"control-point-weights":[.5,.5]}}],layout:{name:"dagre",rankDir:"TB",nodeSep:100,rankSep:80},autoungrabify:!0,userZoomingEnabled:!0,userPanningEnabled:!0});return f.on("tap","node",u=>{let T=String(u.target.id()),E=e.find(ue=>String(ue.id)===T)||null;h(E)}),f}salvarHabilidade(i,e,n,t,o,h,v){return x(this,null,function*(){let f={},u={},T={};if(n==="nova"&&o.trim()){let E={id:W.generateULID(),caminho:String(e||""),arvore:o.trim()};h.push(E),n=E.id,f.Arvores=[E]}return i.id=String(i.id||W.generateULID()),i.caminho=String(e||""),i.arvore=String(n||""),i.dependencia=t?String(t):null,v.find(E=>String(E.id)===i.id)?(u.Habilidades||(u.Habilidades=[]),u.Habilidades.push(i)):(f.Habilidades||(f.Habilidades=[]),f.Habilidades.push(i)),yield M.batch({create:Object.keys(f).length?f:void 0,updateById:Object.keys(u).length?u:void 0,deleteById:Object.keys(T).length?T:void 0})})}excluirHabilidade(i){return x(this,null,function*(){return yield M.batch({deleteById:{Habilidades:[{id:String(i)}]}})})}excluirHabilidadeComDependencias(i,e){return x(this,null,function*(){let n=e.filter(o=>String(o.dependencia)===String(i));if(n.length>0){let o=n.map(v=>`- ${v.habilidade} (Lv ${v.nivel})`).join(`
`);if(!confirm(`\u26A0\uFE0F Esta habilidade possui dependentes:

${o}

Se continuar, esses v\xEDnculos ser\xE3o removidos. Deseja prosseguir?`))return!1;n.forEach(v=>{v.dependencia=null,v.id=String(v.id);let f=e.findIndex(u=>String(u.id)===String(v.id));f!==-1&&(e[f]=k({},v))})}let t={};return n.length>0&&(t.Habilidades=n),yield M.batch({deleteById:{Habilidades:[{id:String(i)}]},updateById:Object.keys(t).length?t:void 0}),!0})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"})};var fe=["cyPreview"];function _e(a,i){if(a&1&&(l(0,"div",27)(1,"span"),s(2,"\u{1F4CC} Requisito:"),d(),s(3),d()),a&2){let e=c(2);r(3),D(" ",e.habilidadeSelecionada.requisitos," ")}}function be(a,i){if(a&1&&(l(0,"div",22)(1,"h4",23),s(2),l(3,"span",24),s(4),d()(),l(5,"p",25),s(6),d(),b(7,_e,4,1,"div",26),d()),a&2){let e=c();r(2),D(" ",e.habilidadeSelecionada.habilidade," "),r(2),D("Lv ",e.habilidadeSelecionada.nivel),r(2),F(e.habilidadeSelecionada.descricao),r(),m("ngIf",e.habilidadeSelecionada.requisitos)}}function Se(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;m("ngValue",e.id),r(),F(e.caminho)}}function xe(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;m("ngValue",e.id),r(),D(" ",e.arvore," ")}}function Ce(a,i){if(a&1){let e=S();l(0,"div",31)(1,"input",32),y("ngModelChange",function(t){g(e);let o=c(2);return w(o.novaArvoreNome,t)||(o.novaArvoreNome=t),p(t)}),_("ngModelChange",function(){g(e);let t=c(2);return p(t.atualizarPreview())}),d()()}if(a&2){let e=c(2);r(),C("ngModel",e.novaArvoreNome)}}function we(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F333} \xC1rvore"),d(),l(3,"select",29),y("ngModelChange",function(t){g(e);let o=c();return w(o.arvoreSelecionada,t)||(o.arvoreSelecionada=t),p(t)}),_("ngModelChange",function(t){g(e);let o=c();return p(o.onArvoreChange(t))}),l(4,"option",14),s(5,"Selecione..."),d(),b(6,xe,2,2,"option",15),l(7,"option",28),s(8,"\u2795 Nova \xC1rvore"),d()(),b(9,Ce,2,1,"div",30),d()}if(a&2){let e=c();r(3),C("ngModel",e.arvoreSelecionada),r(),m("ngValue",null),r(2),m("ngForOf",e.arvoresDoCaminho),r(),m("ngValue","nova"),r(2),m("ngIf",e.arvoreSelecionada==="nova")}}function ye(a,i){if(a&1&&(l(0,"option",28),s(1),d()),a&2){let e=i.$implicit;m("ngValue",e.id),r(),Q(" ",e.habilidade," (Lv ",e.nivel,") ")}}function Ee(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F517} Depend\xEAncia"),d(),l(3,"select",33),y("ngModelChange",function(t){g(e);let o=c();return w(o.dependenciaSelecionada,t)||(o.dependenciaSelecionada=t),p(t)}),_("ngModelChange",function(){g(e);let t=c();return p(t.atualizarPreview())}),l(4,"option",28),s(5,"Nenhuma"),d(),b(6,ye,2,3,"option",15),d()()}if(a&2){let e=c();r(3),C("ngModel",e.dependenciaSelecionada),r(),m("ngValue",null),r(2),m("ngForOf",e.habilidadesDaArvore)}}function ke(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F3F7}\uFE0F Nome"),d(),l(3,"input",34),y("ngModelChange",function(t){g(e);let o=c();return w(o.habilidadeEdit.habilidade,t)||(o.habilidadeEdit.habilidade=t),p(t)}),_("ngModelChange",function(){g(e);let t=c();return p(t.atualizarPreview())}),d()()}if(a&2){let e=c();r(3),C("ngModel",e.habilidadeEdit.habilidade)}}function De(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F4C8} N\xEDvel"),d(),l(3,"input",35),y("ngModelChange",function(t){g(e);let o=c();return w(o.habilidadeEdit.nivel,t)||(o.habilidadeEdit.nivel=t),p(t)}),_("ngModelChange",function(){g(e);let t=c();return p(t.atualizarPreview())}),d()()}if(a&2){let e=c();r(3),C("ngModel",e.habilidadeEdit.nivel)}}function Me(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F4CC} Requisitos"),d(),l(3,"textarea",36),y("ngModelChange",function(t){g(e);let o=c();return w(o.habilidadeEdit.requisitos,t)||(o.habilidadeEdit.requisitos=t),p(t)}),_("ngModelChange",function(){g(e);let t=c();return p(t.atualizarPreview())}),d()()}if(a&2){let e=c();r(3),C("ngModel",e.habilidadeEdit.requisitos)}}function Te(a,i){if(a&1){let e=S();l(0,"div",11)(1,"label",12),s(2,"\u{1F4DD} Descri\xE7\xE3o"),d(),l(3,"textarea",37),y("ngModelChange",function(t){g(e);let o=c();return w(o.habilidadeEdit.descricao,t)||(o.habilidadeEdit.descricao=t),p(t)}),_("ngModelChange",function(){g(e);let t=c();return p(t.atualizarPreview())}),d()()}if(a&2){let e=c();r(3),C("ngModel",e.habilidadeEdit.descricao)}}function Ve(a,i){a&1&&(A(0),s(1,"\u{1F4BE}"),N())}function Ie(a,i){a&1&&(A(0),H(1,"span",38),N())}function Pe(a,i){if(a&1){let e=S();l(0,"button",39),_("click",function(){g(e);let t=c();return p(t.excluir())}),s(1,"\u{1F5D1}\uFE0F"),d()}}var me=class a{constructor(i,e,n){this.route=i;this.router=e;this.habilidadeService=n}cyPreviewRef;cyInstance=null;carregando=!0;salvando=!1;editMode=!1;caminhoSelecionado=null;arvoreSelecionada=null;dependenciaSelecionada=null;novaArvoreNome="";habilidadeEdit={id:"",caminho:"",arvore:"",habilidade:"",nivel:1,requisitos:"",descricao:"",dependencia:null};habilidadeSelecionada=null;ngOnInit(){return x(this,null,function*(){yield this.habilidadeService.carregarTudo();let i=this.route.snapshot.paramMap.get("id");if(i){let e=this.habilidadeService.habilidades.find(n=>String(n.id)===String(i));e&&(this.habilidadeEdit={id:String(e.id),caminho:String(e.caminho),arvore:String(e.arvore),habilidade:e.habilidade,nivel:e.nivel,requisitos:e.requisitos||"",descricao:e.descricao||"",dependencia:e.dependencia?String(e.dependencia):null},this.caminhoSelecionado=this.habilidadeEdit.caminho,this.arvoreSelecionada=this.habilidadeEdit.arvore,this.dependenciaSelecionada=this.habilidadeEdit.dependencia,this.editMode=!0,this.onCaminhoChange(this.caminhoSelecionado,!1),this.onArvoreChange(this.arvoreSelecionada),this.atualizarPreview())}this.renderPreview()})}ngAfterViewInit(){this.renderPreview()}get arvoresDoCaminho(){return this.habilidadeService.getArvoresDoCaminho(this.caminhoSelecionado)}get habilidadesDaArvore(){return this.habilidadeService.getHabilidadesDaArvore(this.arvoreSelecionada)}onCaminhoChange(i,e=!0){this.caminhoSelecionado=i?String(i):null,e&&(this.arvoreSelecionada=null),this.atualizarPreview()}onArvoreChange(i){this.arvoreSelecionada=i?String(i):null,i==="nova"&&(this.novaArvoreNome=""),this.atualizarPreview()}renderPreview(){this.cyPreviewRef&&(this.cyInstance&&this.cyInstance.destroy(),this.cyInstance=this.habilidadeService.renderPreview(this.cyPreviewRef.nativeElement,this.habilidadesDaArvore,this.habilidadeEdit,this.dependenciaSelecionada,this.editMode,i=>this.habilidadeSelecionada=i))}salvar(i){return x(this,null,function*(){if(!i.invalid)try{this.salvando=!0,yield this.habilidadeService.salvarHabilidade(this.habilidadeEdit,this.caminhoSelecionado,this.arvoreSelecionada,this.dependenciaSelecionada,this.novaArvoreNome,this.habilidadeService.arvores,this.habilidadeService.habilidades),alert("\u2705 Habilidade salva com sucesso!"),this.router.navigate(["/skills-jogador"])}catch(e){console.error(e),alert("\u274C Erro ao salvar")}finally{this.salvando=!1}})}excluir(){return x(this,null,function*(){if(this.habilidadeEdit.id)try{this.salvando=!0,(yield this.habilidadeService.excluirHabilidadeComDependencias(this.habilidadeEdit.id,this.habilidadeService.habilidades))&&(alert("\u{1F5D1}\uFE0F Habilidade exclu\xEDda com sucesso!"),this.router.navigate(["/skills-jogador"]))}catch(i){console.error("[EdicaoSkillTree] \u274C Erro ao excluir:",i),alert("\u274C Erro ao excluir")}finally{this.salvando=!1}})}atualizarPreview(){setTimeout(()=>{this.habilidadeEdit.caminho=this.caminhoSelecionado||"",this.habilidadeEdit.arvore=this.arvoreSelecionada||"",this.renderPreview(),this.habilidadeSelecionada=k({},this.habilidadeEdit)},0)}get arvoreSelecionadaNome(){if(this.arvoreSelecionada==="nova")return this.novaArvoreNome||"Nova \xC1rvore";let i=this.habilidadeService.arvores.find(e=>String(e.id)===String(this.arvoreSelecionada));return i?i.arvore:"Sem \xE1rvore"}get caminhos(){return this.habilidadeService.caminhos}get arvores(){return this.habilidadeService.arvores}get habilidades(){return this.habilidadeService.habilidades}static \u0275fac=function(e){return new(e||a)(I(J),I(K),I(P))};static \u0275cmp=B({type:a,selectors:[["app-edicao-skilltree"]],viewQuery:function(e,n){if(e&1&&R(fe,5),e&2){let t;j(t=z())&&(n.cyPreviewRef=t.first)}},decls:33,vars:16,consts:[["cyPreview",""],["form","ngForm"],[1,"edicao-skilltree-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"edicao-skilltree-container","w-100"],[1,"page-title"],[1,"preview-wrapper","mt-4"],[1,"text-light"],[1,"cy-preview"],["class","detalhe-card shadow-lg mt-4 p-3",4,"ngIf"],["id","formSkillTree",3,"ngSubmit"],[1,"mb-3"],[1,"form-label"],["name","caminhoSelecionado","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"fab-stack"],["type","submit","form","formSkillTree",1,"fab","fab-success",3,"disabled"],[4,"ngIf"],["type","button","class","fab fab-danger",3,"click",4,"ngIf"],["type","button",1,"fab","fab-warning",3,"click"],[1,"detalhe-card","shadow-lg","mt-4","p-3"],[1,"detalhe-nome"],[1,"nivel"],[1,"detalhe-descricao"],["class","detalhe-extra",4,"ngIf"],[1,"detalhe-extra"],[3,"ngValue"],["name","arvoreSelecionada","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["class","mt-2",4,"ngIf"],[1,"mt-2"],["type","text","name","novaArvoreNome","placeholder","Digite o nome da nova \xE1rvore",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","dependenciaSelecionada",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["type","text","name","habilidade","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["type","number","name","nivel","min","1","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","requisitos",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","descricao",1,"form-control","input-dark",3,"ngModelChange","ngModel"],[1,"spinner-border","spinner-border-sm"],["type","button",1,"fab","fab-danger",3,"click"]],template:function(e,n){if(e&1){let t=S();l(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),s(4),d(),l(5,"div",6)(6,"h4",7),s(7),d(),H(8,"div",8,0),d(),b(10,be,8,4,"div",9),l(11,"form",10,1),_("ngSubmit",function(){g(t);let h=O(12);return p(n.salvar(h))}),l(13,"div",11)(14,"label",12),s(15,"\u{1F310} Caminho"),d(),l(16,"select",13),y("ngModelChange",function(h){return g(t),w(n.caminhoSelecionado,h)||(n.caminhoSelecionado=h),p(h)}),_("ngModelChange",function(h){return g(t),p(n.onCaminhoChange(h))}),l(17,"option",14),s(18,"Selecione..."),d(),b(19,Se,2,2,"option",15),d()(),b(20,we,10,5,"div",16)(21,Ee,7,3,"div",16)(22,ke,4,1,"div",16)(23,De,4,1,"div",16)(24,Me,4,1,"div",16)(25,Te,4,1,"div",16),d()()(),l(26,"div",17)(27,"button",18),b(28,Ve,2,0,"ng-container",19)(29,Ie,2,0,"ng-container",19),d(),b(30,Pe,2,0,"button",20),l(31,"button",21),_("click",function(){return g(t),p(n.router.navigate(["/skilltree"]))}),s(32,"\u2B05\uFE0F"),d()()()}if(e&2){let t=O(12);r(4),D("\u{1F6E0}\uFE0F ",n.editMode?"Editar":"Cadastro"," da SkillTree"),r(3),D("\u{1F50E} Pr\xE9via \u2014 ",n.arvoreSelecionadaNome),r(3),m("ngIf",n.habilidadeSelecionada),r(6),C("ngModel",n.caminhoSelecionado),r(),m("ngValue",null),r(2),m("ngForOf",n.caminhos),r(),m("ngIf",n.caminhoSelecionado),r(),m("ngIf",n.arvoreSelecionada),r(),m("ngIf",n.arvoreSelecionada),r(),m("ngIf",n.arvoreSelecionada),r(),m("ngIf",n.arvoreSelecionada),r(),m("ngIf",n.arvoreSelecionada),r(2),m("disabled",(t==null?null:t.invalid)||n.salvando),r(),m("ngIf",!n.salvando),r(),m("ngIf",n.salvando),r(),m("ngIf",n.editMode)}},dependencies:[Z,U,G,ce,te,re,oe,X,ne,ae,Y,$,le,de,ie,ee],styles:[".edicao-skilltree-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden;border:1px solid #333}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border:1px solid #444!important;border-radius:6px;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd!important;box-shadow:0 0 0 .2rem #0d6efd40!important;outline:none!important}textarea[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px;resize:vertical}textarea[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.cy-preview[_ngcontent-%COMP%]{width:100%;height:400px;min-height:300px;background:#111;border:1px solid #333;border-radius:8px;margin-top:10px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-danger[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545,#a71d2a);color:#fff}node.habilidade-edit[_ngcontent-%COMP%]{background-color:#0056b3!important;border:3px solid #0d6efd!important;color:#fff!important}"]})};export{me as EdicaoSkillTree};
