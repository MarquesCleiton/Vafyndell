import{a as Ce,d as Ie,e as we,h as xe,o as Me,p as ye,q as De,r as Se,u as Ee,v as Oe}from"./chunk-CG2SQOMH.js";import{A as re,B as de,K as le,N as ce}from"./chunk-DI5MEB7V.js";import{a as B}from"./chunk-XQNWO7VY.js";import{c as se,f as me,g as pe,h as ge,i as ue,j as fe,k as ve,q as _e,r as he,s as be}from"./chunk-NOURQFKT.js";import{a as M}from"./chunk-W2L5F7JW.js";import{f as oe,h as ae}from"./chunk-P5XSKUQX.js";import{e as ee,h as te,i as ie,q as ne,x as z}from"./chunk-UNL43WIN.js";import{Ab as p,Bb as o,Cb as a,Db as $,Hb as D,Ib as S,Jb as L,Nb as _,Pb as E,Sa as A,Ua as d,Za as k,Zb as x,a as H,b as K,bc as c,cc as N,dc as Y,eb as X,ec as Z,g as y,gc as F,hc as V,ic as R,jb as w,la as g,ma as u,sc as U}from"./chunk-XPYPFFIJ.js";function ke(n,i){if(n&1){let t=L();o(0,"mat-option",31),_("click",function(){g(t);let l=E();return u(l.novoItem())}),o(1,"mat-icon",32),c(2,"add_circle"),a(),c(3," Novo "),a()}}function $e(n,i){if(n&1&&(D(0),$(1,"img",36),S()),n&2){let t=E().$implicit;d(),p("src",t.imagem,A)}}function Fe(n,i){n&1&&(o(0,"span",32),c(1,"\u{1F4E6}"),a())}function Ve(n,i){if(n&1&&(o(0,"mat-option",33)(1,"div",34),w(2,$e,2,1,"ng-container",35)(3,Fe,2,0,"ng-template",null,2,U),o(5,"span"),c(6),a()()()),n&2){let t=i.$implicit,e=x(4);p("value",t),d(2),p("ngIf",t.imagem&&t.imagem!=="-")("ngIfElse",e),d(4),N(t.nome)}}function Re(n,i){if(n&1&&(D(0),$(1,"img",40),S()),n&2){let t=E(2);d(),p("src",t.selecionado.imagem,A)}}function qe(n,i){n&1&&(o(0,"span",41),c(1,"\u{1F4E6}"),a())}function Te(n,i){if(n&1&&(o(0,"div",37)(1,"div",34),w(2,Re,2,1,"ng-container",35)(3,qe,2,0,"ng-template",null,3,U),o(5,"div")(6,"h6",38),c(7),a(),o(8,"small",39),c(9),a()()()()),n&2){let t=x(4),e=E();d(2),p("ngIf",e.selecionado.imagem&&e.selecionado.imagem!=="-")("ngIfElse",t),d(5),N(e.selecionado.nome),d(2),Z(" ",e.selecionado.categoria," | ",e.selecionado.raridade," ")}}function je(n,i){n&1&&(D(0),c(1,"\u{1F4BE}"),S())}function Ae(n,i){n&1&&(D(0),$(1,"span",42),S())}var Pe=class n{constructor(i,t,e){this.router=i;this.route=t;this.location=e}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;descricao="";salvando=!1;editando=!1;inventarioAtual=null;catalogoRepo=new M("Catalogo");inventarioRepo=new M("Inventario");registroRepo=new M("Registro");jogadoresRepo=new M("Personagem");ngOnInit(){return y(this,null,function*(){try{this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens,this.catalogoRepo.sync().then(t=>y(this,null,function*(){t&&(this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens)}));let i=this.route.snapshot.paramMap.get("id");if(i){this.editando=!0;let t=z.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield this.inventarioRepo.getLocal();this.inventarioAtual=e.find(l=>String(l.id)===String(i)&&l.jogador===t.email)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual),this.descricao="")}}catch(i){console.error("[CadastroInventario] \u274C Erro ao carregar:",i)}})}carregarItemSelecionado(i){return y(this,null,function*(){this.catalogoItens.length||(this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens),this.selecionado=this.catalogoItens.find(t=>String(t.id)===String(i.item_catalogo))||null,this.quantidade=i.quantidade,this.filtro=this.selecionado?.nome||""})}filtrarItens(){let i=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),t=i(this.filtro||"");this.catalogoFiltrado=t?this.catalogoItens.filter(e=>i(e.nome).includes(t)):[...this.catalogoItens]}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(0,this.quantidade-1)}cancelar(){this.location.back()}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}salvar(i){return y(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let t=z.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");let e=t.email,m=((yield this.jogadoresRepo.getLocal()).find(P=>P.email===e)||null)?.personagem||"Voc\xEA",r=this.selecionado?.unidade_medida||"unidade(s)",q=`${this.selecionado?.nome||"Item desconhecido"}`,h=(yield this.inventarioRepo.getLocal()).find(P=>P.jogador===e&&String(P.item_catalogo)===String(this.selecionado.id)),b=this.descricao.trim(),T,W,J="",v="",C="",I=h?h.quantidade:0,f=this.editando?this.quantidade:I+this.quantidade,s=f-I,Q=`Quantidade: ${I} \u2192 ${f} (${s>=0?"+":""}${s} ${r})`+(b?`
${b}`:"");if(s>0&&!this.editando?C="adicionar\xE1 um item ao invent\xE1rio":s>0&&this.editando?C="editar\xE1 um item ao invent\xE1rio":s<0?C="consumir\xE1 um item do invent\xE1rio":f===0?C="remover\xE1 o item do invent\xE1rio":C="atualizar\xE1 o invent\xE1rio",J=`\u{1F9CD}\u200D\u2642\uFE0F Voc\xEA ${C}
\u{1F392} ${q}: ${I} \u2192 ${f} (${s>=0?"+":""}${s} ${r})
`+(b?`\u{1F4DD} ${b}`:""),s>0&&!this.editando?v="adicionou um item ao invent\xE1rio":s>0&&this.editando?v="editou um item do invent\xE1rio":s<0?v="consumiu um item do invent\xE1rio":f===0?v="removeu o item do invent\xE1rio":v="atualizou o invent\xE1rio",!confirm(`${J}

Deseja confirmar a opera\xE7\xE3o?`)){this.salvando=!1;return}let O=h?.descricao?.trim()||"",G=this.editando?Q+(O?`
---
${O}`:""):Q+(O?`
---
${O}`:"");T=h?K(H({},h),{quantidade:f,descricao:G}):{id:B.generateULID(),index:Date.now(),jogador:e,item_catalogo:this.selecionado.id,quantidade:f,descricao:G},W={id:B.generateULID(),jogador:e,alvo:e,tipo:"inventario",acao:v,detalhes:`\u{1F4E6} ${m} ${v}
\u{1F392} ${q}: ${I} \u2192 ${f} (${s>=0?"+":""}${s} ${r})
`+(b?`\u{1F4DD} Descri\xE7\xE3o: ${b}`:""),data:new Date().toISOString()};let j={create:{Registro:[W]}};h?j.updateById={Inventario:[T]}:j.create.Inventario=[T],yield M.batch(j),alert(`\u2705 Opera\xE7\xE3o conclu\xEDda!

${m} ${v}
\u{1F392} ${q}: ${I} \u2192 ${f} (${s>=0?"+":""}${s} ${r})`),this.router.navigate(["/inventario-jogador"])}catch(t){console.error("[CadastroInventario] \u274C Erro ao salvar:",t),alert("\u274C Erro ao salvar item.")}finally{this.salvando=!1}})}displayFn(i){return i?i.nome:""}static \u0275fac=function(t){return new(t||n)(k(ae),k(oe),k(ee))};static \u0275cmp=X({type:n,selectors:[["app-cadastro-inventario"]],decls:42,vars:12,consts:[["form","ngForm"],["auto","matAutocomplete"],["noItemIcon",""],["noPreviewIcon",""],[1,"inventario-cadastro-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-cadastro-container","w-100"],["id","formInventario",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","fill",1,"w-100","input-dark","compact-select","dropdown-field"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],["mat-icon-button","","matSuffix","","disabled","",1,"dropdown-arrow"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","quantidade","min","0","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],["rows","3","name","descricao","placeholder","Ex: Comprado no mercado, ganho em miss\xE3o, achado nas ru\xEDnas...",1,"form-control","bg-dark","text-light","border-secondary",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","button",1,"fab","fab-warning",3,"click"],["type","submit","form","formInventario",1,"fab","fab-primary",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],[4,"ngIf","ngIfElse"],[1,"me-2","rounded",2,"width","24px","height","24px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],[1,"fw-bold","text-light","mb-1"],[1,"text-light"],[1,"me-3","rounded","preview-img",3,"src"],[1,"me-3"],[1,"spinner-border","spinner-border-sm"]],template:function(t,e){if(t&1){let l=L();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"form",7,0),_("ngSubmit",function(){g(l);let r=x(4);return u(e.salvar(r))}),o(5,"div",8)(6,"div",9)(7,"h4",10),c(8),a()(),o(9,"div",11)(10,"div",12)(11,"label",13),c(12,"\u{1F3F7}\uFE0F Item *"),a(),o(13,"mat-form-field",14)(14,"input",15),R("ngModelChange",function(r){return g(l),V(e.filtro,r)||(e.filtro=r),u(r)}),_("input",function(){return g(l),u(e.filtrarItens())}),a(),o(15,"button",16)(16,"mat-icon"),c(17,"arrow_drop_down"),a()(),o(18,"mat-autocomplete",17,1),_("optionSelected",function(r){return g(l),u(e.selecionarItem(r.option.value))}),w(20,ke,4,0,"mat-option",18)(21,Ve,7,4,"mat-option",19),a()()(),w(22,Te,10,5,"div",20),o(23,"div",21)(24,"label",22),c(25,"\u{1F522} Quantidade *"),a(),o(26,"div",23)(27,"button",24),_("click",function(){return g(l),u(e.decrementar())}),c(28,"\u2212"),a(),o(29,"input",25),R("ngModelChange",function(r){return g(l),V(e.quantidade,r)||(e.quantidade=r),u(r)}),a(),o(30,"button",24),_("click",function(){return g(l),u(e.incrementar())}),c(31,"+"),a()()(),o(32,"div",12)(33,"label",13),c(34,"\u{1F4DD} Descri\xE7\xE3o (opcional)"),a(),o(35,"textarea",26),R("ngModelChange",function(r){return g(l),V(e.descricao,r)||(e.descricao=r),u(r)}),a()()()()()()(),o(36,"div",27)(37,"button",28),_("click",function(){return g(l),u(e.cancelar())}),c(38,"\u2B05\uFE0F"),a(),o(39,"button",29),w(40,je,2,0,"ng-container",30)(41,Ae,2,0,"ng-container",30),a()()()}if(t&2){let l=x(4),m=x(19);d(8),Y(" \u{1F392} ",e.editando?"Editar Item do Invent\xE1rio":"Adicionar ao Invent\xE1rio"," "),d(6),F("ngModel",e.filtro),p("matAutocomplete",m)("readonly",e.editando),d(6),p("ngIf",!e.editando),d(),p("ngForOf",e.catalogoFiltrado),d(),p("ngIf",e.selecionado),d(7),F("ngModel",e.quantidade),d(6),F("ngModel",e.descricao),d(4),p("disabled",l.invalid||e.salvando),d(),p("ngIf",!e.salvando),d(),p("ngIf",e.salvando)}},dependencies:[ne,te,ie,be,fe,se,ve,me,pe,he,_e,ue,ge,we,Ie,Ce,Se,ye,xe,De,Oe,Ee,Me,de,re,ce,le],styles:[".inventario-cadastro-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inventario-cadastro-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border-radius:6px;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{padding:.25rem .5rem}.compact-select[_ngcontent-%COMP%]   .mat-select-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.dropdown-field[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.dropdown-arrow[_ngcontent-%COMP%]{pointer-events:none;color:#bbb!important;margin-left:auto}.dropdown-arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.4rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.5rem .75rem;text-align:left}.preview-img[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;border-radius:.5rem;border:1px solid #6c757d}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.2rem;font-size:.85rem}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}@media (min-width: 992px){.inventario-cadastro-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{Pe as CadastroInventario};
