import{a as _}from"./chunk-FJZA3HMC.js";import{b as N,e as L,h as R,q as V}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import"./chunk-HS244SCX.js";import{Ga as l,Ha as o,Ia as r,Ib as k,Ja as f,Jb as J,Mb as O,Na as v,Oa as b,Pa as I,Ra as y,S as C,T as E,Ta as c,Vb as P,bb as u,d as g,fb as d,gb as w,ha as D,hb as x,ia as n,kb as B,lb as S,ma as F,mb as T,nb as M,qa as j,sb as h,ua as p}from"./chunk-ILJPX4RU.js";function A(t,i){t&1&&(o(0,"div",14),f(1,"div",15),o(2,"p",16),d(3,"Carregando jogadores..."),r()())}function z(t,i){if(t&1&&f(0,"img",31),t&2){let e=c().$implicit;l("alt",M(e.personagem))("src",e.imagem,D)}}function W(t,i){t&1&&(o(0,"span",27),d(1,"\u{1F464}"),r())}function q(t,i){if(t&1&&(o(0,"span",34),d(1),r()),t&2){let e=c(2).$implicit;n(),x(" \u{1F6E1}\uFE0F ",e.classe_de_armadura," ")}}function U(t,i){t&1&&(o(0,"span",32),d(1,"\u{1F6E1}\uFE0F\u274C"),r())}function Y(t,i){if(t&1&&(v(0),o(1,"span",32),d(2),r(),p(3,q,2,1,"span",33)(4,U,2,0,"ng-template",null,2,h),b()),t&2){let e=u(5),a=c().$implicit;n(2),x("\u2764\uFE0F ",a.pontos_de_vida),n(),l("ngIf",a.classe_de_armadura>0)("ngIfElse",e)}}function G(t,i){t&1&&(o(0,"span",35),d(1,"\u{1F480} \u26B0\uFE0F"),r())}function H(t,i){if(t&1&&(o(0,"span"),d(1),r()),t&2){let e=c().$implicit;n(),x("| ",e.tipo)}}function K(t,i){t&1&&(v(0),f(1,"span",36),b())}function Q(t,i){t&1&&d(0,"\u2694\uFE0F")}function X(t,i){t&1&&(v(0),f(1,"span",36),b())}function Z(t,i){t&1&&d(0,"\u{1F5D1}\uFE0F")}function ee(t,i){if(t&1){let e=I();o(0,"button",37),y("click",function(){C(e);let s=c().$implicit,m=c(2);return E(m.excluirNpcDaBatalha(s))}),p(1,X,2,0,"ng-container",26)(2,Z,1,0,"ng-template",null,3,h),r()}if(t&2){let e=u(3),a=c().$implicit,s=c(2);l("disabled",s.processando[a.id]==="excluir"),n(),l("ngIf",s.processando[a.id]==="excluir")("ngIfElse",e)}}function te(t,i){if(t&1){let e=I();o(0,"div",18)(1,"div",19)(2,"div",20),p(3,z,1,3,"img",21)(4,W,2,0,"span",22),r(),o(5,"div",23)(6,"h6",24)(7,"span",25),d(8),r(),p(9,Y,6,3,"ng-container",26)(10,G,2,0,"ng-template",null,0,h),r(),o(12,"small",27),d(13),p(14,H,2,1,"span",12),r()(),o(15,"div",28)(16,"button",29),y("click",function(){let s=C(e).$implicit,m=c(2);return E(m.abrirJogador(s))}),p(17,K,2,0,"ng-container",26)(18,Q,1,0,"ng-template",null,1,h),r(),p(20,ee,4,3,"button",30),r()()()}if(t&2){let e=i.$implicit,a=u(11),s=u(19),m=c(2);n(3),l("ngIf",e.imagem),n(),l("ngIf",!e.imagem),n(4),w(e.personagem),n(),l("ngIf",e.pontos_de_vida>0)("ngIfElse",a),n(4),x(" ",e.classificacao||"Jogador"," "),n(),l("ngIf",e.tipo),n(2),l("disabled",m.processando[e.id]==="abrir"),n(),l("ngIf",m.processando[e.id]==="abrir")("ngIfElse",s),n(3),l("ngIf",!e.email)}}function ie(t,i){if(t&1&&(o(0,"div"),p(1,te,21,11,"div",17),r()),t&2){let e=c();n(),l("ngForOf",e.jogadoresFiltrados)}}function ae(t,i){t&1&&(o(0,"div",38),d(1," Nenhum jogador encontrado. "),r())}var $=class t{constructor(i){this.router=i}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};ngOnInit(){return g(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let i=yield _.getLocalJogadores();if(i.length>0&&(this.jogadores=i,this.aplicarFiltro(),this.carregando=!1),_.syncJogadores().then(e=>g(this,null,function*(){if(e){let a=yield _.getLocalJogadores();this.jogadores=a,this.aplicarFiltro()}})),i.length===0){let e=yield _.forceFetchJogador();e&&(this.jogadores=Array.isArray(e)?e:[e],this.aplicarFiltro()),this.carregando=!1}}catch(i){console.error("[Batalha] Erro ao carregar jogadores:",i),this.carregando=!1}})}aplicarFiltro(){let i=this.filtro.toLowerCase().trim();if(!i){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(e=>String(e.personagem||"").toLowerCase().includes(i)||String(e.nome_do_jogador||"").toLowerCase().includes(i)||String(e.classificacao||"").toLowerCase().includes(i)||String(e.tipo||"").toLowerCase().includes(i))}abrirJogador(i){return g(this,null,function*(){this.processando[i.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador",i.id]),this.processando[i.id]=null},400)})}excluirNpcDaBatalha(i){return g(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${i.personagem}" do campo de batalha?`)){this.processando[i.id]="excluir";try{yield _.deleteJogador(i.id),this.jogadores=this.jogadores.filter(a=>a.id!==i.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(a){console.error("[Batalha] Erro ao excluir NPC:",a),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[i.id]=null}}})}static \u0275fac=function(e){return new(e||t)(F(P))};static \u0275cmp=j({type:t,selectors:[["app-batalha"]],decls:11,vars:4,consts:[["morto",""],["abrirIcon",""],["semArmadura",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"bg-black","border-bottom","sticky-top"],[1,"p-3","d-flex","justify-content-between","align-items-center"],[1,"m-0"],[1,"p-2","border-top","bg-dark"],["type","text","placeholder","\u{1F50D} Pesquisar...",1,"form-control","bg-dark","text-light","border-light","rounded-pill",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card bg-secondary text-light mb-2 shadow-sm jogador-card",4,"ngFor","ngForOf"],[1,"card","bg-secondary","text-light","mb-2","shadow-sm","jogador-card"],[1,"d-flex","align-items-center","p-2","position-relative"],[1,"rounded","me-3","d-flex","align-items-center","justify-content-center","bg-dark",2,"width","55px","height","55px","overflow","hidden"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"flex-grow-1"],[1,"fw-bold","mb-1","d-flex","align-items-center"],[1,"me-3"],[4,"ngIf","ngIfElse"],[1,"text-muted"],[1,"d-flex","ms-2"],[1,"btn","btn-sm","btn-outline-light","me-1",3,"click","disabled"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"me-2","text-danger"],["class","me-2 text-primary",4,"ngIf","ngIfElse"],[1,"me-2","text-primary"],[1,"me-2"],[1,"spinner-border","spinner-border-sm"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"text-center","text-muted","py-5"]],template:function(e,a){e&1&&(o(0,"div",4)(1,"div",5)(2,"div",6)(3,"h5",7),d(4,"\u2694\uFE0F Batalha"),r()(),o(5,"div",8)(6,"input",9),T("ngModelChange",function(m){return S(a.filtro,m)||(a.filtro=m),m}),y("input",function(){return a.aplicarFiltro()}),r()()(),o(7,"div",10),p(8,A,4,0,"div",11)(9,ie,2,1,"div",12)(10,ae,2,0,"div",13),r()()),e&2&&(n(6),B("ngModel",a.filtro),n(2),l("ngIf",a.carregando),n(),l("ngIf",!a.carregando&&a.jogadoresFiltrados.length>0),n(),l("ngIf",!a.carregando&&a.jogadoresFiltrados.length===0))},dependencies:[O,k,J,V,N,L,R],styles:[".jogador-card[_ngcontent-%COMP%]{border-radius:10px;transition:transform .15s ease}.jogador-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.jogador-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .jogador-card[_ngcontent-%COMP%]   .bg-dark[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:6px}button.btn[_ngcontent-%COMP%]{border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;padding:0}"]})};export{$ as Batalha};
