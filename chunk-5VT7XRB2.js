import{a as G}from"./chunk-ZBMM7GYJ.js";import"./chunk-R66HVWNJ.js";import"./chunk-XQNWO7VY.js";import{r as X}from"./chunk-7HYCYAOW.js";import{a as E}from"./chunk-DET3QFJ6.js";import{e as L,f as $,g as N,i as B,j as H,q as U,s as W}from"./chunk-7SGEPDVZ.js";import{Ab as r,Bb as o,Cb as b,Gb as F,Hb as O,Ib as C,Mb as f,Ob as s,Sa as P,Ta as n,Ya as V,Yb as J,_b as D,a as w,ac as l,b as S,bc as u,cc as _,db as j,dc as M,ec as k,g as x,ib as p,ic as T,la as h,lc as A,ma as I,nc as R,oc as z,pc as q,zb as d}from"./chunk-DNZPJZVY.js";var ee=i=>({"text-danger fw-bold":i});function te(i,t){if(i&1){let e=C();r(0,"li",3)(1,"button",4),f("click",function(){h(e);let c=s();return I(c.selecionarAba("inventario"))}),l(2," \u{1F392} Invent\xE1rio "),o()()}if(i&2){let e=s();n(),D("active",e.abaAtiva==="inventario")}}function ie(i,t){if(i&1){let e=C();r(0,"li",3)(1,"button",4),f("click",function(){h(e);let c=s();return I(c.selecionarAba("habilidades"))}),l(2," \u{1F333} Habilidades "),o()()}if(i&2){let e=s();n(),D("active",e.abaAtiva==="habilidades")}}function ae(i,t){i&1&&(r(0,"div",15),b(1,"div",16),r(2,"p",17),l(3,"Carregando..."),o()())}function ne(i,t){if(i&1&&(F(0),b(1,"img",30),O()),i&2){let e=s(2);n(),d("src",e.jogador.imagem,P)}}function oe(i,t){i&1&&(r(0,"div",31),l(1,"\u{1F464}"),o())}function re(i,t){if(i&1&&(r(0,"div",32),l(1),r(2,"span"),l(3),o(),r(4,"b"),l(5),o(),r(6,"small",33),l(7),o()()),i&2){let e=t.$implicit;n(),_(" ",e.icon," "),n(2),u(e.label),n(2),u(e.value),n(2),_("(",e.mod>=0?"+"+e.mod:e.mod,")")}}function le(i,t){if(i&1&&(r(0,"p",39),l(1),o()),i&2){let e=s(3);n(),u(e.jogador.descricao)}}function de(i,t){i&1&&(r(0,"h6",40),l(1,"\u2694\uFE0F Ataques"),o())}function se(i,t){if(i&1&&(r(0,"p",41),l(1),o()),i&2){let e=s(3);n(),u(e.jogador.ataques)}}function ce(i,t){if(i&1&&(r(0,"div",34)(1,"h6",35),l(2,"\u{1F4DD} Descri\xE7\xE3o"),o(),p(3,le,2,1,"p",36)(4,de,2,0,"h6",37)(5,se,2,1,"p",38),o()),i&2){let e=s(2);n(3),d("ngIf",e.jogador.descricao),n(),d("ngIf",e.jogador.ataques),n(),d("ngIf",e.jogador.ataques)}}function me(i,t){if(i&1&&(r(0,"div",18)(1,"div",19),p(2,ne,2,1,"ng-container",20)(3,oe,2,0,"ng-template",null,0,q),o(),r(5,"div",21)(6,"h4",22),l(7),o(),r(8,"p",23),l(9),o(),r(10,"ul",24)(11,"li"),l(12),o(),r(13,"li"),l(14,"\u2764\uFE0F Vida: "),r(15,"span",25),l(16),o(),l(17),o(),r(18,"li"),l(19),o(),r(20,"li"),l(21),o(),r(22,"li"),l(23),o(),r(24,"li"),l(25),o()(),r(26,"h6",26),l(27,"\u{1F4CA} Atributos"),o(),r(28,"div",27),p(29,re,8,4,"div",28),o(),p(30,ce,6,3,"div",29),o()()),i&2){let e=J(4),a=s();n(2),d("ngIf",a.jogador.imagem&&a.jogador.imagem!=="-")("ngIfElse",e),n(5),M("",a.jogador.email?"\u{1F9D9}":"\u{1F479}"," ",a.jogador.personagem),n(2),_("\u2696\uFE0F ",a.jogador.alinhamento||"Sem alinhamento"),n(3),_("\u2B50 XP: ",a.jogador.xp),n(3),d("ngClass",A(15,ee,a.jogador.vida_atual<=0)),n(),u(a.jogador.vida_atual),n(),_(" / ",a.jogador.pontos_de_vida," "),n(2),_("\u{1F6E1}\uFE0F Armadura: ",a.jogador.classe_de_armadura),n(2),_("\u{1F494} Dano tomado: ",a.jogador.dano_tomado),n(2),_("\u2728 Fator de cura: ",a.jogador.fator_cura),n(2),_("\u{1F6B6}\u200D\u2642\uFE0F Deslocamento: ",a.jogador.deslocamento),n(4),d("ngForOf",a.atributos),n(),d("ngIf",!a.jogador.email)}}function ge(i,t){if(i&1){let e=C();r(0,"li",3)(1,"button",4),f("click",function(){let c=h(e).$implicit,g=s(2);return I(g.selecionarAbaInventario(c))}),l(2),o()()}if(i&2){let e=t.$implicit,a=s(2);n(),D("active",a.abaInventario===e.toLowerCase()),n(),_(" ",e," ")}}function pe(i,t){if(i&1&&(r(0,"div",48)(1,"p",49),l(2," \u2696\uFE0F Peso total: "),r(3,"b"),l(4),R(5,"number"),o()()()),i&2){let e=s(2);n(4),_("",z(5,1,e.resumo.pesoTotal,"1.0-2")," kg")}}function _e(i,t){i&1&&(r(0,"div",15),b(1,"div",16),r(2,"p",17),l(3,"Carregando invent\xE1rio..."),o()())}function ue(i,t){i&1&&(r(0,"div",50),l(1," Nenhum item encontrado. "),o())}function ve(i,t){if(i&1&&b(0,"img",66),i&2){let e=s().$implicit;d("alt",T(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,P)}}function fe(i,t){i&1&&(r(0,"span"),l(1,"\u{1F4E6}"),o())}function xe(i,t){if(i&1&&(r(0,"p",67),l(1),o()),i&2){let e=s().$implicit;n(),_("\u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito)}}function be(i,t){if(i&1&&(r(0,"p",68),l(1),o()),i&2){let e=s().$implicit;n(),_("\u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function he(i,t){if(i&1&&(r(0,"div",58)(1,"div",59)(2,"div",60)(3,"div",61),p(4,ve,1,3,"img",62)(5,fe,2,0,"span",11),o(),r(6,"div")(7,"h6",22),l(8),o(),r(9,"small",63),l(10),o()()(),p(11,xe,2,1,"p",64)(12,be,2,1,"p",65),o()()),i&2){let e=t.$implicit;n(4),d("ngIf",(e.itemDetalhe==null?null:e.itemDetalhe.imagem)&&(e.itemDetalhe==null?null:e.itemDetalhe.imagem)!=="-"),n(),d("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)||(e.itemDetalhe==null?null:e.itemDetalhe.imagem)==="-"),n(3),u((e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"),n(2),k(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",(e.itemDetalhe==null?null:e.itemDetalhe.peso)||0," kg "),n(),d("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),n(),d("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function Ie(i,t){if(i&1&&(r(0,"div",17)(1,"div",56),p(2,he,13,8,"div",57),o()()),i&2){let e=s(2).$implicit;n(2),d("ngForOf",e.itens)}}function Ce(i,t){if(i&1){let e=C();r(0,"div",53)(1,"button",54),f("click",function(){h(e);let c=s().$implicit,g=s(3);return I(g.toggleCategoria(c))}),r(2,"span"),l(3),o(),r(4,"span"),l(5),o()(),p(6,Ie,3,1,"div",55),o()}if(i&2){let e=s().$implicit;n(3),u(e.nome),n(2),u(e.expandido?"\u2212":"+"),n(),d("ngIf",e.expandido)}}function De(i,t){if(i&1&&(F(0),p(1,Ce,7,3,"div",52),O()),i&2){let e=t.$implicit,a=s(3);n(),d("ngIf",a.pertenceAbaInventario(e.nome))}}function Ee(i,t){if(i&1&&(r(0,"div"),p(1,De,2,1,"ng-container",51),o()),i&2){let e=s(2);n(),d("ngForOf",e.categoriasFiltradas)}}function ye(i,t){if(i&1&&(r(0,"div",42)(1,"ul",43),p(2,ge,3,3,"li",44),o(),r(3,"h4",45),l(4,"\u{1F392} Invent\xE1rio"),o(),p(5,pe,6,4,"div",46)(6,_e,4,0,"div",8)(7,ue,2,0,"div",47)(8,Ee,2,1,"div",11),o()),i&2){let e=s();n(2),d("ngForOf",e.abasInventario),n(3),d("ngIf",!e.carregandoInventario&&e.categoriasFiltradas.length>0),n(),d("ngIf",e.carregandoInventario),n(),d("ngIf",!e.carregandoInventario&&e.categoriasFiltradas.length===0),n(),d("ngIf",!e.carregandoInventario)}}function we(i,t){if(i&1&&b(0,"app-skilltree",70),i&2){let e=s(2);d("jogadorId",e.jogador==null?null:e.jogador.email)}}function Se(i,t){if(i&1&&(r(0,"div"),p(1,we,1,1,"app-skilltree",69),o()),i&2){let e=s();n(),d("ngIf",e.jogador==null?null:e.jogador.email)}}function Pe(i,t){i&1&&(r(0,"div",71),l(1," Nenhum personagem encontrado. "),o())}var K=class i{constructor(t,e){this.route=t;this.router=e}jogador=null;atributos=[];loading=!0;categorias=[];categoriasFiltradas=[];carregandoInventario=!0;resumo={tipos:0,unidades:0,pesoTotal:0};abaAtiva="jogador";abaInventario="recursos";abaHabilidade="Warlord";abasInventario=["Recursos","Equipamentos","Pocoes","Outros"];abasHabilidades=["Warlord","Arcane","Rogue"];jogadorRepo=new E("Personagem");catalogoRepo=new E("Catalogo");inventarioRepo=new E("Inventario");ngOnInit(){return x(this,null,function*(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.router.navigate(["/jogadores"]);return}try{yield this.loadJogador(t),this.jogador?.email&&(yield this.loadInventario(this.jogador.email))}catch(e){console.error("[VisaoJogadores] Erro:",e)}finally{this.loading=!1}})}loadJogador(t){return x(this,null,function*(){let a=(yield this.jogadorRepo.getLocal()).find(c=>String(c.id)===String(t));if(a&&this.setJogador(a),this.jogadorRepo.sync().then(c=>x(this,null,function*(){if(c){let m=(yield this.jogadorRepo.getLocal()).find(v=>String(v.id)===String(t));m&&this.setJogador(m)}})),!a){let g=(yield this.jogadorRepo.forceFetch()).find(m=>String(m.id)===String(t));g&&this.setJogador(g)}})}setJogador(t){let e=t.pontos_de_vida||t.energia+t.constituicao,a=Math.floor(t.energia/3),c=Math.floor(t.destreza/3),g=e-(t.dano_tomado||0);this.jogador=S(w({},t),{pontos_de_vida:e,vida_atual:g,fator_cura:a,deslocamento:c});let m=v=>Math.floor((v-10)/2);this.atributos=[{label:"For\xE7a",value:t.forca,mod:m(t.forca),icon:"\u{1F4AA}"},{label:"Destreza",value:t.destreza,mod:m(t.destreza),icon:"\u{1F938}\u200D\u2642\uFE0F"},{label:"Constitui\xE7\xE3o",value:t.constituicao,mod:m(t.constituicao),icon:"\u{1FAA8}"},{label:"Intelig\xEAncia",value:t.inteligencia,mod:m(t.inteligencia),icon:"\u{1F9E0}"},{label:"Sabedoria",value:t.sabedoria,mod:m(t.sabedoria),icon:"\u{1F4D6}"},{label:"Carisma",value:t.carisma,mod:m(t.carisma),icon:"\u{1F60E}"},{label:"Energia",value:t.energia,mod:m(t.energia),icon:"\u26A1"}]}loadInventario(t){return x(this,null,function*(){this.carregandoInventario=!0;try{let[e,a]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),c=a.filter(g=>g.jogador===t);if(this.processarInventario(c,e),Promise.all([this.catalogoRepo.sync(),this.inventarioRepo.sync()]).then(v=>x(this,[v],function*([g,m]){if(g||m){let[y,Q]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),Y=Q.filter(Z=>Z.jogador===t);this.processarInventario(Y,y)}})),c.length===0){let[g,m]=yield Promise.all([this.catalogoRepo.forceFetch(),this.inventarioRepo.forceFetch()]),v=m.filter(y=>y.jogador===t);this.processarInventario(v,g)}}finally{this.carregandoInventario=!1}})}processarInventario(t,e){let a=t.map(g=>{let m=e.find(v=>String(v.id)===String(g.item_catalogo));return S(w({},g),{itemDetalhe:m})}),c=new Map;a.forEach(g=>{let m=g.itemDetalhe?.categoria||"Outros";c.has(m)||c.set(m,[]),c.get(m).push(g)}),this.categorias=Array.from(c.entries()).map(([g,m])=>({nome:g,itens:m,expandido:!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,a)=>e+(a.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,a)=>e+(a.quantidade||0)*(a.itemDetalhe?.peso||0),0)}selecionarAba(t){this.abaAtiva=t}selecionarAbaInventario(t){let e=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();(e==="recursos"||e==="equipamentos"||e==="pocoes"||e==="outros")&&(this.abaInventario=e)}selecionarAbaHabilidade(t){this.abaHabilidade=t}pertenceAbaInventario(t){return t?{recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]}[this.abaInventario].includes(t):this.abaInventario==="outros"}toggleCategoria(t){t.expandido=!t.expandido}voltar(){this.router.navigate(["/jogadores"])}static \u0275fac=function(e){return new(e||i)(V(U),V(W))};static \u0275cmp=j({type:i,selectors:[["app-visao-jogadores"]],decls:17,vars:9,consts:[["noImagem",""],[1,"visao-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],[1,"nav-item"],[1,"nav-link",3,"click"],["class","nav-item",4,"ngIf"],[1,"flex-grow-1","d-flex","justify-content-center"],[1,"visao-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","card detalhe-card shadow-lg border-0",4,"ngIf"],["class","inventario-container",4,"ngIf"],[4,"ngIf"],["class","alert alert-warning mt-4",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body","pb-5"],[1,"fw-bold","mb-1","text-light"],[1,"text-secondary","mb-3"],[1,"info-list","mb-3"],[3,"ngClass"],[1,"fw-bold","mt-3","text-light"],[1,"atributos-grid","compact","mb-3"],["class","atributo-item",4,"ngFor","ngForOf"],["class","mt-3",4,"ngIf"],["alt","Imagem do personagem",1,"card-img-top","detalhe-img",3,"src"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img",2,"height","200px","font-size","3rem"],[1,"atributo-item"],[1,"text-light"],[1,"mt-3"],[1,"fw-bold","text-light"],["class","descricao-text",4,"ngIf"],["class","fw-bold text-light mt-3",4,"ngIf"],["class","ataques-text",4,"ngIf"],[1,"descricao-text"],[1,"fw-bold","text-light","mt-3"],[1,"ataques-text"],[1,"inventario-container"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3","mb-3"],["class","nav-item",4,"ngFor","ngForOf"],[1,"fw-bold","mb-3"],["class","card resumo-card mb-4 p-3 shadow-sm",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[1,"card","resumo-card","mb-4","p-3","shadow-sm"],[1,"mb-1","text-light"],[1,"text-center","text-secondary","py-5"],[4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-3"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","h-100","p-3","shadow-sm"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],[1,"item-meta"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[3,"jogadorId",4,"ngIf"],[3,"jogadorId"],[1,"alert","alert-warning","mt-4"]],template:function(e,a){e&1&&(r(0,"div",1)(1,"ul",2)(2,"li",3)(3,"button",4),f("click",function(){return a.selecionarAba("jogador")}),l(4," \u{1F9D9} Jogador "),o()(),p(5,te,3,2,"li",5)(6,ie,3,2,"li",5),o(),r(7,"div",6)(8,"div",7),p(9,ae,4,0,"div",8)(10,me,31,17,"div",9)(11,ye,9,5,"div",10)(12,Se,2,1,"div",11)(13,Pe,2,0,"div",12),o()(),r(14,"div",13)(15,"button",14),f("click",function(){return a.voltar()}),l(16,"\u2B05\uFE0F"),o()()()),e&2&&(n(3),D("active",a.abaAtiva==="jogador"),n(2),d("ngIf",a.jogador==null?null:a.jogador.email),n(),d("ngIf",a.jogador==null?null:a.jogador.email),n(3),d("ngIf",a.loading),n(),d("ngIf",!a.loading&&a.jogador&&a.abaAtiva==="jogador"),n(),d("ngIf",!a.loading&&(a.jogador==null?null:a.jogador.email)&&a.abaAtiva==="inventario"),n(),d("ngIf",!a.loading&&(a.jogador==null?null:a.jogador.email)&&a.abaAtiva==="habilidades"),n(),d("ngIf",!a.loading&&!a.jogador))},dependencies:[H,L,$,N,X,G,B],styles:[".visao-container[_ngcontent-%COMP%]{max-width:900px;width:100%}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.info-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.info-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;color:#f1f1f1}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px 12px}.atributo-item[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:6px;padding:6px 10px;display:flex;align-items:center;gap:6px;color:#f1f1f1}.atributo-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#ddd}.atributo-item[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#fff;margin-left:auto}.atributo-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#bbb;font-size:.8rem}.resumo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#fff;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40}.inventario-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px}.item-thumb[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-meta[_ngcontent-%COMP%]{color:#bbb;font-size:.85rem}.descricao-text[_ngcontent-%COMP%], .ataques-text[_ngcontent-%COMP%]{white-space:pre-line;background:#2a2a2a;border-radius:6px;padding:10px 12px;line-height:1.5;font-size:.95rem}.descricao-text[_ngcontent-%COMP%]{color:#f1f1f1}.ataques-text[_ngcontent-%COMP%]{color:#f8d775}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#0d6efd;color:#fff;font-size:1.6rem}"]})};export{K as VisaoJogadores};
