import{a as g}from"./chunk-G46V626D.js";import{b as q,e as O,f as j,g as z,h as G,i as U,j as H,l as X,m as J,n as K,o as Q,p as Y,q as Z}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as $}from"./chunk-HS244SCX.js";import{Ga as u,Ha as i,Ia as n,Ib as L,Ja as V,Jb as W,Mb as P,Na as N,Oa as S,Pa as v,Ra as _,S as m,T as p,Ta as f,Tb as B,Vb as R,a as x,bb as E,d as y,fb as l,gb as k,ha as D,ia as d,ib as A,kb as h,lb as C,ma as M,mb as b,nb as I,qa as F,sb as T,ua as w}from"./chunk-ILJPX4RU.js";function ie(s,r){if(s&1){let t=v();N(0),V(1,"img",26),i(2,"button",27),_("click",function(){m(t);let a=f();return p(a.removerImagem())}),l(3,"\u2716"),n(),S()}if(s&2){let t=f();d(),u("src",t.npc.imagem,D)}}function ne(s,r){if(s&1){let t=v();i(0,"label",28)(1,"span",29),l(2,"\u{1F4F7}"),n(),i(3,"input",30),_("change",function(a){m(t);let c=f();return p(c.onFileChange(a))}),n()()}}function ae(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let t=r.$implicit;d(),k(t)}}function oe(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let t=r.$implicit;d(),k(t)}}function re(s,r){if(s&1){let t=v();i(0,"div",31)(1,"label",11),l(2),n(),i(3,"div",32)(4,"input",33),_("ngModelChange",function(a){let c=m(t).$implicit,o=f();return p(o.setValor(c.key,a))}),n(),i(5,"div",34)(6,"button",35),_("click",function(){let a=m(t).$implicit,c=f();return p(c.ajustarValor(a.key,-1))}),l(7,"\u2212"),n(),i(8,"button",35),_("click",function(){let a=m(t).$implicit,c=f();return p(c.ajustarValor(a.key,1))}),l(9,"+"),n()()()()}if(s&2){let t=r.$implicit,e=f();d(2),A("",t.icon," ",t.label),d(2),u("name",I(t.key))("ngModel",e.getValor(t.key))}}function le(s,r){s&1&&(N(0),l(1,"\u{1F4BE} Salvar"),S())}function ce(s,r){s&1&&(N(0),V(1,"span",36),l(2," Salvando... "),S())}var ee=class s{constructor(r,t){this.router=r;this.route=t}npc={id:0,index:0,imagem:"",nome:"",classificacao:"Inimigo",tipo:"Comum",descricao:"",alinhamento:"",pontos_de_vida:0,classe_armadura:0,forca:0,constituicao:0,destreza:0,sabedoria:0,inteligencia:0,energia:0,ataques:"",xp:0,email:""};atributosNumericos=[{key:"xp",label:"XP",icon:"\u2B50"},{key:"pontos_de_vida",label:"Vida",icon:"\u2764\uFE0F"},{key:"classe_armadura",label:"Armadura",icon:"\u{1F6E1}\uFE0F"},{key:"forca",label:"For\xE7a",icon:"\u{1F4AA}"},{key:"constituicao",label:"Constitui\xE7\xE3o",icon:"\u{1FAA8}"},{key:"destreza",label:"Destreza",icon:"\u{1F938}\u200D\u2642\uFE0F"},{key:"sabedoria",label:"Sabedoria",icon:"\u{1F4D6}"},{key:"inteligencia",label:"Intelig\xEAncia",icon:"\u{1F9E0}"},{key:"energia",label:"Energia",icon:"\u26A1"}];classificacoes=["Inimigo","Bestial"];tipos=["Comum","Elite","M\xE1gico","Lend\xE1rio"];salvando=!1;editMode=!1;ngOnInit(){return y(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield g.getLocalNpcs()).find(a=>String(a.id)===r);if(e&&(this.npc=x({},e)),g.syncNpcs().then(a=>y(this,null,function*(){if(a){let o=(yield g.getLocalNpcs()).find(te=>String(te.id)===r);o&&(this.npc=x({},o))}})),!e){let c=(yield g.forceFetchNpcs()).find(o=>String(o.id)===r);c&&(this.npc=x({},c))}}catch(t){console.error("[CadastroNpc] Erro ao carregar NPC:",t)}}})}getValor(r){return this.npc[r]}setValor(r,t){this.npc[r]=Math.max(0,t)}ajustarValor(r,t){this.setValor(r,this.getValor(r)+t)}onFileChange(r){let t=r.target;if(t.files&&t.files.length>0){let e=t.files[0],a=new FileReader;a.onload=()=>{this.npc.imagem=a.result},a.readAsDataURL(e)}}removerImagem(){this.npc.imagem=""}salvar(r){return y(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let t=$.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.npc.email=t.email,yield g.syncNpcs(),this.editMode)yield g.updateNpc(this.npc),window.alert("\u2705 NPC atualizado com sucesso!");else{let e=yield g.getLocalNpcs(),a=0;e.length>0&&(a=Math.max(...e.map(c=>c.index||0))),this.npc.index=a+1,this.npc.id=a+1,yield g.createNpc(this.npc),window.alert("\u2705 NPC criado com sucesso!")}this.router.navigate(["/npcs"])}catch(t){console.error("[CadastroNpc] Erro ao salvar NPC:",t),window.alert("\u274C Erro ao salvar NPC. Veja o console.")}finally{this.salvando=!1}})}cancelar(){this.router.navigate(["/npcs"])}static \u0275fac=function(t){return new(t||s)(M(R),M(B))};static \u0275cmp=F({type:s,selectors:[["app-cadastro-npc"]],decls:64,vars:14,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","pb-5"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","bg-dark","border-0","shadow-sm"],[1,"card-body"],[1,"fw-bold","mb-3","text-white"],[1,"mb-3"],[1,"form-label","text-white"],["type","text","name","nome","required","",1,"form-control","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","classificacao","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["name","tipo","required","",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["name","alinhamento",1,"form-select","bg-dark","text-light","border-light",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["rows","3","name","descricao",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],[1,"mb-3","mt-4"],["rows","3","name","ataques",1,"form-control","bg-dark","text-light","border-light","auto-expand",3,"ngModelChange","ngModel"],[1,"row","row-cols-2","g-3","mt-3"],["class","col",4,"ngFor","ngForOf"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-success","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","shadow-sm",2,"height","250px","object-fit","cover",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"d-flex","align-items-center","justify-content-center","border","rounded","w-100",2,"height","150px","background","#1e1e1e","cursor","pointer"],[1,"text-success","fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"col"],[1,"input-group"],["type","number","min","0",1,"form-control","text-center","bg-dark","text-white","border-light","fw-bold",3,"ngModelChange","ngModel","name"],[1,"d-flex"],["type","button",1,"btn","btn-outline-light",3,"click"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(t,e){if(t&1){let a=v();i(0,"div",2)(1,"div",3)(2,"form",4,0),_("ngSubmit",function(){m(a);let o=E(3);return p(e.salvar(o))}),i(4,"div",5),w(5,ie,4,1,"ng-container",6)(6,ne,4,0,"ng-template",null,1,T),n(),i(8,"div",7)(9,"div",8)(10,"h4",9),l(11,"\u{1F479} Cadastro de NPC"),n(),i(12,"div",10)(13,"label",11),l(14,"\u{1F64D} Nome *"),n(),i(15,"input",12),b("ngModelChange",function(o){return m(a),C(e.npc.nome,o)||(e.npc.nome=o),p(o)}),n()(),i(16,"div",10)(17,"label",11),l(18,"\u{1F3F7}\uFE0F Classifica\xE7\xE3o *"),n(),i(19,"select",13),b("ngModelChange",function(o){return m(a),C(e.npc.classificacao,o)||(e.npc.classificacao=o),p(o)}),w(20,ae,2,1,"option",14),n()(),i(21,"div",10)(22,"label",11),l(23,"\u{1F3AD} Tipo *"),n(),i(24,"select",15),b("ngModelChange",function(o){return m(a),C(e.npc.tipo,o)||(e.npc.tipo=o),p(o)}),w(25,oe,2,1,"option",14),n()(),i(26,"div",10)(27,"label",11),l(28,"\u2696\uFE0F Alinhamento"),n(),i(29,"select",16),b("ngModelChange",function(o){return m(a),C(e.npc.alinhamento,o)||(e.npc.alinhamento=o),p(o)}),i(30,"option",17),l(31,"Selecione..."),n(),i(32,"option"),l(33,"Leal e Bom (Lawful Good)"),n(),i(34,"option"),l(35,"Neutro e Bom (Neutral Good)"),n(),i(36,"option"),l(37,"Ca\xF3tico e Bom (Chaotic Good)"),n(),i(38,"option"),l(39,"Leal e Neutro (Lawful Neutral)"),n(),i(40,"option"),l(41,"Neutro (Neutral)"),n(),i(42,"option"),l(43,"Ca\xF3tico e Neutro (Chaotic Neutral)"),n(),i(44,"option"),l(45,"Leal e Mau (Lawful Evil)"),n(),i(46,"option"),l(47,"Neutro e Mau (Neutral Evil)"),n(),i(48,"option"),l(49,"Ca\xF3tico e Mau (Chaotic Evil)"),n()()(),i(50,"div",10)(51,"label",11),l(52,"\u{1F4DD} Descri\xE7\xE3o"),n(),i(53,"textarea",18),b("ngModelChange",function(o){return m(a),C(e.npc.descricao,o)||(e.npc.descricao=o),p(o)}),n()(),i(54,"div",19)(55,"label",11),l(56,"\u2694\uFE0F Ataques"),n(),i(57,"textarea",20),b("ngModelChange",function(o){return m(a),C(e.npc.ataques,o)||(e.npc.ataques=o),p(o)}),n()(),i(58,"div",21),w(59,re,10,5,"div",22),n()()(),i(60,"div",23)(61,"button",24),w(62,le,2,0,"ng-container",25)(63,ce,3,0,"ng-container",25),n()()()()()}if(t&2){let a=E(3),c=E(7);d(5),u("ngIf",e.npc.imagem)("ngIfElse",c),d(10),h("ngModel",e.npc.nome),d(4),h("ngModel",e.npc.classificacao),d(),u("ngForOf",e.classificacoes),d(4),h("ngModel",e.npc.tipo),d(),u("ngForOf",e.tipos),d(4),h("ngModel",e.npc.alinhamento),d(24),h("ngModel",e.npc.descricao),d(4),h("ngModel",e.npc.ataques),d(2),u("ngForOf",e.atributosNumericos),d(2),u("disabled",a.invalid||e.salvando),d(),u("ngIf",!e.salvando),d(),u("ngIf",e.salvando)}},dependencies:[P,L,W,Z,U,J,K,q,H,X,O,j,Y,Q,G,z],encapsulation:2})};export{ee as CadastroNpc};
