import{a as f}from"./chunk-OKT2OSXS.js";import{b as V,e as j,h as $,q as R}from"./chunk-PF4VWC54.js";import"./chunk-LACG63BB.js";import{Ga as l,Ha as a,Ia as r,Ja as h,Kb as P,Lb as k,Ob as T,Pa as b,Ra as _,S as v,T as x,Ta as m,Xb as L,a as C,b as N,d as u,fb as c,gb as g,ha as y,hb as I,ia as o,ib as E,kb as D,lb as F,ma as w,mb as M,nb as O,qa as S,ua as p}from"./chunk-MZUA6OGT.js";function B(i,e){i&1&&(a(0,"div",10),h(1,"div",11),a(2,"p",12),c(3,"Carregando NPCs..."),r()())}function W(i,e){i&1&&(a(0,"div",13),c(1," Nenhum NPC encontrado. "),r())}function q(i,e){if(i&1&&h(0,"img",30),i&2){let t=m().$implicit;l("alt",O(t.nome))("src",t.imagem,y)}}function A(i,e){i&1&&(a(0,"span",31),c(1,"\u{1F464}"),r())}function U(i,e){if(i&1&&(a(0,"p",32),c(1),r()),i&2){let t=m().$implicit;o(),I(" ",t.descricao," ")}}function Y(i,e){if(i&1){let t=b();a(0,"div",21)(1,"div",22),_("click",function(){let s=v(t).$implicit,d=m(4);return x(d.abrirItem(s))}),a(2,"div",23)(3,"div",24),p(4,q,1,3,"img",25)(5,A,2,0,"span",26),r(),a(6,"div")(7,"h6",27),c(8),r(),a(9,"small"),c(10),r()()(),a(11,"p",28),c(12," \u2764\uFE0F "),a(13,"b"),c(14),r(),c(15," | \u{1F6E1}\uFE0F "),a(16,"b"),c(17),r(),c(18," | \u2B50 "),a(19,"b"),c(20),r()(),p(21,U,2,1,"p",29),r()()}if(i&2){let t=e.$implicit;o(4),l("ngIf",t.imagem),o(),l("ngIf",!t.imagem),o(3),g(t.nome),o(2),E(" ",t.tipo||"\u2014"," | ",t.alinhamento||"Sem alinhamento"," "),o(4),g(t.pontos_de_vida),o(3),g(t.classe_armadura),o(3),g(t.xp),o(),l("ngIf",t.descricao)}}function G(i,e){if(i&1&&(a(0,"div",12)(1,"div",19),p(2,Y,22,9,"div",20),r()()),i&2){let t=m().$implicit;o(2),l("ngForOf",t.itens)}}function H(i,e){if(i&1){let t=b();a(0,"div",15)(1,"button",16),_("click",function(){let s=v(t).$implicit,d=m(2);return x(d.toggleCategoria(s))}),a(2,"span",17),c(3),r(),a(4,"span"),c(5),r()(),p(6,G,3,1,"div",18),r()}if(i&2){let t=e.$implicit;o(3),g(t.nome||"Outros"),o(2),g(t.expandido?"\u2212":"+"),o(),l("ngIf",t.expandido)}}function J(i,e){if(i&1&&(a(0,"div"),p(1,H,7,3,"div",14),r()),i&2){let t=m();o(),l("ngForOf",t.categoriasFiltradas)}}var z=class i{constructor(e){this.router=e}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";ngOnInit(){return u(this,null,function*(){try{this.carregando=!0;let e=yield f.getLocalNpcs();if(this.processarCategorias(e),f.syncNpcs().then(t=>u(this,null,function*(){if(t){let n=yield f.getLocalNpcs();this.processarCategorias(n)}})),e.length===0){let t=yield f.forceFetchNpcs();this.processarCategorias(t)}}catch(e){console.error("[Npcs] Erro ao carregar NPCs:",e)}finally{this.carregando=!1}})}processarCategorias(e){let t=new Map;e.forEach(n=>{let s=n.classificacao||"Outros";t.has(s)||t.set(s,[]),t.get(s).push(n)}),this.categorias=Array.from(t.entries()).sort((n,s)=>String(n[0]).localeCompare(String(s[0]))).map(([n,s])=>({nome:n,itens:s,expandido:!1})),this.categoriasFiltradas=[...this.categorias]}aplicarFiltro(){let e=this.filtro.toLowerCase();if(!e){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(t=>N(C({},t),{itens:t.itens.filter(n=>String(n.nome||"").toLowerCase().includes(e)||String(n.tipo||"").toLowerCase().includes(e)||String(n.descricao||"").toLowerCase().includes(e)||String(n.alinhamento||"").toLowerCase().includes(e))})).filter(t=>t.itens.length>0)}toggleCategoria(e){e.expandido=!e.expandido}abrirItem(e){this.router.navigate(["/npc-detalhes",e.id],{queryParams:{returnUrl:"/npcs"}})}novoNpc(){this.router.navigate(["/cadastro-npc"])}static \u0275fac=function(t){return new(t||i)(w(L))};static \u0275cmp=S({type:i,selectors:[["app-npcs"]],decls:12,vars:4,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar NPCs...",1,"form-control","bg-dark","text-light","border-light","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3","pb-5"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab","btn","btn-primary","rounded-circle","shadow-lg",3,"click"],[1,"fs-4"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-outline-light","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","npc-card","shadow-sm","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"rounded","me-3","d-flex","align-items-center","justify-content-center","bg-dark",2,"width","55px","height","55px","overflow","hidden"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"small","mb-1"],["class","small descricao-text fst-italic",4,"ngIf"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"text-muted"],[1,"small","descricao-text","fst-italic"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"input",2),M("ngModelChange",function(d){return F(n.filtro,d)||(n.filtro=d),d}),_("input",function(){return n.aplicarFiltro()}),r()(),a(3,"div",3)(4,"h4",4),c(5,"\u{1F479} NPCs"),r(),p(6,B,4,0,"div",5)(7,W,2,0,"div",6)(8,J,2,1,"div",7),r(),a(9,"button",8),_("click",function(){return n.novoNpc()}),a(10,"span",9),c(11,"\uFF0B"),r()()()),t&2&&(o(2),D("ngModel",n.filtro),o(4),l("ngIf",n.carregando),o(),l("ngIf",!n.carregando&&n.categoriasFiltradas.length===0),o(),l("ngIf",!n.carregando))},dependencies:[T,P,k,R,V,j,$],styles:[".npc-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:14px;transition:all .2s ease-in-out}.npc-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 14px #00000073}.npc-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.npc-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#b8c2cc}.npc-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e6e6e6}.descricao-text[_ngcontent-%COMP%]{color:#cfcfcf!important;font-style:italic}.npc-card[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{color:#f5f5f5;font-weight:500}button.btn-outline-light[_ngcontent-%COMP%]{border:1px solid #666;background:#1e1e1e;border-radius:10px;color:#e6e6e6}button.btn-outline-light[_ngcontent-%COMP%]:hover{background:#333;border-color:#888;color:#fff}"]})};export{z as Npcs};
