import{a as g}from"./chunk-7RN52ETI.js";import{b as B,e as q,f as H,g as G,h as U,i as Z,j as X,l as Y,m as J,n as K,o as Q,p as $,q as ee}from"./chunk-SBITE6UI.js";import"./chunk-FL3Z7HVM.js";import{Ga as u,Ha as i,Ia as n,Ja as V,Kb as L,Lb as W,Na as E,Oa as N,Ob as R,Pa as w,Ra as h,S as p,T as m,Ta as f,Vb as j,Xb as z,_b as te,a as y,aa as A,bb as S,d as M,fb as l,gb as k,ha as D,ia as d,ib as O,kb as _,lb as b,ma as v,mb as x,nb as I,qa as P,tb as T,ua as C,xa as F}from"./chunk-D4SJKQCR.js";function ae(s,r){if(s&1){let e=w();E(0),V(1,"img",27),i(2,"button",28),h("click",function(){p(e);let a=f();return m(a.removerImagem())}),l(3,"\u2716"),n(),N()}if(s&2){let e=f();d(),u("src",e.npc.imagem,D)}}function oe(s,r){if(s&1){let e=w();i(0,"label",29)(1,"span",30),l(2,"\u{1F4F7}"),n(),i(3,"input",31),h("change",function(a){p(e);let c=f();return m(c.onFileChange(a))}),n()()}}function re(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let e=r.$implicit;d(),k(e)}}function le(s,r){if(s&1&&(i(0,"option"),l(1),n()),s&2){let e=r.$implicit;d(),k(e)}}function ce(s,r){if(s&1){let e=w();i(0,"div",32)(1,"div",33),l(2),n(),i(3,"div",34)(4,"button",35),h("click",function(){let a=p(e).$implicit,c=f();return m(c.ajustarValor(a.key,-1))}),l(5,"\u2212"),n(),i(6,"input",36),h("ngModelChange",function(a){let c=p(e).$implicit,o=f();return m(o.setValor(c.key,a))}),n(),i(7,"button",35),h("click",function(){let a=p(e).$implicit,c=f();return m(c.ajustarValor(a.key,1))}),l(8,"+"),n()()()}if(s&2){let e=r.$implicit,t=f();d(2),O(" ",e.icon," ",e.label," "),d(4),u("name",I(e.key))("ngModel",t.getValor(e.key))}}function se(s,r){s&1&&(E(0),l(1,"\u{1F4BE} Salvar"),N())}function de(s,r){s&1&&(E(0),V(1,"span",37),l(2," Salvando... "),N())}var ie=class s{constructor(r,e,t,a){this.router=r;this.route=e;this.el=t;this.zone=a}npc={id:0,index:0,imagem:"",nome:"",classificacao:"Inimigo",tipo:"Comum",descricao:"",alinhamento:"",pontos_de_vida:0,classe_armadura:0,forca:0,constituicao:0,destreza:0,sabedoria:0,inteligencia:0,energia:0,ataques:"",xp:0,email:""};atributosNumericos=[{key:"xp",label:"XP",icon:"\u2B50"},{key:"pontos_de_vida",label:"Vida",icon:"\u2764\uFE0F"},{key:"classe_armadura",label:"Armadura",icon:"\u{1F6E1}\uFE0F"},{key:"forca",label:"For\xE7a",icon:"\u{1F4AA}"},{key:"constituicao",label:"Constitui\xE7\xE3o",icon:"\u{1FAA8}"},{key:"destreza",label:"Destreza",icon:"\u{1F938}\u200D\u2642\uFE0F"},{key:"sabedoria",label:"Sabedoria",icon:"\u{1F4D6}"},{key:"inteligencia",label:"Intelig\xEAncia",icon:"\u{1F9E0}"},{key:"energia",label:"Energia",icon:"\u26A1"}];classificacoes=["Inimigo","Bestial"];tipos=["Comum","Elite","M\xE1gico","Lend\xE1rio"];salvando=!1;editMode=!1;ngOnInit(){return M(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let t=(yield g.getLocalNpcs()).find(a=>String(a.id)===r);if(t&&(this.npc=y({},t),this.scheduleAutoExpand()),g.syncNpcs().then(a=>M(this,null,function*(){if(a){let o=(yield g.getLocalNpcs()).find(ne=>String(ne.id)===r);o&&(this.npc=y({},o),this.scheduleAutoExpand())}})),!t){let c=(yield g.forceFetchNpcs()).find(o=>String(o.id)===r);c&&(this.npc=y({},c),this.scheduleAutoExpand())}}catch(e){console.error("[CadastroNpc] Erro ao carregar NPC:",e)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(e=>{e.style.height="auto";let t=200;e.style.height=Math.min(e.scrollHeight,t)+"px",e.oninput=()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,t)+"px"}})}getValor(r){return this.npc[r]}setValor(r,e){this.npc[r]=Math.max(0,e)}ajustarValor(r,e){this.setValor(r,this.getValor(r)+e)}onFileChange(r){let e=r.target;if(e.files&&e.files.length>0){let t=e.files[0],a=new FileReader;a.onload=()=>{this.npc.imagem=a.result},a.readAsDataURL(t)}}removerImagem(){this.npc.imagem=""}salvar(r){return M(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let e=te.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.npc.email=e.email,yield g.syncNpcs(),this.editMode)yield g.updateNpc(this.npc),window.alert("\u2705 NPC atualizado com sucesso!");else{let t=yield g.getLocalNpcs(),a=t.length>0?Math.max(...t.map(c=>c.index||0)):0;this.npc.index=a+1,this.npc.id=a+1,yield g.createNpc(this.npc),window.alert("\u2705 NPC criado com sucesso!")}this.router.navigate(["/npcs"])}catch(e){console.error("[CadastroNpc] Erro ao salvar NPC:",e),window.alert("\u274C Erro ao salvar NPC. Veja o console.")}finally{this.salvando=!1}})}cancelar(){this.router.navigate(["/npcs"])}static \u0275fac=function(e){return new(e||s)(v(z),v(j),v(A),v(F))};static \u0275cmp=P({type:s,selectors:[["app-cadastro-npc"]],decls:66,vars:14,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","pb-5"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold","mb-3","text-light"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","nome","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","classificacao","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["name","tipo","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","alinhamento",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[1,"fw-bold","mt-4","text-light"],[1,"atributos-grid-edit","mb-3"],["class","atributo-item-edit",4,"ngFor","ngForOf"],["rows","3","name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"mb-3","mt-4"],["rows","3","name","ataques",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"atributo-item-edit"],[1,"atributo-label","text-center"],[1,"atributo-controls"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","min","0",1,"atributo-input",3,"ngModelChange","ngModel","name"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,t){if(e&1){let a=w();i(0,"div",2)(1,"div",3)(2,"form",4,0),h("ngSubmit",function(){p(a);let o=S(3);return m(t.salvar(o))}),i(4,"div",5),C(5,ae,4,1,"ng-container",6)(6,oe,4,0,"ng-template",null,1,T),n(),i(8,"div",7)(9,"div",8)(10,"h4",9),l(11,"\u{1F479} Cadastro de Feras & Vil\xF5es"),n(),i(12,"div",10)(13,"label",11),l(14,"\u{1F64D} Nome *"),n(),i(15,"input",12),x("ngModelChange",function(o){return p(a),b(t.npc.nome,o)||(t.npc.nome=o),m(o)}),n()(),i(16,"div",10)(17,"label",11),l(18,"\u{1F3F7}\uFE0F Classifica\xE7\xE3o *"),n(),i(19,"select",13),x("ngModelChange",function(o){return p(a),b(t.npc.classificacao,o)||(t.npc.classificacao=o),m(o)}),C(20,re,2,1,"option",14),n()(),i(21,"div",10)(22,"label",11),l(23,"\u{1F3AD} Tipo *"),n(),i(24,"select",15),x("ngModelChange",function(o){return p(a),b(t.npc.tipo,o)||(t.npc.tipo=o),m(o)}),C(25,le,2,1,"option",14),n()(),i(26,"div",10)(27,"label",11),l(28,"\u2696\uFE0F Alinhamento"),n(),i(29,"select",16),x("ngModelChange",function(o){return p(a),b(t.npc.alinhamento,o)||(t.npc.alinhamento=o),m(o)}),i(30,"option",17),l(31,"Selecione..."),n(),i(32,"option"),l(33,"Leal e Bom (Lawful Good)"),n(),i(34,"option"),l(35,"Neutro e Bom (Neutral Good)"),n(),i(36,"option"),l(37,"Ca\xF3tico e Bom (Chaotic Good)"),n(),i(38,"option"),l(39,"Leal e Neutro (Lawful Neutral)"),n(),i(40,"option"),l(41,"Neutro (Neutral)"),n(),i(42,"option"),l(43,"Ca\xF3tico e Neutro (Chaotic Neutral)"),n(),i(44,"option"),l(45,"Leal e Mau (Lawful Evil)"),n(),i(46,"option"),l(47,"Neutro e Mau (Neutral Evil)"),n(),i(48,"option"),l(49,"Ca\xF3tico e Mau (Chaotic Evil)"),n()()(),i(50,"h6",18),l(51,"\u{1F4CA} Atributos Num\xE9ricos"),n(),i(52,"div",19),C(53,ce,9,5,"div",20),n(),i(54,"div",10)(55,"label",11),l(56,"\u{1F4DD} Descri\xE7\xE3o"),n(),i(57,"textarea",21),x("ngModelChange",function(o){return p(a),b(t.npc.descricao,o)||(t.npc.descricao=o),m(o)}),n()(),i(58,"div",22)(59,"label",11),l(60,"\u2694\uFE0F Ataques"),n(),i(61,"textarea",23),x("ngModelChange",function(o){return p(a),b(t.npc.ataques,o)||(t.npc.ataques=o),m(o)}),n()(),i(62,"div",24)(63,"button",25),C(64,se,2,0,"ng-container",26)(65,de,3,0,"ng-container",26),n()()()()()()()}if(e&2){let a=S(3),c=S(7);d(5),u("ngIf",t.npc.imagem)("ngIfElse",c),d(10),_("ngModel",t.npc.nome),d(4),_("ngModel",t.npc.classificacao),d(),u("ngForOf",t.classificacoes),d(4),_("ngModel",t.npc.tipo),d(),u("ngForOf",t.tipos),d(4),_("ngModel",t.npc.alinhamento),d(24),u("ngForOf",t.atributosNumericos),d(4),_("ngModel",t.npc.descricao),d(4),_("ngModel",t.npc.ataques),d(2),u("disabled",a.invalid||t.salvando),d(),u("ngIf",!t.salvando),d(),u("ngIf",t.salvando)}},dependencies:[R,L,W,ee,Z,J,K,B,X,Y,q,H,$,Q,U,G],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#dc3545;color:#dc3545}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;color:#f8f9fa}.input-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributos-grid-edit[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}@media (min-width: 768px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (min-width: 992px){.atributos-grid-edit[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}}.atributo-item-edit[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:6px;padding:8px 10px;display:flex;flex-direction:column;align-items:center}.atributo-label[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa;margin-bottom:6px;text-align:center}.atributo-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px}.atributo-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;color:#fff;background:#1e1e1e;border:1px solid #444;border-radius:4px;padding:2px 4px}.atributo-input[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.atributo-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:2px 8px;font-size:.9rem;line-height:1}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}"]})};export{ie as CadastroNpc};
