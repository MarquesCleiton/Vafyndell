import{a as J}from"./chunk-QWKS73CC.js";import{a as h}from"./chunk-N245TVBG.js";import{r as T}from"./chunk-W45U2HER.js";import"./chunk-VZT3XYFG.js";import{Ia as r,Ja as o,Ka as c,La as m,Mb as B,Nb as j,Pa as v,Qa as C,Qb as S,Ra as O,T as f,Ta as x,U as u,Va as g,Zb as F,d as _,db as y,hb as s,ib as E,ja as w,jb as b,ka as i,kb as D,oa as P,pb as k,sa as I,vb as M,wa as p}from"./chunk-Y44Y2XZC.js";function N(n,t){n&1&&(o(0,"div",8),m(1,"div",9),o(2,"p",10),s(3,"Carregando jogadores..."),c()())}function R(n,t){n&1&&(o(0,"span",33),s(1,"\u{1F480}"),c())}function $(n,t){if(n&1&&m(0,"img",34),n&2){let e=g().$implicit;r("alt",k(e.personagem))("src",e.imagem,w)}}function U(n,t){n&1&&(o(0,"span",20),s(1,"\u{1F464}"),c())}function L(n,t){if(n&1&&(o(0,"span"),s(1),c()),n&2){let e=g().$implicit;i(),b("| ",e.tipo)}}function A(n,t){n&1&&(v(0),m(1,"span",36),C())}function z(n,t){n&1&&s(0,"\u{1F5D1}\uFE0F")}function q(n,t){if(n&1){let e=O();o(0,"button",35),x("click",function(){f(e);let d=g().$implicit,l=g(2);return u(l.excluirNpcDaBatalha(d))}),p(1,A,2,0,"ng-container",31)(2,z,1,0,"ng-template",null,2,M),c()}if(n&2){let e=y(3),a=g().$implicit,d=g(2);r("disabled",d.processando[a.id]==="excluir"),i(),r("ngIf",d.processando[a.id]==="excluir")("ngIfElse",e)}}function Y(n,t){n&1&&m(0,"div",37)}function G(n,t){n&1&&(v(0),m(1,"span",36),C())}function H(n,t){n&1&&s(0,"\u{1F48A}")}function K(n,t){n&1&&(v(0),m(1,"span",36),C())}function Q(n,t){n&1&&s(0,"\u2694\uFE0F")}function W(n,t){if(n&1){let e=O();o(0,"div",12),x("click",function(){let d=f(e).$implicit,l=g(2);return u(l.abrirDetalhes(d))}),o(1,"div",13)(2,"div",14),p(3,R,2,0,"span",15)(4,$,1,3,"img",16)(5,U,2,0,"span",17),c(),o(6,"div",18)(7,"h6",19),s(8),c(),o(9,"small",20),s(10),p(11,L,2,1,"span",6),c()(),o(12,"div",21),x("click",function(d){return f(e),u(d.stopPropagation())}),o(13,"div",22)(14,"div",23),s(15),c(),o(16,"div",24),s(17),c()(),o(18,"div",25),s(19),c(),o(20,"div",26)(21,"div",27),p(22,q,4,3,"button",28)(23,Y,1,0,"div",29),c(),o(24,"div",27)(25,"button",30),x("click",function(){let d=f(e).$implicit,l=g(2);return u(l.acaoRecuperacao(d))}),p(26,G,2,0,"ng-container",31)(27,H,1,0,"ng-template",null,0,M),c()(),o(29,"div")(30,"button",32),x("click",function(){let d=f(e).$implicit,l=g(2);return u(l.acaoEspada(d))}),p(31,K,2,0,"ng-container",31)(32,Q,1,0,"ng-template",null,1,M),c()()()()()()}if(n&2){let e=t.$implicit,a=y(28),d=y(33),l=g(2);i(3),r("ngIf",l.JogadorUtils.estaMorto(e)),i(),r("ngIf",e.imagem&&!l.JogadorUtils.estaMorto(e)),i(),r("ngIf",!e.imagem&&!l.JogadorUtils.estaMorto(e)),i(3),E(e.personagem),i(2),b(" ",e.classificacao||"Jogador"," "),i(),r("ngIf",e.tipo),i(4),D(" \u2764\uFE0F ",l.JogadorUtils.getVidaAtual(e),"/",l.JogadorUtils.getVidaBase(e)," "),i(2),b("\u{1F6E1}\uFE0F ",e.classe_de_armadura),i(2),b(" \u{1F4A5} Dano: ",e.dano_tomado||0," "),i(3),r("ngIf",!e.email),i(),r("ngIf",e.email),i(2),r("disabled",l.processando[e.id]==="recuperar"),i(),r("ngIf",l.processando[e.id]==="recuperar")("ngIfElse",a),i(4),r("disabled",l.processando[e.id]==="espada"),i(),r("ngIf",l.processando[e.id]==="espada")("ngIfElse",d)}}function X(n,t){if(n&1&&(o(0,"div"),p(1,W,34,18,"div",11),c()),n&2){let e=g();i(),r("ngForOf",e.jogadoresFiltrados)}}function Z(n,t){n&1&&(o(0,"div",38),s(1," Nenhum jogador encontrado. "),c())}var V=class n{constructor(t){this.router=t}jogadores=[];jogadoresFiltrados=[];carregando=!0;filtro="";processando={};JogadorUtils=J;ngOnInit(){return _(this,null,function*(){console.log("[Batalha] ngOnInit \u2192 carregando jogadores...");try{let t=yield h.getLocalJogadores();if(t.length>0&&(this.jogadores=t,this.aplicarFiltro(),this.carregando=!1),h.syncJogadores().then(e=>_(this,null,function*(){if(e){let a=yield h.getLocalJogadores();this.jogadores=a,this.aplicarFiltro()}})),t.length===0){let e=yield h.forceFetchJogador();e&&(this.jogadores=Array.isArray(e)?e:[e],this.aplicarFiltro()),this.carregando=!1}}catch(t){console.error("[Batalha] Erro ao carregar jogadores:",t),this.carregando=!1}})}aplicarFiltro(){let t=this.filtro.toLowerCase().trim();if(!t){this.jogadoresFiltrados=[...this.jogadores];return}this.jogadoresFiltrados=this.jogadores.filter(e=>String(e.personagem||"").toLowerCase().includes(t)||String(e.nome_do_jogador||"").toLowerCase().includes(t)||String(e.classificacao||"").toLowerCase().includes(t)||String(e.tipo||"").toLowerCase().includes(t))}abrirDetalhes(t){return _(this,null,function*(){this.processando[t.id]="abrir",setTimeout(()=>{this.router.navigate(["/jogador-detalhes-batalha",t.id]),this.processando[t.id]=null},400)})}acaoEspada(t){return _(this,null,function*(){this.processando[t.id]="espada",setTimeout(()=>{this.router.navigate(["/combate",t.id]),this.processando[t.id]=null},400)})}acaoRecuperacao(t){return _(this,null,function*(){this.processando[t.id]="recuperar",setTimeout(()=>{this.router.navigate(["/recuperacao",t.id]),this.processando[t.id]=null},400)})}excluirNpcDaBatalha(t){return _(this,null,function*(){if(confirm(`\u{1F5D1}\uFE0F Deseja remover "${t.personagem}" do campo de batalha?`)){this.processando[t.id]="excluir";try{yield h.deleteJogador(t.id),this.jogadores=this.jogadores.filter(a=>a.id!==t.id),this.aplicarFiltro(),alert("\u2705 NPC removido da batalha!")}catch(a){console.error("[Batalha] Erro ao excluir NPC:",a),alert("\u274C Erro ao excluir NPC da batalha.")}finally{this.processando[t.id]=null}}})}static \u0275fac=function(e){return new(e||n)(P(F))};static \u0275cmp=I({type:n,selectors:[["app-batalha"]],decls:5,vars:3,consts:[["recuperarIcon",""],["espadaIcon",""],["excluirIcon",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","p-2","overflow-auto"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],["class","card catalogo-card mb-2 shadow-sm p-2",3,"click",4,"ngFor","ngForOf"],[1,"card","catalogo-card","mb-2","shadow-sm","p-2",3,"click"],[1,"d-flex","align-items-center"],[1,"me-3","d-flex","align-items-center","justify-content-center","bg-dark","rounded",2,"width","55px","height","55px","overflow","hidden"],["class","fs-3",4,"ngIf"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"flex-grow-1"],[1,"text-light","fw-bold","mb-1"],[1,"text-secondary"],[1,"d-flex","flex-column","align-items-end","ms-2",3,"click"],[1,"d-flex","mb-1","align-items-center"],[1,"me-3","text-danger","fw-bold"],[1,"text-info"],[1,"text-warning","small","mb-1"],[1,"d-flex"],[1,"me-1"],["class","btn btn-sm btn-outline-danger",3,"disabled","click",4,"ngIf"],["style","width:32px; height:32px;",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"btn","btn-sm","btn-outline-light",3,"click","disabled"],[1,"fs-3"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"btn","btn-sm","btn-outline-danger",3,"click","disabled"],[1,"spinner-border","spinner-border-sm"],[2,"width","32px","height","32px"],[1,"text-center","text-muted","py-5"]],template:function(e,a){e&1&&(o(0,"div",3)(1,"div",4),p(2,N,4,0,"div",5)(3,X,2,1,"div",6)(4,Z,2,0,"div",7),c()()),e&2&&(i(2),r("ngIf",a.carregando),i(),r("ngIf",!a.carregando&&a.jogadoresFiltrados.length>0),i(),r("ngIf",!a.carregando&&a.jogadoresFiltrados.length===0))},dependencies:[S,B,j,T],styles:[".catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.catalogo-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 12px #0006}.status-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.status-line[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff4d6d!important}.status-line[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#4da6ff!important}.jogador-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;font-size:1rem}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]{border-color:#ff4d6d;color:#ff4d6d}.jogador-card[_ngcontent-%COMP%]   .btn-outline-danger[_ngcontent-%COMP%]:hover{background:#ff4d6d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]{border-color:#bbb;color:#bbb}.jogador-card[_ngcontent-%COMP%]   .btn-outline-light[_ngcontent-%COMP%]:hover{background:#bbb;color:#1e1e1e}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.catalogo-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:6px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:.75rem;border:1px solid rgba(255,255,255,.05)}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   .mat-mdc-form-field-outline[_ngcontent-%COMP%]{color:#6c757d!important}.preview-card[_ngcontent-%COMP%]{background:#6c757d26;border-radius:.5rem;padding:.75rem 1rem;text-align:center;margin-bottom:1rem}.preview-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:.5rem;border:1px solid #6c757d;width:50px;height:50px;object-fit:cover}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:70px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.25rem}.btn-save[_ngcontent-%COMP%]{background:#198754;color:#fff;font-weight:600;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover{background:#157347;transform:scale(1.03)}.btn-outline-light[_ngcontent-%COMP%]{border-color:#adb5bd}.btn-outline-light[_ngcontent-%COMP%]:hover{background:#adb5bd;color:#212529}.btn-outline-secondary[_ngcontent-%COMP%]{border-color:#6c757d}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:#6c757d;color:#fff}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745}.jogador-card[_ngcontent-%COMP%]   .btn-outline-success[_ngcontent-%COMP%]:hover{background:#28a745;color:#fff}"]})};export{V as Batalha};
