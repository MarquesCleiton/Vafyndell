import{a as $}from"./chunk-XQNWO7VY.js";import{a as x}from"./chunk-SL4CV3BB.js";import{f as z,h as U}from"./chunk-XMJCILQE.js";import{e as T,i as L,p as A,w as k}from"./chunk-ZOZAG657.js";import{Ab as m,Bb as o,Cb as i,Db as u,Hb as f,Ib as v,Nb as b,Pb as g,Sa as y,Ua as r,Za as h,Zb as S,bc as a,dc as d,eb as M,g as _,jb as s,jc as j,kc as F,rc as w}from"./chunk-YAKM3PEZ.js";function B(e,l){e&1&&(o(0,"div",10),u(1,"div",11),o(2,"p",12),a(3,"Carregando item..."),i()())}function H(e,l){if(e&1&&(f(0),u(1,"img",32),v()),e&2){let t=g(2);r(),m("alt",j(t.item.catalogo==null?null:t.item.catalogo.nome))("src",t.item.catalogo==null?null:t.item.catalogo.imagem,y)}}function N(e,l){e&1&&(o(0,"div",33),a(1," \u{1F4E6} "),i())}function V(e,l){if(e&1&&(o(0,"p",34)(1,"a",35),a(2," \u2139\uFE0F Ver detalhes no cat\xE1logo "),i()()),e&2){let t=g(2);r(),m("href",F("/#/item-catalogo/",t.item.catalogo.id),y)}}function J(e,l){if(e&1&&(o(0,"p",36),a(1," \u2728 "),o(2,"b"),a(3,"Efeito:"),i(),a(4),i()),e&2){let t=g(2);r(4),d(" ",t.item.catalogo==null?null:t.item.catalogo.efeito," ")}}function Q(e,l){if(e&1&&(o(0,"p",37),a(1," \u26A0\uFE0F "),o(2,"b"),a(3,"Colateral:"),i(),a(4),i()),e&2){let t=g(2);r(4),d(" ",t.item.catalogo==null?null:t.item.catalogo.colateral," ")}}function G(e,l){if(e&1&&(o(0,"p",38),a(1," \u{1F4DD} "),o(2,"b"),a(3,"Descri\xE7\xE3o:"),i(),a(4),i()),e&2){let t=g(2);r(4),d(" ",t.item.catalogo==null?null:t.item.catalogo.descricao," ")}}function K(e,l){if(e&1&&(o(0,"p",39),a(1),i()),e&2){let t=g(2);r(),d(" ",t.item.inventario.descricao," ")}}function W(e,l){e&1&&(o(0,"p",40),a(1,"Sem hist\xF3rico registrado."),i())}function X(e,l){if(e&1&&(o(0,"div",13)(1,"div",14)(2,"div",15)(3,"div",16)(4,"h4",17),a(5),i()(),o(6,"div",18),s(7,H,2,3,"ng-container",19)(8,N,2,0,"ng-template",null,0,w),i(),o(10,"div",20)(11,"p",21)(12,"b"),a(13,"\u{1F4C2} Categoria:"),i(),a(14),i(),o(15,"p",21)(16,"b"),a(17,"\u{1F331} Origem:"),i(),a(18),i(),o(19,"p",21)(20,"b"),a(21,"\u{1F48E} Raridade:"),i(),a(22),i(),o(23,"p",21)(24,"b"),a(25,"\u{1F522} Quantidade:"),i(),a(26),i(),o(27,"p",22)(28,"b"),a(29,"\u2696\uFE0F Peso total:"),i(),a(30),i(),s(31,V,3,2,"p",23),u(32,"hr",24),o(33,"details",25)(34,"summary"),a(35,"\u{1F4D6} Detalhes do Item"),i(),o(36,"div",26),s(37,J,5,1,"p",27)(38,Q,5,1,"p",28)(39,G,5,1,"p",29),i()(),o(40,"details",30)(41,"summary"),a(42,"\u{1F9FE} Hist\xF3rico"),i(),o(43,"div",26),s(44,K,2,1,"p",31)(45,W,2,0,"ng-template",null,1,w),i()()()()()()),e&2){let t=S(9),c=S(46),n=g();r(5),d(" \u{1F392} ",(n.item.catalogo==null?null:n.item.catalogo.nome)||"Item desconhecido"," "),r(2),m("ngIf",(n.item.catalogo==null?null:n.item.catalogo.imagem)&&(n.item.catalogo==null?null:n.item.catalogo.imagem)!=="-")("ngIfElse",t),r(7),d(" ",(n.item.catalogo==null?null:n.item.catalogo.categoria)||"\u2014"," "),r(4),d(" ",(n.item.catalogo==null?null:n.item.catalogo.origem)||"\u2014"),r(4),d(" ",(n.item.catalogo==null?null:n.item.catalogo.raridade)||"\u2014"),r(4),d(" ",n.item.inventario.quantidade),r(4),d(" ",(n.item.inventario.quantidade||0)*((n.item.catalogo==null?null:n.item.catalogo.peso)||0)," kg "),r(),m("ngIf",n.item.catalogo),r(6),m("ngIf",n.item.catalogo==null?null:n.item.catalogo.efeito),r(),m("ngIf",n.item.catalogo==null?null:n.item.catalogo.colateral),r(),m("ngIf",n.item.catalogo==null?null:n.item.catalogo.descricao),r(5),m("ngIf",n.item.inventario.descricao)("ngIfElse",c)}}function Y(e,l){e&1&&(f(0),a(1,"\u{1F5D1}\uFE0F"),v())}function Z(e,l){e&1&&(f(0),u(1,"span",41),v())}function ee(e,l){e&1&&(f(0),a(1,"\u270F\uFE0F"),v())}function te(e,l){e&1&&(f(0),u(1,"span",41),v())}var q=class e{constructor(l,t,c){this.route=l;this.router=t;this.location=c}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;inventarioRepo=new x("Inventario");catalogoRepo=new x("Catalogo");registroRepo=new x("Registro");jogadoresRepo=new x("Personagem");ngOnInit(){return _(this,null,function*(){try{this.carregando=!0;let l=this.route.snapshot.paramMap.get("id");if(!l)throw new Error("ID inv\xE1lido para item do invent\xE1rio");let t=k.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let[c,n]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),I=n.find(p=>String(p.id)===String(l)&&p.jogador===t.email);I&&(this.item=this.montarDetalhe(I,c)),this.carregando=!1,Promise.all([this.catalogoRepo.sync(),this.inventarioRepo.sync()]).then(P=>_(this,[P],function*([p,E]){if(p||E){let[D,C]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),R=C.find(O=>String(O.id)===String(l)&&O.jogador===t.email);R&&(this.item=this.montarDetalhe(R,D))}}))}catch(l){console.error("[ItemInventario] Erro ao carregar item:",l),this.carregando=!1}})}montarDetalhe(l,t){let c=t.find(n=>String(n.id)===String(l.item_catalogo));return{inventario:l,catalogo:c}}cancelar(){this.router.navigate(["/inventario-jogador"])}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-inventario",this.item.inventario.id]),this.processandoEditar=!1},400))}excluirItem(){return _(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja remover "${this.item.catalogo?.nome}" do invent\xE1rio?
Esta a\xE7\xE3o ser\xE1 registrada.`))){this.processandoExcluir=!0;try{let t=k.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");let c=t.email,I=((yield this.jogadoresRepo.getLocal()).find(C=>C.email===c)||null)?.personagem||"Voc\xEA",p=this.item.catalogo?.nome||"Item desconhecido",E=this.item.catalogo?.unidade_medida||"unidade(s)",P=this.item.inventario.quantidade,D={id:$.generateULID(),jogador:c,alvo:c,tipo:"inventario",acao:"removeu um item do invent\xE1rio",detalhes:`\u{1F4E6} ${I} removeu um item do invent\xE1rio
\u{1F392} ${p}: ${P} \u2192 0 (-${P} ${E})
\u{1F4DD} Descri\xE7\xE3o: item removido manualmente`,data:new Date().toISOString()};yield x.batch({create:{Registro:[D]},deleteById:{Inventario:[{id:String(this.item.inventario.id)}]}}),alert(`\u2705 ${I} removeu "${p}" do invent\xE1rio.
A\xE7\xE3o registrada com sucesso.`),this.router.navigate(["/inventario-jogador"])}catch(t){console.error("[ItemInventario] Erro ao excluir item:",t),alert("\u274C Erro ao excluir item.")}finally{this.processandoExcluir=!1}}})}static \u0275fac=function(t){return new(t||e)(h(z),h(U),h(T))};static \u0275cmp=M({type:e,selectors:[["app-item-inventario"]],decls:12,vars:8,consts:[["noImagem",""],["semHistorico",""],[1,"inventario-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],["class","text-center py-5",4,"ngIf"],["class","flex-grow-1 p-3 d-flex justify-content-center",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"fab","fab-danger",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-warning",3,"click","disabled"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-detalhe-container","w-100"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-capitalize","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"text-light","mb-1"],[1,"text-light","mb-3"],["class","mb-3",4,"ngIf"],[1,"border-secondary"],["open","",1,"detalhes-section","mb-3"],[1,"p-2","ps-3","mt-2"],["class","mb-1 text-info",4,"ngIf"],["class","mb-1 text-danger",4,"ngIf"],["class","mb-0 text-light fst-italic",4,"ngIf"],[1,"detalhes-section"],["class","descricao-text",4,"ngIf","ngIfElse"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mb-3"],[1,"text-info","text-decoration-none",3,"href"],[1,"mb-1","text-info"],[1,"mb-1","text-danger"],[1,"mb-0","text-light","fst-italic"],[1,"descricao-text"],[1,"text-muted","fst-italic"],[1,"spinner-border","spinner-border-sm"]],template:function(t,c){t&1&&(o(0,"div",2),s(1,B,4,0,"div",3)(2,X,47,14,"div",4),o(3,"div",5)(4,"button",6),b("click",function(){return c.cancelar()}),a(5,"\u2B05\uFE0F"),i(),o(6,"button",7),b("click",function(){return c.excluirItem()}),s(7,Y,2,0,"ng-container",8)(8,Z,2,0,"ng-container",8),i(),o(9,"button",9),b("click",function(){return c.editarItem()}),s(10,ee,2,0,"ng-container",8)(11,te,2,0,"ng-container",8),i()()()),t&2&&(r(),m("ngIf",c.carregando),r(),m("ngIf",!c.carregando&&c.item),r(4),m("disabled",c.processandoExcluir),r(),m("ngIf",!c.processandoExcluir),r(),m("ngIf",c.processandoExcluir),r(),m("disabled",c.processandoEditar),r(),m("ngIf",!c.processandoEditar),r(),m("ngIf",c.processandoEditar))},dependencies:[A,L],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.detalhes-section[_ngcontent-%COMP%]{background:#242424;border:1px solid #333;border-radius:6px;padding:8px 12px;margin-bottom:10px;cursor:pointer}.detalhes-section[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{color:#0dcaf0;font-weight:600;cursor:pointer;list-style:none;outline:none}.detalhes-section[open][_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{color:#ffc107}.detalhes-section[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none}.descricao-text[_ngcontent-%COMP%]{white-space:pre-line;color:#ddd;font-size:.95rem;background:#2a2a2a;border-radius:6px;padding:8px 10px;line-height:1.4;margin-top:8px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}"]})};export{q as ItemInventario};
