import{a as h}from"./chunk-DU24F7PH.js";import{a as v,b as P,c as l,e as I,f as d,g as j,h as S,i as x,j as y,l as c,m as o,n as A,o as w,q as f,r as a,s as b,t as g,y as B}from"./chunk-DNBBXYBI.js";var u=class{static DB_NAME="VafyndellDB";static DB_VERSION=1;static db=null;static storeConfigs=[];static init(){return l(this,arguments,function*(t=[]){if(!this.db)return this.storeConfigs=t,new Promise((e,i)=>{let n=indexedDB.open(this.DB_NAME,this.DB_VERSION);n.onerror=()=>i(n.error),n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=r=>{let s=r.target.result;this.storeConfigs.forEach(p=>{s.objectStoreNames.contains(p.name)||s.createObjectStore(p.name,{keyPath:p.keyPath,autoIncrement:p.autoIncrement||!1})})}})})}static storeExists(t){return this.db?.objectStoreNames.contains(t)??!1}static ensureStore(t,e="id"){return l(this,null,function*(){this.storeExists(t)||(this.db?.close(),this.db=null,this.DB_VERSION++,this.storeConfigs.push({name:t,keyPath:e}),yield this.init(this.storeConfigs))})}static put(t,e,i="id"){return l(this,null,function*(){return yield this.ensureStore(t,i),new Promise((n,r)=>{let s=this.db.transaction(t,"readwrite");s.objectStore(t).put(e),s.oncomplete=()=>n(),s.onerror=()=>r(s.error)})})}static bulkPut(t,e,i="id"){return l(this,null,function*(){return yield this.ensureStore(t,i),new Promise((n,r)=>{let s=this.db.transaction(t,"readwrite"),p=s.objectStore(t);e.forEach(_=>p.put(_)),s.oncomplete=()=>n(),s.onerror=()=>r(s.error)})})}static get(t,e){return l(this,null,function*(){return this.storeExists(t)?new Promise((i,n)=>{let s=this.db.transaction(t,"readonly").objectStore(t).get(e);s.onsuccess=()=>i(s.result||null),s.onerror=()=>n(s.error)}):null})}static getAll(t){return l(this,null,function*(){return this.storeExists(t)?new Promise((e,i)=>{let r=this.db.transaction(t,"readonly").objectStore(t).getAll();r.onsuccess=()=>e(r.result),r.onerror=()=>i(r.error)}):[]})}static delete(t,e,i="id"){return l(this,null,function*(){if(this.storeExists(t))return yield this.ensureStore(t,i),new Promise((n,r)=>{let s=this.db.transaction(t,"readwrite");s.objectStore(t).delete(e),s.oncomplete=()=>n(),s.onerror=()=>r(s.error)})})}static clear(t,e="id"){return l(this,null,function*(){if(this.storeExists(t))return yield this.ensureStore(t,e),new Promise((i,n)=>{let r=this.db.transaction(t,"readwrite");r.objectStore(t).clear(),r.oncomplete=()=>i(),r.onerror=()=>n(r.error)})})}};var E=class{static ENDPOINT="https://script.google.com/macros/s/AKfycbwXF5mzI1eYZATAS3DmGVsUiUirnW5AurHZcorH6zYt-PO-5wFqMM3lN7Z9aISbbQZO/exec";static SHEET_ID="19B2aMGrajvhPJfOvYXt059-fECytaN38iFsP8GInD_g";static call(t,e){return l(this,null,function*(){let i=h.getIdToken();if(!i)throw new Error("Usu\xE1rio n\xE3o autenticado.");let n={idToken:i,action:t,payload:P(v({},e),{sheetId:this.SHEET_ID})},r=yield fetch(this.ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error(`Erro no Script: ${r.status} - ${r.statusText}`);return r.json()})}static createRow(t){return this.call("sheet.createRow",t)}static getAll(t){return this.call("sheet.getAll",t)}static getByIndex(t){return this.call("sheet.getByIndex",t)}static getCell(t){return this.call("sheet.getCell",t)}static updateByIndex(t){return this.call("sheet.updateByIndex",t)}static updateCell(t){return this.call("sheet.updateCell",t)}static deleteByIndex(t){return this.call("sheet.deleteByIndex",t)}static upload(t){return this.call("drive.upload",t)}static update(t){return this.call("drive.update",t)}static remove(t){return this.call("drive.delete",t)}static controllerCreate(t){return this.call("controller.create",t)}static controllerGetAll(t){return this.call("controller.getAll",t)}static controllerGetByIndex(t){return this.call("controller.getByIndex",t)}static controllerGetCell(t){return this.call("controller.getCell",t)}static controllerUpdateByIndex(t){return this.call("controller.updateByIndex",t)}static controllerUpdateCell(t){return this.call("controller.updateCell",t)}static controllerDeleteByIndex(t){return this.call("controller.deleteByIndex",t)}};var T=class{static TAB="Personagem";static META_TAB="Metadados";static getCurrentJogador(){return l(this,null,function*(){let t=h.getUser();if(!t)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=t.email,i=yield u.getAll(this.TAB),n=i.find(r=>r.email===e)||null;return n?(this.validateAndSync(),n):(yield this.syncFromOnline(),i=yield u.getAll(this.TAB),n=i.find(r=>r.email===e)||null,n)})}static validateAndSync(){return l(this,null,function*(){try{let t=yield u.get(this.META_TAB,this.TAB),i=(yield E.controllerGetAll({tab:this.META_TAB})).find(s=>s.SheetName===this.TAB),n=t?.UltimaModificacao,r=i?.UltimaModificacao;(!n||n!==r)&&(yield this.syncFromOnline())}catch(t){console.error("Erro na valida\xE7\xE3o de sync de jogadores:",t)}})}static syncFromOnline(){return l(this,null,function*(){try{let t=yield E.controllerGetAll({tab:this.TAB});yield u.clear(this.TAB),yield u.bulkPut(this.TAB,t);let i=(yield E.controllerGetAll({tab:this.META_TAB})).find(n=>n.SheetName===this.TAB);i&&(yield u.put(this.META_TAB,{name:this.TAB,UltimaModificacao:i.UltimaModificacao}))}catch(t){console.error("Erro ao sincronizar jogadores online:",t)}})}};function D(m,t){if(m&1&&A(0,"img",4),m&2){let e=f(2);w("src",e.jogador==null?null:e.jogador.imagem,I)}}function M(m,t){if(m&1&&(c(0,"h2",2),a(1),o(),c(2,"p",3),a(3),o(),x(4,D,1,1,"img",4),c(5,"div",5)(6,"div",6)(7,"p")(8,"strong"),a(9,"Personagem:"),o(),a(10),o(),c(11,"p")(12,"strong"),a(13,"Classe de Armadura:"),o(),a(14),o(),c(15,"p")(16,"strong"),a(17,"Pontos de Vida:"),o(),a(18),o(),c(19,"p")(20,"strong"),a(21,"N\xEDvel:"),o(),a(22),o(),c(23,"p")(24,"strong"),a(25,"XP:"),o(),a(26),o(),c(27,"p")(28,"strong"),a(29,"For\xE7a:"),o(),a(30),o(),c(31,"p")(32,"strong"),a(33,"Destreza:"),o(),a(34),o(),c(35,"p")(36,"strong"),a(37,"Constitui\xE7\xE3o:"),o(),a(38),o(),c(39,"p")(40,"strong"),a(41,"Intelig\xEAncia:"),o(),a(42),o(),c(43,"p")(44,"strong"),a(45,"Sabedoria:"),o(),a(46),o(),c(47,"p")(48,"strong"),a(49,"Carisma:"),o(),a(50),o()()()),m&2){let e=f();d(),b(e.jogador==null?null:e.jogador.nome_do_jogador),d(2),b(e.jogador==null?null:e.jogador.email),d(),y(e.jogador!=null&&e.jogador.imagem?4:-1),d(6),g(" ",e.jogador==null?null:e.jogador.personagem),d(4),g(" ",e.jogador==null?null:e.jogador.classe_de_armadura),d(4),g(" ",e.jogador==null?null:e.jogador.pontos_de_vida),d(4),g(" ",e.jogador==null?null:e.jogador.nivel),d(4),g(" ",e.jogador==null?null:e.jogador.xp),d(4),g(" ",e.jogador==null?null:e.jogador.forca),d(4),g(" ",e.jogador==null?null:e.jogador.destreza),d(4),g(" ",e.jogador==null?null:e.jogador.constituicao),d(4),g(" ",e.jogador==null?null:e.jogador.inteligencia),d(4),g(" ",e.jogador==null?null:e.jogador.sabedoria),d(4),g(" ",e.jogador==null?null:e.jogador.carisma)}}function O(m,t){m&1&&(c(0,"div",1)(1,"div",7)(2,"span",8),a(3,"Carregando..."),o()()())}var C=class m{constructor(t){this.router=t}jogador=null;loading=!0;ngOnInit(){return l(this,null,function*(){try{if(!h.getUser()){this.router.navigate(["/login"]);return}let e=yield T.getCurrentJogador();if(!e){this.router.navigate(["/cadastro"]);return}this.jogador=e,this.loading=!1}catch(t){console.error("Erro ao carregar Jogador:",t),this.router.navigate(["/login"])}})}static \u0275fac=function(e){return new(e||m)(j(B))};static \u0275cmp=S({type:m,selectors:[["app-jogador"]],decls:3,vars:1,consts:[[1,"container","mt-5"],[1,"text-center","mt-5"],[1,"text-center"],[1,"text-center","text-muted"],["alt","Avatar",1,"img-thumbnail","mb-3",2,"max-width","150px","display","block","margin","auto",3,"src"],[1,"card","mt-4","shadow-sm"],[1,"card-body"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(e,i){e&1&&(c(0,"div",0),x(1,M,51,14)(2,O,4,0,"div",1),o()),e&2&&(d(),y(i.loading?2:1))},encapsulation:2})};export{C as Jogador};
