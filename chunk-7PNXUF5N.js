import{a as k}from"./chunk-XTMY4UAC.js";import"./chunk-2FJKFAQG.js";import{g as C,m as L,v as A,z as r}from"./chunk-QALXKQRA.js";import{Ab as v,Bb as t,Cb as i,Db as s,Hb as b,Ib as w,Jb as _,Nb as E,Pb as d,Ua as m,Za as g,Zb as y,bc as o,cc as I,eb as x,g as l,jb as h,la as u,ma as f,qc as S}from"./chunk-HRDPHWQR.js";function O(a,e){if(a&1){let n=_();b(0),t(1,"div",3)(2,"h1",4),o(3,"\u2694\uFE0F Vafyndell"),i(),t(4,"p",5),o(5," Bem-vindo, aventureiro! "),s(6,"br"),o(7," O seu RPG agora na palma das m\xE3os. "),i(),t(8,"div",6)(9,"button",7),E("click",function(){u(n);let c=d();return f(c.login())}),s(10,"img",8),t(11,"span",9),o(12,"Entrar na Taverna"),i()()()(),t(13,"div",10)(14,"p",11),o(15,"\u2728 Forje po\xE7\xF5es, enfrente bestas e registre suas aventuras"),i(),t(16,"p",11),o(17,"\u{1F3B2} Que os dados rolem sempre a seu favor!"),i()(),w()}}function T(a,e){if(a&1&&(t(0,"div",12),s(1,"div",13),t(2,"p",9),o(3),i(),t(4,"small",14),o(5,"Preparando o mundo..."),i()()),a&2){let n=d();m(3),I(n.mensagem)}}var F=class a{constructor(e,n){this.router=e;this.bootstrap=n}carregando=!1;mensagem="";ngOnInit(){return l(this,null,function*(){let e=r.getUser();if(e&&!r.isAuthenticated()){console.warn("[Login] Token expirado \u2192 limpando credenciais e banco"),yield r.logoutHard();return}e||(yield r.logoutHard(),console.warn("[Login] Nenhum usu\xE1rio \u2192 banco local limpo")),r.isAuthenticated()&&this.inicializarApp()})}login(){return l(this,null,function*(){if(r.isAuthenticated()){yield this.inicializarApp();return}try{this.carregando=!0,this.mensagem="Invocando grim\xF3rios...";let e=yield r.signInWithGoogle();e?(console.log("[Login] Login OK:",e),yield this.inicializarApp()):alert("Falha no login, tente novamente.")}catch(e){console.error("[Login] Erro no login:",e),alert("Erro no login. Verifique sua conex\xE3o e tente novamente.")}})}inicializarApp(){return l(this,null,function*(){this.carregando=!0,this.mensagem="Carregando tomos antigos...";try{yield this.bootstrap.preloadAll(e=>this.mensagem=e),console.log("[Login] Preload conclu\xEDdo!"),this.router.navigate(["/jogador"])}catch(e){console.error("[Login] Erro no preload:",e),alert("Erro ao carregar os dados iniciais. Tente novamente.")}finally{this.carregando=!1}})}static \u0275fac=function(n){return new(n||a)(g(A),g(k))};static \u0275cmp=x({type:a,selectors:[["app-login"]],decls:4,vars:2,consts:[["loading",""],[1,"d-flex","flex-column","justify-content-center","align-items-center","vh-100","bg-dark","text-light","text-center","p-4",2,"background","linear-gradient(135deg, #1a1a1a, #2b1d0e)"],[4,"ngIf","ngIfElse"],[1,"p-4","rounded","shadow-lg",2,"background","rgba(0,0,0,0.6)","max-width","420px","width","100%"],[1,"fw-bold","display-4","text-warning","mb-2"],[1,"fst-italic","mb-4","text-light"],[1,"d-flex","justify-content-center"],[1,"btn","btn-warning","px-4","py-2","rounded-pill","d-flex","align-items-center","gap-2","shadow",3,"click"],["src","https://developers.google.com/identity/images/g-logo.png","alt","Google","width","20","height","20"],[1,"fw-bold"],[1,"mt-4","small","text-light-emphasis"],[1,"m-0"],[1,"text-center"],["role","status",1,"spinner-border","text-warning","mb-3"],[1,"text-muted"]],template:function(n,p){if(n&1&&(t(0,"div",1),h(1,O,18,0,"ng-container",2)(2,T,6,1,"ng-template",null,0,S),i()),n&2){let c=y(3);m(),v("ngIf",!p.carregando)("ngIfElse",c)}},dependencies:[L,C],styles:["body[_ngcontent-%COMP%]{background-color:#212529}h1[_ngcontent-%COMP%]{font-size:2.5rem;letter-spacing:1px}"]})};export{F as Login};
