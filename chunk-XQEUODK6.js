import{a as f}from"./chunk-6NKPA5WO.js";import{a as u}from"./chunk-X6WXRV32.js";import{b as B,e as $,h as q,q as U}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as W}from"./chunk-HS244SCX.js";import{Ga as c,Ha as a,Ia as r,Ib as N,Ja as w,Jb as z,Lb as A,Mb as R,Pa as S,Ra as _,S as y,T as C,Ta as g,Vb as V,a as I,b as D,d as b,fb as d,gb as v,ha as E,hb as h,ia as o,jb as M,kb as O,lb as T,ma as F,mb as P,nb as k,qa as J,qb as L,rb as j,ua as p}from"./chunk-ILJPX4RU.js";function H(i,t){if(i&1&&(a(0,"div",11)(1,"p",12),d(2,"\u{1F4E6} Itens distintos: "),a(3,"b"),d(4),r()(),a(5,"p",12),d(6,"\u2696\uFE0F Peso total: "),a(7,"b"),d(8),L(9,"number"),r()(),a(10,"p",13),d(11,"\u{1F4C2} Categorias: "),a(12,"b"),d(13),r()()()),i&2){let e=g();o(4),v(e.resumo.tipos),o(4),h("",j(9,3,e.resumo.pesoTotal,"1.0-2")," kg"),o(5),v(e.resumo.categorias)}}function K(i,t){i&1&&(a(0,"div",14),w(1,"div",15),a(2,"p",16),d(3,"Carregando invent\xE1rio..."),r()())}function Q(i,t){i&1&&(a(0,"div",17),d(1," Nenhum item encontrado. "),r())}function X(i,t){if(i&1&&w(0,"img",35),i&2){let e=g().$implicit;c("alt",k(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,E)}}function Z(i,t){i&1&&(a(0,"span",32),d(1,"\u{1F4E6}"),r())}function ee(i,t){if(i&1&&(a(0,"p",36),d(1),r()),i&2){let e=g().$implicit;o(),h(" \u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito," ")}}function te(i,t){if(i&1&&(a(0,"p",37),d(1),r()),i&2){let e=g().$implicit;o(),h(" \u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral," ")}}function ie(i,t){if(i&1){let e=S();a(0,"div",25)(1,"div",26),_("click",function(){let s=y(e).$implicit,l=g(4);return C(l.abrirItem(s.id))}),a(2,"div",27)(3,"div",28),p(4,X,1,3,"img",29)(5,Z,2,0,"span",30),r(),a(6,"div")(7,"h6",31),d(8),r(),a(9,"small",32),d(10),r()()(),p(11,ee,2,1,"p",33)(12,te,2,1,"p",34),r()()}if(i&2){let e=t.$implicit;o(4),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.imagem),o(),c("ngIf",!(e.itemDetalhe!=null&&e.itemDetalhe.imagem)),o(3),v((e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"),o(2),M(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | \u2696\uFE0F ",(e.itemDetalhe==null?null:e.itemDetalhe.peso)||0," kg "),o(),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),o(),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function ne(i,t){if(i&1&&(a(0,"div",16)(1,"div",23),p(2,ie,13,8,"div",24),r()()),i&2){let e=g().$implicit;o(2),c("ngForOf",e.itens)}}function ae(i,t){if(i&1){let e=S();a(0,"div",19)(1,"button",20),_("click",function(){let s=y(e).$implicit,l=g(2);return C(l.toggleCategoria(s))}),a(2,"span",21),d(3),r(),a(4,"span"),d(5),r()(),p(6,ne,3,1,"div",22),r()}if(i&2){let e=t.$implicit;o(3),v(e.nome),o(2),v(e.expandido?"\u2212":"+"),o(),c("ngIf",e.expandido)}}function oe(i,t){if(i&1&&(a(0,"div"),p(1,ae,7,3,"div",18),r()),i&2){let e=g();o(),c("ngForOf",e.categoriasFiltradas)}}var Y=class i{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,n)=>e+(n.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,n)=>e+(n.quantidade||0)*(n.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}ngOnInit(){return b(this,null,function*(){try{console.log("[InventarioJogador] Iniciando carregamento..."),this.carregando=!0;let t=W.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield f.getLocalInventarioByJogador(t.email),n=yield u.getLocalItens();if(e?.length&&(console.log("[InventarioJogador] Invent\xE1rio local encontrado."),this.processarInventario(e,n),this.carregando=!1),Promise.all([f.syncInventario(),u.syncItens()]).then(m=>b(this,[m],function*([s,l]){if(s||l){console.log("[InventarioJogador] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let x=yield f.getLocalInventarioByJogador(t.email),G=yield u.getLocalItens();this.processarInventario(x,G)}else console.log("[InventarioJogador] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!e?.length){console.log("[InventarioJogador] Nenhum invent\xE1rio local. Buscando online...");let s=yield f.forceFetchInventario(),l=yield u.getLocalItens();this.processarInventario(s,l),this.carregando=!1}}catch(t){console.error("[InventarioJogador] Erro ao carregar invent\xE1rio:",t),this.carregando=!1}})}processarInventario(t,e){let n=t.map(l=>{let m=e.find(x=>x.id===l.item_catalogo);return D(I({},l),{itemDetalhe:m})}),s=new Map;n.forEach(l=>{let m=l.itemDetalhe?.categoria||"Outros";s.has(m)||s.set(m,[]),s.get(m).push(l)}),this.categorias=Array.from(s.entries()).sort((l,m)=>String(l[0]||"").localeCompare(String(m[0]||""))).map(([l,m])=>({nome:String(l||"Outros"),itens:m,expandido:!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}toggleCategoria(t){t.expandido=!t.expandido}aplicarFiltro(){let t=this.filtro.toLowerCase();if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>D(I({},e),{itens:e.itens.filter(n=>String(n.itemDetalhe?.nome||"").toLowerCase().includes(t)||String(n.itemDetalhe?.raridade||"").toLowerCase().includes(t)||String(n.itemDetalhe?.categoria||"").toLowerCase().includes(t))})).filter(e=>e.itens.length>0)}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}static \u0275fac=function(e){return new(e||i)(F(V))};static \u0275cmp=J({type:i,selectors:[["app-inventario-jogador"]],decls:13,vars:5,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","bg-dark","text-light","border-light","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3"],[1,"fw-bold","mb-3"],["class","card bg-secondary text-light p-3 mb-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab","btn","btn-primary","rounded-circle","shadow-lg"],[1,"fs-4"],[1,"card","bg-secondary","text-light","p-3","mb-4"],[1,"mb-1"],[1,"mb-0"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-outline-light","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","shadow-sm","h-100","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"rounded","me-3","d-flex","align-items-center","justify-content-center","bg-dark",2,"width","45px","height","45px","overflow","hidden"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-muted"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"small","mt-2","text-info"],[1,"small","text-danger"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"input",2),P("ngModelChange",function(l){return T(n.filtro,l)||(n.filtro=l),l}),_("input",function(){return n.aplicarFiltro()}),r()(),a(3,"div",3)(4,"h4",4),d(5,"\u{1F392} Invent\xE1rio"),r(),p(6,H,14,6,"div",5)(7,K,4,0,"div",6)(8,Q,2,0,"div",7)(9,oe,2,1,"div",8),r(),a(10,"button",9)(11,"span",10),d(12,"\uFF0B"),r()()()),e&2&&(o(2),O("ngModel",n.filtro),o(4),c("ngIf",!n.carregando&&n.categoriasFiltradas.length>0),o(),c("ngIf",n.carregando),o(),c("ngIf",!n.carregando&&n.categoriasFiltradas.length===0),o(),c("ngIf",!n.carregando))},dependencies:[R,N,z,U,B,$,q,A],styles:[".inventario-card[_ngcontent-%COMP%]{border-radius:10px;background:#495057;color:#f8f9fa;transition:transform .15s ease,box-shadow .15s ease}.inventario-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.inventario-card[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#0dcaf0!important}.inventario-card[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#ff6b6b!important}.inventario-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#adb5bd}.btn-acao[_ngcontent-%COMP%]{border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:18px;padding:0}.fab[_ngcontent-%COMP%]{position:fixed;bottom:80px;right:20px;width:60px;height:60px;border-radius:50%;font-size:32px;display:flex;align-items:center;justify-content:center}.btn-categoria[_ngcontent-%COMP%]{border-radius:8px!important;text-align:left;font-weight:700}"]})};export{Y as InventarioJogador};
