import{a as f}from"./chunk-G46V626D.js";import{b as L,e as V,h as j,q as z}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import"./chunk-HS244SCX.js";import{Ga as l,Ha as o,Ia as r,Ib as O,Ja as h,Jb as D,Mb as k,Pa as b,Ra as _,S as x,T as v,Ta as g,Vb as T,a as C,b as N,d as u,fb as c,gb as d,ha as y,ia as a,ib as I,kb as M,lb as P,ma as w,mb as E,nb as F,qa as S,ua as m}from"./chunk-ILJPX4RU.js";function R(n,e){n&1&&(o(0,"div",10),h(1,"div",11),o(2,"p",12),c(3,"Carregando NPCs..."),r()())}function A(n,e){n&1&&(o(0,"div",13),c(1," Nenhum NPC encontrado. "),r())}function B(n,e){if(n&1&&h(0,"img",29),n&2){let t=g().$implicit;l("alt",F(t.nome))("src",t.imagem,y)}}function W(n,e){if(n&1&&(o(0,"p",30),c(1),r()),n&2){let t=g().$implicit;a(),d(t.descricao)}}function q(n,e){if(n&1){let t=b();o(0,"div",21)(1,"div",22),_("click",function(){let s=x(t).$implicit,p=g(4);return v(p.abrirItem(s))}),o(2,"div",23),m(3,B,1,3,"img",24),o(4,"div")(5,"h6",25),c(6),r(),o(7,"small",26),c(8),r()()(),o(9,"p",27),c(10," \u2764\uFE0F Vida: "),o(11,"b"),c(12),r(),c(13," | \u{1F6E1}\uFE0F Arm: "),o(14,"b"),c(15),r(),c(16," | \u2B50 XP: "),o(17,"b"),c(18),r()(),m(19,W,2,1,"p",28),r()()}if(n&2){let t=e.$implicit;a(3),l("ngIf",t.imagem),a(3),d(t.nome),a(2),I(" ",t.tipo," | ",t.alinhamento||"Sem alinhamento"," "),a(4),d(t.pontos_de_vida),a(3),d(t.classe_armadura),a(3),d(t.xp),a(),l("ngIf",t.descricao)}}function U(n,e){if(n&1&&(o(0,"div",12)(1,"div",19),m(2,q,20,8,"div",20),r()()),n&2){let t=g().$implicit;a(2),l("ngForOf",t.itens)}}function X(n,e){if(n&1){let t=b();o(0,"div",15)(1,"button",16),_("click",function(){let s=x(t).$implicit,p=g(2);return v(p.toggleCategoria(s))}),o(2,"span",17),c(3),r(),o(4,"span"),c(5),r()(),m(6,U,3,1,"div",18),r()}if(n&2){let t=e.$implicit;a(3),d(t.nome),a(2),d(t.expandido?"\u2212":"+"),a(),l("ngIf",t.expandido)}}function G(n,e){if(n&1&&(o(0,"div"),m(1,X,7,3,"div",14),r()),n&2){let t=g();a(),l("ngForOf",t.categoriasFiltradas)}}var $=class n{constructor(e){this.router=e}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";ngOnInit(){return u(this,null,function*(){try{this.carregando=!0;let e=yield f.getLocalNpcs();if(this.processarCategorias(e),f.syncNpcs().then(t=>u(this,null,function*(){if(t){let i=yield f.getLocalNpcs();this.processarCategorias(i)}})),e.length===0){let t=yield f.forceFetchNpcs();this.processarCategorias(t)}}catch(e){console.error("[Npcs] Erro ao carregar NPCs:",e)}finally{this.carregando=!1}})}processarCategorias(e){let t=new Map;e.forEach(i=>{let s=i.classificacao||"Outros";t.has(s)||t.set(s,[]),t.get(s).push(i)}),this.categorias=Array.from(t.entries()).sort((i,s)=>String(i[0]).localeCompare(String(s[0]))).map(([i,s])=>({nome:i,itens:s,expandido:!1})),this.categoriasFiltradas=[...this.categorias]}aplicarFiltro(){let e=this.filtro.toLowerCase();if(!e){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(t=>N(C({},t),{itens:t.itens.filter(i=>String(i.nome||"").toLowerCase().includes(e)||String(i.tipo||"").toLowerCase().includes(e)||String(i.descricao||"").toLowerCase().includes(e)||String(i.alinhamento||"").toLowerCase().includes(e))})).filter(t=>t.itens.length>0)}toggleCategoria(e){e.expandido=!e.expandido}abrirItem(e){this.router.navigate(["/npc-detalhes",e.id],{queryParams:{returnUrl:"/npcs"}})}novoNpc(){this.router.navigate(["/cadastro-npc"])}static \u0275fac=function(t){return new(t||n)(w(T))};static \u0275cmp=S({type:n,selectors:[["app-npcs"]],decls:12,vars:4,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar NPCs...",1,"form-control","bg-dark","text-light","border-light","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3","pb-5"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab","btn","btn-primary","rounded-circle","shadow-lg",3,"click"],[1,"fs-4"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-outline-light","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","shadow-sm","h-100","p-3","bg-secondary","text-light",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],["class","rounded me-3","style","width: 55px; height: 55px; object-fit: cover;",3,"src","alt",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-muted"],[1,"small","mb-1"],["class","small fst-italic",4,"ngIf"],[1,"rounded","me-3",2,"width","55px","height","55px","object-fit","cover",3,"src","alt"],[1,"small","fst-italic"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),E("ngModelChange",function(p){return P(i.filtro,p)||(i.filtro=p),p}),_("input",function(){return i.aplicarFiltro()}),r()(),o(3,"div",3)(4,"h4",4),c(5,"\u{1F479} NPCs"),r(),m(6,R,4,0,"div",5)(7,A,2,0,"div",6)(8,G,2,1,"div",7),r(),o(9,"button",8),_("click",function(){return i.novoNpc()}),o(10,"span",9),c(11,"\uFF0B"),r()()()),t&2&&(a(2),M("ngModel",i.filtro),a(4),l("ngIf",i.carregando),a(),l("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),a(),l("ngIf",!i.carregando))},dependencies:[k,O,D,z,L,V,j],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:12px;transition:all .2s ease-in-out}.card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#3a3a3a!important}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:55px;height:55px;object-fit:cover;border-radius:8px;box-shadow:0 2px 6px #0006}h4[_ngcontent-%COMP%]{color:#fff;margin-bottom:1rem}h6[_ngcontent-%COMP%]{color:#fff;margin-bottom:0}p[_ngcontent-%COMP%], small[_ngcontent-%COMP%]{color:#ccc}button.btn-outline-light[_ngcontent-%COMP%]{border:1px solid #666;background:#1e1e1e;border-radius:10px}button.btn-outline-light[_ngcontent-%COMP%]:hover{background:#333;border-color:#888}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}.fab[_ngcontent-%COMP%]{position:fixed;bottom:80px;right:20px;width:55px;height:55px;border-radius:50%;font-size:1.5rem;display:flex;align-items:center;justify-content:center}.p-3.bg-black[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}input.form-control[_ngcontent-%COMP%]{border-radius:50px;padding-left:1.2rem;font-size:.95rem;transition:all .2s ease-in-out}input.form-control[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 6px #0d6efd99;outline:none}"]})};export{$ as Npcs};
