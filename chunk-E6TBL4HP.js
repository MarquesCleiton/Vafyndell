import{a as w}from"./chunk-V3YZ2GSY.js";import{c as k,f as R,g as F,m as T,t as z,v as j}from"./chunk-7ENCPJQF.js";import{$b as O,Ab as c,Bb as a,Cb as g,Gb as f,Hb as u,Mb as h,Ob as p,Sa as v,Ta as o,Ya as C,Yb as I,ac as r,bc as M,cc as s,db as D,dc as E,g as x,ib as m,ic as P,jc as S,pc as y,zb as d}from"./chunk-DNZPJZVY.js";function N(e,i){e&1&&(c(0,"div",11),g(1,"div",12),c(2,"p",13),r(3,"Carregando item..."),a()())}function A(e,i){if(e&1&&(f(0),g(1,"img",29),u()),e&2){let t=p(2);o(),d("alt",P(t.item.nome||"Item"))("src",t.item.imagem,v)}}function B(e,i){e&1&&(c(0,"div",30),r(1," \u{1F4E6} "),a())}function $(e,i){if(e&1&&(c(0,"p",31),r(1," \u2728 "),c(2,"b"),r(3,"Efeito:"),a(),r(4),a()),e&2){let t=p(2);o(4),s(" ",t.item.efeito," ")}}function U(e,i){if(e&1&&(c(0,"p",32),r(1," \u26A0\uFE0F "),c(2,"b"),r(3,"Colateral:"),a(),r(4),a()),e&2){let t=p(2);o(4),s(" ",t.item.colateral," ")}}function V(e,i){if(e&1&&(c(0,"p",33),r(1," \u{1F4DD} "),c(2,"b"),r(3,"Descri\xE7\xE3o:"),a(),r(4),a()),e&2){let t=p(2);o(4),s(" ",t.item.descricao," ")}}function G(e,i){if(e&1&&(f(0),g(1,"img",45),u()),e&2){let t=p().$implicit;o(),d("src",t.item.imagem,v)}}function H(e,i){e&1&&(c(0,"span",46),r(1,"\u{1F4E6}"),a())}function J(e,i){if(e&1&&(c(0,"div",41)(1,"div",42),m(2,G,2,1,"ng-container",20)(3,H,2,0,"ng-template",null,1,y),c(5,"span",43),r(6),a()(),c(7,"span",44),r(8),a()()),e&2){let t=i.$implicit,n=I(4);o(2),d("ngIf",t.item.imagem&&(t.item==null?null:t.item.imagem)!=="-")("ngIfElse",n),o(4),M(t.item.nome||"Ingrediente"),o(2),s("x",t.quantidade)}}function K(e,i){if(e&1&&(c(0,"div",34)(1,"h5",35),r(2,"\u{1F963} Receita"),a(),c(3,"div",36),m(4,J,9,4,"div",37),a(),c(5,"div",38)(6,"div",39),r(7,"\u2692\uFE0F Produz"),a(),c(8,"div",40),r(9),a()()()),e&2){let t=p(2);o(4),d("ngForOf",t.ingredientesDetalhados),o(5),E(" ",t.item.quantidade_fabricavel||1," ",t.item.unidade_medida||"unidade(s)"," ")}}function Q(e,i){if(e&1&&(c(0,"div",14)(1,"div",15)(2,"div",16)(3,"div",17)(4,"h4",18),r(5),a()(),c(6,"div",19),m(7,A,2,3,"ng-container",20)(8,B,2,0,"ng-template",null,0,y),a(),c(10,"div",21)(11,"p",22)(12,"b"),r(13,"\u{1F4C2} Categoria:"),a(),r(14),a(),c(15,"p",22)(16,"b"),r(17,"\u{1F331} Origem:"),a(),r(18),a(),c(19,"p",22)(20,"b"),r(21,"\u{1F48E} Raridade:"),a(),c(22,"span"),r(23),a()(),c(24,"p",23)(25,"b"),r(26,"\u2696\uFE0F Peso:"),a(),r(27),a(),g(28,"hr",24),m(29,$,5,1,"p",25)(30,U,5,1,"p",26)(31,V,5,1,"p",27),a(),m(32,K,10,3,"div",28),a()()()),e&2){let t=I(9),n=p();o(5),s(" \u{1F4E6} ",n.item.nome||"Sem nome"," "),o(2),d("ngIf",n.item.imagem&&n.item.imagem!=="-")("ngIfElse",t),o(7),s(" ",n.item.categoria),o(4),s(" ",n.item.origem),o(4),O(S("raridade ",n.getRaridadeClass(n.item.raridade))),o(),s(" ",n.item.raridade||"Comum"," "),o(4),E(" ",n.item.peso," ",n.item.unidade_medida),o(2),d("ngIf",n.item.efeito),o(),d("ngIf",n.item.colateral),o(),d("ngIf",n.item.descricao),o(),d("ngIf",n.ingredientesDetalhados.length>0)}}function W(e,i){e&1&&(f(0),r(1,"\u270F\uFE0F"),u())}function X(e,i){e&1&&(f(0),g(1,"span",47),u())}function Y(e,i){e&1&&(f(0),r(1,"\u{1F5D1}\uFE0F"),u())}function Z(e,i){e&1&&(f(0),g(1,"span",47),u())}var q=class e{constructor(i,t,n){this.route=i;this.router=t;this.location=n}item=null;ingredientesDetalhados=[];carregando=!0;processandoEditar=!1;processandoExcluir=!1;repoCatalogo=new w("Catalogo");repoReceitas=new w("Receitas");ngOnInit(){return x(this,null,function*(){try{console.log("[ItemCatalogo] Iniciando carregamento..."),this.carregando=!0;let i=this.route.snapshot.paramMap.get("id");if(!i){this.router.navigate(["/catalogo"]);return}let t=yield this.repoCatalogo.getById(i,!0);if(t&&(this.item=t,this.carregando=!1,yield this.carregarReceita(i)),Promise.all([this.repoCatalogo.sync(),this.repoReceitas.sync()]).then(n=>x(this,null,function*(){let l=yield this.repoCatalogo.getById(i,!0);l&&(this.item=l,yield this.carregarReceita(i))})),!t){console.log("[ItemCatalogo] N\xE3o encontrado localmente \u2192 for\xE7ando fetch online");let l=(yield this.repoCatalogo.forceFetch()).find(b=>String(b.id)===i);l?(this.item=l,yield this.carregarReceita(i,!0)):(console.warn("[ItemCatalogo] Item n\xE3o encontrado nem online"),this.router.navigate(["/catalogo"])),this.carregando=!1}}catch(i){console.error("[ItemCatalogo] Erro ao carregar item:",i),this.carregando=!1}})}carregarReceita(i,t=!1){return x(this,null,function*(){let l=(t?yield this.repoReceitas.forceFetch():yield this.repoReceitas.getLocal()).filter(_=>String(_.fabricavel)===String(i));if(l.length===0){this.ingredientesDetalhados=[];return}let b=yield this.repoCatalogo.getLocal();this.ingredientesDetalhados=l.map(_=>({item:b.find(L=>String(L.id)===String(_.catalogo))||{},quantidade:_.quantidade}))})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-item-catalogo",this.item.id]),this.processandoEditar=!1},300))}excluirItem(){return x(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja excluir o item "${this.item.nome}"?`))){this.processandoExcluir=!0;try{yield this.repoCatalogo.delete(this.item.id),alert("\u2705 Item exclu\xEDdo com sucesso!"),this.router.navigate(["/catalogo"])}catch(t){console.error("[ItemCatalogo] Erro ao excluir item:",t),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}getRaridadeClass(i){switch((i||"").toLowerCase()){case"comum":return"raridade-comum";case"incomum":return"raridade-incomum";case"raro":return"raridade-raro";case"\xE9pico":case"epico":return"raridade-epico";case"lend\xE1rio":case"lendario":return"raridade-lendario";default:return"raridade-comum"}}static \u0275fac=function(t){return new(t||e)(C(z),C(j),C(k))};static \u0275cmp=D({type:e,selectors:[["app-item-catalogo"]],decls:13,vars:8,consts:[["noImagem",""],["noImgIng",""],[1,"item-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],["class","text-center py-5",4,"ngIf"],["class","flex-grow-1 p-3 d-flex justify-content-center",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-warning",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-danger",3,"click","disabled"],[1,"fab","fab-primary",3,"click"],[1,"mb-5","py-5"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"item-detalhe-container","w-100"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-capitalize","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"text-light","mb-1"],[1,"text-light","mb-3"],[1,"border-secondary"],["class","mb-1 text-info",4,"ngIf"],["class","mb-1 text-danger",4,"ngIf"],["class","fst-italic text-light descricao-text",4,"ngIf"],["class","ingredientes-wrapper p-3 border-top",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mb-1","text-info"],[1,"mb-1","text-danger"],[1,"fst-italic","text-light","descricao-text"],[1,"ingredientes-wrapper","p-3","border-top"],[1,"fw-bold","text-light","mb-3"],[1,"ingredientes-grid","mb-3"],["class","ingrediente-card",4,"ngFor","ngForOf"],[1,"producao-card","text-center"],[1,"titulo"],[1,"quantidade"],[1,"ingrediente-card"],[1,"d-flex","align-items-center","gap-2"],[1,"nome"],[1,"qtd"],[1,"thumb-mini","rounded",3,"src"],[1,"fs-5"],[1,"spinner-border","spinner-border-sm"]],template:function(t,n){t&1&&(c(0,"div",2),m(1,N,4,0,"div",3)(2,Q,33,15,"div",4),c(3,"div",5)(4,"button",6),h("click",function(){return n.editarItem()}),m(5,W,2,0,"ng-container",7)(6,X,2,0,"ng-container",7),a(),c(7,"button",8),h("click",function(){return n.excluirItem()}),m(8,Y,2,0,"ng-container",7)(9,Z,2,0,"ng-container",7),a(),c(10,"button",9),h("click",function(){return n.cancelar()}),r(11," \u2B05\uFE0F "),a()()(),g(12,"div",10)),t&2&&(o(),d("ngIf",n.carregando),o(),d("ngIf",!n.carregando&&n.item),o(2),d("disabled",n.processandoEditar),o(),d("ngIf",!n.processandoEditar),o(),d("ngIf",n.processandoEditar),o(),d("disabled",n.processandoExcluir),o(),d("ngIf",!n.processandoExcluir),o(),d("ngIf",n.processandoExcluir))},dependencies:[T,R,F],styles:[".item-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.raridade[_ngcontent-%COMP%]{font-weight:700;padding:2px 8px;border-radius:6px}.raridade.comum[_ngcontent-%COMP%]{color:#ccc}.raridade.incomum[_ngcontent-%COMP%]{color:#00bcd4}.raridade.raro[_ngcontent-%COMP%]{color:#673ab7}.raridade.lendario[_ngcontent-%COMP%]{color:gold}.descricao-text[_ngcontent-%COMP%]{white-space:pre-line;color:#ddd;font-size:.95rem;background:#2a2a2a;border-radius:6px;padding:8px 10px;line-height:1.4;margin-top:8px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.item-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.ingredientes-wrapper[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:8px;margin-top:15px}.ingredientes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.ingrediente-card[_ngcontent-%COMP%]{background:#212529;border:1px solid #333;border-radius:8px;padding:8px 12px;display:flex;align-items:center;justify-content:space-between}.ingrediente-card[_ngcontent-%COMP%]   .nome[_ngcontent-%COMP%]{color:#f8f9fa;font-size:.9rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ingrediente-card[_ngcontent-%COMP%]   .qtd[_ngcontent-%COMP%]{font-weight:700;color:#0dcaf0;font-size:.85rem}.thumb-mini[_ngcontent-%COMP%]{width:28px;height:28px;object-fit:cover;border-radius:6px;border:1px solid #555}.producao-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:10px;padding:12px;margin-top:10px}.producao-card[_ngcontent-%COMP%]   .titulo[_ngcontent-%COMP%]{font-weight:600;color:#0dcaf0;margin-bottom:4px;font-size:.9rem}.producao-card[_ngcontent-%COMP%]   .quantidade[_ngcontent-%COMP%]{font-weight:700;color:#28a745;font-size:1rem}"]})};export{q as ItemCatalogo};
