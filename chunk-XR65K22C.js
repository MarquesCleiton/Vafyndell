import{a as B}from"./chunk-W4LWWI5Q.js";import{c as R,f as $,i as q,r as N}from"./chunk-7HYCYAOW.js";import{a as w}from"./chunk-DET3QFJ6.js";import{f as A,g as V,j,s as z,w as L}from"./chunk-7SGEPDVZ.js";import{$b as k,Ab as r,Bb as s,Cb as C,Ib as x,Mb as m,Ob as d,Sa as I,Ta as n,Ya as P,_b as u,a as M,ac as g,b as y,bc as h,cc as f,db as O,fc as D,g as _,gc as E,hc as S,ib as p,ic as F,jc as T,la as v,ma as b,zb as c}from"./chunk-DNZPJZVY.js";function J(o,e){if(o&1){let t=x();r(0,"li",5)(1,"button",6),m("click",function(){v(t);let a=d();return b(a.selecionarAba("ocultos"))}),g(2," \u{1F648} Ocultos "),s()()}if(o&2){let t=d();n(),u("active",t.abaAtiva==="ocultos")}}function G(o,e){o&1&&(r(0,"div",14),C(1,"div",15),r(2,"p",16),g(3,"Carregando cat\xE1logo..."),s()())}function H(o,e){o&1&&(r(0,"div",17),g(1," Nenhum item encontrado. "),s())}function K(o,e){if(o&1&&C(0,"img",35),o&2){let t=d().$implicit;c("alt",F(t.nome||"Item"))("src",t.imagem,I)}}function Q(o,e){o&1&&(r(0,"span",36),g(1,"\u{1F4E6}"),s())}function X(o,e){if(o&1&&(r(0,"p",37),g(1),s()),o&2){let t=d().$implicit;n(),f("\u2728 ",t.efeito)}}function Y(o,e){if(o&1&&(r(0,"p",38),g(1),s()),o&2){let t=d().$implicit;n(),f("\u26A0\uFE0F ",t.colateral)}}function Z(o,e){if(o&1&&(r(0,"p",39),g(1),s()),o&2){let t=d().$implicit;n(),f("\u{1F4DD} ",t.descricao)}}function tt(o,e){if(o&1&&(r(0,"span"),g(1),s()),o&2){let t=d(2).$implicit;n(),f(" ",t.visivel_jogadores?"\u{1F648} Ocultar":"\u{1F649} Mostrar"," ")}}function et(o,e){o&1&&C(0,"span",42)}function it(o,e){if(o&1){let t=x();r(0,"button",40),m("click",function(a){v(t);let l=d().$implicit,W=d(4);return b(W.toggleVisibilidade(a,l))}),p(1,tt,2,1,"span",11)(2,et,1,0,"span",41),s()}if(o&2){let t=d().$implicit,i=d(4);c("disabled",i.loadingVisibilidade[t.id]),n(),c("ngIf",!i.loadingVisibilidade[t.id]),n(),c("ngIf",i.loadingVisibilidade[t.id])}}function ot(o,e){if(o&1){let t=x();r(0,"div",24)(1,"div",25),m("click",function(){let a=v(t).$implicit,l=d(4);return b(l.abrirItem(a))}),r(2,"div",26)(3,"div",27),p(4,K,1,3,"img",28)(5,Q,2,0,"span",29),s(),r(6,"div")(7,"h6",30),g(8),s(),r(9,"small"),g(10),s()()(),p(11,X,2,1,"p",31)(12,Y,2,1,"p",32)(13,Z,2,1,"p",33)(14,it,3,3,"button",34),s()()}if(o&2){let t=e.$implicit,i=d(4);n(4),c("ngIf",t.imagem&&t.imagem!=="-"),n(),c("ngIf",!t.imagem||t.imagem==="-"),n(3),h(t.nome||"Sem nome"),n(),k(T("raridade ",i.getRaridadeClass(t.raridade))),n(),f(" ",t.raridade||"Comum"," "),n(),c("ngIf",t.efeito),n(),c("ngIf",t.colateral),n(),c("ngIf",t.descricao),n(),c("ngIf",i.ehMestre)}}function at(o,e){if(o&1&&(r(0,"div",16)(1,"div",22),p(2,ot,15,11,"div",23),s()()),o&2){let t=d().$implicit;n(2),c("ngForOf",t.itens)}}function nt(o,e){if(o&1){let t=x();r(0,"div",19)(1,"button",20),m("click",function(){let a=v(t).$implicit,l=d(2);return b(l.toggleCategoria(a))}),r(2,"span"),g(3),s(),r(4,"span"),g(5),s()(),p(6,at,3,1,"div",21),s()}if(o&2){let t=e.$implicit,i=d(2);c("hidden",i.abaAtiva!=="ocultos"&&!i.pertenceAba(t.nome)),n(3),h(t.nome||"Outros"),n(2),h(t.expandido?"\u2212":"+"),n(),c("ngIf",t.expandido)}}function rt(o,e){if(o&1&&(r(0,"div"),p(1,nt,7,4,"div",18),s()),o&2){let t=d();n(),c("ngForOf",t.categoriasFiltradas)}}var U=class o{constructor(e){this.router=e}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="recursos";repo=new w("Catalogo");jogadorRepo=new w("Personagem");visibilidadeService=new B(this.repo);todosItens=[];ehMestre=!1;loadingVisibilidade={};mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return _(this,null,function*(){this.carregando=!0;try{yield this.definirSeEhMestre(),yield this.loadLocalAndSync()}catch(e){console.error("[Catalogo] Erro ao carregar itens:",e)}finally{this.carregando=!1}})}definirSeEhMestre(){return _(this,null,function*(){let e=L.getUser();if(e?.email){let i=(yield this.jogadorRepo.getLocal()).find(a=>a.email===e.email);this.ehMestre=i?.tipo_jogador==="Mestre",console.log(`[Catalogo] \u{1F451} Usu\xE1rio \xE9 mestre? ${this.ehMestre}`)}})}loadLocalAndSync(){return _(this,null,function*(){console.log("[Catalogo] \u{1F4C2} Carregando itens locais...");let e=yield this.repo.getLocal();if(this.todosItens=e,this.processarItens(this.todosItens),this.repo.sync().then(t=>_(this,null,function*(){if(t){console.log("[Catalogo] \u{1F504} Itens atualizados no servidor, recarregando...");let i=yield this.repo.getLocal();this.todosItens=i,this.processarItens(this.todosItens)}})),e.length===0){console.log("[Catalogo] \u{1F310} Nenhum item local, for\xE7ando fetch online...");let t=yield this.repo.forceFetch();this.todosItens=t,this.processarItens(this.todosItens)}})}processarItens(e){console.log(`[Catalogo] Processando ${e.length} itens...`);let t=new Map(this.categorias.map(a=>[a.nome,a.expandido])),i=new Map;e.filter(a=>this.abaAtiva==="ocultos"?this.ehMestre&&!a.visivel_jogadores:this.ehMestre?!0:a.visivel_jogadores).forEach(a=>{let l=a.categoria||"Outros";i.has(l)||i.set(l,[]),i.get(l).push(a)}),this.categorias=Array.from(i.entries()).sort(([a],[l])=>a.localeCompare(l)).map(([a,l])=>({nome:a,itens:l,expandido:t.get(a)??!1})),this.categoriasFiltradas=[...this.categorias]}aplicarFiltro(){let e=this.normalizarTexto(this.filtro);if(!e){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(t=>{let i=t.itens.filter(a=>[a.nome,a.raridade,a.efeito,a.colateral,a.categoria].map(l=>this.normalizarTexto(String(l||""))).some(l=>l.includes(e)));return y(M({},t),{itens:i,expandido:i.length>0})}).filter(t=>t.itens.length>0)}normalizarTexto(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(e){this.abaAtiva=e,this.processarItens(this.todosItens)}pertenceAba(e){return this.mapaAbas[this.abaAtiva].includes(e)}toggleCategoria(e){e.expandido=!e.expandido}abrirItem(e){this.router.navigate(["/item-catalogo",String(e.id)])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}getRaridadeClass(e){return e?String(e).toLowerCase():"comum"}toggleVisibilidade(e,t){return _(this,null,function*(){if(e.stopPropagation(),!!this.ehMestre){this.loadingVisibilidade[t.id]=!0;try{let i=yield this.visibilidadeService.toggleVisibilidade(t.id);i&&(t.visivel_jogadores=i.visivel_jogadores)}catch(i){console.error("[Catalogo] Erro ao alternar visibilidade:",i)}finally{this.loadingVisibilidade[t.id]=!1}}})}static \u0275fac=function(t){return new(t||o)(P(z))};static \u0275cmp=O({type:o,selectors:[["app-catalogo"]],decls:25,vars:13,consts:[[1,"catalogo-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar no cat\xE1logo...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["class","nav-item","role","presentation",4,"ngIf"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"catalogo-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",3,"hidden",4,"ngFor","ngForOf"],[1,"mb-3",3,"hidden"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","catalogo-card","shadow-sm","h-100","p-3","position-relative",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],["class","text-muted fs-4",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],["class","small descricao-text fst-italic",4,"ngIf"],["class","btn btn-sm btn-outline-warning position-absolute bottom-0 end-0 m-2 d-flex align-items-center gap-1",3,"disabled","click",4,"ngIf"],[3,"src","alt"],[1,"text-muted","fs-4"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[1,"small","descricao-text","fst-italic"],[1,"btn","btn-sm","btn-outline-warning","position-absolute","bottom-0","end-0","m-2","d-flex","align-items-center","gap-1",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"input",2),S("ngModelChange",function(l){return E(i.filtro,l)||(i.filtro=l),l}),m("input",function(){return i.aplicarFiltro()}),s()(),r(3,"ul",3),p(4,J,3,2,"li",4),r(5,"li",5)(6,"button",6),m("click",function(){return i.selecionarAba("recursos")}),g(7," \u{1F33F} Recursos "),s()(),r(8,"li",5)(9,"button",6),m("click",function(){return i.selecionarAba("equipamentos")}),g(10," \u2694\uFE0F Equipamentos "),s()(),r(11,"li",5)(12,"button",6),m("click",function(){return i.selecionarAba("pocoes")}),g(13," \u{1F9EA} Po\xE7\xF5es "),s()(),r(14,"li",5)(15,"button",6),m("click",function(){return i.selecionarAba("outros")}),g(16," \u{1F4E6} Outros "),s()()(),r(17,"div",7)(18,"div",8),p(19,G,4,0,"div",9)(20,H,2,0,"div",10)(21,rt,2,1,"div",11),s()(),r(22,"div",12)(23,"button",13),m("click",function(){return i.novoItem()}),g(24,"\uFF0B"),s()()()),t&2&&(n(2),D("ngModel",i.filtro),n(2),c("ngIf",i.ehMestre),n(2),u("active",i.abaAtiva==="recursos"),n(3),u("active",i.abaAtiva==="equipamentos"),n(3),u("active",i.abaAtiva==="pocoes"),n(3),u("active",i.abaAtiva==="outros"),n(4),c("ngIf",i.carregando),n(),c("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),n(),c("ngIf",!i.carregando))},dependencies:[j,A,V,N,R,$,q],styles:[".nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid #444}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600}.catalogo-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.catalogo-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#f8f9fa;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40;color:#fff}.catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease;color:#f1f1f1}.catalogo-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-thumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#bbb}.catalogo-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.catalogo-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ddd}.catalogo-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e0e0e0;white-space:pre-line}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.catalogo-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}"]})};export{U as Catalogo};
