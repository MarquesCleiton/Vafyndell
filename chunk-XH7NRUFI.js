import{a as _}from"./chunk-OONP6YPG.js";import"./chunk-MPFUFSQ6.js";import{c as k,g as F,j as M,q as P,s as R}from"./chunk-HRLERFBW.js";import{$b as d,Db as u,Eb as f,Fb as w,Jb as v,Lb as s,Pa as y,Qa as a,Va as E,Zb as i,_b as D,ab as S,ac as T,d as b,fb as p,fc as O,ia as I,ja as C,wb as c,xb as r,yb as n,zb as g}from"./chunk-QQSIVCMV.js";function z(t,o){t&1&&(r(0,"div",3),g(1,"div",4),r(2,"p",5),i(3,"Carregando item..."),n()())}function L(t,o){if(t&1&&g(0,"img",14),t&2){let e=s(2);c("alt",O(e.item.nome))("src",e.item.imagem,y)}}function A(t,o){if(t&1&&(r(0,"p")(1,"span",15),i(2,"\u2728"),n(),r(3,"b"),i(4,"Efeito:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.efeito)}}function N(t,o){if(t&1&&(r(0,"p")(1,"span",16),i(2,"\u26A0\uFE0F"),n(),r(3,"b"),i(4,"Colateral:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.colateral)}}function U(t,o){if(t&1&&(r(0,"p")(1,"span",17),i(2,"\u{1F4DD}"),n(),r(3,"b"),i(4,"Descri\xE7\xE3o:"),n(),i(5),n()),t&2){let e=s(2);a(5),d(" ",e.item.descricao)}}function q(t,o){t&1&&(u(0),i(1,"\u{1F5D1}\uFE0F Excluir"),f())}function B(t,o){t&1&&(u(0),g(1,"span",18),i(2," Excluindo... "),f())}function Y(t,o){t&1&&(u(0),i(1,"\u270F\uFE0F Editar"),f())}function $(t,o){t&1&&(u(0),g(1,"span",18),i(2," Editando... "),f())}function G(t,o){if(t&1){let e=w();u(0),r(1,"div",6),p(2,L,1,3,"img",7),n(),r(3,"h4",8),i(4),n(),r(5,"p")(6,"b"),i(7,"Categoria:"),n(),i(8),n(),r(9,"p")(10,"b"),i(11,"Origem:"),n(),i(12),n(),r(13,"p")(14,"b"),i(15,"Raridade:"),n(),i(16),n(),r(17,"p")(18,"b"),i(19,"Peso:"),n(),i(20),n(),g(21,"hr",9),p(22,A,6,1,"p",2)(23,N,6,1,"p",2)(24,U,6,1,"p",2),r(25,"div",10)(26,"button",11),v("click",function(){I(e);let m=s();return C(m.cancelar())}),i(27," \u2B05\uFE0F Cancelar "),n(),r(28,"button",12),v("click",function(){I(e);let m=s();return C(m.excluirItem())}),p(29,q,2,0,"ng-container",2)(30,B,3,0,"ng-container",2),n(),r(31,"button",13),v("click",function(){I(e);let m=s();return C(m.editarItem())}),p(32,Y,2,0,"ng-container",2)(33,$,3,0,"ng-container",2),n()(),f()}if(t&2){let e=s();a(2),c("ngIf",e.item.imagem),a(2),D(e.item.nome),a(4),d(" ",e.item.categoria),a(4),d(" ",e.item.origem),a(4),d(" ",e.item.raridade),a(4),T(" ",e.item.peso," ",e.item.unidade_medida),a(2),c("ngIf",e.item.efeito),a(),c("ngIf",e.item.colateral),a(),c("ngIf",e.item.descricao),a(4),c("disabled",e.processandoExcluir),a(),c("ngIf",!e.processandoExcluir),a(),c("ngIf",e.processandoExcluir),a(),c("disabled",e.processandoEditar),a(),c("ngIf",!e.processandoEditar),a(),c("ngIf",e.processandoEditar)}}var V=class t{constructor(o,e,l){this.route=o;this.router=e;this.location=l}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;ngOnInit(){return b(this,null,function*(){try{console.log("[ItemCatalogo] Iniciando carregamento..."),this.carregando=!0;let o=this.route.snapshot.paramMap.get("id");if(!o){this.router.navigate(["/catalogo"]);return}let l=(yield _.getLocalItens()).find(m=>String(m.id)===o)||null;if(l&&(this.item=l,this.carregando=!1),_.syncItens().then(m=>b(this,null,function*(){if(m){console.log("[ItemCatalogo] Sync trouxe altera\xE7\xF5es. Recarregando...");let x=(yield _.getLocalItens()).find(j=>String(j.id)===o);x&&(this.item=x)}})),!l){console.log("[ItemCatalogo] N\xE3o encontrado localmente \u2192 for\xE7ando fetch online");let h=(yield _.forceFetchItens()).find(x=>String(x.id)===o);h?this.item=h:(console.warn("[ItemCatalogo] Item n\xE3o encontrado nem online"),this.router.navigate(["/catalogo"])),this.carregando=!1}}catch(o){console.error("[ItemCatalogo] Erro ao carregar item:",o),this.carregando=!1}})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-item-catalogo",this.item.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},300))}excluirItem(){!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja excluir o item "${this.item.nome}"?`)||(this.processandoExcluir=!0,_.deleteItem(this.item.id).then(()=>{alert("\u2705 Item exclu\xEDdo com sucesso!"),this.router.navigate(["/catalogo"])}).catch(e=>{console.error("[ItemCatalogo] Erro ao excluir item:",e),alert("\u274C Erro ao excluir item. Veja o console.")}).finally(()=>this.processandoExcluir=!1))}static \u0275fac=function(e){return new(e||t)(E(P),E(R),E(k))};static \u0275cmp=S({type:t,selectors:[["app-item-catalogo"]],decls:3,vars:2,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"item-image","mb-3"],[3,"src","alt",4,"ngIf"],[1,"fw-bold","text-capitalize"],[1,"border-secondary"],[1,"d-flex","gap-2","mt-4"],[1,"btn","btn-secondary","flex-fill",3,"click"],[1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"btn","btn-outline-warning","flex-fill",3,"click","disabled"],[3,"src","alt"],[1,"text-warning"],[1,"text-danger"],[1,"text-info"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,l){e&1&&(r(0,"div",0),p(1,z,4,0,"div",1)(2,G,34,16,"ng-container",2),n()),e&2&&(a(),c("ngIf",l.carregando),a(),c("ngIf",!l.carregando&&l.item))},dependencies:[M,F],styles:[".item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:220px;object-fit:cover;border-radius:10px}h4[_ngcontent-%COMP%]{color:#fff;margin-bottom:.5rem}p[_ngcontent-%COMP%]{color:#ddd;margin-bottom:.4rem}hr[_ngcontent-%COMP%]{opacity:.3;margin:1rem 0}button[_ngcontent-%COMP%]{font-weight:500;border-radius:8px;padding:.5rem;transition:all .2s ease-in-out}button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}"]})};export{V as ItemCatalogo};
