import{a as J}from"./chunk-XQNWO7VY.js";import{a as K}from"./chunk-GYUQKXYZ.js";import{c as N,f as R,g as z,h as W,i as L,j as U,q as H,r as q}from"./chunk-7HYCYAOW.js";import{a as G}from"./chunk-DET3QFJ6.js";import{g as P,j as F,q as B,s as j,w as Z}from"./chunk-7SGEPDVZ.js";import{Ab as i,Bb as r,Cb as v,Gb as h,Hb as _,Ib as y,Mb as x,Ob as b,Sa as S,Ta as l,Ya as C,Yb as E,a as g,ac as s,cc as O,db as T,fc as M,g as f,gc as A,hc as D,ib as w,la as m,ma as u,mb as k,pc as V,za as I,zb as d}from"./chunk-DNZPJZVY.js";function X(o,n){if(o&1){let e=y();h(0),v(1,"img",23),i(2,"button",24),x("click",function(){m(e);let a=b();return u(a.removerImagem())}),s(3,"\u2716"),r(),_()}if(o&2){let e=b();l(),d("src",e.imagemBase64Temp||e.anotacao.imagem,S)}}function Y(o,n){if(o&1){let e=y();i(0,"label",25)(1,"span",26),s(2,"\u{1F4F7}"),r(),i(3,"input",27),x("change",function(a){m(e);let p=b();return u(p.onFileChange(a))}),r()()}}function $(o,n){o&1&&(h(0),s(1,"\u{1F4BE}"),_())}function ee(o,n){o&1&&(h(0),v(1,"span",28),_())}function te(o,n){o&1&&(h(0),s(1,"\u{1F5D1}\uFE0F"),_())}function ae(o,n){o&1&&(h(0),v(1,"span",28),_())}function ne(o,n){if(o&1){let e=y();i(0,"button",29),x("click",function(){m(e);let a=b();return u(a.excluir())}),w(1,te,2,0,"ng-container",20)(2,ae,2,0,"ng-container",20),r()}if(o&2){let e=b();d("disabled",e.excluindo),l(),d("ngIf",!e.excluindo),l(),d("ngIf",e.excluindo)}}var Q=class o{constructor(n,e,t,a){this.router=n;this.route=e;this.el=t;this.zone=a}anotacao={id:"",jogador:"",autor:"",titulo:"",descricao:"",imagem:"",data:"",tags:""};imagemBase64Temp=null;salvando=!1;excluindo=!1;editMode=!1;repo=new G("Anotacoes");ngOnInit(){return f(this,null,function*(){let n=this.route.snapshot.paramMap.get("id");if(n){this.editMode=!0;try{let e=yield this.repo.getById(n,!0);e&&(this.anotacao=g({},e),this.scheduleAutoExpand()),this.repo.sync().then(t=>f(this,null,function*(){if(t){let a=yield this.repo.getById(n,!0);a&&(this.anotacao=g({},a),this.scheduleAutoExpand())}}))}catch(e){console.error("[CriarAnotacao] Erro ao carregar anota\xE7\xE3o:",e)}}})}ngAfterViewInit(){this.scheduleAutoExpand()}scheduleAutoExpand(){this.zone.runOutsideAngular(()=>{setTimeout(()=>this.applyAutoExpand(),0)})}applyAutoExpand(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(e=>{let a=()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,300)+"px"};a(),e.addEventListener("input",a)})}onFileChange(n){return f(this,null,function*(){let e=n.target;if(e.files?.length){let t=e.files[0];try{this.imagemBase64Temp=yield K.toOptimizedBase64(t,.7,1024)}catch(a){console.error("[CriarAnotacao] Erro ao otimizar imagem:",a)}}})}removerImagem(){this.anotacao.imagem="-",this.imagemBase64Temp=null}salvar(n){return f(this,null,function*(){if(!n.invalid)try{this.salvando=!0;let e=Z.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");this.anotacao.autor=e.email,this.anotacao.jogador=e.email,(!this.editMode||!this.anotacao.data)&&(this.anotacao.data=new Date().toISOString());let t=g({},this.anotacao);if(this.imagemBase64Temp&&(t.imagem=this.imagemBase64Temp),this.editMode){let a=yield this.repo.update(t);this.anotacao=g({},a),window.alert("\u2705 Anota\xE7\xE3o atualizada!")}else{this.anotacao.id=J.generateULID();let a=yield this.repo.create(t);this.anotacao=g({},a),window.alert("\u2705 Anota\xE7\xE3o criada!")}this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao salvar anota\xE7\xE3o:",e),window.alert("\u274C Erro ao salvar anota\xE7\xE3o.")}finally{this.salvando=!1,this.imagemBase64Temp=null}})}cancelar(){this.router.navigate(["/anotacoes"])}excluir(){return f(this,null,function*(){if(!(!this.anotacao.id||!confirm(`\u{1F5D1} Deseja realmente excluir a anota\xE7\xE3o "${this.anotacao.titulo}"?`)))try{this.excluindo=!0,yield this.repo.delete(this.anotacao.id),window.alert("\u2705 Anota\xE7\xE3o exclu\xEDda com sucesso!"),this.router.navigate(["/anotacoes"])}catch(e){console.error("[CriarAnotacao] Erro ao excluir anota\xE7\xE3o:",e),window.alert("\u274C Erro ao excluir anota\xE7\xE3o.")}finally{this.excluindo=!1}})}static \u0275fac=function(e){return new(e||o)(C(j),C(B),C(I),C(k))};static \u0275cmp=T({type:o,selectors:[["app-criar-anotacao"]],decls:34,vars:10,consts:[["form","ngForm"],["uploadBox",""],[1,"anotacao-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"anotacao-detalhe-container","w-100"],["id","formAnotacao",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","titulo","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["rows","3","name","descricao","required","",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["type","text","name","tags","placeholder","ex: miss\xE3o, npc, combate...",1,"form-control","input-dark","text-light",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","submit","form","formAnotacao",1,"fab","fab-primary",3,"disabled"],[4,"ngIf"],["type","button","class","fab fab-danger",3,"disabled","click",4,"ngIf"],["type","button",1,"fab","fab-warning",3,"click"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm"],["type","button",1,"fab","fab-danger",3,"click","disabled"]],template:function(e,t){if(e&1){let a=y();i(0,"div",2)(1,"div",3)(2,"div",4)(3,"form",5,0),x("ngSubmit",function(){m(a);let c=E(4);return u(t.salvar(c))}),i(5,"div",6)(6,"div",7)(7,"div",8)(8,"h4",9),s(9),r()()(),i(10,"div",10),w(11,X,4,1,"ng-container",11)(12,Y,4,0,"ng-template",null,1,V),r(),i(14,"div",12)(15,"div",13)(16,"label",14),s(17,"\u{1F4CC} T\xEDtulo *"),r(),i(18,"input",15),D("ngModelChange",function(c){return m(a),A(t.anotacao.titulo,c)||(t.anotacao.titulo=c),u(c)}),r()(),i(19,"div",13)(20,"label",14),s(21,"\u{1F4D6} Descri\xE7\xE3o *"),r(),i(22,"textarea",16),D("ngModelChange",function(c){return m(a),A(t.anotacao.descricao,c)||(t.anotacao.descricao=c),u(c)}),r()(),i(23,"div",13)(24,"label",14),s(25,"\u{1F3F7}\uFE0F Tags"),r(),i(26,"input",17),D("ngModelChange",function(c){return m(a),A(t.anotacao.tags,c)||(t.anotacao.tags=c),u(c)}),r()()()()()()(),i(27,"div",18)(28,"button",19),w(29,$,2,0,"ng-container",20)(30,ee,2,0,"ng-container",20),r(),w(31,ne,3,3,"button",21),i(32,"button",22),x("click",function(){return m(a),u(t.cancelar())}),s(33," \u2B05\uFE0F "),r()()()}if(e&2){let a=E(4),p=E(13);l(9),O(" ",t.editMode?"\u270F\uFE0F Editar Anota\xE7\xE3o":"\u{1F4DD} Nova Anota\xE7\xE3o"," "),l(2),d("ngIf",t.imagemBase64Temp||t.anotacao.imagem&&t.anotacao.imagem!=="-")("ngIfElse",p),l(7),M("ngModel",t.anotacao.titulo),l(4),M("ngModel",t.anotacao.descricao),l(4),M("ngModel",t.anotacao.tags),l(2),d("disabled",a.invalid||t.salvando),l(),d("ngIf",!t.salvando),l(),d("ngIf",t.salvando),l(),d("ngIf",t.editMode)}},dependencies:[F,P,q,U,N,R,z,H,L,W],styles:[".anotacao-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.anotacao-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{max-height:280px;object-fit:cover;width:100%}.upload-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px dashed #666;border-radius:8px;padding:20px;cursor:pointer;color:#aaa}.upload-box[_ngcontent-%COMP%]:hover{border-color:#fff;color:#fff}.input-dark[_ngcontent-%COMP%]{background:#2a2a2a;color:#f1f1f1;border:1px solid #444}.input-dark[_ngcontent-%COMP%]:focus{background:#2a2a2a;color:#fff;border-color:#0d6efd;box-shadow:none}textarea.auto-expand[_ngcontent-%COMP%]{overflow-y:hidden;resize:none;min-height:60px;max-height:200px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.anotacao-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{Q as CriarAnotacao};
