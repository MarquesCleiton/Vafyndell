import{a as f}from"./chunk-6NKPA5WO.js";import{a as _}from"./chunk-X6WXRV32.js";import{b as B,e as $,h as q,q as U}from"./chunk-6EPUS52O.js";import"./chunk-W7DVKRY2.js";import{a as W}from"./chunk-HS244SCX.js";import{Ga as c,Ha as a,Ia as l,Ib as j,Ja as h,Jb as z,Lb as A,Mb as R,Pa as S,Ra as u,S as C,T as w,Ta as g,Vb as V,a as b,b as D,d as y,fb as d,gb as v,ha as E,hb as x,ia as r,jb as M,kb as O,lb as T,ma as F,mb as k,nb as P,qa as J,qb as L,rb as N,ua as p}from"./chunk-ILJPX4RU.js";function G(i,t){if(i&1&&(a(0,"div",12)(1,"p",13),d(2,"\u{1F4E6} Quantidade de itens: "),a(3,"b"),d(4),l()(),a(5,"p",13),d(6,"\u2696\uFE0F Peso total: "),a(7,"b"),d(8),L(9,"number"),l()(),a(10,"p",14),d(11,"\u{1F4C2} Categorias: "),a(12,"b"),d(13),l()()()),i&2){let e=g();r(4),v(e.resumo.tipos),r(4),x("",N(9,3,e.resumo.pesoTotal,"1.0-2")," kg"),r(5),v(e.resumo.categorias)}}function H(i,t){i&1&&(a(0,"div",15),h(1,"div",16),a(2,"p",17),d(3,"Carregando invent\xE1rio..."),l()())}function K(i,t){i&1&&(a(0,"div",18),d(1," Nenhum item encontrado. "),l())}function X(i,t){if(i&1&&h(0,"img",34),i&2){let e=g().$implicit;c("alt",P(e.itemDetalhe==null?null:e.itemDetalhe.nome))("src",e.itemDetalhe==null?null:e.itemDetalhe.imagem,E)}}function Z(i,t){if(i&1&&(a(0,"p",35),d(1),l()),i&2){let e=g().$implicit;r(),x(" \u2728 ",e.itemDetalhe==null?null:e.itemDetalhe.efeito," ")}}function ee(i,t){if(i&1&&(a(0,"p",36),d(1),l()),i&2){let e=g().$implicit;r(),x(" \u26A0\uFE0F ",e.itemDetalhe==null?null:e.itemDetalhe.colateral," ")}}function te(i,t){if(i&1){let e=S();a(0,"div",26)(1,"div",27),u("click",function(){let s=C(e).$implicit,o=g(4);return w(o.abrirItem(s.id))}),a(2,"div",28),p(3,X,1,3,"img",29),a(4,"div")(5,"h6",30),d(6),l(),a(7,"small",31),d(8),l()()(),p(9,Z,2,1,"p",32)(10,ee,2,1,"p",33),l()()}if(i&2){let e=t.$implicit;r(3),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.imagem),r(3),v((e.itemDetalhe==null?null:e.itemDetalhe.nome)||"Item desconhecido"),r(2),M(" ",e.quantidade," ",(e.itemDetalhe==null?null:e.itemDetalhe.unidade_medida)||""," | ",(e.itemDetalhe==null?null:e.itemDetalhe.peso)||0," kg "),r(),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.efeito),r(),c("ngIf",e.itemDetalhe==null?null:e.itemDetalhe.colateral)}}function ie(i,t){if(i&1&&(a(0,"div",17)(1,"div",24),p(2,te,11,7,"div",25),l()()),i&2){let e=g().$implicit;r(2),c("ngForOf",e.itens)}}function ne(i,t){if(i&1){let e=S();a(0,"div",20)(1,"button",21),u("click",function(){let s=C(e).$implicit,o=g(2);return w(o.toggleCategoria(s))}),a(2,"span",22),d(3),l(),a(4,"span"),d(5),l()(),p(6,ie,3,1,"div",23),l()}if(i&2){let e=t.$implicit;r(3),v(e.nome),r(2),v(e.expandido?"\u2212":"+"),r(),c("ngIf",e.expandido)}}function ae(i,t){if(i&1&&(a(0,"div"),p(1,ne,7,3,"div",19),l()),i&2){let e=g();r(),c("ngForOf",e.categoriasFiltradas)}}var Q=class i{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";resumo={tipos:0,unidades:0,pesoTotal:0,categorias:0};calcularResumo(){let t=this.categorias.flatMap(e=>e.itens);this.resumo.tipos=t.length,this.resumo.unidades=t.reduce((e,n)=>e+(n.quantidade||0),0),this.resumo.pesoTotal=t.reduce((e,n)=>e+(n.quantidade||0)*(n.itemDetalhe?.peso||0),0),this.resumo.categorias=this.categorias.length}ngOnInit(){return y(this,null,function*(){try{console.log("[InventarioJogador] Iniciando carregamento..."),this.carregando=!0;let t=W.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let e=yield f.getLocalInventarioByJogador(t.email),n=yield _.getLocalItens();if(e?.length&&(console.log("[InventarioJogador] Invent\xE1rio local encontrado."),this.processarInventario(e,n),this.carregando=!1),Promise.all([f.syncInventario(),_.syncItens()]).then(m=>y(this,[m],function*([s,o]){if(s||o){console.log("[InventarioJogador] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let I=yield f.getLocalInventarioByJogador(t.email),Y=yield _.getLocalItens();this.processarInventario(I,Y)}else console.log("[InventarioJogador] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!e?.length){console.log("[InventarioJogador] Nenhum invent\xE1rio local. Buscando online...");let s=yield f.forceFetchInventario(),o=yield _.getLocalItens();this.processarInventario(s,o),this.carregando=!1}}catch(t){console.error("[InventarioJogador] Erro ao carregar invent\xE1rio:",t),this.carregando=!1}})}processarInventario(t,e){let n=t.map(o=>{let m=e.find(I=>I.id===o.item_catalogo);return D(b({},o),{itemDetalhe:m})}),s=new Map;n.forEach(o=>{let m=o.itemDetalhe?.categoria||"Outros";s.has(m)||s.set(m,[]),s.get(m).push(o)}),this.categorias=Array.from(s.entries()).sort((o,m)=>String(o[0]||"").localeCompare(String(m[0]||""))).map(([o,m])=>({nome:String(o||"Outros"),itens:m,expandido:!1})),this.categoriasFiltradas=[...this.categorias],this.calcularResumo()}toggleCategoria(t){t.expandido=!t.expandido}aplicarFiltro(){let t=this.filtro.toLowerCase();if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>D(b({},e),{itens:e.itens.filter(n=>String(n.itemDetalhe?.nome||"").toLowerCase().includes(t)||String(n.itemDetalhe?.raridade||"").toLowerCase().includes(t)||String(n.itemDetalhe?.categoria||"").toLowerCase().includes(t))})).filter(e=>e.itens.length>0)}abrirItem(t){this.router.navigate(["/item-inventario",t])}novoItemInventario(){this.router.navigate(["/cadastro-inventario"])}static \u0275fac=function(e){return new(e||i)(F(V))};static \u0275cmp=J({type:i,selectors:[["app-inventario-jogador"]],decls:15,vars:5,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar no invent\xE1rio...",1,"form-control","bg-dark","text-light","border-light","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3"],[1,"fw-bold","mb-3"],["class","card bg-secondary text-light p-3 mb-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"flex-grow-1","p-3","pb-5"],[1,"fab","btn","btn-primary","rounded-circle","shadow-lg",3,"click"],[1,"fs-4"],[1,"card","bg-secondary","text-light","p-3","mb-4"],[1,"mb-1"],[1,"mb-0"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-outline-light","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","inventario-card","shadow-sm","h-100","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],["class","rounded me-3","style","width: 55px; height: 55px; object-fit: cover;",3,"src","alt",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"item-info"],["class","small mt-2 efeito-text",4,"ngIf"],["class","small colateral",4,"ngIf"],[1,"rounded","me-3",2,"width","55px","height","55px","object-fit","cover",3,"src","alt"],[1,"small","mt-2","efeito-text"],[1,"small","colateral"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"input",2),k("ngModelChange",function(o){return T(n.filtro,o)||(n.filtro=o),o}),u("input",function(){return n.aplicarFiltro()}),l()(),a(3,"div",3)(4,"h4",4),d(5,"\u{1F392} Invent\xE1rio"),l(),p(6,G,14,6,"div",5)(7,H,4,0,"div",6)(8,K,2,0,"div",7)(9,ae,2,1,"div",8),l(),a(10,"div",0),h(11,"div",9),a(12,"button",10),u("click",function(){return n.novoItemInventario()}),a(13,"span",11),d(14,"\uFF0B"),l()()()()),e&2&&(r(2),O("ngModel",n.filtro),r(4),c("ngIf",!n.carregando&&n.categoriasFiltradas.length>0),r(),c("ngIf",n.carregando),r(),c("ngIf",!n.carregando&&n.categoriasFiltradas.length===0),r(),c("ngIf",!n.carregando))},dependencies:[R,j,z,U,B,$,q,A],styles:[".inventario-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:12px;transition:all .2s ease-in-out}.inventario-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 14px #00000073}.item-info[_ngcontent-%COMP%]{color:#d0d0d0!important;font-size:.85rem}.efeito-text[_ngcontent-%COMP%]{color:#e6e6e6!important}.colateral[_ngcontent-%COMP%]{color:#c97a7a!important}.fab[_ngcontent-%COMP%]{position:fixed;bottom:80px;right:20px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;z-index:100;background:#0d6efd;border:none;transition:all .2s ease-in-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1);background:#0b5ed7}"]})};export{Q as InventarioJogador};
