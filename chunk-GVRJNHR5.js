import{a as g}from"./chunk-3JZCMNK3.js";import{c as N,f as V,i as j,r as B}from"./chunk-2MTP6EBK.js";import"./chunk-2P6BNU5L.js";import{f as k,g as O,j as L,s as P}from"./chunk-HRLERFBW.js";import{$b as f,Fb as b,Jb as _,Lb as p,Pa as C,Qa as r,Va as S,Zb as d,_b as A,a as y,ab as E,b as D,cc as I,d as u,dc as T,ec as F,fb as m,fc as M,ia as x,ja as v,wb as l,xb as o,yb as a,zb as h}from"./chunk-QQSIVCMV.js";function z(i,e){i&1&&(o(0,"div",10),h(1,"div",11),o(2,"p",12),d(3,"Carregando anota\xE7\xF5es..."),a()())}function R(i,e){i&1&&(o(0,"div",13),d(1," Nenhuma anota\xE7\xE3o encontrada. "),a())}function W(i,e){if(i&1&&h(0,"img",30),i&2){let t=p().$implicit;l("alt",M(t.titulo||"Anota\xE7\xE3o"))("src",t.imagem,C)}}function q(i,e){i&1&&(o(0,"span",31),d(1,"\u{1F4DD}"),a())}function U(i,e){if(i&1&&(o(0,"span"),d(1),a()),i&2){let t=p().$implicit;r(),f(" | #",t.tags)}}function Y(i,e){if(i&1&&(o(0,"p",32),d(1),a()),i&2){let t=p().$implicit;r(),f(" ",t.descricao," ")}}function G(i,e){if(i&1){let t=b();o(0,"div",21)(1,"div",22),_("click",function(){let s=x(t).$implicit,c=p(4);return v(c.abrirAnotacao(s))}),o(2,"div",23)(3,"div",24),m(4,W,1,3,"img",25)(5,q,2,0,"span",26),a(),o(6,"div")(7,"h6",27),d(8),a(),o(9,"small",28),d(10),m(11,U,2,1,"span",7),a()()(),m(12,Y,2,1,"p",29),a()()}if(i&2){let t=e.$implicit;r(4),l("ngIf",t.imagem),r(),l("ngIf",!t.imagem),r(3),A(t.titulo||"Sem t\xEDtulo"),r(2),f(" \u270D ",t.autor," "),r(),l("ngIf",t.tags),r(),l("ngIf",t.descricao)}}function H(i,e){if(i&1&&(o(0,"div",12)(1,"div",19),m(2,G,13,6,"div",20),a()()),i&2){let t=p().$implicit;r(2),l("ngForOf",t.itens)}}function J(i,e){if(i&1){let t=b();o(0,"div",15)(1,"button",16),_("click",function(){let s=x(t).$implicit,c=p(2);return v(c.toggleSecao(s))}),o(2,"span",17),d(3),a(),o(4,"span"),d(5),a()(),m(6,H,3,1,"div",18),a()}if(i&2){let t=e.$implicit,n=p(2);r(3),f("\u{1F4C5} ",n.formatarData(t.data)),r(2),A(t.expandido?"\u2212":"+"),r(),l("ngIf",t.expandido)}}function K(i,e){if(i&1&&(o(0,"div"),m(1,J,7,3,"div",14),a()),i&2){let t=p();r(),l("ngForOf",t.secoesFiltradas)}}var $=class i{constructor(e){this.router=e}secoes=[];secoesFiltradas=[];carregando=!0;filtro="";ngOnInit(){return u(this,null,function*(){try{console.log("[Anotacoes] Iniciando carregamento..."),this.carregando=!0;let e=yield g.getLocalAnotacoes();if(e.length&&(this.processarAnotacoes(e),this.carregando=!1),u(this,null,function*(){if(yield g.syncAnotacoes()){console.log("[Anotacoes] Sync trouxe altera\xE7\xF5es.");let n=yield g.getLocalAnotacoes();this.processarAnotacoes(n)}}),!e.length){console.log("[Anotacoes] Nenhuma anota\xE7\xE3o local. Buscando online...");let t=yield g.forceFetchAnotacoes();this.processarAnotacoes(t),this.carregando=!1}}catch(e){console.error("[Anotacoes] Erro ao carregar:",e),this.carregando=!1}})}processarAnotacoes(e){let t=new Map;e.forEach(n=>{let s=n.data||"",c=s.includes("T")?s.split("T")[0]:s;t.has(c)||t.set(c,[]),t.get(c).push(n)}),this.secoes=Array.from(t.entries()).sort((n,s)=>{let c=new Date(n[0]).getTime();return new Date(s[0]).getTime()-c}).map(([n,s])=>({data:n,itens:s.sort((c,w)=>new Date(w.data||0).getTime()-new Date(c.data||0).getTime()),expandido:!1})),this.secoesFiltradas=[...this.secoes]}toggleSecao(e){e.expandido=!e.expandido}aplicarFiltro(){let e=this.filtro.toLowerCase();if(!e){this.secoesFiltradas=[...this.secoes];return}this.secoesFiltradas=this.secoes.map(t=>D(y({},t),{itens:t.itens.filter(n=>String(n.titulo||"").toLowerCase().includes(e)||String(n.descricao||"").toLowerCase().includes(e)||String(n.tags||"").toLowerCase().includes(e)||String(n.autor||"").toLowerCase().includes(e)),expandido:!0})).filter(t=>t.itens.length>0)}formatarData(e){try{return(e.includes("T")?new Date(e):new Date(e+"T00:00:00")).toLocaleDateString("pt-BR")}catch{return e}}novaAnotacao(){this.router.navigate(["/criar-anotacao"])}abrirAnotacao(e){this.router.navigate(["/criar-anotacao",e.id])}static \u0275fac=function(t){return new(t||i)(S(P))};static \u0275cmp=E({type:i,selectors:[["app-anotacoes"]],decls:12,vars:4,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar anota\xE7\xF5es...",1,"form-control","bg-dark","text-light","border-light","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],[1,"flex-grow-1","p-3"],[1,"fw-bold","mb-3"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab","btn","btn-primary","rounded-circle","shadow-lg",3,"click"],[1,"fs-4"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-outline-light","w-100","text-start","d-flex","justify-content-between","align-items-center",3,"click"],[1,"fw-bold"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","anotacao-card","shadow-sm","h-100","p-3",2,"cursor","pointer",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"rounded","me-3","d-flex","align-items-center","justify-content-center","bg-dark",2,"width","50px","height","50px","overflow","hidden"],["style","width: 100%; height: 100%; object-fit: cover;",3,"src","alt",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],[1,"text-secondary"],["class","small descricao-text fst-italic",4,"ngIf"],[2,"width","100%","height","100%","object-fit","cover",3,"src","alt"],[1,"text-muted"],[1,"small","descricao-text","fst-italic"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),F("ngModelChange",function(c){return T(n.filtro,c)||(n.filtro=c),c}),_("input",function(){return n.aplicarFiltro()}),a()(),o(3,"div",3)(4,"h4",4),d(5,"\u{1F4DD} Minhas Anota\xE7\xF5es"),a(),m(6,z,4,0,"div",5)(7,R,2,0,"div",6)(8,K,2,1,"div",7),a(),o(9,"button",8),_("click",function(){return n.novaAnotacao()}),o(10,"span",9),d(11,"\uFF0B"),a()()()),t&2&&(r(2),I("ngModel",n.filtro),r(4),l("ngIf",n.carregando),r(),l("ngIf",!n.carregando&&n.secoesFiltradas.length===0),r(),l("ngIf",!n.carregando))},dependencies:[L,k,O,B,N,V,j],styles:[".anotacao-card[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #333;border-radius:14px;transition:all .2s ease-in-out}.anotacao-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 14px #00000073}.descricao-text[_ngcontent-%COMP%]{color:#cfcfcf!important;white-space:pre-line}.text-secondary[_ngcontent-%COMP%]{color:#bfbfbf!important}.fab[_ngcontent-%COMP%]{position:fixed;bottom:80px;right:20px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;z-index:100;background:#0d6efd;border:none;transition:all .2s ease-in-out}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.1);background:#0b5ed7}"]})};export{$ as Anotacoes};
