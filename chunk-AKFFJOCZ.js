import{a as L}from"./chunk-Y43637AY.js";import{a as B}from"./chunk-W2L5F7JW.js";import{h as V}from"./chunk-P5XSKUQX.js";import{g as T,i as A,q as N,x as R}from"./chunk-UNL43WIN.js";import{Ab as s,Bb as i,Cb as n,Db as p,Hb as O,Ib as P,Jb as j,Nb as u,Pb as f,Sa as E,Ua as r,Za as S,Zb as F,a as v,b,bc as t,cc as _,dc as d,eb as D,g as x,jb as w,la as h,ma as C,oc as k,sc as z,wb as I,xb as M,yb as y,zb as J}from"./chunk-XPYPFFIJ.js";var X=(l,e,o)=>({"text-danger fw-bold":l,"text-warning":e,"":o}),q=(l,e)=>e.label;function G(l,e){l&1&&(i(0,"div",4),p(1,"div",9),i(2,"p",10),t(3,"Carregando jogador..."),n()())}function H(l,e){if(l&1){let o=j();O(0),i(1,"img",22),u("click",function(){h(o);let m=f(2);return C(m.abrirImagem(m.jogador.imagem))}),n(),P()}if(l&2){let o=f(2);r(),s("src",o.jogador.imagem,E)}}function K(l,e){l&1&&(i(0,"div",23),t(1," \u{1F464} "),n())}function Q(l,e){if(l&1&&(i(0,"div",21),t(1),i(2,"span"),t(3),n(),i(4,"b"),t(5),n(),i(6,"small",24),t(7),n()()),l&2){let o=e.$implicit;r(),d(" ",o.icon," "),r(2),_(o.label),r(2),_(o.value),r(2),d(" (",o.mod>=0?"+"+o.mod:o.mod,") ")}}function W(l,e){if(l&1&&(i(0,"div",5)(1,"div",11),w(2,H,2,1,"ng-container",12)(3,K,2,0,"ng-template",null,0,z),n(),i(5,"div",13)(6,"h4",14),t(7),n(),i(8,"p",15),t(9),n(),i(10,"ul",16)(11,"li"),t(12,"\u{1F3C5} "),i(13,"span"),t(14,"N\xEDvel:"),n(),t(15),n(),i(16,"li"),t(17,"\u2B50 "),i(18,"span"),t(19,"XP:"),n(),t(20),n(),i(21,"li"),t(22,"\u{1F340} "),i(23,"span"),t(24,"Sorte:"),n(),t(25),n(),p(26,"hr",17),i(27,"li"),t(28," \u2764\uFE0F "),i(29,"span"),t(30,"Vida:"),n(),i(31,"span",18),t(32),n(),t(33),n(),i(34,"li"),t(35,"\u{1F494} "),i(36,"span"),t(37,"Dano tomado:"),n(),t(38),n(),i(39,"li"),t(40,"\u{1F6E1}\uFE0F "),i(41,"span"),t(42,"Armadura:"),n(),t(43),n(),i(44,"li"),t(45,"\u{1F530} "),i(46,"span"),t(47,"Escudo:"),n(),t(48),n(),p(49,"hr",17),i(50,"li"),t(51,"\u2728 "),i(52,"span"),t(53,"Fator de cura:"),n(),t(54),n(),i(55,"li"),t(56,"\u{1F6B6}\u200D\u2642\uFE0F "),i(57,"span"),t(58,"Deslocamento:"),n(),t(59),n()(),i(60,"h6",19),t(61,"\u{1F4CA} Atributos"),n(),i(62,"div",20),y(63,Q,8,4,"div",21,q),n()()()),l&2){let o=F(4),a=f();r(2),s("ngIf",a.jogador.imagem&&a.jogador.imagem!=="-")("ngIfElse",o),r(5),d("\u{1F9D9} ",a.jogador.personagem),r(2),d("\u2696\uFE0F ",a.jogador.alinhamento||"Sem alinhamento"),r(6),d(" ",a.jogador.nivel),r(5),d(" ",a.jogador.xp),r(5),d(" ",a.jogador.pontos_de_sorte),r(6),s("ngClass",k(15,X,a.jogador.vida_atual<=0,a.jogador.vida_atual>0&&a.jogador.vida_atual<a.jogador.pontos_de_vida*.5,a.jogador.vida_atual>=a.jogador.pontos_de_vida*.5)),r(),d(" ",a.jogador.vida_atual," "),r(),d(" / ",a.jogador.pontos_de_vida," "),r(5),d(" ",a.jogador.dano_tomado),r(5),d(" ",a.jogador.classe_de_armadura),r(5),d(" ",a.jogador.escudo),r(6),d(" ",a.jogador.fator_cura),r(5),d(" ",a.jogador.deslocamento),r(4),J(a.atributos)}}function Y(l,e){l&1&&(i(0,"div",6),t(1,"Nenhum jogador encontrado. V\xE1 para o cadastro."),n())}var U=class l{constructor(e){this.router=e}jogador=null;atributos=[];loading=!0;imagemSelecionada=null;modalAberto=!1;repo=new B("Personagem");ngOnInit(){return x(this,null,function*(){console.log("[Jogador] Iniciando carregamento..."),this.loading=!0;try{let e=R.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let o=(yield this.repo.getLocal()).find(m=>m.email===e.email);if(o){console.log("[Jogador] Jogador local encontrado:",o),this.setJogador(o),this.repo.sync().then(m=>x(this,null,function*(){if(m){let g=(yield this.repo.getLocal()).find(c=>c.email===e.email);g&&this.setJogador(g)}}));return}console.log("[Jogador] Nenhum jogador local \u2192 carregando online..."),o=(yield this.repo.forceFetch()).find(m=>m.email===e.email),o?this.setJogador(o):(console.warn("[Jogador] Nenhum jogador encontrado nem online \u2192 cadastro"),this.router.navigate(["/cadastro-jogador"]))}catch(e){console.error("[Jogador] Erro ao carregar Jogador:",e),this.router.navigate(["/login"])}finally{this.loading=!1}})}setJogador(e){e.escudo=e.escudo??0,e.pontos_de_sorte=e.pontos_de_sorte??0;let o=e.pontos_de_vida&&e.pontos_de_vida>0?e.pontos_de_vida:(e.energia||0)+(e.constituicao||0),a=Math.floor((e.energia||0)/3),m=Math.floor((e.destreza||0)/3),g=Math.max(o-(e.dano_tomado||0),0);this.jogador=b(v({},e),{pontos_de_vida:o,vida_atual:g,fator_cura:a,deslocamento:m});let c=$=>Math.floor((($||0)-10)/2);this.atributos=[{label:"For\xE7a",value:e.forca,mod:c(e.forca),icon:"\u{1F4AA}"},{label:"Destreza",value:e.destreza,mod:c(e.destreza),icon:"\u{1F938}\u200D\u2642\uFE0F"},{label:"Constitui\xE7\xE3o",value:e.constituicao,mod:c(e.constituicao),icon:"\u{1FAA8}"},{label:"Intelig\xEAncia",value:e.inteligencia,mod:c(e.inteligencia),icon:"\u{1F9E0}"},{label:"Sabedoria",value:e.sabedoria,mod:c(e.sabedoria),icon:"\u{1F4D6}"},{label:"Carisma",value:e.carisma,mod:c(e.carisma),icon:"\u{1F60E}"},{label:"Energia",value:e.energia,mod:c(e.energia),icon:"\u26A1"}]}editarJogador(){this.router.navigate(["/edicao-jogador"])}abrirImagem(e){this.imagemSelecionada=e,this.modalAberto=!0}static \u0275fac=function(o){return new(o||l)(S(V))};static \u0275cmp=D({type:l,selectors:[["app-jogador"]],decls:9,vars:3,consts:[["noImagem",""],[1,"jogador-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"flex-grow-1","d-flex","justify-content-center"],[1,"jogador-detalhe-container","w-100"],[1,"text-center","py-5"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"alert","alert-warning","mt-4"],[1,"fab","fab-primary",3,"click"],[3,"fecharModal","imagem","aberto"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body","pb-5"],[1,"fw-bold","mb-1","text-light"],[1,"text-secondary","mb-3"],[1,"info-list","mb-3"],[1,"my-2","opacity-25"],[3,"ngClass"],[1,"fw-bold","mt-3","text-light"],[1,"atributos-grid","compact","mb-3"],[1,"atributo-item"],["alt","Imagem do jogador",1,"card-img-top","detalhe-img",3,"click","src"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"text-light"]],template:function(o,a){o&1&&(i(0,"div",1)(1,"div",2)(2,"div",3),I(3,G,4,0,"div",4)(4,W,65,19,"div",5)(5,Y,2,0,"div",6),n()(),i(6,"button",7),u("click",function(){return a.editarJogador()}),t(7,"\u270F\uFE0F"),n()(),i(8,"app-image-modal",8),u("fecharModal",function(){return a.modalAberto=!1}),n()),o&2&&(r(3),M(a.loading?3:a.jogador?4:5),r(5),s("imagem",a.imagemSelecionada)("aberto",a.modalAberto))},dependencies:[N,T,A,L],styles:[".jogador-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.jogador-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.info-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.95rem}.info-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;color:#f1f1f1}.info-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px 14px;font-size:.9rem;color:#f1f1f1}.atributo-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:.9rem;background:#2a2a2a;border-radius:6px;padding:6px 10px;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.atributo-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#ccc}.atributo-item[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#fff}.atributo-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#f8f9fa}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;position:fixed;bottom:70px;right:20px;background:#0d6efd;color:#fff;box-shadow:0 4px 14px #0006;transition:transform .2s ease;border:none}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}@media (min-width: 992px){.fab[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{U as Jogador};
