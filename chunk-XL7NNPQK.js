import{a as _}from"./chunk-6NKPA5WO.js";import{a as E}from"./chunk-X6WXRV32.js";import"./chunk-W7DVKRY2.js";import{a as U}from"./chunk-HS244SCX.js";import{Ga as l,Gb as A,Ha as a,Ia as n,Ja as p,Jb as R,Mb as V,Na as f,Oa as x,Pa as M,Ra as w,S as C,T as D,Ta as m,Tb as N,Vb as B,d as y,fb as t,gb as P,ha as k,hb as d,ia as o,ib as j,ma as S,nb as L,qa as z,ua as u}from"./chunk-ILJPX4RU.js";function $(i,r){i&1&&(a(0,"div",3),p(1,"div",4),a(2,"p",5),t(3,"Carregando item..."),n()())}function G(i,r){if(i&1&&p(0,"img",21),i&2){let e=m(2);l("alt",L(e.item.catalogo==null?null:e.item.catalogo.nome))("src",e.item.catalogo==null?null:e.item.catalogo.imagem,k)}}function H(i,r){i&1&&(a(0,"div",22)(1,"span",23),t(2,"\u{1F4E6} Sem imagem"),n()())}function K(i,r){if(i&1&&(a(0,"p",24),t(1," \u2728 "),a(2,"b"),t(3,"Efeito:"),n(),t(4),n()),i&2){let e=m(2);o(4),d(" ",e.item.catalogo==null?null:e.item.catalogo.efeito," ")}}function W(i,r){if(i&1&&(a(0,"p",25),t(1," \u26A0\uFE0F "),a(2,"b"),t(3,"Colateral:"),n(),t(4),n()),i&2){let e=m(2);o(4),d(" ",e.item.catalogo==null?null:e.item.catalogo.colateral," ")}}function X(i,r){if(i&1&&(a(0,"p",26),t(1),n()),i&2){let e=m(2);o(),d(" \u{1F4DD} ",e.item.catalogo==null?null:e.item.catalogo.descricao," ")}}function Y(i,r){i&1&&(f(0),t(1,"\u270F\uFE0F Editar"),x())}function Z(i,r){i&1&&(f(0),p(1,"span",27),t(2," Editando... "),x())}function ee(i,r){i&1&&(f(0),t(1,"\u{1F5D1}\uFE0F Excluir"),x())}function te(i,r){i&1&&(f(0),p(1,"span",27),t(2," Excluindo... "),x())}function ne(i,r){if(i&1){let e=M();f(0),a(1,"div",6),u(2,G,1,3,"img",7)(3,H,3,0,"div",8),n(),a(4,"div",9)(5,"h4",10),t(6),n(),a(7,"div",11)(8,"p")(9,"span",12),t(10,"\u{1F4C2}"),n(),a(11,"b"),t(12,"Categoria: "),n(),t(13),n(),a(14,"p")(15,"span",12),t(16,"\u{1F331}"),n(),a(17,"b"),t(18,"Origem:"),n(),t(19),n(),a(20,"p")(21,"span",12),t(22,"\u{1F48E}"),n(),a(23,"b"),t(24,"Raridade:"),n(),t(25),n(),a(26,"p")(27,"span",12),t(28,"\u{1F522}"),n(),a(29,"b"),t(30,"Quantidade:"),n(),t(31),n(),a(32,"p")(33,"span",12),t(34,"\u2696\uFE0F"),n(),a(35,"b"),t(36,"Peso total:"),n(),t(37),n()(),p(38,"hr",13),u(39,K,5,1,"p",14)(40,W,5,1,"p",15)(41,X,2,1,"p",16),n(),a(42,"div",17)(43,"button",18),w("click",function(){C(e);let s=m();return D(s.cancelar())}),t(44," \u2B05\uFE0F Cancelar "),n(),a(45,"button",19),w("click",function(){C(e);let s=m();return D(s.editarItem())}),u(46,Y,2,0,"ng-container",2)(47,Z,3,0,"ng-container",2),n(),a(48,"button",20),w("click",function(){C(e);let s=m();return D(s.excluirItem())}),u(49,ee,2,0,"ng-container",2)(50,te,3,0,"ng-container",2),n()(),x()}if(i&2){let e=m();o(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.imagem),o(),l("ngIf",!(e.item.catalogo!=null&&e.item.catalogo.imagem)),o(3),P((e.item.catalogo==null?null:e.item.catalogo.nome)||"Item desconhecido"),o(7),d(" ",(e.item.catalogo==null?null:e.item.catalogo.categoria)||"\u2014"),o(6),d(" ",(e.item.catalogo==null?null:e.item.catalogo.origem)||"\u2014"),o(6),d(" ",(e.item.catalogo==null?null:e.item.catalogo.raridade)||"\u2014"),o(6),j(" ",e.item.inventario.quantidade," ",(e.item.catalogo==null?null:e.item.catalogo.unidade_medida)||""," "),o(6),d(" ",(e.item.inventario.quantidade||0)*((e.item.catalogo==null?null:e.item.catalogo.peso)||0)," kg "),o(2),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.efeito),o(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.colateral),o(),l("ngIf",e.item.catalogo==null?null:e.item.catalogo.descricao),o(4),l("disabled",e.processandoEditar),o(),l("ngIf",!e.processandoEditar),o(),l("ngIf",e.processandoEditar),o(),l("disabled",e.processandoExcluir),o(),l("ngIf",!e.processandoExcluir),o(),l("ngIf",e.processandoExcluir)}}var q=class i{constructor(r,e,c){this.route=r;this.router=e;this.location=c}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;ngOnInit(){return y(this,null,function*(){try{console.log("[ItemInventario] Iniciando carregamento..."),this.carregando=!0;let r=Number(this.route.snapshot.paramMap.get("id"));if(!r)throw new Error("ID inv\xE1lido para item do invent\xE1rio");let e=U.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let c=yield _.getLocalInventarioByJogador(e.email),s=yield E.getLocalItens(),v=c.find(g=>g.id===r),J=v?s.find(g=>g.id===v.item_catalogo):void 0;if(v&&(this.item={inventario:v,catalogo:J},this.carregando=!1),Promise.all([_.syncInventario(),E.syncItens()]).then(h=>y(this,[h],function*([g,T]){if(g||T){console.log("[ItemInventario] Sync trouxe altera\xE7\xF5es. Atualizando cache...");let O=yield _.getLocalInventarioByJogador(e.email),I=yield E.getLocalItens(),b=O.find(F=>F.id===r),Q=b?I.find(F=>F.id===b.item_catalogo):void 0;b&&(this.item={inventario:b,catalogo:Q})}else console.log("[ItemInventario] Sync conclu\xEDdo. Nenhuma altera\xE7\xE3o detectada.")})),!v){console.log("[ItemInventario] Item n\xE3o encontrado localmente. Buscando online...");let g=yield _.forceFetchInventario(),T=yield E.getLocalItens(),h=g.find(I=>I.id===r),O=h?T.find(I=>I.id===h.item_catalogo):void 0;if(h)this.item={inventario:h,catalogo:O};else throw new Error("Item n\xE3o encontrado nem online.");this.carregando=!1}}catch(r){console.error("[ItemInventario] Erro ao carregar item:",r),this.carregando=!1}})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-inventario",this.item.inventario.id],{queryParams:{returnUrl:this.router.url}}),this.processandoEditar=!1},500))}excluirItem(){return y(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja remover "${this.item.catalogo?.nome}" do invent\xE1rio?`))){this.processandoExcluir=!0;try{yield _.deleteInventario(this.item.inventario.id),alert("\u2705 Item removido do invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(e){console.error("[ItemInventario] Erro ao excluir item:",e),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}static \u0275fac=function(e){return new(e||i)(S(N),S(B),S(A))};static \u0275cmp=z({type:i,selectors:[["app-item-inventario"]],decls:3,vars:2,consts:[[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","p-3"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","mb-3"],["class","img-fluid rounded shadow-sm","style","max-height: 280px; object-fit: cover; width: 100%;",3,"src","alt",4,"ngIf"],["class","bg-secondary d-flex align-items-center justify-content-center rounded","style","height: 200px; width: 100%;",4,"ngIf"],[1,"card","bg-dark","border-0","shadow-sm","p-3"],[1,"fw-bold","mb-3","text-light"],[1,"meta-info"],[1,"icon"],[1,"border-secondary"],["class","efeito-text mt-2",4,"ngIf"],["class","colateral mt-2",4,"ngIf"],["class","descricao-text mt-2 fst-italic",4,"ngIf"],[1,"d-flex","gap-2","mt-4"],[1,"btn","btn-secondary","flex-fill",3,"click"],[1,"btn","btn-outline-warning","flex-fill",3,"click","disabled"],[1,"btn","btn-outline-danger","flex-fill",3,"click","disabled"],[1,"img-fluid","rounded","shadow-sm",2,"max-height","280px","object-fit","cover","width","100%",3,"src","alt"],[1,"bg-secondary","d-flex","align-items-center","justify-content-center","rounded",2,"height","200px","width","100%"],[1,"text-light"],[1,"efeito-text","mt-2"],[1,"colateral","mt-2"],[1,"descricao-text","mt-2","fst-italic"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,c){e&1&&(a(0,"div",0),u(1,$,4,0,"div",1)(2,ne,51,18,"ng-container",2),n()),e&2&&(o(),l("ngIf",c.carregando),o(),l("ngIf",!c.carregando&&c.item))},dependencies:[V,R],styles:[".meta-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e6e6e6;font-size:1rem;margin-bottom:.6rem;display:flex;align-items:center}.meta-info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:6px;font-size:1.1rem}.efeito-text[_ngcontent-%COMP%]{color:#ddd;font-size:.95rem}.colateral[_ngcontent-%COMP%]{color:#c97a7a!important;font-size:.95rem}.descricao-text[_ngcontent-%COMP%]{color:#bfbfbf!important;font-size:.95rem}"]})};export{q as ItemInventario};
