import{b as C}from"./chunk-UJSUP3BC.js";import{c as L,g as z,j as A,q as V,s as B,w as N}from"./chunk-WLM7QTUH.js";import{$b as m,Db as f,Eb as v,Fb as M,Jb as x,Lb as s,Pa as O,Qa as r,Va as _,Vb as R,Zb as i,ab as P,ac as F,d as h,fb as p,fc as T,ia as S,ja as k,mc as j,wb as c,xb as l,yb as a,zb as u}from"./chunk-QQSIVCMV.js";function Q(n,o){n&1&&(l(0,"div",9),u(1,"div",10),l(2,"p",11),i(3,"Carregando item..."),a()())}function $(n,o){if(n&1&&(f(0),u(1,"img",27),v()),n&2){let t=s(2);r(),c("alt",T(t.item.catalogo==null?null:t.item.catalogo.nome))("src",t.item.catalogo==null?null:t.item.catalogo.imagem,O)}}function G(n,o){n&1&&(l(0,"div",28),i(1," \u{1F4E6} "),a())}function H(n,o){if(n&1&&(l(0,"p",29),i(1," \u2728 "),l(2,"b"),i(3,"Efeito:"),a(),i(4),a()),n&2){let t=s(2);r(4),m(" ",t.item.catalogo==null?null:t.item.catalogo.efeito," ")}}function J(n,o){if(n&1&&(l(0,"p",30),i(1," \u26A0\uFE0F "),l(2,"b"),i(3,"Colateral:"),a(),i(4),a()),n&2){let t=s(2);r(4),m(" ",t.item.catalogo==null?null:t.item.catalogo.colateral," ")}}function K(n,o){if(n&1&&(l(0,"p",31),i(1," \u{1F4DD} "),l(2,"b"),i(3,"Descri\xE7\xE3o:"),a(),i(4),a()),n&2){let t=s(2);r(4),m(" ",t.item.catalogo==null?null:t.item.catalogo.descricao," ")}}function W(n,o){if(n&1){let t=M();l(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"button",16),x("click",function(){S(t);let d=s();return k(d.cancelar())}),i(5," \u2B05 Voltar "),a(),l(6,"h4",17),i(7),a()(),l(8,"div",18),p(9,$,2,3,"ng-container",19)(10,G,2,0,"ng-template",null,0,j),a(),l(12,"div",20)(13,"p",21)(14,"b"),i(15,"\u{1F4C2} Categoria:"),a(),i(16),a(),l(17,"p",21)(18,"b"),i(19,"\u{1F331} Origem:"),a(),i(20),a(),l(21,"p",21)(22,"b"),i(23,"\u{1F48E} Raridade:"),a(),i(24),a(),l(25,"p",21)(26,"b"),i(27,"\u{1F522} Quantidade:"),a(),i(28),a(),l(29,"p",22)(30,"b"),i(31,"\u2696\uFE0F Peso total:"),a(),i(32),a(),u(33,"hr",23),p(34,H,5,1,"p",24)(35,J,5,1,"p",25)(36,K,5,1,"p",26),a()()()()}if(n&2){let t=R(11),e=s();r(7),m(" \u{1F392} ",(e.item.catalogo==null?null:e.item.catalogo.nome)||"Item desconhecido"," "),r(2),c("ngIf",(e.item.catalogo==null?null:e.item.catalogo.imagem)&&(e.item.catalogo==null?null:e.item.catalogo.imagem)!=="-")("ngIfElse",t),r(7),m(" ",(e.item.catalogo==null?null:e.item.catalogo.categoria)||"\u2014"),r(4),m(" ",(e.item.catalogo==null?null:e.item.catalogo.origem)||"\u2014"),r(4),m(" ",(e.item.catalogo==null?null:e.item.catalogo.raridade)||"\u2014"),r(4),F(" ",e.item.inventario.quantidade," ",(e.item.catalogo==null?null:e.item.catalogo.unidade_medida)||""," "),r(4),m(" ",(e.item.inventario.quantidade||0)*((e.item.catalogo==null?null:e.item.catalogo.peso)||0)," kg "),r(2),c("ngIf",e.item.catalogo==null?null:e.item.catalogo.efeito),r(),c("ngIf",e.item.catalogo==null?null:e.item.catalogo.colateral),r(),c("ngIf",e.item.catalogo==null?null:e.item.catalogo.descricao)}}function X(n,o){n&1&&(f(0),i(1,"\u{1F5D1}\uFE0F"),v())}function Y(n,o){n&1&&(f(0),u(1,"span",32),v())}function Z(n,o){n&1&&(f(0),i(1,"\u270F\uFE0F"),v())}function ee(n,o){n&1&&(f(0),u(1,"span",32),v())}var U=class n{constructor(o,t,e){this.route=o;this.router=t;this.location=e}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;inventarioRepo=new C("Inventario","Inventario");catalogoRepo=new C("Catalogo","Catalogo");ngOnInit(){return h(this,null,function*(){try{console.log("[ItemInventario] Iniciando carregamento..."),this.carregando=!0;let o=this.route.snapshot.paramMap.get("id");if(!o)throw new Error("ID inv\xE1lido para item do invent\xE1rio");let t=N.getUser();if(!t?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let[e,d]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),b=d.find(g=>String(g.id)===o&&g.jogador===t.email);if(b&&(this.item=this.montarDetalhe(b,e),this.carregando=!1),Promise.all([this.catalogoRepo.sync(),this.inventarioRepo.sync()]).then(D=>h(this,[D],function*([g,E]){if(g||E){console.log("[ItemInventario] Sync trouxe altera\xE7\xF5es.");let[I,q]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),y=q.find(w=>String(w.id)===o&&w.jogador===t.email);y&&(this.item=this.montarDetalhe(y,I))}})),!b){console.log("[ItemInventario] Item n\xE3o encontrado localmente. For\xE7ando fetch online..."),yield this.catalogoRepo.forceFetch(),yield this.inventarioRepo.forceFetch();let[g,E]=yield Promise.all([this.catalogoRepo.getLocal(),this.inventarioRepo.getLocal()]),D=E.find(I=>String(I.id)===o&&I.jogador===t.email);if(D)this.item=this.montarDetalhe(D,g);else throw new Error("Item n\xE3o encontrado nem online.");this.carregando=!1}}catch(o){console.error("[ItemInventario] Erro ao carregar item:",o),this.carregando=!1}})}montarDetalhe(o,t){let e=t.find(d=>String(d.id)===String(o.item_catalogo));return{inventario:o,catalogo:e}}cancelar(){this.router.navigate(["/inventario-jogador"])}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-inventario",this.item.inventario.id]),this.processandoEditar=!1},400))}excluirItem(){return h(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja remover "${this.item.catalogo?.nome}" do invent\xE1rio?`))){this.processandoExcluir=!0;try{yield this.inventarioRepo.delete(this.item.inventario.index),alert("\u2705 Item removido do invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(t){console.error("[ItemInventario] Erro ao excluir item:",t),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}static \u0275fac=function(t){return new(t||n)(_(V),_(B),_(L))};static \u0275cmp=P({type:n,selectors:[["app-item-inventario"]],decls:12,vars:8,consts:[["noImagem",""],[1,"inventario-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],["class","text-center py-5",4,"ngIf"],["class","flex-grow-1 p-3 d-flex justify-content-center",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"fab","fab-danger",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-warning",3,"click","disabled"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-detalhe-container","w-100"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],["type","button",1,"btn","btn-outline-light","btn-sm",3,"click"],[1,"fw-bold","mb-0","text-capitalize","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"text-light","mb-1"],[1,"text-light","mb-3"],[1,"border-secondary"],["class","mb-1 text-info",4,"ngIf"],["class","mb-1 text-danger",4,"ngIf"],["class","fst-italic text-light descricao-text",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mb-1","text-info"],[1,"mb-1","text-danger"],[1,"fst-italic","text-light","descricao-text"],[1,"spinner-border","spinner-border-sm"]],template:function(t,e){t&1&&(l(0,"div",1),p(1,Q,4,0,"div",2)(2,W,37,12,"div",3),l(3,"div",4)(4,"button",5),x("click",function(){return e.cancelar()}),i(5,"\u2B05\uFE0F"),a(),l(6,"button",6),x("click",function(){return e.excluirItem()}),p(7,X,2,0,"ng-container",7)(8,Y,2,0,"ng-container",7),a(),l(9,"button",8),x("click",function(){return e.editarItem()}),p(10,Z,2,0,"ng-container",7)(11,ee,2,0,"ng-container",7),a()()()),t&2&&(r(),c("ngIf",e.carregando),r(),c("ngIf",!e.carregando&&e.item),r(4),c("disabled",e.processandoExcluir),r(),c("ngIf",!e.processandoExcluir),r(),c("ngIf",e.processandoExcluir),r(),c("disabled",e.processandoEditar),r(),c("ngIf",!e.processandoEditar),r(),c("ngIf",e.processandoEditar))},dependencies:[A,z],styles:[".inventario-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inventario-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.descricao-text[_ngcontent-%COMP%]{white-space:pre-line;color:#ddd;font-size:.95rem;background:#2a2a2a;border-radius:6px;padding:8px 10px;line-height:1.4;margin-top:8px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.inventario-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{U as ItemInventario};
