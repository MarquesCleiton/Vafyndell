import{b as R}from"./chunk-KJ5OHPYV.js";import{c as O,g as k,j as P,q as T,s as F}from"./chunk-WLM7QTUH.js";import{$b as d,Db as p,Eb as f,Jb as b,Lb as u,Pa as I,Qa as a,Va as C,Vb as E,Yb as y,Zb as i,ab as v,ac as D,d as _,fb as s,fc as S,gc as w,mc as M,wb as l,xb as r,yb as o,zb as g}from"./chunk-QQSIVCMV.js";function L(t,n){t&1&&(r(0,"div",9),g(1,"div",10),r(2,"p",11),i(3,"Carregando item..."),o()())}function A(t,n){if(t&1&&(p(0),g(1,"img",26),f()),t&2){let c=u(2);a(),l("alt",S(c.item.nome||"Item"))("src",c.item.imagem,I)}}function N(t,n){t&1&&(r(0,"div",27),i(1," \u{1F4E6} "),o())}function B(t,n){if(t&1&&(r(0,"p",28),i(1," \u2728 "),r(2,"b"),i(3,"Efeito:"),o(),i(4),o()),t&2){let c=u(2);a(4),d(" ",c.item.efeito," ")}}function U(t,n){if(t&1&&(r(0,"p",29),i(1," \u26A0\uFE0F "),r(2,"b"),i(3,"Colateral:"),o(),i(4),o()),t&2){let c=u(2);a(4),d(" ",c.item.colateral," ")}}function V(t,n){if(t&1&&(r(0,"p",30),i(1," \u{1F4DD} "),r(2,"b"),i(3,"Descri\xE7\xE3o:"),o(),i(4),o()),t&2){let c=u(2);a(4),d(" ",c.item.descricao," ")}}function $(t,n){if(t&1&&(r(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h4",16),i(5),o()(),r(6,"div",17),s(7,A,2,3,"ng-container",18)(8,N,2,0,"ng-template",null,0,M),o(),r(10,"div",19)(11,"p",20)(12,"b"),i(13,"\u{1F4C2} Categoria:"),o(),i(14),o(),r(15,"p",20)(16,"b"),i(17,"\u{1F331} Origem:"),o(),i(18),o(),r(19,"p",20)(20,"b"),i(21,"\u{1F48E} Raridade:"),o(),r(22,"span"),i(23),o()(),r(24,"p",21)(25,"b"),i(26,"\u2696\uFE0F Peso:"),o(),i(27),o(),g(28,"hr",22),s(29,B,5,1,"p",23)(30,U,5,1,"p",24)(31,V,5,1,"p",25),o()()()()),t&2){let c=E(9),e=u();a(5),d(" \u{1F4E6} ",e.item.nome||"Sem nome"," "),a(2),l("ngIf",e.item.imagem&&e.item.imagem!=="-")("ngIfElse",c),a(7),d(" ",e.item.categoria),a(4),d(" ",e.item.origem),a(4),y(w("raridade ",e.getRaridadeClass(e.item.raridade))),a(),d(" ",e.item.raridade||"Comum"," "),a(4),D(" ",e.item.peso," ",e.item.unidade_medida),a(2),l("ngIf",e.item.efeito),a(),l("ngIf",e.item.colateral),a(),l("ngIf",e.item.descricao)}}function q(t,n){t&1&&(p(0),i(1,"\u270F\uFE0F"),f())}function G(t,n){t&1&&(p(0),g(1,"span",31),f())}function H(t,n){t&1&&(p(0),i(1,"\u{1F5D1}\uFE0F"),f())}function J(t,n){t&1&&(p(0),g(1,"span",31),f())}var j=class t{constructor(n,c,e){this.route=n;this.router=c;this.location=e}item=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;repo=new R("Catalogo","Catalogo");ngOnInit(){return _(this,null,function*(){try{console.log("[ItemCatalogo] Iniciando carregamento..."),this.carregando=!0;let n=this.route.snapshot.paramMap.get("id");if(!n){this.router.navigate(["/catalogo"]);return}let e=(yield this.repo.getLocal()).find(m=>String(m.id)===n)||null;if(e&&(this.item=e,this.carregando=!1),this.repo.sync().then(m=>_(this,null,function*(){if(m){console.log("[ItemCatalogo] Sync trouxe altera\xE7\xF5es. Recarregando...");let x=(yield this.repo.getLocal()).find(z=>String(z.id)===n);x&&(this.item=x)}})),!e){console.log("[ItemCatalogo] N\xE3o encontrado localmente \u2192 for\xE7ando fetch online");let h=(yield this.repo.forceFetch()).find(x=>String(x.id)===n);h?this.item=h:(console.warn("[ItemCatalogo] Item n\xE3o encontrado nem online"),this.router.navigate(["/catalogo"])),this.carregando=!1}}catch(n){console.error("[ItemCatalogo] Erro ao carregar item:",n),this.carregando=!1}})}cancelar(){this.location.back()}editarItem(){this.item&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-item-catalogo",this.item.id]),this.processandoEditar=!1},300))}excluirItem(){return _(this,null,function*(){if(!(!this.item||!confirm(`\u{1F5D1}\uFE0F Deseja excluir o item "${this.item.nome}"?`))){this.processandoExcluir=!0;try{yield this.repo.delete(this.item.index),alert("\u2705 Item exclu\xEDdo com sucesso!"),this.router.navigate(["/catalogo"])}catch(c){console.error("[ItemCatalogo] Erro ao excluir item:",c),alert("\u274C Erro ao excluir item. Veja o console.")}finally{this.processandoExcluir=!1}}})}getRaridadeClass(n){switch((n||"").toLowerCase()){case"comum":return"raridade-comum";case"incomum":return"raridade-incomum";case"raro":return"raridade-raro";case"\xE9pico":case"epico":return"raridade-epico";case"lend\xE1rio":case"lendario":return"raridade-lendario";default:return"raridade-comum"}}static \u0275fac=function(c){return new(c||t)(C(T),C(F),C(O))};static \u0275cmp=v({type:t,selectors:[["app-item-catalogo"]],decls:12,vars:8,consts:[["noImagem",""],[1,"item-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],["class","text-center py-5",4,"ngIf"],["class","flex-grow-1 p-3 d-flex justify-content-center",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-warning",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-danger",3,"click","disabled"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"item-detalhe-container","w-100"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-capitalize","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"text-light","mb-1"],[1,"text-light","mb-3"],[1,"border-secondary"],["class","mb-1 text-info",4,"ngIf"],["class","mb-1 text-danger",4,"ngIf"],["class","fst-italic text-light descricao-text",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mb-1","text-info"],[1,"mb-1","text-danger"],[1,"fst-italic","text-light","descricao-text"],[1,"spinner-border","spinner-border-sm"]],template:function(c,e){c&1&&(r(0,"div",1),s(1,L,4,0,"div",2)(2,$,32,14,"div",3),r(3,"div",4)(4,"button",5),b("click",function(){return e.editarItem()}),s(5,q,2,0,"ng-container",6)(6,G,2,0,"ng-container",6),o(),r(7,"button",7),b("click",function(){return e.excluirItem()}),s(8,H,2,0,"ng-container",6)(9,J,2,0,"ng-container",6),o(),r(10,"button",8),b("click",function(){return e.cancelar()}),i(11," \u2B05\uFE0F "),o()()()),c&2&&(a(),l("ngIf",e.carregando),a(),l("ngIf",!e.carregando&&e.item),a(2),l("disabled",e.processandoEditar),a(),l("ngIf",!e.processandoEditar),a(),l("ngIf",e.processandoEditar),a(),l("disabled",e.processandoExcluir),a(),l("ngIf",!e.processandoExcluir),a(),l("ngIf",e.processandoExcluir))},dependencies:[P,k],styles:[".item-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.raridade[_ngcontent-%COMP%]{font-weight:700;padding:2px 8px;border-radius:6px}.raridade.comum[_ngcontent-%COMP%]{color:#ccc}.raridade.incomum[_ngcontent-%COMP%]{color:#00bcd4}.raridade.raro[_ngcontent-%COMP%]{color:#673ab7}.raridade.lendario[_ngcontent-%COMP%]{color:gold}.descricao-text[_ngcontent-%COMP%]{white-space:pre-line;color:#ddd;font-size:.95rem;background:#2a2a2a;border-radius:6px;padding:8px 10px;line-height:1.4;margin-top:8px}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.item-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}"]})};export{j as ItemCatalogo};
