import{a as at,d as ot,e as rt,h as lt,o as dt,p as ct,q as st,r as mt,u as pt,v as gt}from"./chunk-KSMHGLXZ.js";import{A as B,B as W,K as G,N as Q}from"./chunk-MBVAMQKJ.js";import{c as H,f as J,g as K,h as X,i as Y,j as Z,k as $,p as tt,q as et,r as it}from"./chunk-GFP7435U.js";import{a as nt,b as k}from"./chunk-FLOHM7ZW.js";import{f as j,g as N,j as z,q as L,s as U,w as D}from"./chunk-WLM7QTUH.js";import{$b as q,Db as h,Eb as I,Fb as M,Jb as u,Lb as C,Pa as w,Qa as l,Va as x,Vb as _,Zb as c,_b as y,a as A,ab as V,ac as T,b as R,cc as S,d as f,dc as E,ec as O,fb as v,ia as p,ja as g,mc as P,wb as m,xb as a,yb as r,zb as b}from"./chunk-QQSIVCMV.js";function ft(n,i){if(n&1){let e=M();a(0,"mat-option",30),u("click",function(){p(e);let o=C();return g(o.novoItem())}),a(1,"mat-icon",31),c(2,"add_circle"),r(),c(3," Novo "),r()}}function vt(n,i){if(n&1&&(h(0),b(1,"img",35),I()),n&2){let e=C().$implicit;l(),m("src",e.imagem,w)}}function _t(n,i){n&1&&(a(0,"span",31),c(1,"\u{1F4E6}"),r())}function ht(n,i){if(n&1&&(a(0,"mat-option",32)(1,"div",33),v(2,vt,2,1,"ng-container",34)(3,_t,2,0,"ng-template",null,2,P),a(5,"span"),c(6),r()()()),n&2){let e=i.$implicit,t=_(4);m("value",e),l(2),m("ngIf",e.imagem&&e.imagem!=="-")("ngIfElse",t),l(4),y(e.nome)}}function It(n,i){if(n&1&&(h(0),b(1,"img",39),I()),n&2){let e=C(2);l(),m("src",e.selecionado.imagem,w)}}function Ct(n,i){n&1&&(a(0,"span",40),c(1,"\u{1F4E6}"),r())}function bt(n,i){if(n&1&&(a(0,"div",36)(1,"div",33),v(2,It,2,1,"ng-container",34)(3,Ct,2,0,"ng-template",null,3,P),a(5,"div")(6,"h6",37),c(7),r(),a(8,"small",38),c(9),r()()()()),n&2){let e=_(4),t=C();l(2),m("ngIf",t.selecionado.imagem&&t.selecionado.imagem!=="-")("ngIfElse",e),l(5),y(t.selecionado.nome),l(2),T(" ",t.selecionado.categoria," | ",t.selecionado.raridade," ")}}function wt(n,i){n&1&&(h(0),c(1,"\u{1F4BE}"),I())}function xt(n,i){n&1&&(h(0),b(1,"span",41),I())}var ut=class n{constructor(i,e){this.router=i;this.route=e}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;salvando=!1;editando=!1;inventarioAtual=null;catalogoRepo=new k("Catalogo","Catalogo");inventarioRepo=new k("Inventario","Inventario");ngOnInit(){return f(this,null,function*(){try{console.log("[CadastroInventario] Iniciando carregamento..."),this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens,this.catalogoRepo.sync().then(e=>f(this,null,function*(){e&&(console.log("[CadastroInventario] Cat\xE1logo atualizado. Recarregando..."),this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens)}));let i=this.route.snapshot.paramMap.get("id");if(i){this.editando=!0;let e=D.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let t=yield this.inventarioRepo.getLocal();if(this.inventarioAtual=t.find(o=>String(o.id)===i&&o.jogador===e.email)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual)),this.inventarioRepo.sync().then(o=>f(this,null,function*(){if(o){console.log("[CadastroInventario] Invent\xE1rio atualizado. Recarregando item...");let d=(yield this.inventarioRepo.getLocal()).find(F=>String(F.id)===i&&F.jogador===e.email);d&&(this.inventarioAtual=d,yield this.carregarItemSelecionado(this.inventarioAtual))}})),!this.inventarioAtual){let o=yield this.inventarioRepo.forceFetch();this.inventarioAtual=o.find(s=>String(s.id)===i&&s.jogador===e.email)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual))}}}catch(i){console.error("[CadastroInventario] Erro ao carregar:",i)}})}carregarItemSelecionado(i){return f(this,null,function*(){this.catalogoItens.length||(this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens),this.selecionado=this.catalogoItens.find(e=>String(e.id)===String(i.item_catalogo))||null,this.quantidade=i.quantidade,this.filtro=this.selecionado?.nome||""})}filtrarItens(){let i=t=>(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),e=i(this.filtro||"");if(!e){this.catalogoFiltrado=[...this.catalogoItens];return}this.catalogoFiltrado=this.catalogoItens.filter(t=>i(t.nome).includes(e))}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(1,this.quantidade-1)}cancelar(){this.editando&&this.inventarioAtual?.id?this.router.navigate(["/item-inventario",this.inventarioAtual.id]):this.router.navigate(["/inventario-jogador"])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}salvar(i){return f(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let e=D.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.editando&&this.inventarioAtual){let t=R(A({},this.inventarioAtual),{jogador:e.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade});yield this.inventarioRepo.update(t)}else{let t=yield this.inventarioRepo.getLocal(),o=t.length>0?Math.max(...t.map(d=>d.index||0)):0,s={id:nt.generateULID(),index:o+1,jogador:e.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade};yield this.inventarioRepo.create(s)}alert("\u2705 Item salvo no invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(e){console.error("[CadastroInventario] Erro ao salvar:",e),alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}displayFn(i){return i?i.nome:""}static \u0275fac=function(e){return new(e||n)(x(U),x(L))};static \u0275cmp=V({type:n,selectors:[["app-cadastro-inventario"]],decls:38,vars:11,consts:[["form","ngForm"],["auto","matAutocomplete"],["noItemIcon",""],["noPreviewIcon",""],[1,"inventario-cadastro-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-cadastro-container","w-100"],["id","formInventario",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","fill",1,"w-100","input-dark","compact-select","dropdown-field"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],["mat-icon-button","","matSuffix","","disabled","",1,"dropdown-arrow"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","quantidade","min","1","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","button",1,"fab","fab-warning",3,"click"],["type","submit","form","formInventario",1,"fab","fab-primary",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],[4,"ngIf","ngIfElse"],[1,"me-2","rounded",2,"width","24px","height","24px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],[1,"fw-bold","text-light","mb-1"],[1,"text-light"],[1,"me-3","rounded","preview-img",3,"src"],[1,"me-3"],[1,"spinner-border","spinner-border-sm"]],template:function(e,t){if(e&1){let o=M();a(0,"div",4)(1,"div",5)(2,"div",6)(3,"form",7,0),u("ngSubmit",function(){p(o);let d=_(4);return g(t.salvar(d))}),a(5,"div",8)(6,"div",9)(7,"h4",10),c(8),r()(),a(9,"div",11)(10,"div",12)(11,"label",13),c(12,"\u{1F3F7}\uFE0F Item *"),r(),a(13,"mat-form-field",14)(14,"input",15),O("ngModelChange",function(d){return p(o),E(t.filtro,d)||(t.filtro=d),g(d)}),u("input",function(){return p(o),g(t.filtrarItens())}),r(),a(15,"button",16)(16,"mat-icon"),c(17,"arrow_drop_down"),r()(),a(18,"mat-autocomplete",17,1),u("optionSelected",function(d){return p(o),g(t.selecionarItem(d.option.value))}),v(20,ft,4,0,"mat-option",18)(21,ht,7,4,"mat-option",19),r()()(),v(22,bt,10,5,"div",20),a(23,"div",21)(24,"label",22),c(25,"\u{1F522} Quantidade *"),r(),a(26,"div",23)(27,"button",24),u("click",function(){return p(o),g(t.decrementar())}),c(28,"\u2212"),r(),a(29,"input",25),O("ngModelChange",function(d){return p(o),E(t.quantidade,d)||(t.quantidade=d),g(d)}),r(),a(30,"button",24),u("click",function(){return p(o),g(t.incrementar())}),c(31,"+"),r()()()()()()()(),a(32,"div",26)(33,"button",27),u("click",function(){return p(o),g(t.cancelar())}),c(34,"\u2B05\uFE0F"),r(),a(35,"button",28),v(36,wt,2,0,"ng-container",29)(37,xt,2,0,"ng-container",29),r()()()}if(e&2){let o=_(4),s=_(19);l(8),q(" \u{1F392} ",t.editando?"Editar Item do Invent\xE1rio":"Adicionar ao Invent\xE1rio"," "),l(6),S("ngModel",t.filtro),m("matAutocomplete",s)("readonly",t.editando),l(6),m("ngIf",!t.editando),l(),m("ngForOf",t.catalogoFiltrado),l(),m("ngIf",t.selecionado),l(7),S("ngModel",t.quantidade),l(6),m("disabled",o.invalid||t.salvando),l(),m("ngIf",!t.salvando),l(),m("ngIf",t.salvando)}},dependencies:[z,j,N,it,Z,H,$,J,K,et,tt,Y,X,rt,ot,at,mt,ct,lt,st,gt,pt,dt,W,B,Q,G],styles:[".inventario-cadastro-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inventario-cadastro-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border-radius:6px;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{padding:.25rem .5rem}.compact-select[_ngcontent-%COMP%]   .mat-select-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.dropdown-field[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.dropdown-arrow[_ngcontent-%COMP%]{pointer-events:none;color:#bbb!important;margin-left:auto}.dropdown-arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.4rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.5rem .75rem;text-align:left}.preview-img[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;border-radius:.5rem;border:1px solid #6c757d}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.2rem;font-size:.85rem}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}@media (min-width: 992px){.inventario-cadastro-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{ut as CadastroInventario};
