import{a as z}from"./chunk-IKGGEFY2.js";import{a as q}from"./chunk-XQNWO7VY.js";import{a as D}from"./chunk-IDK3EA3G.js";import{c as F,g as A,m as T,t as j,v as R}from"./chunk-JZWR3MRG.js";import{Ab as l,Bb as e,Cb as i,Db as b,Hb as p,Ib as m,Jb as M,Nb as u,Pb as h,Sa as N,Ua as a,Za as v,Zb as w,a as S,bc as n,cc as d,dc as E,eb as P,g as x,jb as f,jc as O,la as y,ma as I,qc as k}from"./chunk-HRDPHWQR.js";function V(r,o){r&1&&(e(0,"div",14),b(1,"div",15),e(2,"p",16),n(3,"Carregando NPC..."),i()())}function $(r,o){if(r&1){let c=M();p(0),e(1,"img",28),u("click",function(){y(c);let s=h(2);return I(s.abrirImagem(s.npc.imagem))}),i(),m()}if(r&2){let c=h(2);a(),l("alt",O(c.npc.nome))("src",c.npc.imagem,N)}}function J(r,o){r&1&&(e(0,"div",29),n(1," \u{1F479} "),i())}function B(r,o){if(r&1&&(e(0,"div",30)(1,"h6",31),n(2,"\u{1F4DD} Descri\xE7\xE3o"),i(),e(3,"p",32),n(4),i()()),r&2){let c=h(2);a(4),d(c.npc.descricao)}}function U(r,o){if(r&1&&(e(0,"div",30)(1,"h6",31),n(2,"\u2694\uFE0F Ataques"),i(),e(3,"p",33),n(4),i()()),r&2){let c=h(2);a(4),d(c.npc.ataques)}}function X(r,o){if(r&1&&(e(0,"div",17)(1,"div",18)(2,"h5",19),n(3),i()(),e(4,"div",20),f(5,$,2,3,"ng-container",21)(6,J,2,0,"ng-template",null,0,k),i(),e(8,"div",22)(9,"ul",23)(10,"li"),n(11,"\u{1F3F7}\uFE0F "),e(12,"span"),n(13,"Classifica\xE7\xE3o:"),i(),n(14),i(),e(15,"li"),n(16,"\u{1F3AD} "),e(17,"span"),n(18,"Tipo:"),i(),n(19),i(),e(20,"li"),n(21,"\u2696\uFE0F "),e(22,"span"),n(23,"Alinhamento:"),i(),n(24),i()(),e(25,"h6",24),n(26,"\u{1F4CA} Atributos"),i(),e(27,"div",25)(28,"div",26),n(29,"\u2764\uFE0F "),e(30,"span"),n(31,"Vida"),i(),e(32,"b"),n(33),i()(),e(34,"div",26),n(35,"\u{1F6E1}\uFE0F "),e(36,"span"),n(37,"Armadura"),i(),e(38,"b"),n(39),i()(),e(40,"div",26),n(41,"\u2B50 "),e(42,"span"),n(43,"XP"),i(),e(44,"b"),n(45),i()(),e(46,"div",26),n(47,"\u{1F4AA} "),e(48,"span"),n(49,"For\xE7a"),i(),e(50,"b"),n(51),i()(),e(52,"div",26),n(53,"\u{1FAA8} "),e(54,"span"),n(55,"Constitui\xE7\xE3o"),i(),e(56,"b"),n(57),i()(),e(58,"div",26),n(59,"\u{1F938}\u200D\u2642\uFE0F "),e(60,"span"),n(61,"Destreza"),i(),e(62,"b"),n(63),i()(),e(64,"div",26),n(65,"\u{1F4D6} "),e(66,"span"),n(67,"Sabedoria"),i(),e(68,"b"),n(69),i()(),e(70,"div",26),n(71,"\u{1F9E0} "),e(72,"span"),n(73,"Intelig\xEAncia"),i(),e(74,"b"),n(75),i()(),e(76,"div",26),n(77,"\u26A1 "),e(78,"span"),n(79,"Energia"),i(),e(80,"b"),n(81),i()()(),f(82,B,5,1,"div",27)(83,U,5,1,"div",27),i()()),r&2){let c=w(7),t=h();a(3),d(t.npc.nome),a(2),l("ngIf",t.npc.imagem&&t.npc.imagem!=="-")("ngIfElse",c),a(9),E(" ",t.npc.classificacao),a(5),E(" ",t.npc.tipo),a(5),E(" ",t.npc.alinhamento||"N\xE3o definido"),a(9),d(t.npc.pontos_de_vida),a(6),d(t.npc.classe_armadura),a(6),d(t.npc.xp),a(6),d(t.npc.forca),a(6),d(t.npc.constituicao),a(6),d(t.npc.destreza),a(6),d(t.npc.sabedoria),a(6),d(t.npc.inteligencia),a(6),d(t.npc.energia),a(),l("ngIf",t.npc.descricao),a(),l("ngIf",t.npc.ataques)}}function G(r,o){r&1&&(e(0,"div",34),n(1," NPC n\xE3o encontrado. "),i())}function H(r,o){r&1&&(p(0),n(1,"\u2694\uFE0F"),m())}function K(r,o){r&1&&(p(0),b(1,"div",35),m())}function Q(r,o){r&1&&(p(0),n(1,"\u270F\uFE0F"),m())}function W(r,o){r&1&&(p(0),b(1,"span",36),m())}function Y(r,o){r&1&&(p(0),n(1,"\u{1F5D1}\uFE0F"),m())}function Z(r,o){r&1&&(p(0),b(1,"span",36),m())}var L=class r{constructor(o,c,t){this.route=o;this.router=c;this.location=t}npc=null;carregando=!0;processandoEditar=!1;processandoExcluir=!1;processandoAdicionar=!1;imagemSelecionada=null;modalAberto=!1;npcRepo=new D("NPCs");jogadorRepo=new D("Personagem");ngOnInit(){return x(this,null,function*(){let o=this.route.snapshot.paramMap.get("id");if(!o){this.router.navigate(["/npcs"]);return}try{this.carregando=!0;let c=yield this.npcRepo.getLocal();if(this.npc=c.find(t=>String(t.id)===o)||null,this.npc)this.npcRepo.sync().then(t=>x(this,null,function*(){if(t){let _=(yield this.npcRepo.getLocal()).find(g=>String(g.id)===o);_&&(this.npc=S({},_))}}));else{let t=yield this.npcRepo.forceFetch();this.npc=t.find(s=>String(s.id)===o)||null}}catch(c){console.error("[NpcDetalhes] Erro ao carregar NPC:",c)}finally{this.carregando=!1}})}cancelar(){this.location.back()}editarNpc(){this.npc&&(this.processandoEditar=!0,setTimeout(()=>{this.router.navigate(["/cadastro-npc",this.npc.id]),this.processandoEditar=!1},300))}excluirNpc(){return x(this,null,function*(){if(!(!this.npc||!confirm(`\u{1F5D1}\uFE0F Deseja realmente excluir "${this.npc.nome}"?`))){this.processandoExcluir=!0;try{yield this.npcRepo.delete(this.npc.id),alert("\u2705 NPC exclu\xEDdo com sucesso!"),this.router.navigate(["/npcs"])}catch(c){console.error("[NpcDetalhes] Erro ao excluir NPC:",c),alert("\u274C Erro ao excluir NPC. Veja o console.")}finally{this.processandoExcluir=!1}}})}adicionarAoCampo(){return x(this,null,function*(){if(this.npc){this.processandoAdicionar=!0;try{let o=yield this.jogadorRepo.getLocal();this.jogadorRepo.sync().then(g=>x(this,null,function*(){g&&(o=yield this.jogadorRepo.getLocal())}));let c=this.npc.nome.trim(),t=o.map(g=>{let C=String(g.personagem||"").trim().match(/^(\d+) - (.+)$/);return C&&C[2]===c?parseInt(C[1],10):null}).filter(g=>g!==null),s=t.length>0?Math.max(...t)+1:1,_={id:q.generateULID(),email:"",imagem:this.npc.imagem||"",nome_do_jogador:"NPC",personagem:`${s} - ${c}`,alinhamento:this.npc.alinhamento||"",pontos_de_vida:this.npc.pontos_de_vida,classe_de_armadura:this.npc.classe_armadura,forca:this.npc.forca,destreza:this.npc.destreza,constituicao:this.npc.constituicao,inteligencia:this.npc.inteligencia,sabedoria:this.npc.sabedoria,carisma:0,energia:this.npc.energia,nivel:1,xp:this.npc.xp,dano_tomado:0,tipo_jogador:"NPC",efeitos_temporarios:"",registo_de_jogo:"",classificacao:this.npc.classificacao,tipo:this.npc.tipo,descricao:this.npc.descricao,ataques:this.npc.ataques};yield this.jogadorRepo.create(_),alert(`\u2705 ${_.personagem} adicionado ao campo de batalha!`)}catch(o){console.error("[NpcDetalhes] Erro ao adicionar NPC no campo de batalha:",o),alert("\u274C Erro ao adicionar NPC. Veja o console.")}finally{this.processandoAdicionar=!1}}})}abrirImagem(o){this.imagemSelecionada=o,this.modalAberto=!0}static \u0275fac=function(c){return new(c||r)(v(j),v(R),v(F))};static \u0275cmp=P({type:r,selectors:[["app-npc-detalhes"]],decls:19,vars:14,consts:[["noImagem",""],[1,"npc-detalhe-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"npc-detalhe-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","card detalhe-card shadow-lg border-0",4,"ngIf"],["class","text-center text-secondary py-5",4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click","disabled"],[4,"ngIf"],[1,"fab","fab-warning",3,"click","disabled"],[1,"fab","fab-danger",3,"click","disabled"],[1,"fab","fab-primary",3,"click"],[3,"fecharModal","imagem","aberto"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"position-relative"],[4,"ngIf","ngIfElse"],[1,"card-body","p-3"],[1,"info-list","mb-3"],[1,"fw-bold","mt-3","text-light"],[1,"atributos-grid","compact","mb-3"],[1,"atributo-item"],["class","mt-3",4,"ngIf"],[1,"card-img-top","detalhe-img",3,"click","src","alt"],[1,"d-flex","align-items-center","justify-content-center","bg-secondary","text-dark","detalhe-img","fallback-icone"],[1,"mt-3"],[1,"fw-bold","text-light"],[1,"descricao-text"],[1,"ataques-text"],[1,"text-center","text-secondary","py-5"],["role","status",1,"spinner-border","text-light",2,"width","2rem","height","2rem"],[1,"spinner-border","spinner-border-sm"]],template:function(c,t){c&1&&(e(0,"div",1)(1,"div",2)(2,"div",3),f(3,V,4,0,"div",4)(4,X,84,17,"div",5)(5,G,2,0,"div",6),i()(),e(6,"div",7)(7,"button",8),u("click",function(){return t.adicionarAoCampo()}),f(8,H,2,0,"ng-container",9)(9,K,2,0,"ng-container",9),i(),e(10,"button",10),u("click",function(){return t.editarNpc()}),f(11,Q,2,0,"ng-container",9)(12,W,2,0,"ng-container",9),i(),e(13,"button",11),u("click",function(){return t.excluirNpc()}),f(14,Y,2,0,"ng-container",9)(15,Z,2,0,"ng-container",9),i(),e(16,"button",12),u("click",function(){return t.cancelar()}),n(17," \u2B05\uFE0F "),i()()(),e(18,"app-image-modal",13),u("fecharModal",function(){return t.modalAberto=!1}),i()),c&2&&(a(3),l("ngIf",t.carregando),a(),l("ngIf",!t.carregando&&t.npc),a(),l("ngIf",!t.carregando&&!t.npc),a(2),l("disabled",t.processandoAdicionar),a(),l("ngIf",!t.processandoAdicionar),a(),l("ngIf",t.processandoAdicionar),a(),l("disabled",t.processandoEditar),a(),l("ngIf",!t.processandoEditar),a(),l("ngIf",t.processandoEditar),a(),l("disabled",t.processandoExcluir),a(),l("ngIf",!t.processandoExcluir),a(),l("ngIf",t.processandoExcluir),a(3),l("imagem",t.imagemSelecionada)("aberto",t.modalAberto))},dependencies:[T,A,z],styles:[".npc-detalhe-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.npc-detalhe-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:220px;object-fit:cover;width:100%}.fallback-icone[_ngcontent-%COMP%]{font-size:3rem}.info-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;font-size:.95rem}.info-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px;color:#f1f1f1}.info-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:#f8f9fa}.atributos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px 12px;font-size:.9rem;color:#f1f1f1}.atributo-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;white-space:nowrap;font-size:.9rem;background:#2a2a2a;border-radius:6px;padding:6px 10px}.atributo-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#ccc}.atributo-item[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:#fff}.descricao-text[_ngcontent-%COMP%], .ataques-text[_ngcontent-%COMP%]{white-space:pre-line;background:#2a2a2a;border-radius:6px;padding:10px 12px;line-height:1.5;font-size:.95rem}.descricao-text[_ngcontent-%COMP%]{color:#f1f1f1}.ataques-text[_ngcontent-%COMP%]{color:#f8d775}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}.fab-danger[_ngcontent-%COMP%]{background:#ff4d6d;color:#fff}.fab-danger[_ngcontent-%COMP%]:hover{background:#e63e5b}@media (min-width: 992px){.npc-detalhe-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{L as NpcDetalhes};
