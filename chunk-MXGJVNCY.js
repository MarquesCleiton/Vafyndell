import{a as B}from"./chunk-XTOQPDWA.js";import{c as R,f as $,i as q,r as L}from"./chunk-GFP7435U.js";import{b as w}from"./chunk-H7VFQHUE.js";import{f as A,g as V,j,s as z,w as N}from"./chunk-WLM7QTUH.js";import{$b as u,Fb as C,Jb as m,Lb as g,Pa as P,Qa as n,Va as O,Xb as f,Yb as I,Zb as d,_b as h,a as M,ab as k,b as y,cc as E,d as _,dc as D,ec as S,fb as p,fc as F,gc as T,ia as v,ja as b,wb as c,xb as r,yb as l,zb as x}from"./chunk-QQSIVCMV.js";function J(a,t){a&1&&(r(0,"div",13),x(1,"div",14),r(2,"p",15),d(3,"Carregando cat\xE1logo..."),l()())}function G(a,t){a&1&&(r(0,"div",16),d(1," Nenhum item encontrado. "),l())}function H(a,t){if(a&1&&x(0,"img",34),a&2){let e=g().$implicit;c("alt",F(e.nome||"Item"))("src",e.imagem,P)}}function K(a,t){a&1&&(r(0,"span",35),d(1,"\u{1F4E6}"),l())}function Q(a,t){if(a&1&&(r(0,"p",36),d(1),l()),a&2){let e=g().$implicit;n(),u("\u2728 ",e.efeito)}}function X(a,t){if(a&1&&(r(0,"p",37),d(1),l()),a&2){let e=g().$implicit;n(),u("\u26A0\uFE0F ",e.colateral)}}function Y(a,t){if(a&1&&(r(0,"p",38),d(1),l()),a&2){let e=g().$implicit;n(),u("\u{1F4DD} ",e.descricao)}}function Z(a,t){if(a&1&&(r(0,"span"),d(1),l()),a&2){let e=g(2).$implicit;n(),u(" ",e.visivel_jogadores?"\u{1F648} Ocultar":"\u{1F649} Mostrar"," ")}}function ee(a,t){a&1&&x(0,"span",41)}function te(a,t){if(a&1){let e=C();r(0,"button",39),m("click",function(o){v(e);let s=g().$implicit,W=g(4);return b(W.toggleVisibilidade(o,s))}),p(1,Z,2,1,"span",10)(2,ee,1,0,"span",40),l()}if(a&2){let e=g().$implicit,i=g(4);c("disabled",i.loadingVisibilidade[e.id]),n(),c("ngIf",!i.loadingVisibilidade[e.id]),n(),c("ngIf",i.loadingVisibilidade[e.id])}}function ie(a,t){if(a&1){let e=C();r(0,"div",23)(1,"div",24),m("click",function(){let o=v(e).$implicit,s=g(4);return b(s.abrirItem(o))}),r(2,"div",25)(3,"div",26),p(4,H,1,3,"img",27)(5,K,2,0,"span",28),l(),r(6,"div")(7,"h6",29),d(8),l(),r(9,"small"),d(10),l()()(),p(11,Q,2,1,"p",30)(12,X,2,1,"p",31)(13,Y,2,1,"p",32)(14,te,3,3,"button",33),l()()}if(a&2){let e=t.$implicit,i=g(4);n(4),c("ngIf",e.imagem&&e.imagem!=="-"),n(),c("ngIf",!e.imagem||e.imagem==="-"),n(3),h(e.nome||"Sem nome"),n(),I(T("raridade ",i.getRaridadeClass(e.raridade))),n(),u(" ",e.raridade||"Comum"," "),n(),c("ngIf",e.efeito),n(),c("ngIf",e.colateral),n(),c("ngIf",e.descricao),n(),c("ngIf",i.ehMestre)}}function ae(a,t){if(a&1&&(r(0,"div",15)(1,"div",21),p(2,ie,15,11,"div",22),l()()),a&2){let e=g().$implicit;n(2),c("ngForOf",e.itens)}}function oe(a,t){if(a&1){let e=C();r(0,"div",18)(1,"button",19),m("click",function(){let o=v(e).$implicit,s=g(2);return b(s.toggleCategoria(o))}),r(2,"span"),d(3),l(),r(4,"span"),d(5),l()(),p(6,ae,3,1,"div",20),l()}if(a&2){let e=t.$implicit,i=g(2);c("hidden",!i.pertenceAba(e.nome)),n(3),h(e.nome||"Outros"),n(2),h(e.expandido?"\u2212":"+"),n(),c("ngIf",e.expandido)}}function ne(a,t){if(a&1&&(r(0,"div"),p(1,oe,7,4,"div",17),l()),a&2){let e=g();n(),c("ngForOf",e.categoriasFiltradas)}}var U=class a{constructor(t){this.router=t}categorias=[];categoriasFiltradas=[];carregando=!0;filtro="";abaAtiva="recursos";repo=new w("Catalogo","Catalogo");jogadorRepo=new w("Personagem","Personagem");visibilidadeService=new B(this.repo);ehMestre=!1;loadingVisibilidade={};mapaAbas={recursos:["Recursos bot\xE2nicos","Mineral","Componentes bestiais e animalescos","Tesouro","Moeda"],equipamentos:["Equipamento","Ferramentas","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos"],pocoes:["Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte"],outros:["Outros"]};ngOnInit(){return _(this,null,function*(){this.carregando=!0;try{yield this.definirSeEhMestre(),yield this.loadLocalAndSync()}catch(t){console.error("[Catalogo] Erro ao carregar itens:",t)}finally{this.carregando=!1}})}definirSeEhMestre(){return _(this,null,function*(){let t=N.getUser();if(t?.email){let i=(yield this.jogadorRepo.getLocal()).find(o=>o.email===t.email);this.ehMestre=i?.tipo_jogador==="Mestre"}})}loadLocalAndSync(){return _(this,null,function*(){let t=yield this.repo.getLocal();if(this.processarItens(t),this.repo.sync().then(e=>_(this,null,function*(){if(e){let i=yield this.repo.getLocal();this.processarItens(i)}})),t.length===0){let e=yield this.repo.forceFetch();this.processarItens(e)}})}processarItens(t){let e=new Map(this.categorias.map(o=>[o.nome,o.expandido])),i=new Map;t.filter(o=>this.ehMestre?!0:o.visivel_jogadores).forEach(o=>{let s=o.categoria||"Outros";i.has(s)||i.set(s,[]),i.get(s).push(o)}),this.categorias=Array.from(i.entries()).sort(([o],[s])=>o.localeCompare(s)).map(([o,s])=>({nome:o,itens:s,expandido:e.get(o)??!1})),this.categoriasFiltradas=[...this.categorias]}aplicarFiltro(){let t=this.normalizarTexto(this.filtro);if(!t){this.categoriasFiltradas=[...this.categorias];return}this.categoriasFiltradas=this.categorias.map(e=>{let i=e.itens.filter(o=>[o.nome,o.raridade,o.efeito,o.colateral,o.categoria].map(s=>this.normalizarTexto(String(s||""))).some(s=>s.includes(t)));return y(M({},e),{itens:i,expandido:i.length>0})}).filter(e=>e.itens.length>0)}normalizarTexto(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}selecionarAba(t){this.abaAtiva=t}pertenceAba(t){return this.mapaAbas[this.abaAtiva].includes(t)}toggleCategoria(t){t.expandido=!t.expandido}abrirItem(t){this.router.navigate(["/item-catalogo",t.id])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}getRaridadeClass(t){return t?String(t).toLowerCase():"comum"}toggleVisibilidade(t,e){return _(this,null,function*(){if(t.stopPropagation(),!!this.ehMestre){this.loadingVisibilidade[e.id]=!0;try{let i=yield this.visibilidadeService.toggleVisibilidade(e.index);i&&(e.visivel_jogadores=i.visivel_jogadores)}catch(i){console.error("[Catalogo] Erro ao alternar visibilidade:",i)}finally{this.loadingVisibilidade[e.id]=!1}}})}static \u0275fac=function(e){return new(e||a)(O(z))};static \u0275cmp=k({type:a,selectors:[["app-catalogo"]],decls:24,vars:12,consts:[[1,"catalogo-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light"],[1,"p-3","bg-black","border-bottom","position-sticky","top-0",2,"z-index","10"],["type","text","placeholder","\u{1F50D} Pesquisar no cat\xE1logo...",1,"form-control","search-bar","rounded-pill","px-3",3,"ngModelChange","input","ngModel"],["role","tablist",1,"nav","nav-tabs","bg-dark","px-3"],["role","presentation",1,"nav-item"],[1,"nav-link",3,"click"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"catalogo-container","w-100"],["class","text-center py-5",4,"ngIf"],["class","text-center text-muted py-5",4,"ngIf"],[4,"ngIf"],[1,"fab-stack"],[1,"fab","fab-primary",3,"click"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-light"],[1,"mt-2"],[1,"text-center","text-muted","py-5"],["class","mb-3",3,"hidden",4,"ngFor","ngForOf"],[1,"mb-3",3,"hidden"],[1,"btn","btn-categoria","w-100","d-flex","justify-content-between","align-items-center",3,"click"],["class","mt-2",4,"ngIf"],[1,"row","row-cols-1","g-2"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","catalogo-card","shadow-sm","h-100","p-3","position-relative",3,"click"],[1,"d-flex","align-items-center","mb-2"],[1,"item-thumb","me-3"],[3,"src","alt",4,"ngIf"],["class","text-muted fs-4",4,"ngIf"],[1,"fw-bold","text-white","mb-1"],["class","small mt-2 text-info",4,"ngIf"],["class","small text-danger",4,"ngIf"],["class","small descricao-text fst-italic",4,"ngIf"],["class","btn btn-sm btn-outline-warning position-absolute bottom-0 end-0 m-2 d-flex align-items-center gap-1",3,"disabled","click",4,"ngIf"],[3,"src","alt"],[1,"text-muted","fs-4"],[1,"small","mt-2","text-info"],[1,"small","text-danger"],[1,"small","descricao-text","fst-italic"],[1,"btn","btn-sm","btn-outline-warning","position-absolute","bottom-0","end-0","m-2","d-flex","align-items-center","gap-1",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"input",2),S("ngModelChange",function(s){return D(i.filtro,s)||(i.filtro=s),s}),m("input",function(){return i.aplicarFiltro()}),l()(),r(3,"ul",3)(4,"li",4)(5,"button",5),m("click",function(){return i.selecionarAba("recursos")}),d(6,"\u{1F33F} Recursos"),l()(),r(7,"li",4)(8,"button",5),m("click",function(){return i.selecionarAba("equipamentos")}),d(9,"\u2694\uFE0F Equipamentos"),l()(),r(10,"li",4)(11,"button",5),m("click",function(){return i.selecionarAba("pocoes")}),d(12,"\u{1F9EA} Po\xE7\xF5es"),l()(),r(13,"li",4)(14,"button",5),m("click",function(){return i.selecionarAba("outros")}),d(15,"\u{1F4E6} Outros"),l()()(),r(16,"div",6)(17,"div",7),p(18,J,4,0,"div",8)(19,G,2,0,"div",9)(20,ne,2,1,"div",10),l()(),r(21,"div",11)(22,"button",12),m("click",function(){return i.novoItem()}),d(23,"\uFF0B"),l()()()),e&2&&(n(2),E("ngModel",i.filtro),n(3),f("active",i.abaAtiva==="recursos"),n(3),f("active",i.abaAtiva==="equipamentos"),n(3),f("active",i.abaAtiva==="pocoes"),n(3),f("active",i.abaAtiva==="outros"),n(4),c("ngIf",i.carregando),n(),c("ngIf",!i.carregando&&i.categoriasFiltradas.length===0),n(),c("ngIf",!i.carregando))},dependencies:[j,A,V,L,R,$,q],styles:[".nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid #444}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600}.catalogo-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.catalogo-container[_ngcontent-%COMP%]{width:100%;max-width:900px}.search-bar[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;border:1px solid #444}.search-bar[_ngcontent-%COMP%]:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40}.btn-categoria[_ngcontent-%COMP%]{background:#2a2a2a;color:#f8f9fa;font-weight:600;border-radius:8px;padding:.6rem 1rem;text-align:left}.btn-categoria[_ngcontent-%COMP%]:hover{background:#343a40;color:#fff}.catalogo-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:10px;transition:transform .15s ease;color:#f1f1f1}.catalogo-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);background:#252525}.item-thumb[_ngcontent-%COMP%]{width:55px;height:55px;border-radius:8px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;overflow:hidden}.item-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.item-thumb[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#bbb}.catalogo-card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#fff}.catalogo-card[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ddd}.catalogo-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#e0e0e0;white-space:pre-line}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;border:none;cursor:pointer;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}@media (min-width: 992px){.catalogo-container[_ngcontent-%COMP%]{padding:0 2rem}.fab-stack[_ngcontent-%COMP%]{right:50%;transform:translate(450px)}}.nav-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid #444;scrollbar-width:none}.nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex:1 0 auto;text-align:center}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#aaa;background:transparent;border:none;font-weight:600;padding:.5rem .8rem;display:flex;align-items:center;gap:6px;white-space:nowrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff;background:#2a2a2a;border-radius:8px 8px 0 0}"]})};export{U as Catalogo};
