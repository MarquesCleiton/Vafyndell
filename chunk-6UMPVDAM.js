import{a as _}from"./chunk-HXJSPHLL.js";import{c as N,f as B,g as q,h as z,i as U,j,k as H,m as G,n as Y,o as J,p as K,q as Q,r as X}from"./chunk-2MTP6EBK.js";import"./chunk-2P6BNU5L.js";import{f as W,g as T,j as L,q as R,s as A,v as Z}from"./chunk-HRLERFBW.js";import{Db as y,Eb as v,Fb as S,Jb as E,Lb as I,Pa as D,Qa as d,Va as x,Vb as V,Zb as m,_b as w,a as b,ab as O,cc as u,d as M,dc as f,ec as C,fb as h,ia as c,ja as g,mc as k,wa as F,wb as p,xb as n,yb as a,zb as P}from"./chunk-QQSIVCMV.js";function te(l,r){if(l&1){let i=S();y(0),P(1,"img",26),n(2,"button",27),E("click",function(){c(i);let o=I();return g(o.removerImagem())}),m(3,"\u2716"),a(),v()}if(l&2){let i=I();d(),p("src",i.item.imagem,D)}}function ie(l,r){if(l&1){let i=S();n(0,"label",28)(1,"span",29),m(2,"\u{1F4F7}"),a(),n(3,"input",30),E("change",function(o){c(i);let s=I();return g(s.onFileChange(o))}),a()()}}function ne(l,r){if(l&1&&(n(0,"option"),m(1),a()),l&2){let i=r.$implicit;d(),w(i)}}function ae(l,r){if(l&1&&(n(0,"option"),m(1),a()),l&2){let i=r.$implicit;d(),w(i)}}function oe(l,r){if(l&1&&(n(0,"option"),m(1),a()),l&2){let i=r.$implicit;d(),w(i)}}function re(l,r){if(l&1&&(n(0,"option"),m(1),a()),l&2){let i=r.$implicit;d(),w(i)}}function le(l,r){l&1&&(y(0),m(1,"\u{1F4BE} Salvar"),v())}function de(l,r){l&1&&(y(0),P(1,"span",31),m(2," Salvando... "),v())}var $=class l{constructor(r,i,e){this.router=r;this.el=i;this.route=e}item={index:0,id:0,nome:"",unidade_medida:"",peso:0,categoria:"",origem:"",raridade:"",efeito:"",colateral:"",descricao:"",imagem:"",email:""};salvando=!1;editMode=!1;unidadesMedida=["g","kg","ml","l","cm","m","unidade"];origens=["Fabric\xE1vel","Natural"];raridades=["Comum","Incomum","Raro","\xC9pico","Lend\xE1rio"];categorias=["Recursos bot\xE2nicos","Mineral","Equipamento","Moeda","Tesouro","Componentes bestiais e animalescos","Po\xE7\xE3o de Cura \u2013 Regenera vida, cicatriza feridas","Po\xE7\xE3o Mental \u2013 Calmante, foco, mem\xF3ria, sono, esquecimento","Po\xE7\xE3o de Aprimoramento F\xEDsico \u2013 For\xE7a, resist\xEAncia, agilidade","Po\xE7\xE3o Sensorial \u2013 Vis\xE3o, audi\xE7\xE3o, percep\xE7\xE3o, voz, respira\xE7\xE3o","Po\xE7\xE3o de Furtividade \u2013 Camuflagem, passos suaves, sil\xEAncio","Po\xE7\xE3o de Energia \u2013 Percep\xE7\xE3o da energia fundamental","Veneno \u2013 Sonol\xEAncia, confus\xE3o ou morte","Utilit\xE1rio \u2013 Bombas, armadilhas, luz, som, g\xE1s, adesivos","Ferramentas","Outros"];ngOnInit(){return M(this,null,function*(){let r=this.route.snapshot.paramMap.get("id");if(r){this.editMode=!0;try{let e=(yield _.getLocalItens()).find(o=>String(o.id)===r);if(e&&(this.item=b({},e)),_.syncItens().then(o=>M(this,null,function*(){if(o){console.log("[CadastroItemCatalogo] Sync trouxe altera\xE7\xF5es. Recarregando item...");let t=(yield _.getLocalItens()).find(ee=>String(ee.id)===r);t&&(this.item=b({},t))}})),!e){let s=(yield _.forceFetchItens()).find(t=>String(t.id)===r);s&&(this.item=b({},s))}}catch(i){console.error("[CadastroItemCatalogo] Erro ao carregar item:",i)}}})}ngAfterViewInit(){this.el.nativeElement.querySelectorAll("textarea.auto-expand").forEach(i=>{let e=()=>{i.style.height="auto",i.style.height=Math.min(i.scrollHeight,200)+"px"};i.addEventListener("input",e),e()})}onFileChange(r){let i=r.target;if(i.files&&i.files.length>0){let e=i.files[0],o=new FileReader;o.onload=()=>{this.item.imagem=o.result},o.readAsDataURL(e)}}removerImagem(){this.item.imagem=""}salvar(r){return M(this,null,function*(){if(!r.invalid)try{this.salvando=!0;let i=Z.getUser();if(!i?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.item.email=i.email,this.editMode)yield _.updateItem(this.item),window.alert("\u2705 Item atualizado com sucesso!");else{let o=yield _.getLocalItens(),s=o.length>0?Math.max(...o.map(t=>t.index||0)):0;this.item.index=s+1,this.item.id=s+1,yield _.createItem(this.item),window.alert("\u2705 Item criado com sucesso!")}let e=this.route.snapshot.queryParamMap.get("returnUrl")||"/catalogo";this.router.navigateByUrl(e)}catch(i){console.error("[CadastroItemCatalogo] Erro ao salvar:",i),window.alert("\u274C Erro ao salvar item. Veja o console.")}finally{this.salvando=!1}})}static \u0275fac=function(i){return new(i||l)(x(A),x(F),x(R))};static \u0275cmp=O({type:l,selectors:[["app-cadastro-item-catalogo"]],decls:64,vars:18,consts:[["form","ngForm"],["uploadBox",""],[1,"d-flex","flex-column","min-vh-100","bg-dark","text-light","mb-5"],[1,"flex-grow-1"],[3,"ngSubmit"],[1,"position-relative","text-center","mb-3"],[4,"ngIf","ngIfElse"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body"],[1,"fw-bold","mb-3","text-light"],[1,"mb-3"],[1,"form-label","text-light"],["type","text","name","nome","required","",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","unidadeMedida","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[4,"ngFor","ngForOf"],["type","number","name","peso","min","0",1,"form-control","input-dark",3,"ngModelChange","ngModel"],["name","categoria","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","origem","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","raridade","required","",1,"form-select","input-dark",3,"ngModelChange","ngModel"],["name","descricao",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["name","efeito",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],["name","colateral",1,"form-control","input-dark","auto-expand",3,"ngModelChange","ngModel"],[1,"text-end","mt-4"],["type","submit",1,"btn","btn-save","px-4",3,"disabled"],[4,"ngIf"],["alt","Preview",1,"w-100","rounded","detalhe-img","shadow-sm",3,"src"],["type","button",1,"btn","btn-danger","rounded-circle","position-absolute","d-flex","align-items-center","justify-content-center",2,"top","10px","right","10px","width","40px","height","40px",3,"click"],[1,"upload-box"],[1,"fs-1"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,e){if(i&1){let o=S();n(0,"div",2)(1,"div",3)(2,"form",4,0),E("ngSubmit",function(){c(o);let t=V(3);return g(e.salvar(t))}),n(4,"div",5),h(5,te,4,1,"ng-container",6)(6,ie,4,0,"ng-template",null,1,k),a(),n(8,"div",7)(9,"div",8)(10,"h4",9),m(11,"\u{1F4E6} Cadastro de Item do Cat\xE1logo"),a(),n(12,"div",10)(13,"label",11),m(14,"\u{1F3F7}\uFE0F Nome *"),a(),n(15,"input",12),C("ngModelChange",function(t){return c(o),f(e.item.nome,t)||(e.item.nome=t),g(t)}),a()(),n(16,"div",10)(17,"label",11),m(18,"\u2696\uFE0F Unidade de Medida *"),a(),n(19,"select",13),C("ngModelChange",function(t){return c(o),f(e.item.unidade_medida,t)||(e.item.unidade_medida=t),g(t)}),n(20,"option",14),m(21,"Selecione..."),a(),h(22,ne,2,1,"option",15),a()(),n(23,"div",10)(24,"label",11),m(25,"\u2696\uFE0F Peso"),a(),n(26,"input",16),C("ngModelChange",function(t){return c(o),f(e.item.peso,t)||(e.item.peso=t),g(t)}),a()(),n(27,"div",10)(28,"label",11),m(29,"\u{1F4C2} Categoria *"),a(),n(30,"select",17),C("ngModelChange",function(t){return c(o),f(e.item.categoria,t)||(e.item.categoria=t),g(t)}),n(31,"option",14),m(32,"Selecione..."),a(),h(33,ae,2,1,"option",15),a()(),n(34,"div",10)(35,"label",11),m(36,"\u{1F331} Origem *"),a(),n(37,"select",18),C("ngModelChange",function(t){return c(o),f(e.item.origem,t)||(e.item.origem=t),g(t)}),n(38,"option",14),m(39,"Selecione..."),a(),h(40,oe,2,1,"option",15),a()(),n(41,"div",10)(42,"label",11),m(43,"\u{1F48E} Raridade *"),a(),n(44,"select",19),C("ngModelChange",function(t){return c(o),f(e.item.raridade,t)||(e.item.raridade=t),g(t)}),n(45,"option",14),m(46,"Selecione..."),a(),h(47,re,2,1,"option",15),a()(),n(48,"div",10)(49,"label",11),m(50,"\u{1F4DD} Descri\xE7\xE3o"),a(),n(51,"textarea",20),C("ngModelChange",function(t){return c(o),f(e.item.descricao,t)||(e.item.descricao=t),g(t)}),a()(),n(52,"div",10)(53,"label",11),m(54,"\u2728 Efeito"),a(),n(55,"textarea",21),C("ngModelChange",function(t){return c(o),f(e.item.efeito,t)||(e.item.efeito=t),g(t)}),a()(),n(56,"div",10)(57,"label",11),m(58,"\u26A0\uFE0F Colateral"),a(),n(59,"textarea",22),C("ngModelChange",function(t){return c(o),f(e.item.colateral,t)||(e.item.colateral=t),g(t)}),a()(),n(60,"div",23)(61,"button",24),h(62,le,2,0,"ng-container",25)(63,de,3,0,"ng-container",25),a()()()()()()()}if(i&2){let o=V(3),s=V(7);d(5),p("ngIf",e.item.imagem)("ngIfElse",s),d(10),u("ngModel",e.item.nome),d(4),u("ngModel",e.item.unidade_medida),d(3),p("ngForOf",e.unidadesMedida),d(4),u("ngModel",e.item.peso),d(4),u("ngModel",e.item.categoria),d(3),p("ngForOf",e.categorias),d(4),u("ngModel",e.item.origem),d(3),p("ngForOf",e.origens),d(4),u("ngModel",e.item.raridade),d(3),p("ngForOf",e.raridades),d(4),u("ngModel",e.item.descricao),d(4),u("ngModel",e.item.efeito),d(4),u("ngModel",e.item.colateral),d(2),p("disabled",o.invalid||e.salvando),d(),p("ngIf",!e.salvando),d(),p("ngIf",e.salvando)}},dependencies:[L,W,T,X,j,Y,J,N,H,G,B,q,Q,K,U,z],styles:[".detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.detalhe-img[_ngcontent-%COMP%]{height:200px;object-fit:cover;border-radius:8px}.upload-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:2px dashed #444;border-radius:12px;width:100%;height:140px;background:#1e1e1e;color:#6c757d;cursor:pointer;transition:border .2s ease,color .2s ease}.upload-box[_ngcontent-%COMP%]:hover{border-color:#0d6efd;color:#0d6efd}.input-dark[_ngcontent-%COMP%], .form-control.bg-dark[_ngcontent-%COMP%], .form-select.bg-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border:1px solid #444!important;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]:focus, .form-control.bg-dark[_ngcontent-%COMP%]:focus, .form-select.bg-dark[_ngcontent-%COMP%]:focus{border-color:#0d6efd!important;box-shadow:0 0 0 .2rem #0d6efd40!important;outline:none!important}textarea.auto-expand[_ngcontent-%COMP%]{min-height:80px;resize:vertical;background:#1e1e1e;border:1px solid #444;color:#f8f9fa;border-radius:6px;padding:6px 10px}textarea.auto-expand[_ngcontent-%COMP%]:focus{border-color:#0d6efd;outline:none;box-shadow:0 0 0 .2rem #0d6efd40}.btn-save[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#218838);border:none;color:#fff;font-weight:600;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .2s ease-in-out}.btn-save[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#34d058,#28a745);transform:translateY(-2px);box-shadow:0 4px 10px #0000004d}.btn-save[_ngcontent-%COMP%]:disabled{background:#444!important;color:#bbb!important;cursor:not-allowed;box-shadow:none}.btn-save[_ngcontent-%COMP%]{margin-left:auto}"]})};export{$ as CadastroItemCatalogo};
