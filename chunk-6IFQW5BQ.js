import{a as at,d as ot,e as rt,h as lt,o as dt,p as ct,q as st,r as mt,u as pt,v as gt}from"./chunk-M6SXYBRE.js";import{a as B,b as W}from"./chunk-NNCKLQ3D.js";import{I as G,L as Q}from"./chunk-CIU33VZW.js";import{a as nt}from"./chunk-XQNWO7VY.js";import{c as H,f as J,g as K,h as X,i as Y,j as Z,k as $,p as tt,q as et,r as it}from"./chunk-4AXINNVO.js";import{a as A}from"./chunk-IDK3EA3G.js";import{f as j,g as N,m as z,t as L,v as U,z as F}from"./chunk-JZWR3MRG.js";import{Ab as m,Bb as o,Cb as l,Db as C,Hb as h,Ib as I,Jb as S,Nb as u,Pb as b,Sa as M,Ua as d,Za as y,Zb as _,a as w,b as x,bc as c,cc as E,dc as R,eb as q,ec as T,g as f,gc as O,hc as D,ic as P,jb as v,la as p,ma as g,qc as k}from"./chunk-HRDPHWQR.js";function ft(n,i){if(n&1){let e=S();o(0,"mat-option",30),u("click",function(){p(e);let a=b();return g(a.novoItem())}),o(1,"mat-icon",31),c(2,"add_circle"),l(),c(3," Novo "),l()}}function vt(n,i){if(n&1&&(h(0),C(1,"img",35),I()),n&2){let e=b().$implicit;d(),m("src",e.imagem,M)}}function _t(n,i){n&1&&(o(0,"span",31),c(1,"\u{1F4E6}"),l())}function ht(n,i){if(n&1&&(o(0,"mat-option",32)(1,"div",33),v(2,vt,2,1,"ng-container",34)(3,_t,2,0,"ng-template",null,2,k),o(5,"span"),c(6),l()()()),n&2){let e=i.$implicit,t=_(4);m("value",e),d(2),m("ngIf",e.imagem&&e.imagem!=="-")("ngIfElse",t),d(4),E(e.nome)}}function It(n,i){if(n&1&&(h(0),C(1,"img",39),I()),n&2){let e=b(2);d(),m("src",e.selecionado.imagem,M)}}function bt(n,i){n&1&&(o(0,"span",40),c(1,"\u{1F4E6}"),l())}function Ct(n,i){if(n&1&&(o(0,"div",36)(1,"div",33),v(2,It,2,1,"ng-container",34)(3,bt,2,0,"ng-template",null,3,k),o(5,"div")(6,"h6",37),c(7),l(),o(8,"small",38),c(9),l()()()()),n&2){let e=_(4),t=b();d(2),m("ngIf",t.selecionado.imagem&&t.selecionado.imagem!=="-")("ngIfElse",e),d(5),E(t.selecionado.nome),d(2),T(" ",t.selecionado.categoria," | ",t.selecionado.raridade," ")}}function wt(n,i){n&1&&(h(0),c(1,"\u{1F4BE}"),I())}function xt(n,i){n&1&&(h(0),C(1,"span",41),I())}var ut=class n{constructor(i,e){this.router=i;this.route=e}catalogoItens=[];catalogoFiltrado=[];selecionado=null;filtro="";quantidade=1;salvando=!1;editando=!1;inventarioAtual=null;catalogoRepo=new A("Catalogo");inventarioRepo=new A("Inventario");ngOnInit(){return f(this,null,function*(){try{console.log("[CadastroInventario] \u25B6\uFE0F Iniciando carregamento..."),this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens,this.catalogoRepo.sync().then(e=>f(this,null,function*(){e&&(console.log("[CadastroInventario] Cat\xE1logo atualizado."),this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens)}));let i=this.route.snapshot.paramMap.get("id");if(i){this.editando=!0;let e=F.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado.");let t=yield this.inventarioRepo.getLocal();if(this.inventarioAtual=t.find(a=>String(a.id)===String(i)&&a.jogador===e.email)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual)),this.inventarioRepo.sync().then(a=>f(this,null,function*(){if(a){let s=(yield this.inventarioRepo.getLocal()).find(V=>String(V.id)===String(i)&&V.jogador===e.email);s&&(this.inventarioAtual=s,yield this.carregarItemSelecionado(this.inventarioAtual))}})),!this.inventarioAtual){let a=yield this.inventarioRepo.forceFetch();this.inventarioAtual=a.find(r=>String(r.id)===String(i)&&r.jogador===e.email)||null,this.inventarioAtual&&(yield this.carregarItemSelecionado(this.inventarioAtual))}}}catch(i){console.error("[CadastroInventario] \u274C Erro ao carregar:",i)}})}carregarItemSelecionado(i){return f(this,null,function*(){this.catalogoItens.length||(this.catalogoItens=yield this.catalogoRepo.getLocal(),this.catalogoFiltrado=this.catalogoItens),this.selecionado=this.catalogoItens.find(e=>String(e.id)===String(i.item_catalogo))||null,this.quantidade=i.quantidade,this.filtro=this.selecionado?.nome||""})}filtrarItens(){let i=t=>(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),e=i(this.filtro||"");this.catalogoFiltrado=e?this.catalogoItens.filter(t=>i(t.nome).includes(e)):[...this.catalogoItens]}selecionarItem(i){this.selecionado=i,this.filtro=i.nome}incrementar(){this.quantidade++}decrementar(){this.quantidade=Math.max(1,this.quantidade-1)}cancelar(){this.editando&&this.inventarioAtual?.id?this.router.navigate(["/item-inventario",this.inventarioAtual.id]):this.router.navigate(["/inventario-jogador"])}novoItem(){this.router.navigate(["/cadastro-item-catalogo"])}salvar(i){return f(this,null,function*(){if(!(i.invalid||!this.selecionado))try{this.salvando=!0;let e=F.getUser();if(!e?.email)throw new Error("Usu\xE1rio n\xE3o autenticado");if(this.editando&&this.inventarioAtual){let t=x(w({},this.inventarioAtual),{jogador:e.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade});yield this.inventarioRepo.update(t)}else{let a=(yield this.inventarioRepo.getLocal()).find(r=>r.jogador===e.email&&r.item_catalogo===this.selecionado.id);if(a){let r=x(w({},a),{quantidade:(a.quantidade||0)+this.quantidade});yield this.inventarioRepo.update(r)}else{let r={id:nt.generateULID(),index:Date.now(),jogador:e.email,item_catalogo:this.selecionado.id,quantidade:this.quantidade};yield this.inventarioRepo.create(r)}}alert("\u2705 Item salvo no invent\xE1rio!"),this.router.navigate(["/inventario-jogador"])}catch(e){console.error("[CadastroInventario] \u274C Erro ao salvar:",e),alert("\u274C Erro ao salvar item.")}finally{this.salvando=!1}})}displayFn(i){return i?i.nome:""}static \u0275fac=function(e){return new(e||n)(y(U),y(L))};static \u0275cmp=q({type:n,selectors:[["app-cadastro-inventario"]],decls:38,vars:11,consts:[["form","ngForm"],["auto","matAutocomplete"],["noItemIcon",""],["noPreviewIcon",""],[1,"inventario-cadastro-wrapper","d-flex","flex-column","min-vh-100","bg-dark","text-light","pb-5","mb-5"],[1,"flex-grow-1","p-3","d-flex","justify-content-center"],[1,"inventario-cadastro-container","w-100"],["id","formInventario",3,"ngSubmit"],[1,"card","detalhe-card","shadow-lg","border-0"],[1,"card-body","p-3","border-bottom","d-flex","align-items-center","gap-2"],[1,"fw-bold","mb-0","text-light"],[1,"card-body"],[1,"mb-3"],[1,"form-label","text-light","fw-bold"],["appearance","fill",1,"w-100","input-dark","compact-select","dropdown-field"],["type","text","matInput","","placeholder","Selecione ou pesquise...","name","filtro",3,"ngModelChange","input","ngModel","matAutocomplete","readonly"],["mat-icon-button","","matSuffix","","disabled","",1,"dropdown-arrow"],[3,"optionSelected"],["class","text-success bg-dark",3,"click",4,"ngIf"],["class","bg-dark text-light",3,"value",4,"ngFor","ngForOf"],["class","preview-card mb-3",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"form-label","text-light","fw-bold","mb-0","me-3"],[1,"quantidade-box"],["type","button",1,"btn","btn-sm","btn-outline-light",3,"click"],["type","number","name","quantidade","min","1","required","",1,"quantidade-input",3,"ngModelChange","ngModel"],[1,"fab-stack"],["type","button",1,"fab","fab-warning",3,"click"],["type","submit","form","formInventario",1,"fab","fab-primary",3,"disabled"],[4,"ngIf"],[1,"text-success","bg-dark",3,"click"],[1,"me-2"],[1,"bg-dark","text-light",3,"value"],[1,"d-flex","align-items-center"],[4,"ngIf","ngIfElse"],[1,"me-2","rounded",2,"width","24px","height","24px","object-fit","cover",3,"src"],[1,"preview-card","mb-3"],[1,"fw-bold","text-light","mb-1"],[1,"text-light"],[1,"me-3","rounded","preview-img",3,"src"],[1,"me-3"],[1,"spinner-border","spinner-border-sm"]],template:function(e,t){if(e&1){let a=S();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"form",7,0),u("ngSubmit",function(){p(a);let s=_(4);return g(t.salvar(s))}),o(5,"div",8)(6,"div",9)(7,"h4",10),c(8),l()(),o(9,"div",11)(10,"div",12)(11,"label",13),c(12,"\u{1F3F7}\uFE0F Item *"),l(),o(13,"mat-form-field",14)(14,"input",15),P("ngModelChange",function(s){return p(a),D(t.filtro,s)||(t.filtro=s),g(s)}),u("input",function(){return p(a),g(t.filtrarItens())}),l(),o(15,"button",16)(16,"mat-icon"),c(17,"arrow_drop_down"),l()(),o(18,"mat-autocomplete",17,1),u("optionSelected",function(s){return p(a),g(t.selecionarItem(s.option.value))}),v(20,ft,4,0,"mat-option",18)(21,ht,7,4,"mat-option",19),l()()(),v(22,Ct,10,5,"div",20),o(23,"div",21)(24,"label",22),c(25,"\u{1F522} Quantidade *"),l(),o(26,"div",23)(27,"button",24),u("click",function(){return p(a),g(t.decrementar())}),c(28,"\u2212"),l(),o(29,"input",25),P("ngModelChange",function(s){return p(a),D(t.quantidade,s)||(t.quantidade=s),g(s)}),l(),o(30,"button",24),u("click",function(){return p(a),g(t.incrementar())}),c(31,"+"),l()()()()()()()(),o(32,"div",26)(33,"button",27),u("click",function(){return p(a),g(t.cancelar())}),c(34,"\u2B05\uFE0F"),l(),o(35,"button",28),v(36,wt,2,0,"ng-container",29)(37,xt,2,0,"ng-container",29),l()()()}if(e&2){let a=_(4),r=_(19);d(8),R(" \u{1F392} ",t.editando?"Editar Item do Invent\xE1rio":"Adicionar ao Invent\xE1rio"," "),d(6),O("ngModel",t.filtro),m("matAutocomplete",r)("readonly",t.editando),d(6),m("ngIf",!t.editando),d(),m("ngForOf",t.catalogoFiltrado),d(),m("ngIf",t.selecionado),d(7),O("ngModel",t.quantidade),d(6),m("disabled",a.invalid||t.salvando),d(),m("ngIf",!t.salvando),d(),m("ngIf",t.salvando)}},dependencies:[z,j,N,it,Z,H,$,J,K,et,tt,Y,X,rt,ot,at,mt,ct,lt,st,gt,pt,dt,W,B,Q,G],styles:[".inventario-cadastro-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.inventario-cadastro-container[_ngcontent-%COMP%]{width:100%;max-width:900px;margin:0 auto}.detalhe-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;overflow:hidden}.input-dark[_ngcontent-%COMP%]{background:#1e1e1e!important;border-radius:6px;color:#f8f9fa!important}.input-dark[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#f8f9fa!important}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.compact-select[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{padding:.25rem .5rem}.compact-select[_ngcontent-%COMP%]   .mat-select-trigger[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.dropdown-field[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.dropdown-arrow[_ngcontent-%COMP%]{pointer-events:none;color:#bbb!important;margin-left:auto}.dropdown-arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.4rem}.preview-card[_ngcontent-%COMP%]{background:#6c757d33;border-radius:.5rem;padding:.5rem .75rem;text-align:left}.preview-img[_ngcontent-%COMP%]{width:50px;height:50px;object-fit:cover;border-radius:.5rem;border:1px solid #6c757d}.quantidade-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.quantidade-input[_ngcontent-%COMP%]{width:60px;text-align:center;font-weight:700;border:1px solid #6c757d;border-radius:.4rem;background:#212529;color:#f8f9fa;padding:.2rem;font-size:.85rem}.fab-stack[_ngcontent-%COMP%]{position:fixed;bottom:70px;right:20px;display:flex;flex-direction:column-reverse;gap:15px;z-index:1000}.fab[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;font-size:1.6rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px #0006;transition:transform .2s ease}.fab[_ngcontent-%COMP%]:hover{transform:scale(1.08)}.fab-primary[_ngcontent-%COMP%]{background:#0d6efd;color:#fff}.fab-primary[_ngcontent-%COMP%]:hover{background:#0b5ed7}.fab-warning[_ngcontent-%COMP%]{background:#ffc107;color:#000}.fab-warning[_ngcontent-%COMP%]:hover{background:#e0a800}@media (min-width: 992px){.inventario-cadastro-container[_ngcontent-%COMP%]{padding:0 2rem}.detalhe-card[_ngcontent-%COMP%]{border-radius:16px}.fab-stack[_ngcontent-%COMP%]{right:calc(50% - 430px)}}"]})};export{ut as CadastroInventario};
